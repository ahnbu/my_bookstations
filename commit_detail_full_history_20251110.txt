13c2f89
ahnbu
Mon Nov 10 13:18:14 2025 +0900
refactor(UX): 재고 정보 표시 UX 개선 및 안정성 강화
사용자 경험(UX)을 개선하기 위해 내 서재의 도서관 재고 정보 표시 방식을 리팩토링했습니다. 이번 변경의 핵심 목표는 API의 일시적인 실패가 사용자에게 불필요한 스트레스를 주지 않도록 하고, 정보의 성격에 따라 표시 방식을 달리하는 것입니다.

### 주요 변경 사항

1.  **목록 뷰(내 서재)의 안정성 강화:**
    -   `MyLibraryListItem`의 재고 태그(`LibraryTag`)는 이제 API 갱신 실패 여부(`isError`)를 색상에 반영하지 않습니다.
    -   오직 DB에 저장된 마지막 성공 데이터(`stock_*` 컬럼)만을 기준으로 색상을 표시하여, API가 일시적으로 실패하더라도 목록에서는 항상 안정적인 정보(녹색/회색)가 보이도록 수정했습니다.

2.  **상세 뷰(상세 모달)의 정확성 유지:**
    -   `MyLibraryBookDetailModal`의 재고 표시(`StockDisplay`) 로직은 그대로 유지하여, 상세 정보 확인 시에는 API 갱신 실패 상태를 명확하게 인지할 수 있도록 했습니다. (빨간색 및 `(에러)` 텍스트 표시)

3.  **신규 도서 추가 시 UX 개선:**
    -   새 책을 서재에 추가할 때, 재고 정보가 조회되기 전까지의 초기 상태가 '에러'(빨간색)로 잠시 표시되던 문제를 해결했습니다.
    -   이제는 '정보 없음'(회색)으로 표시되다가 API 응답 후 상태가 변경되어, 훨씬 더 자연스럽고 안정적인 사용자 경험을 제공합니다.

이번 리팩토링은 "점진적 정보 공개(Progressive Disclosure)" 원칙에 따라, 목록에서는 간결하고 안정적인 정보를, 상세 뷰에서는 정확하고 상세한 상태 정보를 제공하도록 역할을 명확히 분리했습니다.


bfbcb59
ahnbu
Mon Nov 10 12:42:20 2025 +0900
refactor(Core): 스키마 버전 관리 시스템 제거 및 코드 단순화
기존에 도입했던 `schemaVersion` 기반의 동적 데이터 마이그레이션 시스템을 폐기하고, 개발자가 직접 SQL로 마이그레이션을 관리하는 표준 방식으로 아키텍처를 변경함에 따라 관련 코드를 모두 정리했습니다.

이 변경은 데이터베이스의 일관성을 완벽하게 보장하고, 애플리케이션 코드의 복잡성을 크게 낮추기 위함입니다.

### 주요 변경 사항

1.  **`useAppStore` 및 관련 로직 제거:**
    -   DB에서 스키마 버전을 동적으로 가져오던 `useAppStore`를 완전히 삭제했습니다.
    -   `App.tsx`에서 앱 초기화 시 스키마 버전을 불러오던 로직과 로딩 화면을 제거하여 앱 시작 절차를 단순화했습니다.

2.  **`schemaVersion` 속성 제거:**
    -   `types.ts`의 `BookData` 타입 정의와 `useBookStore`의 관련 로직에서 `schemaVersion` 속성을 모두 제거했습니다.
    -   DB의 `user_library` 테이블에 있는 `book_data` JSON 필드에서도 `schemaVersion` 키를 제거하는 일회성 SQL 마이그레이션을 수행했습니다.

3.  **캐시 우회 로직 단순화:**
    -   `refreshBookInfo` 함수에서 `schemaVersion`을 비교하여 캐시 우회 여부(`isDbSchemaChanged`)를 결정하던 로직을 제거했습니다.
    -   이제 캐시 갱신은 Cloudflare의 TTL(12시간) 정책을 따르거나, 필요한 경우 수동으로 캐시를 무효화하는 방식으로 관리됩니다.

이번 코드 정리를 통해 애플리케이션은 더 이상 여러 버전의 데이터 스키마를 고려할 필요가 없어졌으며, 데이터 마이그레이션에 대한 책임 소재를 명확히 하여 장기적인 유지보수성을 향상시켰습니다.


8bdb854
ahnbu
Mon Nov 10 12:02:52 2025 +0900
프로젝트의 핵심 데이터인 도서관 재고 정보의 안정성과 일관성을 확보하고, 향후 확장성을 개선하기 위해 데이터베이스 스키마와 관련 로직을 전면적으로 리팩토링했습니다.
이번 리팩토링의 핵심 목표는 크롤링 API의 간헐적 실패에도 데이터가 유실되지 않는 견고한 시스템을 구축하는 것입니다.

### 주요 변경 사항

#### 1. DB 스키마 변경: 재고 정보 컬럼 분리
- **`user_library` 테이블에 도서관별 재고 정보를 저장할 12개의 `stock_*` 컬럼을 신규 추가했습니다.** (`stock_gwangju_toechon_total` 등)
- 이는 변동성이 높은 API 응답 결과와 안정적으로 유지되어야 할 재고 데이터를 분리하여 관리하기 위함입니다.
- 향후 재고 기반 필터링 및 검색 성능을 위해 `_total` 컬럼들에 인덱스를 추가했습니다.

#### 2. 데이터 마이그레이션 및 정합성 확보
- 기존 `book_data` JSON에 저장되어 있던 재고 정보를 새로 추가된 `stock_*` 컬럼으로 이전하는 일회성 마이그레이션을 완료했습니다.
- 마이그레이션 전/후 데이터 검증 쿼리를 통해 JSON 내부 데이터와 신규 컬럼 데이터 간의 정합성을 100% 확인했습니다.
- `book_data.siripEbookInfo` 객체 내에 `availableCountOwned`, `availableCountSubs` 필드를 추가하여 데이터 구조의 일관성을 높였습니다.

#### 3. 프론트엔드 데이터 흐름 재설계 (`useBookStore`)
- **`refreshBookInfo` 로직 강화 (핵심 변경):**
    - **"선택적 폴백(Fallback)" 전략을 도입**하여, API 호출이 실패하더라도 기존의 유효한 `book_data`가 유실되지 않도록 데이터를 보호합니다.
    - `schemaVersion`을 이용한 런타임 마이그레이션 로직을 폐기하고, 표준적인 DB 마이그레이션 절차를 따르도록 아키텍처를 단순화했습니다.
    - 데이터 업데이트 시, `book_data` JSON과 `stock_*` 컬럼이 **동일한 API 원본으로부터 함께 업데이트**되도록 하여 데이터 불일치 위험을 원천적으로 차단했습니다.
- **데이터 조회 로직 수정:**
    - `fetchUserLibrary`, `getBookById` 등 모든 DB 조회 함수가 새로운 `stock_*` 컬럼을 함께 가져오도록 `select` 구문을 수정했습니다.
    - 반복되는 로직을 `mapDbItemToSelectedBook` 헬퍼 함수로 중앙화하여 코드 중복을 줄였습니다.

#### 4. UI 컴포넌트 수정
- `MyLibraryListItem`과 `MyLibraryBookDetailModal`의 재고 표시 컴포넌트(`LibraryTag`, `StockDisplay`)가 더 이상 복잡한 `book_data` JSON 경로를 참조하지 않고, **새롭게 추가된 최상위 `stock_*` 컬럼을 직접 참조**하도록 수정했습니다.
- 이를 통해 UI 코드의 가독성과 안정성이 크게 향상되었습니다.

#### 5. 백엔드 API (Cloudflare Worker) 수정
- `siripEbook` API 응답 객체에 `availableCountOwned`, `availableCountSubs` 필드를 추가하여, 클라이언트의 계산 부담을 줄이고 서버의 책임을 강화했습니다.

이번 리팩토링을 통해 애플리케이션은 API의 일시적인 오류에 훨씬 더 탄력적으로 대응할 수 있게 되었으며, 향후 재고 관련 기능 확장을 위한 견고한 데이터 기반을 마련했습니다.


13e9aad
ahnbu
Mon Nov 10 10:44:51 2025 +0900
fix(Store): 데이터 업데이트 시 `id`, `note` 누락 문제 해결 및 로직 안정화
### 📝 요약 (Summary)

`book_data` JSON 컬럼에 `id`와 `note`를 포함하여 저장하는 현재 DB 구조와 `useBookStore`의 데이터 업데이트 로직 간의 불일치 문제를 해결했습니다. 이로 인해 일괄 갱신 시 `id`, `note`가 누락되거나, 개별 갱신 시 데이터가 손상되던 문제를 모두 수정하여 데이터 일관성을 확보했습니다.

### 🧐 문제 상황 (Problem)

1.  **잘못된 가정:** `updateBookInStoreAndDB` 함수는 `id`와 `note`가 `book_data` 외부에 있는 별도 컬럼이라는 잘못된 가정 하에, 업데이트 시마다 `book_data`에서 이 두 필드를 **제거**하고 있었습니다.
2.  **일괄 갱신 시 데이터 누락:** 스키마가 다른 오래된 데이터를 일괄 갱신할 때, "전체 덮어쓰기" 로직이 `originalBook`의 `id`와 `note`를 참조하지 않아, 최종적으로 `book_data`에서 `id`, `note`가 누락된 채로 DB에 저장되었습니다.
3.  **개별 갱신 시 데이터 손상:** 개별 갱신 역시 `id`, `note`를 제거하는 로직을 수행하여 DB 데이터를 손상시키고 있었습니다. 이는 낙관적 UI 업데이트 때문에 즉시 드러나지 않았을 뿐, 근본적으로 동일한 문제였습니다.

### ✨ 해결 방안 (Solution)

1.  **`updateBookInStoreAndDB` 로직 수정:**
    -   `book_data`에서 `id`와 `note`를 제거하는 코드를 삭제했습니다.
    -   이제 `book_data` 컬럼에는 항상 `id`와 `note`가 포함된 완전한 `SelectedBook` 객체의 복사본이 저장됩니다.
    -   어떤 업데이트든 최상위 `note` 컬럼도 항상 함께 동기화하도록 로직을 보강했습니다.

2.  **`refreshBookInfo` 로직 강화:**
    -   "전체 덮어쓰기(마이그레이션)" 로직이 실행될 때, 함수 파라미터로 받은 `id`와 `originalBook`의 `note`를 최종 데이터 객체(`updatedBookForUI`)에 명시적으로 다시 조합하도록 수정했습니다.
    -   이를 통해 `originalBook`의 상태와 관계없이, DB에 저장되는 데이터의 무결성을 보장합니다.
    -   DB 업데이트 실패 시 `catch` 블록으로 에러를 전파하여 UI 롤백이 정상적으로 실행되도록 `if (error) throw error;` 구문을 복원했습니다.

### 🎯 기대 효과 (Expected Benefits)

-   **데이터 일관성 확보:** 이제 개별/일괄 갱신, 태그 수정 등 모든 업데이트 작업에서 `book_data`는 항상 `id`와 `note`를 포함한 완전한 스키마를 유지합니다.
-   **버그 해결:** 일괄 갱신 시 `id`, `note`가 누락되던 문제와, 개별 갱신 시 DB 데이터가 손상되던 문제가 모두 해결되었습니다.
-   **안정성 향상:** DB 업데이트 실패 시 롤백 로직이 안정적으로 동작하여 UI와 DB 간의 데이터 불일치 가능성을 차단했습니다.


3325dff
ahnbu
Sun Nov 9 17:32:39 2025 +0900
feat(Core): DB 부분 업데이트 기능과 DB 구조 변경시 대응로직 개선
## 핵심

- DB 구조나 변수명이 변경되면, 에러 여부 상관없이 DB와 캐싱 업데이트
- (DB구조가 동일한 것을 체크한 후에) API응답이 일부만 변경되면, 해당 부분만 업데이트

## feat(Core): DB 스키마 버전을 이용한 자동화된 데이터 마이그레이션 시스템 구축

### 📝 요약 (Summary)

데이터 스키마 변경에 안전하고 유연하게 대응하기 위해, DB에 저장된 개별 데이터의 스키마 버전과 현재 코드의 스키마 버전을 비교하는 시스템을 도입했습니다. 이를 통해 과거 스키마의 데이터는 자동으로 최신 스키마로 마이그레이션되며, 이 과정에서 백엔드 캐시가 지능적으로 관리됩니다.

### ✨ 주요 변경 사항 (Key Changes)

1.  **DB 스키마 버전 필드 추가:**
    -   프론트엔드 `types.tsx`의 `BookData` 타입에 `schemaVersion` 속성을 추가하여 데이터 구조의 버전을 기록할 수 있는 기반을 마련했습니다.

2.  **스키마 비교에 따른 DB 업데이트 및 캐시 전략 분기:**
    -   책 정보 새로고침(`refreshBookInfo`) 시, DB에 저장된 `schemaVersion`과 코드의 현재 버전을 비교합니다.
    -   **[스키마 불일치 시]**: 데이터 마이그레이션을 위해 백엔드에 캐시를 우회하도록 요청(`isDbSchemaChanged: true`)하고, API로부터 받은 최신 데이터를 기반으로 DB 레코드를 **안전하게 전체 덮어쓰기**합니다.
    -   **[스키마 일치 시]**: 효율성을 위해 백엔드 캐시를 사용하고, API 응답에 부분적인 실패가 있더라도 성공한 데이터는 유지하는 **지능형 부분 업데이트**를 수행합니다.

3.  **DB 기반 동적 버전 관리 도입 (자동화):**
    -   기존의 하드코딩된 버전 상수를 제거하고, Supabase `app_metadata` 테이블에서 최신 스키마 버전을 동적으로 가져오도록 시스템을 고도화했습니다.
    -   앱 시작 시 최신 버전을 로드하는 `useAppStore`를 신설하고, 모든 로직이 이 중앙화된 버전 정보를 참조하도록 수정했습니다.

4.  **신규 데이터 버전 기록:**
    -   새 책을 서재에 추가할 때(`addToLibrary`), DB에서 가져온 최신의 `schemaVersion`을 자동으로 기록하도록 수정했습니다. 이를 통해 신규 데이터가 구버전으로 잘못 인식되는 문제를 해결했습니다.

### 🎯 기대 효과 (Expected Benefits)

-   **안전한 데이터 마이그레이션:** `isAvailable` -> `loanStatus`와 같은 스키마 변경이 발생하더라도, 사용자의 데이터는 다음번 새로고침 시 자동으로, 그리고 데이터 손실 없이 최신 구조로 업데이트됩니다.
-   **지능적인 캐시 관리:** 오래된 스키마의 캐시 데이터가 최신 코드와 충돌하는 문제를 원천적으로 차단하고, 스키마 마이그레이션이 필요한 경우에만 캐시를 자동으로 갱신합니다.
-   **향상된 유지보수성:** 향후 스키마 변경 시, 개발자는 DB의 버전 숫자만 수정하면 되므로, 복잡한 마이그레이션 스크립트 없이도 시스템 전체가 변화에 자동으로 대응할 수 있습니다.

## feat(Core): DB 기반의 동적 스키마 버전 관리 시스템 도입

### 📝 요약 (Summary)

기존에 프론트엔드 코드에 하드코딩 되어 있던 데이터 스키마 버전을 Supabase DB에서 동적으로 가져와 관리하는 시스템을 구축했습니다. 이를 통해 향후 데이터 구조 변경 시 코드 재배포 없이 안정적인 데이터 마이그레이션과 캐시 관리가 가능해졌습니다.

### ✨ 주요 변경 사항 (Key Changes)

1.  **DB 기반 버전 관리 도입:**
    -   `app_metadata` 테이블을 Supabase에 신설하여 `book_data`의 현재 스키마 버전을 중앙에서 관리합니다.
    -   모든 사용자가 읽을 수 있도록 RLS 정책을 설정했습니다.

2.  **전역 상태 관리 스토어 신설 (`useAppStore`):**
    -   앱 시작 시 DB에서 최신 스키마 버전을 가져와 전역 상태로 관리하는 `useAppStore`를 구현했습니다.
    -   `App.tsx`에 초기화 로직(`initializeApp`)을 추가하여, 앱 로드 시 스키마 버전을 우선적으로 불러오도록 수정했습니다.

3.  **캐시 우회 및 마이그레이션 로직 자동화:**
    -   `useBookStore`의 `refreshBookInfo` 함수가 DB의 `schemaVersion`과 `useAppStore`의 최신 버전을 비교하도록 로직을 변경했습니다.
    -   버전 불일치 시, 백엔드(`library-checker`)에 캐시를 우회하도록 요청(`isDbSchemaChanged: true`)하여 최신 데이터를 강제로 가져옵니다.
    -   가져온 최신 데이터를 기반으로 DB 레코드를 안전하게 덮어쓰는(마이그레이션) 로직을 완성했습니다.

4.  **신규 데이터 버전 기록:**
    -   `addToLibrary` 함수를 수정하여, 새로 추가되는 책 데이터에 현재의 최신 스키마 버전을 자동으로 기록하도록 했습니다. 이로써 신규 데이터가 구버전으로 취급되는 문제를 해결했습니다.

### 🎯 기대 효과 (Expected Benefits)

-   **유지보수성 향상:** 향후 스키마 변경 시, DB의 버전 숫자만 변경하면 모든 클라이언트가 자동으로 마이그레이션 로직을 수행하므로 관리가 매우 용이해집니다.
-   **안정성 강화:** 개발자의 수동 버전 관리 실수를 원천적으로 차단하고, 오래된 캐시 데이터로 인한 데이터 오염 문제를 해결하여 시스템의 안정성을 크게 높였습니다.
-   **확장성 확보:** `app_metadata` 테이블을 통해 향후 `user_settings` 등 다른 데이터의 스키마 버전도 중앙에서 통합 관리할 수 있는 기반을 마련했습니다.


01e82f8
ahnbu
Sun Nov 9 15:42:32 2025 +0900
feat(Refactor): API 응답의 `loanStatus` 타입을 boolean으로 단일화
### 📝 요약 (Summary)

프로젝트 전반에 걸쳐 혼용되던 대출 상태(`loanStatus`)의 데이터 타입을 `boolean`으로 통일했습니다. 기존에는 `'대출가능'/'대출불가'`와 같은 문자열과 `true/false`가 혼재되어 있었으나, 이제부터 모든 API 응답과 내부 데이터 구조는 `loanStatus: boolean` 형태를 따릅니다.

### ✨ 개선 사항 (Improvements)

1.  **데이터 일관성 확보**:
    -   Cloudflare Worker(백엔드)의 모든 파싱 함수(`parseGwangjuPaperHTML`, `parseGyeonggiEduHTML` 등)가 `loanStatus`를 `boolean`으로 변환하여 반환하도록 수정했습니다.
    -   이에 맞춰 `library-checker`와 프론트엔드의 TypeScript 타입 정의(`*.types.ts`)를 모두 갱신했습니다.

2.  **코드 단순성 및 가독성 향상**:
    -   프론트엔드 컴포넌트 및 헬퍼 함수에서 `'대출가능'` 문자열과 비교하던 복잡한 로직을 제거했습니다.
    -   이제 `if (book.loanStatus)` 와 같이 직관적이고 간결한 조건문으로 대출 가능 여부를 확인할 수 있습니다.

3.  **잠재적 버그 제거**:
    -   TypeScript가 타입 불일치 오류를 컴파일 타임에 감지할 수 있게 되어 런타임 에러 발생 가능성을 원천적으로 차단했습니다. (`boolean`과 `string` 비교 오류 해결)

### 🎯 영향 범위 (Impact Scope)

-   **Backend (`library-checker`):**
    -   `src/index.tsx`: 파싱 함수 로직 수정
    -   `src/types.tsx`: 인터페이스 타입 정의 수정
-   **Frontend:**
    -   `services/unifiedLibrary.service.ts`: `loanStatus` 관련 헬퍼 함수 로직 수정
    -   `types.tsx`: `PaperBookAvailability`, `gyeonggiEduEbookList` 타입 정의 수정

이번 리팩토링을 통해 코드의 안정성과 유지보수성이 크게 향상되었습니다.


a0896c8
ahnbu
Sun Nov 9 14:52:18 2025 +0900
fix(UI): 상세 모달에서 발생하는 TypeError 수정 및 안정성 강화
### 📝 요약 (Summary)

`MyLibraryBookDetailModal` 컴포-넌트에서 시립도서관 전자책 재고(`siripEbookInfo`) 정보가 `null`일 때, 하위 속성인 `.bookList`에 접근하려다 발생하는 `TypeError: Cannot read properties of undefined (reading 'filter')` 오류를 수정했습니다.

### 🧐 원인 (Cause)

-   API 응답이 아직 없거나 실패한 경우, `book.siripEbookInfo` 객체는 `null` 또는 `undefined`가 될 수 있습니다.
-   기존 코드에서는 `book.siripEbookInfo`가 `null`인 상황을 고려하지 않고 `.bookList` 속성에 직접 접근하여 `.filter()` 메서드를 호출했기 때문에 런타임 에러가 발생했습니다.

### ✨ 해결 (Solution)

**옵셔널 체이닝(`?.`)**을 사용하여 `bookList` 속성에 안전하게 접근하도록 코드를 수정했습니다. 이를 통해 중첩된 객체의 각 단계가 유효한지 먼저 확인하고, 유효하지 않으면 즉시 `undefined`를 반환하여 에러를 방지합니다.

#### 코드 변경 사항:

-   **Before:**
    ```typescript
    // book.siripEbookInfo가 null이면 에러 발생
    availableCount={... ? book.siripEbookInfo.bookList.filter(...) : ...}
    ```

-   **After:**
    ```typescript
    // book.siripEbookInfo 또는 bookList가 null/undefined여도 안전
    availableCount={book.siripEbookInfo?.bookList?.filter(...)}
    ```

### 🎯 영향 범위 (Impact Scope)

-   `MyLibraryBookDetailModal.tsx`
-   (동일 로직이 사용된 `MyLibraryListItem.tsx`도 함께 점검 및 수정 완료)

이번 수정으로 인해, 시립도서관 재고 정보의 유무와 관계없이 도서 상세 정보 모달이 안정적으로 렌더링됩니다.


3642bb4
ahnbu
Sun Nov 9 14:26:21 2025 +0900
feat(file) : ts파일 일괄 변환 ps1 파일 추가


0a1af88
ahnbu
Sat Nov 8 18:57:00 2025 +0900
refactor(api): 시립 전자도서관(siripEbook) API 응답 구조 평탄화 & 재고 일괄 갱신 시 발생하는 'socket hang up' 에러 해결
refactor(api): 시립 전자도서관(siripEbook) API 응답 구조 평탄화

**목표:**
`siripEbookInfo`의 복잡한 중첩 구조(`details`, `summary`)를 다른 도서관 API 응답(`gyeonggiEbookInfo` 등)과 동일한 평탄한 구조로 통일하여, 프론트엔드의 데이터 처리 로직을 단순화하고 코드의 일관성과 유지보수성을 향상시킵니다.

**주요 변경 사항:**

**1. 서버 (Cloudflare Worker) 변경 사항:**
-   **`types.ts`:**
    -   `SiripEbookDetails` 타입을 제거했습니다.
    -   `SiripEbookResult` 타입을 요약 정보와 단일 `bookList`를 포함하는 평탄한 구조로 재설계했습니다.
    -   `SiripEbookBook` 유니온 타입을 추가하여 소장형과 구독형을 함께 다룰 수 있도록 했습니다.
-   **`index.ts` (`searchSiripEbookIntegrated` 함수):**
    -   소장형(`owned`)과 구독형(`subscription`) API 결과를 조합하여, 단일 `bookList`를 가진 평탄화된 `SiripEbookResult` 객체를 생성하도록 로직을 변경했습니다.
    -   모든 에러 정보는 최상위 `errors` 객체에 일관되게 담도록 수정했습니다.

**2. 클라이언트 (React App) 변경 사항:**
-   **`MyLibraryListItem.tsx` (`LibraryTagsGroup`):**
    -   `e시립구독`, `e시립소장` 태그가 평탄화된 데이터 구조에 접근하도록 경로를 수정했습니다.
    -   (예: `book.siripEbookInfo.details.owned.totalCount` -> `book.siripEbookInfo.totalCountOwned`)
-   **`MyLibraryBookDetailModal.tsx` (`StockDisplay`):**
    -   `LibraryTagsGroup`과 마찬가지로, `e시립구독`, `e시립소장` 재고 정보가 새로운 데이터 구조를 참조하도록 수정했습니다.
    -   `availableCount`는 통합된 `bookList`를 직접 필터링하여 계산하도록 로직을 개선했습니다.

이번 리팩토링을 통해 `siripEbookInfo` 관련 처리 로직이 크게 단순화되었으며, 모든 도서관 데이터를 일관된 방식으로 다룰 수 있는 기반이 마련되었습니다.

fix(core): 재고 일괄 갱신 시 발생하는 'socket hang up' 에러 해결

**문제점:**
'재고 일괄 갱신' 기능 실행 시, 짧은 시간 안에 외부 API(알라딘)로 너무 많은 요청이 동시에 전송되어 서버의 Rate Limiting 정책에 의해 연결이 강제 종료되는 `socket hang up` 에러가 간헐적으로 발생했습니다. 기존 로직은 배치(batch) 단위로만 지연(delay)을 적용하여, 개별 요청들은 여전히 한꺼번에 전송되는 문제가 있었습니다.

**해결책:**

1.  **개별 요청 사이 지연 로직 추가 (`useBookStore.tsx`):**
    -   `bulkRefreshAllBooks` 함수 내의 `setTimeout` 로직의 위치를 **배치(batch) 사이에서 개별 책(book) 요청 사이로 이동**시켰습니다.
    -   이제 각 책의 정보를 갱신한 후 200ms의 지연 시간을 두어, API 서버에 가해지는 부하를 분산시키고 안정적인 요청 흐름을 유지합니다.

2.  **일시정지 콜백 안정성 강화 (`SettingsModal.tsx`):**
    -   `bulkRefreshAllBooks` 호출 시 전달하는 `shouldPause` 콜백이 클로저(closure)로 인해 오래된 상태(stale state)를 참조하던 문제를 해결했습니다.
    -   이제 `useBookStore.getState()`를 통해 항상 최신 `isPaused` 상태를 스토어에서 직접 읽어오므로, '일시정지' 기능이 더 안정적으로 작동합니다.

이번 수정으로 재고 일괄 갱신 기능의 안정성이 크게 향상되었으며, 외부 API와의 통신 오류가 현저히 줄어들 것으로 기대됩니다.


0221ffa
ahnbu
Sat Nov 8 18:18:21 2025 +0900
fix(UI): API 에러 발생 시 표시 비일관성 문제 해결
API 호출 실패 시, '책 상세 모달'과 '내 서재 목록'에서 에러 상태가 비일관적으로 표시되거나(빨간색/회색), "조회중..." 상태로 멈추는 버그를 수정합니다.

**1. 책 상세 모달의 "조회중..." 버그 수정 (`MyLibraryBookDetailModal.tsx`)**

- **문제점:** API 응답 객체가 `null`일 경우, `StockDisplay` 컴포넌트가 이를 에러로 인지하지 못하고 "조회중..." 상태로 무한 대기하는 문제가 있었습니다.
- **해결책:** `hasError` prop을 계산할 때, 데이터 객체가 `null`이거나 `undefined`인 경우 자체를 에러 상태로 간주하도록 로직을 강화했습니다. 이를 통해 API 호출이 실패하면 "조회중..."이 아닌 명확한 (에러) 상태로 표시됩니다.

**2. 내 서재 목록의 에러 표시 통일 (`MyLibraryListItem.tsx`)**

- **문제점:** `gwangjuPaperInfo`(`퇴촌`, `기타`)의 API 에러가 발생해도 회색(정상)으로 표시되는 등, `LibraryTagsGroup` 내부의 각 `LibraryTag`가 에러를 판단하는 기준이 달라 표시가 비일관적이었습니다.
- **해결책:** 모든 `LibraryTag`의 `isError` prop을 판단하는 로직을 `!book.someInfo || ('error' in book.someInfo)` 패턴으로 표준화했습니다. 이제 어떤 도서관의 API 조회가 실패하더라도 일관되게 빨간색(에러) 상태로 표시됩니다.

이번 수정으로 모든 API 에러 시나리오에 대해 사용자에게 일관되고 명확한 피드백을 제공할 수 있게 되었습니다.


3af3765
ahnbu
Sat Nov 8 17:42:17 2025 +0900
refactor(MyLibraryListItem): LibraryTagsGroup 컴포넌트 추출 및 데이터 접근 로직 개선
`MyLibraryListItem` 컴포넌트의 가독성과 유지보수성을 향상시키고, 데이터 처리의 안정성을 높이기 위해 리팩토링을 진행했습니다.

**1. 코드 중복 제거: `LibraryTagsGroup` 컴포넌트 추출**

-   **문제점:** 카드뷰와 그리드뷰에서 도서관 재고 태그(`LibraryTag`)를 렌더링하는 코드가 완전히 중복되어 있었습니다. 이로 인해 향후 로직 수정 시 두 곳을 모두 변경해야 하는 번거로움과 버그 발생 위험이 있었습니다.
-   **해결책:** 중복되는 JSX 코드를 `MyLibraryListItem.tsx` 파일 내에 독립적인 `LibraryTagsGroup` 컴포넌트로 추출했습니다. 이제 양쪽 뷰에서 이 컴포넌트를 호출하여 코드 중복을 제거하고 유지보수성을 크게 향상시켰습니다.

**2. 데이터 접근 로직 안정성 및 일관성 강화**

-   **안전한 기본값 처리 (`??` 연산자 적용):**
    `|| 0` 구문은 유효한 값인 `0`을 `false`로 취급하여 버그를 유발할 수 있습니다. 이를 방지하기 위해 `null` 또는 `undefined`일 때만 기본값을 반환하는 `?? 0` 연산자로 교체했습니다.
    -   적용 대상: **`e교육`, `e시립구독`, `e시립소장`, `e경기`**의 재고 수량(`totalBooks`, `availableBooks`) 처리 로직

-   **에러 처리 로직 일관성 확보:**
    `isError`를 판단하는 로직을 `!!` 연산자를 사용하여 명시적으로 `boolean` 타입으로 변환하도록 통일했습니다. 이는 코드의 일관성을 높이고 가독성을 개선합니다.
    -   적용 대상: **`퇴촌`, `기타`, `e경기`, `e시립구독`, `e시립소장`** 등

이러한 변경을 통해 `MyLibraryListItem`은 더 간결하고 안정적인 컴포넌트가 되었으며, 향후 기능 확장 및 유지보수가 용이해졌습니다.


5d87b26
ahnbu
Sat Nov 8 17:17:42 2025 +0900
refactor(API): 응답 필드명을 camelCase로 표준화하여 일관성 확보
- **목표:** API 응답 데이터 구조의 일관성을 확보하여 코드 가독성과 유지보수성을 향상시킵니다.
- **문제점:** 기존 API 응답은 snake_case(`gwangju_paper`)와 한글 필드명('대출상태' 등)이 혼용되어 있어 프론트엔드에서 예외 처리가 필요하고 데이터 모델이 비일관적이었습니다. 이를 camelCase로 통일합니다.

**주요 변경 내역:**

1.  **최상위 키 통일:**
    -   `gwangju_paper` -> `gwangjuPaper`
    -   `book_list` -> `bookList`

2.  **`gwangjuPaper.bookList` 필드 영문화:**
    -   소장도서관 -> `libraryName`
    -   청구기호 -> `callNumber`
    -   대출상태 -> `loanStatus `
    -   반납예정일 -> `dueDate`

3.  **`gyeonggiEbookEdu.bookList` 필드 영문화:**
    -   소장도서관 -> `libraryName`
    -   도서명 -> `title`
    -   저자 -> `author`
    -   발행일 -> `publishDate`
    -   대출상태 -> `loanStatus `

4.  **관련 타입 및 로직 수정:**
    -   `library-checker/types.ts`와 `src/types.ts`의 관련 타입 정의를 모두 업데이트했습니다.
    -   변경된 필드명을 사용하도록 프론트엔드의 데이터 참조 로직을 수정했습니다.

이를 통해 모든 도서관 API 응답을 동일한 규칙으로 처리할 수 있게 되었습니다.


a9d8e0c
ahnbu
Sat Nov 8 15:46:28 2025 +0900
Stop tracking .docs/git_commit_history


8029dbf
ahnbu
Sat Nov 8 15:20:22 2025 +0900
refactor(api) : 시립(소장) 에러 메시지에 "소장형"이라고 명시


b3aa32b
ahnbu
Sat Nov 8 15:11:54 2025 +0900
refactor(api) : api응답변수 통일 작업 2차 - 경기도 전자도서관, 시립(구독,소장)도서관


96183e4
ahnbu
Sat Nov 8 14:43:01 2025 +0900
refactor(api) : api응답변수 통일 작업 1차 - (광주시립(종이책), 경기도 교육청 도서관


4aaa37b
ahnbu
Sat Nov 8 14:22:05 2025 +0900
docs: e경기(소장) 공식 api 문서 추가


4a6b238
ahnbu
Sat Nov 8 14:19:33 2025 +0900
docs: 경기도 전자도서관 API 관련 기술 결정 사항 기록
최근 발견된 경기도 전자도서관의 공식 OpenAPI(/api/open-search/ebook)를 검토한 결과, 해당 API는 서지 정보만 제공할 뿐 대출 가능 여부와 같은 핵심 재고 정보를 포함하지 않음을 확인했습니다.

현재 프로젝트에서 사용 중인 비공식 API(/api/service/search-engine)는 재고 정보를 제공하여 '대출 가능' 상태를 표시하는 핵심 기능을 구현하고 있습니다.

사용자 경험의 저하를 막기 위해, 기능적으로 우월한 현재의 비공식 API 사용을 유지하기로 결정했습니다. 이 의사 결정 과정과 배경을 DEVELOPMENT.md의 트러블슈팅 가이드에 상세히 기록하여 향후 개발 과정에서의 혼선을 방지하고자 합니다.

또한, 비공식 API가 중단될 경우를 대비한 장기적인 Fallback 전략(공식 API로의 점진적 기능 저하)도 함께 명시했습니다.


542e9e9
ahnbu
Sun Nov 2 14:08:12 2025 +0900
Refactor: Supabase 데이터베이스 성능 및 보안 경고 전체 수정
Supabase 대시보드의 'Database Linter'에서 보고된 다수의 성능 및 보안 관련 경고들을 해결했습니다. 이번 리팩터링은 프로젝트의 장기적인 안정성, 확장성, 보안을 확보하는 것을 목표로 합니다.

주요 변경 사항은 다음과 같습니다.

### 1. RLS 정책 성능 최적화 (auth_rls_initplan)
- **문제**: RLS 정책에서 `auth.uid()` 함수가 각 행마다 재평가되어, 데이터 증가 시 심각한 쿼리 성능 저하를 유발했습니다.
- **조치**: `user_library`, `user_settings`, `dev_notes` 테이블의 모든 RLS 정책에서 `auth.uid()`를 `(select auth.uid())` 서브쿼리 형태로 변경하여, 쿼리 당 단 한 번만 실행되도록 최적화했습니다.

### 2. 데이터베이스 함수 보안 강화 (function_search_path_mutable)
- **문제**: DB 함수들의 `search_path`가 고정되지 않아 잠재적인 보안 취약점에 노출되어 있었습니다.
- **조치**: `pg_proc`를 조회하여 모든 대상 함수의 정확한 서명(Signature)을 파악한 후, `ALTER FUNCTION`을 통해 `search_path`를 'public'으로 명시적으로 설정했습니다.

### 3. PostgreSQL 버전 업그레이드 (vulnerable_postgres_version)
- **문제**: 사용 중인 PostgreSQL 버전에 보안 취약점이 발견되었습니다.
- **조치**: Supabase 대시보드를 통해 보안 패치가 적용된 최신 버전으로 데이터베이스를 업그레이드했습니다.

### 4. 인증 보안 강화 (auth_otp_long_expiry)
- **문제**: 이메일 OTP의 만료 시간이 24시간(86400초)으로 매우 길어 보안에 취약했습니다.
- **조치**: OTP 만료 시간을 10분(600초)으로 대폭 단축하여 인증 토큰 탈취의 위험을 줄였습니다.

### 5. 데이터베이스 구조 개선 (extension_in_public)
- **문제**: `pg_trgm` 확장 프로그램이 `public` 스키마에 설치되어 있어 관리상 비효율적이었습니다.
- **조치**: 확장 프로그램 전용 `extensions` 스키마를 생성하고 `pg_trgm`을 이전하여 `public` 스키마와의 의존성을 분리했습니다.

### 6. 개발 문서 업데이트
- `DEVELOPMENT.md`에 '데이터베이스 유지보수 및 최적화 로그' 섹션을 신설했습니다.
- 이번에 진행된 모든 경고 해결 과정과 최종 조치 내역을 상세히 기록하여, 향후 유사 문제 발생 시 가이드로 활용할 수 있도록 문서화했습니다.

이번 수정을 통해 프로젝트의 잠재적인 병목 현상과 보안 위협을 선제적으로 제거하여, 더욱 안정적이고 빠른 서비스를 제공할 수 있는 기반을 마련했습니다.


5591bcd
ahnbu
Tue Oct 28 23:28:28 2025 +0900
refactor(data): API 응답 데이터 처리 및 디버깅 편의성 개선
신규 도서 추가 시 API 조회 실패 정보를 올바르게 저장하도록 데이터 처리 방식을 개선하고, 디버깅 편의성을 높이기 위해 'API 보기' 기능의 데이터 표시 구조를 조정합니다.

### 주요 변경 내용

1.  **신규 도서의 API 조회 실패 정보 유지 (`useBookStore.ts`)**
    -   **문제점**: 이전에는 신규 도서 추가 시 도서관 재고 API 조회에 실패하면, `null`이 DB에 저장되어 '원래 정보가 없는 것'과 '조회에 실패한 것'을 구분할 수 없었습니다.
    -   **원인**: `refreshBookInfo` 함수의 폴백(Fallback) 로직에서, `originalBook`의 `null` 상태인 재고 정보 속성에 접근하려다 런타임 에러가 발생하여 `catch` 블록의 롤백 로직이 실행되었기 때문입니다.
    -   **해결**: 폴백 조건문에 **옵셔널 체이닝(`?.`)**을 적용하여 `null` 값의 속성에 안전하게 접근하도록 수정했습니다. (예: `originalBook.siripEbookInfo?.errors`)
    -   **결과**: 이제 런타임 에러 없이, 신규 도서의 재고 조회 실패 시 **API가 반환한 에러 객체**가 DB의 `book_data`에 그대로 저장되어 추후 원인 분석이 용이해졌습니다.

2.  **'API 보기' JSON 키 순서 재정렬 (`MyLibraryBookDetailModal.tsx`)**
    -   **문제점**: DB의 `jsonb` 타입 특성으로 인해 'API 보기' 기능으로 확인하는 `book_data`의 키 순서가 네트워크 탭의 원본 응답과 달라 비교하기 불편했습니다.
    -   **해결**: `handleApiButtonClick` 함수 내에서 DB 데이터를 조회한 후, **화면에 표시하기 직전에** 원하는 순서(`desiredKeyOrder`)에 따라 키를 재정렬하는 로직을 추가했습니다.
    -   **결과**: DB에는 `jsonb`의 효율적인 저장 방식을 유지하면서, 디버깅 시에는 네트워크 응답과 동일한 순서로 정렬된 JSON을 확인할 수 있게 되어 편의성이 크게 향상되었습니다.

### 영향 범위
-   `useBookStore.ts`: `refreshBookInfo` 함수의 데이터 처리 로직 수정.
-   `MyLibraryBookDetailModal.tsx`: 'API 보기' 버튼 클릭 시 데이터 표시 방식 수정.
-   데이터베이스: 신규 책 추가 시 `user_library` 테이블의 `book_data` 컬럼에 에러 객체가 저장될 수 있음. (저장 방식 변경 없음)


78a9154
ahnbu
Tue Oct 28 19:36:35 2025 +0900
feat(library): AND 조건 필터링 및 초기 화면 맞춤설정 기능 구현
'좋아요' 필터와 '태그' 필터를 동시에 적용(AND 조건)하여 책을 검색하는 기능을 구현하고, 관련 설정을 관리하는 UI를 개선합니다. 이제 사용자는 내 서재에 처음 진입할 때 적용될 기본 필터(좋아요, 태그, 또는 둘 다)와 보기 방식을 자유롭게 설정할 수 있습니다.

### 1. 백엔드: AND 조건 필터링 RPC 함수 구현

-   **Supabase SQL 함수 (`get_books_by_tags`) 수정**:
    -   기존 함수 시그니처를 `(tags_to_filter text[], filter_by_favorites boolean)`으로 확장했습니다.
    -   SQL 쿼리 내 `WHERE` 절을 수정하여, `tags_to_filter`와 `filter_by_favorites` 파라미터를 기반으로 AND 조건 필터링을 수행하도록 로직을 변경했습니다.
    -   두 파라미터가 모두 비어있거나 `false`일 경우 전체 목록을 반환하여 유연성을 확보했습니다.

### 2. 프론트엔드: 데이터 흐름 통합 및 UI 로직 재설계

-   **상태 관리 로직 통합 (`useBookStore.ts`)**:
    -   `filterLibraryByFavorites` 관련 상태 및 함수(`libraryFavoritesFilterResults` 등)를 모두 제거하고, `filterLibraryByTags` 하나로 데이터 요청 창구를 통일했습니다.
    -   `filterLibraryByTags`는 이제 `(tagIds: string[], filterByFavorites: boolean)` 인자를 받아 수정된 Supabase RPC를 호출합니다.
    -   책 정보를 수정하는 모든 내부 함수(`removeFromLibrary`, `toggleFavorite` 등)에서 분리된 필터 결과 배열에 대한 참조를 제거하여 코드 복잡도를 낮췄습니다.

-   **컴포넌트 로직 리팩토링 (`MyLibrary.tsx`)**:
    -   **역할 분리**: `useEffect` 훅을 2개로 분리하여 역할을 명확히 했습니다.
        1.  `settings` 동기화 `useEffect`: `useSettingsStore`의 변경사항을 컴포넌트의 로컬 상태(`activeTags`, `showFavoritesOnly`)에 반영하는 역할만 수행합니다.
        2.  데이터 로딩 `useEffect`: 로컬 상태가 변경될 때마다 통합된 `filterLibraryByTags` 함수를 호출하여 실제 데이터 필터링을 요청합니다.
    -   **상태 중심 설계**: 모든 필터 핸들러(`handleTagClick` 등)는 이제 API를 직접 호출하지 않고 로컬 상태만 변경합니다. 실제 데이터 로딩은 상태 변경에 따라 `useEffect`가 자동으로 처리합니다.
    -   **`useMemo` 로직 단순화**: `sortedAndFilteredLibraryBooks`는 이제 서버 필터링이 필요할 때 `libraryTagFilterResults`라는 단일 결과 배열만 참조하도록 수정되었습니다.

### 3. UI/UX 개선: 설정 모달 구조 변경 (`SettingsModal.tsx`)

-   **'초기화면' 탭 신설**:
    -   기존 '표시옵션' 탭에 있던 '기본 보기 방식', '좋아요 필터', '기본 태그 필터' 설정을 "초기화면"이라는 별도의 탭으로 분리하여 관련 설정을 그룹화했습니다.
    -   이에 따라 탭 네비게이션과 하단 저장/취소 버튼의 표시 로직을 수정했습니다.

-   **AND 조건 허용**:
    -   '좋아요' 필터와 '태그' 필터가 서로를 해제하던 상호 배타 로직을 제거했습니다. 이제 사용자는 두 필터를 동시에 선택하여 기본 AND 조건 필터를 설정할 수 있습니다.

-   **사용자 편의 기능 추가**:
    -   '기본 태그 필터' 섹션에 선택된 태그 목록을 보여주는 "필터링 미리보기" 텍스트와, 모든 선택을 해제하는 "초기화" 버튼을 추가하여 메인 화면의 필터 UI와 경험을 통일했습니다.


7a54546
ahnbu
Tue Oct 28 18:01:08 2025 +0900
feat(settings): 내 서재 초기 표시 방식 맞춤설정 기능 구현
사용자가 내 서재에 처음 진입할 때의 화면을 개인화할 수 있도록 '초기 표시 방식 맞춤설정' 기능을 추가합니다. 이제 사용자는 선호하는 보기 방식(카드/그리드)과 기본 필터('좋아요' 또는 특정 태그)를 미리 설정할 수 있습니다.

### 주요 구현 내용

1.  **데이터베이스 스키마 확장 (`user_settings` 테이블)**:
    -   `default_view_type` (text): 기본 보기 방식을 저장합니다. (기본값: 'card')
    -   `default_filter_favorites` (boolean): '좋아요' 필터 기본 적용 여부를 저장합니다. (기본값: false)
    -   `default_filter_tag_ids` (jsonb): 기본으로 적용할 태그 ID 배열을 저장합니다. (기본값: '[]')

2.  **설정 UI 통합 및 개선 (`SettingsModal.tsx`)**:
    -   '표시옵션' 탭에 '내 서재 초기 표시 설정' 섹션을 신설했습니다.
    -   기존 '기본 보기 방식' 설정을 이 섹션으로 통합하고, '초기 필터 설정'('좋아요', '태그') UI를 함께 배치하여 연관된 설정들을 그룹화했습니다.
    -   '좋아요' 필터와 '태그' 필터를 독립적으로 선택할 수 있도록 UI 로직을 수정하여, 향후 AND 조건 필터링을 위한 기반을 마련했습니다.

3.  **초기 상태 적용 로직 구현 (`MyLibrary.tsx`)**:
    -   컴포넌트가 마운트되거나 `settings`가 변경될 때 실행되는 통합 `useEffect` 훅을 구현했습니다.
    -   이 훅은 `useSettingsStore`에서 저장된 `defaultViewType`, `defaultFilterFavorites`, `defaultFilterTagIds` 값을 읽어와 `viewType`, `showFavoritesOnly`, `activeTags` 상태를 자동으로 설정합니다.
    -   '필터 초기화' 기능(`resetLibraryFilters`)이 이제 모든 필터를 제거하는 대신, 사용자가 설정한 기본 필터 상태로 되돌아가도록 동작을 변경했습니다.

### 현재 상태 및 다음 단계

-   이번 커밋은 프론트엔드의 UI와 상태 관리 로직 변경까지만 포함합니다.
-   '좋아요'와 '태그' 필터를 동시에 선택할 수는 있으나, 아직 실제 데이터 필터링은 AND 조건으로 동작하지 않습니다.
-   다음 단계는 Supabase RPC 함수를 수정하여 백엔드에서 실제 AND 조건 필터링을 구현하는 것입니다.


ab54f71
ahnbu
Tue Oct 28 17:39:18 2025 +0900
feat(settings): 사용자의 기본 보기 방식 설정 기능 추가
사용자가 내 서재의 초기 보기 방식을 '카드 뷰' 또는 '그리드 뷰'로 직접 설정할 수 있는 기능을 추가합니다. 이를 통해 개인화된 사용자 경험을 제공하고, 앱 진입 시 선호하는 레이아웃으로 즉시 탐색을 시작할 수 있습니다.

### 구현 내용

1.  **데이터베이스 스키마 확장 (`user_settings` 테이블)**:
    -   `default_view_type` (text 타입) 컬럼을 추가하여 사용자의 선택을 저장합니다.
    -   기존 사용자를 위해 기본값으로 `'card'`를 설정했습니다.

2.  **타입 정의 업데이트 (`types.ts`)**:
    -   `UserSettings` 인터페이스에 `defaultViewType: ViewType` 속성을 추가하여 타입 안정성을 확보했습니다.

3.  **설정 모달 UI 추가 (`SettingsModal.tsx`)**:
    -   '표시옵션' 탭에 '기본 보기 방식' 섹션을 새로 추가했습니다.
    -   사용자가 '카드 뷰'와 '그리드 뷰' 중 하나를 선택할 수 있는 직관적인 버튼 그룹 UI를 구현했습니다.

4.  **설정 적용 로직 구현 (`MyLibrary.tsx`)**:
    -   `MyLibrary` 컴포넌트가 마운트될 때, `useSettingsStore`에서 저장된 `defaultViewType` 값을 읽어와 `viewType` 상태의 초기값으로 설정합니다.
    -   설정이 비동기적으로 로드되는 경우를 대비하여, `useEffect`를 통해 설정값이 변경되면 `viewType` 상태가 동기화되도록 구현했습니다.

5.  **기본값 처리 로직 강화 (`useSettingsStore.ts`)**:
    -   `getDefaultSettings` 함수에 `defaultViewType: 'card'`를 추가하여, 신규 사용자나 설정이 없는 사용자에게도 올바른 기본값이 적용되도록 보장했습니다.

### 기대 효과

-   **사용자 경험 개인화**: 사용자가 가장 선호하는 뷰 타입으로 서재를 시작할 수 있어 편의성이 증대됩니다.
-   **유지보수성 향상**: 보기 방식 설정이 중앙화된 `useSettingsStore`를 통해 관리되어 코드의 일관성과 유지보수성이 향상됩니다.


bc33aa0
ahnbu
Tue Oct 28 17:25:30 2025 +0900
doc : 캐싱 실패: 동일한 요청에도 계속 Cache MISS가 발생하는 경우 추가


e90f974
ahnbu
Tue Oct 28 17:24:43 2025 +0900
fix(worker): 도서관 재고 API 캐싱 오류 수정
도서관 도서 재고를 확인하는 Cloudflare Worker에 견고한 캐싱 계층을 도입합니다. 이 커밋의 주목표는 동일한 도서에 대한 반복 요청의 성능을 크게 향상시키고, 크롤링 대상 도서관 웹사이트의 부하를 줄이며, 더 빠른 사용자 경험을 제공하는 것입니다.

### 문제 상황

이전에는 캐싱 메커니즘이 의도대로 작동하지 않아, 동일한 요청에 대해서도 지속적으로 `Cache MISS`가 발생하는 문제가 있었습니다. 모든 API 호출은 2-3초가 소요되는 새로운 크롤링 프로세스를 유발했습니다. 문제의 근본 원인은 두 가지였습니다.
1. 캐시에 저장되는 `Response` 객체에 필수적인 `Cache-Control` 헤더가 누락되어, Cloudflare 캐시가 응답을 효과적으로 저장하지 못했습니다.
2. 캐시 키로 URL 문자열을 사용하는 방식이, 정식 `Request` 객체를 사용하는 것보다 덜 명시적이고 안정성이 떨어졌습니다.

### 해결 방안 및 구현 상세

이번 커밋은 캐싱 전략을 근본적으로 개선하여 문제를 해결합니다.

1.  **명시적인 캐시 키 객체 사용**:
    -   단순한 URL 문자열 대신, 요청 본문의 SHA-256 해시값으로 생성된 고유 경로(`/cache/<hash>`)와 `GET` 메서드를 갖는 전용 `Request` 객체를 생성합니다.
    -   이 `Request` 객체를 `cache.match()`와 `cache.put()` 양쪽에서 일관되게 사용하여 신뢰할 수 있는 캐시 조회를 보장합니다.

2.  **`Cache-Control` 헤더 추가**:
    -   이번 수정의 핵심으로, 캐시 MISS 발생 시 생성되는 `Response` 객체에 `Cache-Control` 헤더를 추가했습니다.
    -   헤더 값을 `public, max-age=43200`으로 설정하여, 캐시가 해당 응답을 저장하고 12시간 동안 유효한 것으로 간주하도록 명시합니다. 이 변경 사항이 성공적인 캐싱을 가능하게 하는 결정적인 역할을 합니다.

3.  **로직 개선**:
    -   전체 캐싱 로직을 Cloudflare의 권장 사례에 더 부합하도록 개선했습니다.
    -   오류가 포함된 응답(`hasCacheBlockingError`)은 `Cache-Control: no-store`를 설정하여 캐싱 대상에서 명시적으로 제외함으로써, 잘못된 데이터가 캐시에서 제공되는 것을 방지합니다.

### 기대 효과

-   **성능 향상**: 동일 도서에 대한 후속 요청은 이제 캐시에서 직접 처리되어, 응답 시간이 약 2000ms에서 10ms 미만으로 단축됩니다 (99% 이상 개선).
-   **외부 부하 감소**: 도서관 웹사이트로 전송되는 크롤링 요청 수가 급격히 줄어들어, 더 책임감 있는 서비스 운영이 가능해집니다.
-   **사용자 경험 개선**: 사용자는 이전에 검색했던 책의 재고 확인 결과를 거의 즉시 받아볼 수 있습니다.
-   **코드 안정성**: 새로운 구현은 표준 HTTP 캐싱 프로토콜을 준수하여 더 견고하고 디버깅이 용이합니다.

이번 변경은 애플리케이션의 성능과 확장성에 있어 중요한 진전을 이루었습니다.


5fffd4c
ahnbu
Tue Oct 28 15:51:05 2025 +0900
refactor(worker): Cloudflare Worker를 TypeScript로 전환
Cloudflare Worker 코드(`library-checker`)를 기존 JavaScript에서 TypeScript로 완전히 마이그레이션했습니다. 이를 통해 코드의 안정성을 대폭 향상시키고, 타입 추론 및 자동 완성 기능을 활용하여 향후 유지보수성과 개발 생산성을 높였습니다.

### 배경
- **타입 안정성 부재:** 기존 JavaScript 코드는 런타임에서만 오류를 발견할 수 있어, 크롤링 데이터 구조 변경이나 API 응답 변화에 취약했습니다.
- **개발자 경험:** `any` 타입의 남용으로 인해 코드의 흐름을 추적하기 어렵고, VS Code와 같은 에디터의 타입 지원 기능을 온전히 활용하지 못했습니다.
- **거짓 양성 오류:** 에디터가 번들링된 JS 파일을 분석하며 실제 런타임과 무관한 수많은 타입 오류 경고를 표시하여 개발에 혼란을 주었습니다.

### 주요 변경사항
1.  **개발 환경 구성:**
    -   `typescript` 및 `@cloudflare/workers-types` 패키지를 설치하여 타입 검사 환경을 구축했습니다.
    -   `tsconfig.json`을 추가하여 엄격한(`strict: true`) 타입 검사 규칙을 적용했습니다.
    -   `wrangler.jsonc`의 진입점(`main`)을 `src/index.js`에서 `src/index.ts`로 변경했습니다.

2.  **타입 시스템 도입 (`src/types.ts`):**
    -   Worker가 다루는 모든 핵심 데이터 구조(API 요청/응답, 도서관별 결과 등)에 대한 타입을 `types.ts` 파일에 명시적으로 정의했습니다.
    -   `Env` 인터페이스를 정의하여 환경 변수에 대한 타입 안정성을 확보했습니다.

3.  **코드 리팩토링 및 타입 적용:**
    -   `index.js`를 `index.ts`로 변경하고, 모든 함수 시그니처(파라미터, 반환 값)에 타입을 적용했습니다.
    -   `catch (error)` 블록에서 `instanceof Error` 타입 가드를 사용하여 `unknown` 타입 문제를 해결했습니다.
    -   `Promise.allSettled`의 결과를 처리할 때, `status`를 먼저 확인하여 타입을 좁히는 안전한 로직으로 개선했습니다.
    -   Node.js 환경에 의존적인 `Buffer` 관련 코드를 제거하고, Workers 환경 표준인 `btoa`만 사용하도록 수정했습니다.
    -   `cache.put` 메서드를 최신 Wrangler 사양에 맞게 2개의 인자만 사용하도록 수정하여 CORS preflight 오류를 해결했습니다.

### 기대 효과
- **버그 사전 방지:** 컴파일 시점에 타입 오류를 발견하여 런타임 에러 발생 가능성을 크게 줄입니다.
- **유지보수성 향상:** 코드의 가독성이 향상되고, 데이터의 흐름을 명확하게 추적할 수 있습니다.
- **생산성 증대:** 에디터의 강력한 자동 완성 및 타입 힌트 기능을 통해 더 빠르고 정확한 코딩이 가능해졌습니다.


078d16a
ahnbu
Tue Oct 28 13:34:08 2025 +0900
refactor(data): 책 상세 api를 api와 일치하도록 단순화 및 중복 파생 데이터 제거
기존에는 DB에 저장되는 `book_data`에 API 원본 데이터와 함께 UI 표시를 위한 파생 데이터(`toechonStock`, `filteredGyeonggiEbookInfo` 등)가 중복으로 저장되었습니다. 이는 데이터 불일치 위험을 초래하고, 데이터 모델을 복잡하게 만들며, 유지보수성을 저해하는 문제가 있었습니다.

이를 해결하기 위해, DB에는 순수 API 응답만 저장하고 파생/계산은 UI 컴포넌트에서 실시간으로 처리하도록 구조를 변경했습니다. 이를 통해 데이터 모델의 책임과 역할이 명확해졌습니다.

주요 변경사항:
- **`utils/bookDataCombiner.ts`**:
  - `createBookDataFromApis` 함수에서 `toechonStock`, `otherStock`, `filteredGyeonggiEbookInfo` 등 파생 데이터를 생성하는 로직을 모두 제거했습니다.
  - 이제 이 함수는 순수 API 응답을 조합하는 역할만 수행합니다.

- **`stores/useBookStore.ts`**:
  - `refreshBookInfo`의 데이터 복원(Fallback) 로직에서 제거된 파생 필드(`toechonStock` 등)에 대한 처리를 삭제했습니다.
  - 이제 오직 원본 API 객체(`gwangjuPaperInfo` 등)의 유효성만 검사하고 복원합니다.

- **`components/MyLibraryListItem.tsx` & `MyLibraryBookDetailModal.tsx`**:
  - `book.toechonStock`과 같이 중복 저장된 파생 데이터를 직접 참조하던 부분을 수정했습니다.
  - 이제 `book.gwangjuPaperInfo.toechon_total_count`와 같이 원본 데이터 소스에서 직접 값을 읽어와 UI에 표시합니다.
  - 이를 통해 UI는 항상 최신 원본 데이터를 기반으로 렌더링됩니다.


dfb753f
ahnbu
Tue Oct 28 13:02:09 2025 +0900
docs: 시립구독 크롤링 관련 문서 업데이트


984cae4
ahnbu
Tue Oct 28 12:58:39 2025 +0900
refactor(worker): 시립(구독형) 크롤링에서 세션쿠기 제거 & 헤더 보강
본문:
간헐적으로 HTTP 400 오류가 발생하던 광주시립도서관(구독형) 크롤링 로직을 전면 재검토하고, 복잡성을 제거하여 안정성을 크게 향상시켰습니다.

문제 분석:
이전에 시도했던 KV를 이용한 세션 캐싱 전략이 오히려 동시 요청 상황에서 서버의 봇 탐지를 유발하는 역효과를 낳는 것으로 분석되었습니다. 반면, 매번 새로운 세션을 요청하는 단순한 2단계 요청 방식이 더 높은 성공률을 보였습니다. 그러나 이 방식 역시 헤더 구성이 단순하여 간헐적인 차단이 발생하는 약점이 있었습니다.

개선 사항:
성공률이 높았던 단순 2단계 요청 패턴의 장점은 계승하되, 실패 원인이었던 헤더 위장술을 대폭 강화하는 방향으로 리팩토링했습니다.

    KV 세션 캐싱 로직 제거:

        동시성 문제를 유발하고 복잡성을 높였던 getCachedSession, refreshAndCacheSession 헬퍼 함수와 KV 관련 로직을 모두 제거했습니다.

        이를 통해 각 요청이 완전히 독립적으로 동작하도록 하여 예측 가능성을 높였습니다.

    브라우저 헤더 모방 강화:

        세션을 획득하는 첫 번째 요청부터 Sec-Fetch-* 계열의 헤더를 포함한 정교한 헤더 세트를 사용하여, 실제 브라우저의 첫 방문과 매우 유사하게 동작하도록 수정했습니다.

        검색을 수행하는 두 번째 요청에도 일관된 헤더를 상속하고, Referer와 Sec-Fetch-Site: 'same-origin'을 명시하여 자연스러운 사용자 행동 맥락을 부여했습니다.

이번 리팩토링은 복잡한 해결책보다 문제의 본질을 파악하고 단순하면서도 견고한 접근법을 채택하는 것이 더 효과적임을 보여줍니다. 이를 통해 searchSiripEbookSubs 함수의 안정성을 확보하고, 향후 유지보수성을 크게 개선했습니다.


cb6bd45
ahnbu
Tue Oct 28 12:40:53 2025 +0900
fix(worker): 세션쿠키 적용 이전으로 되돌림
왜냐하면, 세션쿠키나 KV 방식을 적용하고 여러번 수정했는데, 계속 세션 에러 생김. 즉, 이게 문제가 아니라는 판단.


baf95f8
ahnbu
Mon Oct 27 19:00:28 2025 +0900
fix(worker): 시립(구독형) 크롤링의 '조용한 실패' 문제 해결
본문:
시립도서관 구독형 전자책 크롤링 시, 세션 만료 후에도 에러 없이 "결과 없음"으로만 응답하여 자동 복구가 되지 않던 '조용한 실패(Silent Failure)' 문제를 근본적으로 해결했습니다.

원인 분석:
이전 코드의 parseSiripE-bookSubsHTML 함수는 만료된 세션으로 인해 유효하지 않은 HTML(예: 로그인 페이지)을 받았을 때, 내부 파싱 오류를 catch한 후 **에러 정보를 담은 객체를 정상적으로 return**했습니다.

이로 인해 상위 함수인 searchSiripEbookSubs는 에러가 발생했음을 인지하지 못했고, 세션을 갱신하고 재시도하는 catch 블록이 실행되지 않았습니다. 결과적으로 만료된 세션이 KV 저장소에 계속 남아있어, 이후의 모든 요청이 지속적으로 실패하는 악순환이 발생했습니다.

해결 방안:
파싱 함수와 검색 함수의 역할을 명확히 하여, 실패 신호가 확실하게 전파되도록 수정했습니다.

    parseSiripEbookSubsHTML 로직 변경:

        이제 유효하지 않은 HTML을 받으면 에러 객체를 반환하는 대신, **명시적으로 에러를 throw**합니다.

        정상적인 검색 결과 페이지에만 존재하는 특정 CSS 선택자(.book_resultList)를 확인하여, 세션 만료로 인한 비정상 페이지를 더 능동적이고 정확하게 감지하도록 개선했습니다.

    searchSiripEbookSubs 재시도 로직 활성화:

        parseSiripEbookSubsHTML이 throw한 에러를 catch 블록이 정상적으로 감지하게 되었습니다.

        에러 감지 시(세션 만료 또는 HTTP 에러), 기존의 만료된 세션 정보를 KV에서 삭제하고, 새로운 세션을 발급받아 단 한 번 검색을 자동 재시도합니다.

이번 수정을 통해 크롤링 시스템의 자동 복구(Self-Healing) 능력이 대폭 향상되었습니다. 이제 세션이 만료되더라도 시스템이 스스로 문제를 인지하고 해결하여, 장기적으로 훨씬 더 안정적인 재고 정보 조회가 가능해졌습니다.


c246a10
ahnbu
Mon Oct 27 18:36:32 2025 +0900
fix(data): 재고 갱신 실패 시 기존 데이터가 초기화되는 문제 수정
본문:
도서 재고 정보 갱신(refreshBookInfo) 시, 특정 도서관 API 호출이 실패했을 때 해당 재고 정보가 (0/0)으로 초기화되던 버그를 수정했습니다.

원인 분석:
useBookStore의 refreshBookInfo 함수 내부에 있는 데이터 폴백(Fallback) 로직이 API 실패 응답을 제대로 감지하지 못했습니다. API가 null이나 undefined 대신, 에러 정보가 포함된 유효한 JSON 객체({ "errors": ... } 등)를 반환할 경우, 폴백 조건이 이를 정상 응답으로 오판하여 기존의 유효한 재고 데이터를 에러 객체로 덮어씌웠습니다. 이로 인해 UI에서는 재고가 0으로 표시되는 문제가 발생했습니다.

해결 방안:
refreshBookInfo 함수의 폴백 로직을 대폭 강화하여, 각 도서관 API의 고유한 에러 응답 구조를 명시적으로 확인하도록 수정했습니다.

    gwangjuPaperInfo, gyeonggiEbookInfo: 'error' in ... 조건을 추가하여 객체 내 error 프로퍼티를 확인합니다.

    GyeonggiEduEbookInfo: error_count > 0 조건을 추가하여 에러 발생 여부를 확인합니다.

    siripEbookInfo: .errors 객체의 존재 여부를 확인하여 중첩된 에러 구조를 정확히 감지합니다.

    toechonStock, otherStock 등 파생 데이터도 원본 API(gwangjuPaperInfo)의 에러 상태를 기반으로 폴백 여부를 결정하도록 수정했습니다.

이번 수정을 통해, 이제 재고 갱신 중 일부 API가 실패하더라도 해당 재고 정보는 가장 최근에 성공했던 데이터를 그대로 유지하게 됩니다. 예를 들어, (녹색) e시립구독(1/1) 상태에서 갱신이 실패하면 (빨간색) e시립구독(1/1)으로 표시되어, 사용자에게 데이터 손실 없이 오류 상황만을 명확히 전달할 수 있게 되었습니다. 이를 통해 전체적인 데이터의 안정성과 사용자 경험을 향상시켰습니다.


d859426
ahnbu
Mon Oct 27 18:30:53 2025 +0900
fix(worker): 크롤링 안정성 및 캐시 로직 전면 개선
본문:
Cloudflare Worker에서 간헐적으로 발생하던 크롤링 실패와 로컬 환경에서 캐시가 동작하지 않던 문제를 근본적으로 해결했습니다.

1. 시립(구독형) 크롤링 안정성 강화

    문제: 세션 획득 실패: HTTP 400 오류가 반복적으로 발생. 이는 도서관 서버의 강화된 안티-스크래핑 정책이 세션 획득을 위한 최초 접속 단계부터 봇을 탐지하여 차단했기 때문입니다.

    해결:

        세션 쿠키 캐싱 도입: Cloudflare KV를 사용하여 한 번 발급받은 세션 쿠키를 25분간 재사용하도록 로직을 변경했습니다. 이를 통해 매번 새로운 세션을 요청하는 비정상적인 패턴을 제거하고 실제 사용자처럼 동작하도록 개선했습니다.

        헤더 모방 강화: 세션을 새로 발급받는 refreshAndCacheSession 함수에도 Sec-Fetch-* 등 실제 브라우저와 유사한 헤더를 적용하여 초기 접속 시 차단될 가능성을 최소화했습니다.

        자동 복구 로직 추가: 검색 요청이 HTTP 400으로 실패할 경우, 캐시된 세션이 만료된 것으로 간주하고 캐시를 삭제한 후 자동으로 1회 재시도하는 로직을 추가하여 견고성을 높였습니다.

2. 캐시 로직 근본 문제 해결

    문제: 로컬 및 배포 환경에서 Cache HIT!가 발생하지 않고, 매번 새로 크롤링하는 현상 발생. POST 요청에 대한 응답은 Cache API가 기본적으로 캐싱하지 않기 때문이었습니다.

    해결:

        GET 응답 모방: POST 요청에 대한 최종 응답(finalResponse)을 생성한 후, 캐시 저장을 위해 해당 응답의 본문과 헤더를 복사하여 GET 요청에 대한 응답처럼 보이는 별도의 cacheableResponse 객체를 생성했습니다. 이 객체를 캐시에 저장함으로써 Cache API가 정상적으로 동작하도록 수정했습니다.

        await 적용: 로컬 테스트 시 ctx.waitUntil의 비동기 동작으로 인해 캐시 저장이 누락되는 현상을 방지하기 위해, await cache.put()으로 변경하여 캐시 저장이 완료될 때까지 명시적으로 기다리도록 수정했습니다.

        에러 감지 로직 수정: hasCacheBlockingError 함수가 sirip_ebook의 중첩된 에러 구조를 정확히 감지하도록 수정하여, 불완전한 응답이 캐시에 저장되는 것을 방지했습니다.

이번 수정으로 크롤링 성공률과 안정성이 대폭 향상되었으며, 캐시 시스템이 의도대로 동작하여 불필요한 크롤링을 줄이고 응답 속도를 개선했습니다.


456891b
ahnbu
Mon Oct 27 16:36:02 2025 +0900
fix(worker): 시립(구독형) 크롤링 인증 로직 강화 및 문서 업데이트
본문:
세션 획득 실패: HTTP 400 오류가 간헐적으로 발생하는 문제를 해결하고, 관련 기술적 내용을 DEVELOPMENT.md에 상세히 반영했습니다.

주요 변경 사항:

    크롤링 로직 강화 (searchSiripEbookSubs)

        원인: 도서관 서버가 세션 획득을 위한 최초 접속 단계부터 정교한 헤더 검증을 수행하여, 단순화된 헤더를 가진 요청을 봇으로 탐지하고 차단하고 있었습니다.

        해결: 세션 획득(1단계)과 검색(2단계) 요청 모두에 Sec-Fetch-* 계열 헤더 등 실제 브라우저와 거의 동일한 헤더 구성을 적용했습니다. 특히, 각 단계의 맥락에 맞게 Sec-Fetch-Site 값을 'none'과 'same-origin'으로 다르게 설정하여 사용자 행동 패턴을 더욱 정교하게 모방했습니다.

    개발 문서 업데이트 (DEVELOPMENT.md)

        트러블슈팅 가이드의 "세션 쿠키가 필요한 경우" 항목을 이번에 발견된 다단계 방어 정책과 "완전한 브라우저 헤더 모방" 해결 전략에 맞게 내용을 전면 개정했습니다.

        문제의 진화 과정(1차/2차 방어)과 단계별 헤더 구성의 중요성을 명시하여, 향후 유사 문제 발생 시 근본적인 해결책을 찾는 데 도움이 되도록 했습니다.

이번 업데이트를 통해 크롤링 로직의 장기적인 안정성을 확보하고, 프로젝트의 기술적 해결 과정을 체계적으로 문서화했습니다.


ad92c6b
ahnbu
Mon Oct 27 15:49:48 2025 +0900
fix(ui): 상세 모달에서 상태(태그) 업데이트 시 스크롤 위치 유지
본문:
모바일 환경의 MyLibraryBookDetailModal에서 태그를 추가/삭제하거나 다른 상태를 업데이트할 때, 스크롤 위치가 최상단으로 초기화되는 문제를 해결했습니다.

원인:
useBookStore의 전역 상태가 변경되면 모달 컴포넌트가 새로운 book 데이터로 리렌더링되면서, 스크롤 컨테이너의 scrollTop이 0으로 리셋되었습니다.

해결:
useRef와 useLayoutEffect를 사용하여 스크롤 위치를 기억하고 복원하는 로직을 구현했습니다.

    상태 변경을 유발하는 핸들러(handleAddTag, handleRemoveTag) 실행 직전에 현재 스크롤 위치를 useRef에 저장합니다.

    컴포넌트가 리렌더링된 직후 useLayoutEffect를 통해 저장된 위치로 스크롤을 즉시 복원합니다.

이를 통해 상태가 변경되어도 사용자는 보던 위치에서 벗어나지 않게 되어, 특히 스크롤이 필수적인 모바일 환경에서의 사용자 경험(UX)을 크게 향상시켰습니다.


64d65db
ahnbu
Mon Oct 27 15:42:29 2025 +0900
feat(worker): 크롤링 인증 로직 개선 및 트러블슈팅 가이드 문서화
본문:
Cloudflare Worker의 도서관 크롤링 안정성을 강화하고, 주요 문제 해결 과정을 DEVELOPMENT.md에 상세히 기록했습니다.

주요 변경 사항:

    시립(구독형) 크롤링 오류 해결 (HTTP 400)

        searchSiripEbookSubs 함수에 2단계 요청 프로세스를 도입했습니다.

        먼저 세션 쿠키를 획득한 후, 해당 쿠키를 Cookie 및 Referer 헤더에 담아 검색을 요청하는 방식으로 서버의 안티-스크래핑 정책을 우회하여 문제를 해결했습니다.

    DEVELOPMENT.md 트러블슈팅 가이드 대폭 강화

        [유형 1] 세션 쿠키: 이번에 해결한 광주시립도서관(구독형) 사례를 바탕으로 세션 쿠키 방식의 크롤링 해결 과정을 상세히 기술했습니다.

        [유형 2] 동적 토큰: 기존에 해결했던 경기도 전자도서관(구독형) 사례를 동적 인증 토큰 방식의 대표 해결책으로 함께 정리했습니다.

        이를 통해 향후 발생할 수 있는 두 가지 대표적인 크롤링 인증 문제를 체계적으로 진단하고 해결할 수 있는 가이드를 마련했습니다.

이번 업데이트는 API의 안정성을 높이는 동시에, 프로젝트의 기술적 자산과 지식 공유 체계를 강화하여 장기적인 유지보수성을 크게 향상시켰습니다.


b0072fc
ahnbu
Mon Oct 27 15:23:34 2025 +0900
refactor(components): MyLibrary 컴포넌트 분리를 통한 가독성 및 유지보수성 향상
기존에 1500라인이 넘어가던 거대 컴포넌트 `MyLibrary.tsx`를 역할에 따라 세분화하여 구조를 개선했습니다. 이번 리팩토링은 코드의 복잡도를 낮추고, 각 컴포넌트의 책임을 명확히 하여 향후 기능 추가 및 수정 작업을 용이하게 만드는 데 목적이 있습니다.

### 주요 변경 사항

#### 1. `MyLibraryListItem.tsx` 신규 생성
- **역할**: `MyLibrary.tsx`의 카드 뷰 및 그리드 뷰에서 개별 도서 아이템을 렌더링하는 로직을 담당합니다.
- **분리 내용**:
  - 카드/그리드 뷰 JSX 템플릿
  - 아이템 내에서만 사용되는 로컬 컴포넌트 (`ReadStatusDropdown`, `LibraryTag`)
- **기대 효과**: `MyLibrary.tsx`의 가장 큰 JSX 덩어리를 제거하여 부모 컴포넌트의 가독성을 크게 향상시켰습니다. `React.memo`를 적용하여 불필요한 리렌더링을 방지하고 성능을 최적화했습니다.

#### 2. `MyLibraryToolbar.tsx` 신규 생성
- **역할**: 서재 상단의 모든 컨트롤 UI(검색, 필터, 정렬, 일괄 작업 버튼 등)를 담당합니다.
- **분리 내용**:
  - 검색 입력창, 뷰 타입 토글 버튼
  - `TagFilter` 컴포넌트 호출부
  - 정렬 드롭다운 메뉴 및 관련 로직 (`sortDropdownOpen` 상태 등)
  - 선택된 아이템 수 표시 및 일괄 관리(태그, 삭제, 즐겨찾기) 버튼
- **기대 효과**: UI 로직과 상태 관리 로직을 분리했습니다. `MyLibraryToolbar`는 UI 표시에만 집중하고, 모든 상태와 이벤트는 `props`를 통해 부모(`MyLibrary`)로부터 주입받는 구조로 변경되었습니다.

#### 3. `MyLibrary.tsx` 리팩토링
- **역할**: 상태 관리와 비즈니스 로직을 총괄하는 **컨테이너(Container) 컴포넌트**로 역할이 명확해졌습니다.
- **변경 내용**:
  - `MyLibraryListItem`과 `MyLibraryToolbar`를 호출하고 필요한 `props`를 전달합니다.
  - 툴바와 리스트 아이템에서 사용되던 로컬 상태(`sortDropdownOpen` 등)와 헬퍼 함수들을 제거하여 코드를 대폭 간소화했습니다.
  - 검색 기능이 정상 동작하도록 누락되었던 `useEffect` 훅(debouncedSearchQuery 관련)을 복원했습니다.

### 타입 정의 추가
- `types.ts`에 `ViewType` ('card' | 'grid') 타입을 추가하여 프로젝트 전반에서 일관된 타입 사용을 보장합니다.

이번 리팩토링을 통해 `MyLibrary` 관련 컴포넌트들은 **Container/Presentational 패턴**에 가까운 구조를 갖게 되었으며, 이는 코드의 재사용성과 테스트 용이성을 높이는 기반이 됩니다.

(참고) fix(types): MyLibrary에서 Set 타입 추론 오류 수정

본문:
MyLibrary.tsx 컴포넌트 내에서 Set 객체를 새로 생성하거나 복제할 때 타입이 Set<unknown>으로 추론되는 문제를 해결했습니다.

useState, new Set(), new Set(iterable) 구문에서 제네릭 타입 <string>을 명시적으로 선언하여, activeTags 상태 및 관련 변수들이 항상 Set<string> 타입을 유지하도록 수정했습니다.

주요 변경 사항:

    handleTagClick, handleClearAllTags, resetAllLibraryStates 함수 내에서 new Set<string>()으로 타입 명시

    useState<ViewType> 선언 시 ViewType을 types.ts에서 import 하도록 수정

    리팩토링 후 남은 불필요한 주석 코드(LibraryTag 컴포넌트) 제거

이를 통해 filterLibraryByTags 함수 호출 시 발생하던 타입 에러를 해결하고 코드의 타입 안정성을 강화했습니다.


aed0c1a
ahnbu
Mon Oct 27 14:32:29 2025 +0900
fix(api): Cloudflare Worker의 키워드 검색 로직 오류 수정   - 경기도교육청 전자책 검색 결과 처리 시, 존재하지 않는 'availability' 키 대신 올바른 'book_list' 키를 참조하도록 수정하여 검색 결과 누락 문제 해결


8fc5931
ahnbu
Sun Oct 26 16:26:10 2025 +0900
fix(api): 🔧 APITestContent의 API 호출 시그니처 불일치 수정
`unifiedLibrary.service`의 `fetchBookAvailability` 함수 시그니처가 `author` 인수를 필수로 받도록 변경됨에 따라, `APITestContent` 컴포넌트에서 해당 함수를 호출할 때 발생하던 타입스크립트 오류를 수정했습니다.

### 주요 변경 사항

- **`author` 상태 추가**:
  - `APITestContent` 컴포넌트에 `author`와 `setAuthor` 상태를 추가하여 저자 정보를 관리하도록 변경했습니다.

- **API 호출 인수 추가**:
  - `runApiTest` 함수가 `author` 인수를 받도록 시그니처를 업데이트했습니다.
  - 책 검색 후 자동 테스트 실행(`handleApiSelectBook`) 및 수동 테스트 실행(`handleSubmit`) 시 `fetchBookAvailability` 함수에 `author` 인수가 올바르게 전달되도록 수정했습니다.

- **상태 업데이트 로직 개선**:
  - 검색 모달에서 책을 선택하면(`handleApiSelectBook`), `isbn`과 `title`뿐만 아니라 `author` 상태도 함께 업데이트되도록 로직을 개선했습니다.

이번 수정으로 API 테스트 페이지의 기능이 최신 서비스 로직과 일치하게 되어 정상적으로 동작합니다.


afc6431
ahnbu
Sun Oct 26 16:15:31 2025 +0900
refactor : 전반적인 주석 제거


9b2e6c4
ahnbu
Sun Oct 26 16:04:10 2025 +0900
fxi: 좋아요 필터링 버그 수정
좋아요 필터링이 초기 50건에 대해서만 동작하는 버그를 수정했다. 이를 위해 서버 기반의 '좋아요 필터링' 기능을 추가하고, 필터링된 뷰에서 상태 변경이 즉시 UI에 반영되지 않던 버그를 해결했습니다.

### 주요 변경 사항

#### 1. 서버 기반 '좋아요' 필터링 기능 구현 (`useBookStore.ts`)
- **`filterLibraryByFavorites` 액션 추가**:
  - Supabase DB에 `isFavorite: true`인 모든 책을 직접 요청하는 기능을 구현했습니다.
  - 초기 로딩된 50권이 아닌 전체 서재를 대상으로 필터링하여 정확성을 확보했습니다.
  - JSONB 타입에 최적화된 `.contains()` 연산자를 사용하여, `isFavorite` 키가 없는 레코드로 인한 조회 실패 문제를 원천적으로 방지합니다.
- **`libraryFavoritesFilterResults` 상태 추가**:
  - '좋아요' 필터링 결과를 저장할 `libraryFavoritesFilterResults` 상태와 관련 로딩 상태(`isFilteringByFavorites`)를 추가했습니다.
- **`clearLibraryFavoritesFilter` 액션 추가**:
  - 필터 해제 시 관련 상태를 초기화하는 기능을 추가했습니다.

#### 2. '좋아요' 필터 UI 연동 (`MyLibrary.tsx`)
- **버튼 핸들러 수정**:
  - '좋아요' 버튼 클릭 시, 로컬 상태(`showFavoritesOnly`) 변경과 함께 `filterLibraryByFavorites` 스토어 액션을 호출하도록 `handleToggleFavoritesFilter` 함수를 구현했습니다.
- **데이터 소스 분기 처리**:
  - `sortedAndFilteredLibraryBooks`의 `useMemo` 로직을 수정하여, `showFavoritesOnly`가 true일 때 `libraryFavoritesFilterResults` 배열을 데이터 소스로 사용하도록 변경했습니다.
- **로딩 UI 개선**:
  - '좋아요' 필터링이 진행되는 동안 사용자에게 스피너와 함께 "좋아하는 책을 찾는 중입니다..." 메시지를 표시하도록 UI를 개선했습니다.

#### 3. UI 상태 동기화 버그 수정 (`useBookStore.ts`)
- **문제점**:
  - '좋아요' 필터링된 뷰에서 하트 아이콘 클릭 시, DB 데이터는 변경되지만 필터링된 목록(`libraryFavoritesFilterResults`)이 업데이트되지 않아 UI가 갱신되지 않았습니다.
- **해결**:
  - 핵심 데이터 업데이트 함수인 `updateBookInStoreAndDB`가 `myLibraryBooks` 등 기존 3개 배열뿐만 아니라 `libraryFavoritesFilterResults` 배열도 동시에 업데이트하도록 수정했습니다.
  - '좋아요'가 해제된 책은 `.filter()`를 통해 필터링된 목록에서 즉시 제거하여, 사용자의 액션이 UI에 실시간으로 반영되도록 개선했습니다.


25be2ec
ahnbu
Sat Oct 25 19:39:43 2025 +0900
fix(tags): 상세 모달의 태그 정렬 불일치 문제 해결 - 선택된 태그 부분
`MyLibraryBookDetailModal`의 "사용 가능한 태그" 목록이 다른 UI 영역과 달리 색상에 따라 정렬되지 않는 마지막 UI 불일치 문제를 수정했습니다.

- **원인:** 해당 목록을 렌더링하는 로직에 정렬(sort) 단계가 누락되어 있었습니다.
- **해결:** 렌더링 파이프라인에 `1.색상 우선순위`, `2.이름 가나다순`을 기준으로 하는 정렬 로직을 추가하여, 이제 애플리케이션의 모든 태그 표시 영역이 동일한 정렬 규칙을 따르도록 일관성을 확보했습니다.

이 커밋으로 최근 진행된 태그 시스템 개선 작업이 모두 완료되었습니다.


231ced7
ahnbu
Sat Oct 25 19:36:30 2025 +0900
fix(tags): 상세 모달의 태그 정렬 불일치 문제 해결
`MyLibraryBookDetailModal`의 "사용 가능한 태그" 목록이 다른 UI 영역과 달리 색상에 따라 정렬되지 않는 마지막 UI 불일치 문제를 수정했습니다.

- **원인:** 해당 목록을 렌더링하는 로직에 정렬(sort) 단계가 누락되어 있었습니다.
- **해결:** 렌더링 파이프라인에 `1.색상 우선순위`, `2.이름 가나다순`을 기준으로 하는 정렬 로직을 추가하여, 이제 애플리케이션의 모든 태그 표시 영역이 동일한 정렬 규칙을 따르도록 일관성을 확보했습니다.

이 커밋으로 최근 진행된 태그 시스템 개선 작업이 모두 완료되었습니다.


691ec63
ahnbu
Sat Oct 25 19:29:59 2025 +0900
fix(name) : e교육 db 조회명칭 book.ebookInfo -> book.GyeonggiEduEbookInfo로 변경


af4fe66
ahnbu
Sat Oct 25 19:27:04 2025 +0900
docs: 프로젝트 문서 대규모 업데이트 및 최신화
개발 속도에 맞춰 한동안 업데이트되지 않았던 핵심 문서(README, DEVELOPMENT, CHANGELOG)를 현재 구현 내용과 완벽하게 동기화했습니다.

이번 업데이트는 신규 참여자의 온보딩 비용을 줄이고, 프로젝트의 기술적 성과와 발전 과정을 명확하게 기록하여 유지보수성을 높이는 것을 목표로 합니다.

### 1. `CHANGELOG.md` 업데이트
- **이력 복원**: `v2.0.0` 이후 누락되었던 19개 이상의 주요 커밋 히스토리를 분석하여 변경 내역을 모두 복원하고 `v2.1.0` 버전을 추가했습니다.
- **체계화**: 각 변경 사항을 `Fix`, `Feature`, `Refactor` 등으로 분류하고, 커밋 해시를 첨부하여 추적 용이성을 확보했습니다.

### 2. `README.md` (사용자 중심 문서) 전면 개정
- **기능 최신화**: '일괄 재고 갱신' 옵션 확장, '전자책' 검색 등 최근 추가된 모든 기능을 "주요 기능" 섹션에 반영했습니다.
- **성과 요약**: "최신 기술적 개선사항" 섹션을 재구성하여, 데이터 유실 방지, 상태 동기화 버그 해결, API 응답 캐싱 등 주목할 만한 기술적 성과를 상단에 배치하고 요약했습니다.

### 3. `DEVELOPMENT.md` (개발자 중심 문서) 정밀 동기화
- **API 명세 수정**: Cloudflare Workers API 명세에서 실제 코드 변경 사항(예: `author` 파라미터 제거)을 정확히 반영했습니다.
- **데이터 흐름 재설명**: `createBookDataFromApis`의 역할, 데이터 복원 로직 등 현재의 데이터 처리 파이프라인을 Mermaid 다이어그램과 함께 명확하게 재정의했습니다.
- **트러블슈팅 가이드 추가**: 최근 해결한 '"조회중..." 무한 반복 버그'의 원인과 해결책을 추가하여 개발자들의 디버깅을 돕도록 했습니다.


3b73adf
ahnbu
Sat Oct 25 19:08:43 2025 +0900
fix(tags): 태그 정렬 일관성 및 카운트 실시간 업데이트 개선
태그 기능과 관련된 세 가지 UX 불일치 문제를 해결하여, 모든 뷰에서 태그가 일관되게 동작하도록 수정했습니다.

### 1. 개별 책의 태그 정렬 불일치 문제 해결

-   **문제점:** `MyLibrary`의 책 목록(Card/Grid View)에 표시되는 태그 순서가 `TagFilter`의 순서와 다르고, 책마다 제각각으로 표시되는 버그가 있었습니다.
-   **원인:** `MyLibrary`의 렌더링 로직이 태그 정렬 시 `tagCounts`(태그 인기도) 정보를 사용하지 않아, `TagFilter`와 다른 정렬 기준을 가졌기 때문입니다.
-   **해결책:** `MyLibrary` 컴포넌트가 `useBookStore`로부터 `tagCounts` 상태를 가져오도록 수정했습니다. 이제 렌더링 시 `1.색상`, `2.인기도`, `3.이름순`의 일관된 정렬 기준을 적용하여 모든 책에서 태그가 동일한 순서로 표시됩니다.

### 2. 일괄 태그 관리 모달의 정렬 문제 해결

-   **문제점:** '일괄 태그 관리' 팝업 모달에 표시되는 태그들이 색상이나 인기도에 따라 정렬되지 않았습니다.
-   **원인:** 모달에 `settings`에서 가져온 원본 태그 배열을 정렬 없이 그대로 전달하고 있었습니다.
-   **해결책:** `MyLibrary.tsx`에서 `useMemo`를 사용하여 색상과 이름순으로 미리 정렬된 태그 배열(`sortedAvailableTags`)을 생성하고, 이 배열을 `BulkTagModal`과 `TagFilter` 컴포넌트에 일관되게 전달하도록 수정했습니다.

### 3. 태그 카운트 실시간 업데이트 기능 구현

-   **문제점:** 상세 모달 등에서 태그를 추가하거나 제거해도, 상단의 `TagFilter`에 표시되는 태그별 카운트 숫자가 즉시 반영되지 않고 새로고침해야만 갱신되었습니다.
-   **원인:** 상태 변경 함수들(`addTagToBook`, `removeTagToBook` 등)이 `tagCounts` 상태를 업데이트하는 로직이 누락되어 있었습니다.
-   **해결책:** `useBookStore`의 모든 태그 CRUD 관련 함수(`addTagToBook`, `removeTagFromBook`, `updateBookTags`, `updateMultipleBookTags`) 내부에, 로컬 상태인 `tagCounts`를 즉시 증감시키는 낙관적 업데이트(Optimistic Update) 로직을 추가했습니다. 이를 통해 사용자의 액션이 UI에 실시간으로 반영되어 반응성이 크게 향상되었습니다.


851abdb
ahnbu
Sat Oct 25 18:42:11 2025 +0900
fix(store): '좋아요' 적용 버그 수정 - 검색/필터된 책
검색이나 태그 필터를 통해 표시된 책(초기 로딩에 포함되지 않은)에 대해 '좋아요', 태그 추가/삭제 등의 상태 변경 기능이 동작하지 않던 버그를 수정했습니다.

원인은 상태 업데이트 함수(`toggleFavorite`)가 오직 초기 로딩된 `myLibraryBooks` 배열에서만 대상 책을 찾았기 때문입니다.

이 문제를 해결하기 위해, 해당 함수들이 `myLibraryBooks.find()` 대신 모든 데이터 소스(초기 목록, 검색 결과, 필터 결과)를 포괄적으로 조회하는 `getBookById` 함수를 사용하도록 수정하여, 어떤 뷰에서든 모든 책에 대한 상태 변경이 정상적으로 처리되도록 보장했습니다.


b303898
ahnbu
Sat Oct 25 18:32:14 2025 +0900
fix(store): API 실패 시 데이터 유실 방지를 위한 복원 로직 강화
기존 재고 정보 갱신 로직은 `error` 프로퍼티가 명시된 응답에 대해서만 실패로 간주했습니다.

이로 인해, API가 `undefined`나 빈 객체(`{}`)와 같은 비정상 응답을 반환할 경우, 시스템이 이를 성공으로 오판하여 기존에 저장되어 있던 유효한 데이터를 `undefined`로 덮어쓰는 심각한 데이터 유실 버그가 있었습니다.

이 문제를 해결하기 위해, `useBookStore`의 `refreshBookInfo` 함수 내 데이터 병합 로직을 다음과 같이 개선했습니다:

- **통합된 복원 규칙 적용:** 각 도서관 API의 특정 에러 구조를 개별적으로 확인하는 대신, '새로운 데이터가 `undefined` 또는 `null`이면 기존 데이터를 유지한다'는 하나의 단순하고 강력한 규칙을 모든 도서관 정보 필드에 일관되게 적용했습니다.

- **코드 단순화 및 안정성 향상:** 이 변경으로 복원 로직이 훨씬 간결해졌으며, 향후 API 응답 형식이 변경되더라도 데이터 유실을 방지할 수 있는 견고한 구조를 갖추게 되었습니다.


40f31f7
ahnbu
Sat Oct 25 18:02:30 2025 +0900
feat(ui): 상세 모달의 긴 제목을 2줄로 제한
`MyLibraryBookDetailModal`에서 매우 긴 책 제목이 레이아웃을 해치는 문제를 해결합니다.

- 제목(`h3`) 요소에 `line-clamp-2` Tailwind CSS 유틸리티를 적용하여 최대 2줄까지만 표시하고, 나머지는 말줄임표(`...`)로 처리합니다.
- `title` 속성을 추가하여, 사용자가 잘린 제목 위에 마우스를 올리면 전체 제목을 툴팁으로 확인할 수 있도록 UX를 개선했습니다.


8ddd742
ahnbu
Sat Oct 25 17:54:23 2025 +0900
refactor(ux): API 실패 시 "조회중.." 반복 표시 개선 및 안정성 강화
API 조회 실패로 인해 데이터가 `null`로 저장되었을 때, UI가 일관성 없이 동작하던 문제를 해결하고, 정보 제공의 계층화 전략을 도입하여 사용자 경험을 개선합니다.

### 문제점

-   **상세 모달:** API 실패로 `book.siripEbookInfo` 등이 `null`이 되면, `isLoading` 조건(`!book.siripEbookInfo`)이 `true`로 계속 평가되어 "조회중..." 상태가 무한히 표시되는 버그가 있었습니다.
-   **서재 목록:** `null` 값을 에러로 간주하지 않아, 조회 실패가 "재고 없음"(회색 점)으로 표시되었습니다. 이는 정확한 정보 전달 측면에서 개선의 여지가 있었습니다.

### 새로운 UX 전략: 정보 제공의 계층화

사용자가 느끼는 시각적 스트레스와 정보의 정확성 사이의 균형을 맞추기 위해, 컴포넌트별로 다른 정보 표시 전략을 채택했습니다.

1.  **서재 목록 (`MyLibrary.tsx`): 시각적 안정감 우선**
    -   API 실패 시에도 기존처럼 **회색 점**과 `(0/0)`을 표시하여, 훑어보는 과정에서 빨간 점이 주는 미묘한 스트레스를 줄입니다. 사용자는 이를 '재고 없음'으로 빠르게 인지하고 넘어갈 수 있습니다.

2.  **상세 모달 (`MyLibraryBookDetailModal.tsx`): 정보 정확성 우선**
    -   사용자가 상세 정보를 확인하고자 할 때는, API 실패(조회 불가)와 재고 없음(조회 성공)의 차이를 명확히 구분하여 전달합니다. 실패 시 **에러 상태(빨간색 텍스트)**를 명확히 표시합니다.

### 주요 변경 사항

-   **`MyLibraryBookDetailModal.tsx`:**
    -   **"조회중..." 무한 루프 버그 해결:** `StockDisplay`로 전달하는 `isLoading` prop의 조건을 `!book.someInfo`에서 `book.someInfo === undefined`로 변경했습니다. 이를 통해 `null`(값 없음)과 `undefined`(로딩 전) 상태를 명확히 구분하여, `null`일 때 더 이상 로딩 상태로 간주하지 않도록 수정했습니다.
    -   **에러 표시 강화:** `StockDisplay` 내부 로직을 개선하여, `null` 값이나 `error` 객체가 전달될 경우 `hasError`로 판단하고 에러 상태를 명확히 표시하도록 안정성을 강화했습니다.

-   **`MyLibrary.tsx`:**
    -   "실패 시 회색 점 표시"라는 UX 전략에 따라, `isError` 로직을 수정하지 않고 현재 상태를 유지하기로 결정했습니다. `null` 값은 의도적으로 '재고 없음' 상태로 표시됩니다.

### 기대 효과

-   API의 일시적인 실패가 발생해도 상세 모_branch-2_branch-3달에서 "조회중..." 상태에 갇히는 치명적인 UX 버그를 해결했습니다.
-   서재 목록에서는 시각적 피로도를 낮추고, 상세 정보에서는 정확한 상태를 전달하는 계층적인 UX를 구현하여 전반적인 사용성을 향상시켰습니다.


b14ec89
ahnbu
Fri Oct 24 20:21:02 2025 +0900
feat(perf): Cloudflare Cache API 도입하여 API 응답 캐싱 구현
`POST` 요청에 대한 도서관 재고 확인 API의 응답을 캐싱하는 기능을 도입하여, 반복적인 요청에 대한 응답 속도를 비약적으로 향상시키고 외부 API 부하를 줄입니다.

### 주요 변경 사항

1.  **POST 요청 캐싱 전략 도입:**
    -   Cloudflare의 Cache API가 기본적으로 `GET` 요청만 지원하는 제약을 우회하기 위해, `POST` 요청의 본문(body)을 SHA-256으로 해싱하여 고유한 캐시 키를 생성했습니다.
    -   생성된 해시 값을 URL 경로에 포함시킨 `GET` 요청 형태로 캐시 키를 "위장"하여, `POST` 요청의 본문 내용별로 독립적인 캐싱이 가능하도록 구현했습니다.

2.  **캐시 로직 구현:**
    -   API 요청 수신 시, 먼저 생성된 캐시 키로 캐시 저장소(`caches.default`)를 조회합니다.
    -   **Cache HIT:** 캐시된 응답이 존재할 경우, 실제 크롤링을 생략하고 즉시 캐시된 데이터를 반환합니다. 응답 헤더에 `X-Cache-Status: HIT`를 추가하여 동작을 명확히 했습니다.
    -   **Cache MISS:** 캐시가 없을 경우, 기존 크롤링 로직을 수행하고, 생성된 응답을 사용자에게 반환하는 동시에 `ctx.waitUntil`을 사용하여 백그라운드에서 캐시에 저장합니다.

3.  **캐시 만료 시간(TTL) 설정:**
    -   캐시의 유효 기간을 2시간(`expirationTtl: 7200`)으로 설정하여 데이터의 최신성과 성능 사이의 균형을 맞췄습니다.

### 기대 효과

-   **성능 향상:** 캐시 히트 시, API 응답 시간이 수 초에서 수십 밀리초 단위로 단축됩니다.
-   **안정성 강화:** 외부 도서관 서버의 일시적인 오류나 점검 시에도, 캐시된 데이터를 통해 사용자에게 안정적인 서비스를 제공할 수 있습니다.
-   **외부 리소스 보호:** 동일한 요청에 대한 반복적인 크롤링을 방지하여 대상 도서관 서버의 부하를 줄입니다.


36aa1ca
ahnbu
Fri Oct 24 19:53:00 2025 +0900
fix(store): API 부분 실패 시 데이터가 초기화되는 버그 수정
`refreshBookInfo` 로직을 개선하여, 일부 도서관 API 응답에만 에러가 포함된 경우 해당 데이터가 `0/0`으로 초기화되지 않고 기존 DB 값을 유지하도록 수정합니다.

- `finalBookData` 생성 시, 각 API 정보 객체 내부의 `error` 필드를 명시적으로 확인.
- 에러가 있는 정보 블록만 선별하여 기존 데이터로 복원하는 로직 추가.
- API의 간헐적 실패에 대한 데이터 복원력(Resilience) 강화.


2ade7f2
ahnbu
Fri Oct 24 19:38:40 2025 +0900
fix(modal): 상세 모달의 'API' 버튼 기능을 DB 데이터 조회로 복원
상세 정보 모달(`MyLibraryBookDetailModal`)의 'API' 버튼 클릭 시, 실시간으로 외부 API를 호출하던 동작을 수정하여 원래 의도대로 Supabase DB에 저장된 `book_data`를 조회하도록 복원합니다.

### 문제점

-   현재 'API' 버튼은 DB에 저장된 최신 API 응답 스냅샷을 보여주는 대신, 불필요하게 실시간으로 외부 API(알라딘, 도서관)를 재호출하고 있었습니다.
-   이는 원래의 "DB 데이터 확인" 목적과 맞지 않으며, 불필요한 네트워크 요청을 유발했습니다.

### 해결 방안

-   `handleApiButtonClick` 함수의 로직을 `useBookStore`의 `fetchRawBookData(book.id)`를 호출하는 방식으로 변경했습니다.
-   `fetchRawBookData`는 Supabase의 `user_library` 테이블에서 해당 책의 `book_data` JSON 컬럼을 직접 조회하는 역할을 합니다.
-   JSON 뷰어 모달의 제목 프리픽스를 `[API]`에서 `[DB]`로 변경하여, 표시되는 데이터가 실시간이 아닌 데이터베이스 스냅샷임을 명확히 했습니다.

### 기대 효과

-   **기능 정상화:** 'API' 버튼이 "DB에 저장된 마지막 API 응답 확인"이라는 본래의 기능으로 올바르게 동작합니다.
-   **성능 개선:** 불필요한 외부 API 호출을 제거하여 응답 속도를 개선하고 리소스를 절약합니다.
-   **사용자 경험:** 데이터의 출처(`[DB]`)를 명확히 하여 혼동을 방지합니다.


9345ce3
ahnbu
Fri Oct 24 19:32:55 2025 +0900
feat(data): 책 상세 내 API 응답 시간 표시 에러 해결 & 관련 코드 리팩토링
API 정보의 최신성을 나타내는 `lastUpdated` 타임스탬프를 도입하고, 이를 관리하는 데이터 아키텍처를 개선합니다. 이를 통해 재고 정보가 언제 기준인지 명확히 표시하고, 관련 데이터 흐름을 일관성 있게 만듭니다.

### 주요 변경 사항

1.  **데이터 모델 (`types.ts`):**
    -   `BookDataSchema`의 API 정보 그룹(`ApiCombinedBookDataSchema`)에 `lastUpdated: z.number().optional()` 필드를 추가하여 데이터 모델을 확장했습니다.
    -   `addedDate`(서재 추가 시점)와 `lastUpdated`(정보 갱신 시점)의 역할을 명확히 분리했습니다.

2.  **백엔드 API (Cloudflare Worker):**
    -   도서관 재고 확인 API(`/`) 응답의 최상위 레벨에 `lastUpdated: Date.now()`를 포함시켜, 모든 API 정보에 대한 단일 생성 시점을 제공하도록 수정했습니다.

3.  **데이터 처리 파이프라인 (`bookDataCombiner.ts`):**
    -   `createBookDataFromApis` 함수가 API 응답의 `lastUpdated` 값을 결과 객체(`ApiCombinedBookData`)에 포함하도록 책임을 위임했습니다.
    -   이를 통해 데이터 가공 로직을 중앙화하고 `useBookStore`의 복잡성을 줄였습니다.

4.  **상태 관리 (`useBookStore.ts`):**
    -   `refreshBookInfo` 함수에서 `createBookDataFromApis`가 반환한 `pureApiData`를 그대로 사용하여 `lastUpdated`가 자연스럽게 최종 데이터에 포함되도록 로직을 단순화했습니다.

5.  **UI (`MyLibraryBookDetailModal.tsx`):**
    -   재고 정보 업데이트 시간을 표시할 때 `book.ebookInfo.lastUpdated` 대신 `book.lastUpdated`를 참조하도록 수정했습니다.
    -   이를 통해 UI가 데이터의 내부 구조에 대한 의존성을 줄이고, 아키텍처를 개선했습니다.

### 해결된 문제

-   `MyLibraryBookDetailModal`에서 재고 정보 업데이트 시간이 `NaN`으로 표시되던 버그를 근본적으로 해결했습니다.


ac86da5
ahnbu
Fri Oct 24 01:05:13 2025 +0900
fix(ui): 그리드 뷰에서 첫 번째 열이 넓어지는 레이아웃 오류 수정
'내 서재'의 그리드 뷰에서 책 제목이 길 경우, 해당 아이템이 포함된 열의 너비가 다른 열보다 넓어지는 문제를 해결했습니다.

그리드 아이템 컨테이너에 `min-w-0` 클래스를 추가하여, 내부 콘텐츠(긴 제목)가 그리드 너비 계산에 영향을 주지 않도록 수정했습니다. 이를 통해 모든 열이 항상 균등한 너비를 유지하도록 보장합니다.


e7b644f
ahnbu
Fri Oct 24 00:57:59 2025 +0900
fix(api): API 응답의 `customTitle`이 `null`로 반환되는 오류 수정
**문제점:**
프론트엔드에서 `customTitle`을 설정하지 않은 채 재고 조회 API를 요청할 경우(`undefined` 또는 `null` 값으로 전송), 백엔드(Worker)에서 이 값을 제대로 처리하지 못하여 API 응답의 `customTitle` 필드가 `"customTitle": null`로 반환되는 문제가 있었습니다.

**원인:**
백엔드의 `fetch` 핸들러에서 구조 분해 할당 시 `customTitle = ''`와 같이 기본값을 설정했으나, 이는 요청 `body`에 `customTitle` 키가 아예 없을 때만 동작합니다. 키는 존재하되 값이 `null`인 경우에는 기본값이 적용되지 않고 `null`이 그대로 변수에 할당되었습니다.

**수정 내용:**
- `index.js`의 `fetch` 핸들러에서 `customTitle` 변수를 받은 직후, `customTitle = customTitle || '';` 코드를 추가하여 `null`이나 `undefined` 값을 빈 문자열(`''`)로 명시적으로 변환하도록 수정했습니다.

**기대 효과:**
- 이제 API는 `customTitle` 값이 없더라도 항상 `"customTitle": ""`와 같이 일관된 빈 문자열을 반환하여, 프론트엔드에서의 데이터 처리 안정성을 높입니다.


6a4656d
ahnbu
Thu Oct 23 23:44:53 2025 +0900
refactor(api): 신뢰도 문제로 인한 저자명 기반 재고 필터링 기능 제거
전자책 재고 조회 시 정확도를 높이기 위해 도입했던 저자명 필터링 기능이, 도서관별로 다른 저자명 표기(예: '게리 마커스' vs '개리 마커스')로 인해 오히려 정확한 재고를 누락시키는 문제를 유발했습니다.

이에 따라 기능의 신뢰성이 낮다고 판단하여 해당 필터링 로직을 백엔드에서 제거하기로 결정했습니다.

**주요 변경 사항:**

1.  **[백엔드] 저자 필터링 로직 제거**:
    - `index.js`(Cloudflare Worker)에서 `author` 정보를 받아 검색 결과를 필터링하고 요약 정보를 재계산하던 로직을 모두 제거했습니다.
    - 불필요해진 `normalizeAuthor` 헬퍼 함수를 삭제했습니다.

2.  **[프론트엔드] API 호출 시그니처 복원**:
    - 백엔드로 `author` 정보를 보내기 위해 수정했던 `useBookStore.ts`와 `unifiedLibrary.service.ts`의 `refreshBookInfo`, `fetchBookAvailability` 함수 시그니처 및 호출부를 원래대로 복원했습니다.
    - 이 과정에서 발생했던 연쇄적인 TypeScript 타입 오류들도 함께 해결되었습니다.

**유지되는 사항:**
- API 요청 시 `author`와 `customTitle` 파라미터를 보내고, 최종 응답에 해당 값들을 포함시키는 로직은 디버깅 편의성을 위해 그대로 유지합니다. 백엔드는 이 값들을 필터링에 사용하지 않고 그대로 반환만 합니다.

**기대 효과:**
- 저자명 표기 차이로 인해 재고가 누락되는 문제가 해결되어, 모든 전자책 도서관의 재고가 정확하게 집계 및 표시됩니다.
- 백엔드 로직이 단순화되어 유지보수성이 향상되었습니다.


a3b451d
ahnbu
Thu Oct 23 23:23:51 2025 +0900
feat(settings): 재고 일괄 갱신 기능 확장 및 오류 수정
맞춤설정의 '재고 일괄 갱신' 기능을 대폭 확장하고, 기존 기능의 오류를 수정하여 사용자 편의성과 안정성을 높였습니다.

### 1. 갱신 옵션 확장 (오래된 순, 범위 지정)

- **'오래된 순' 옵션 추가**: 기존의 '최근 n권' 방식에 더해, 재고 정보가 가장 오래된 책부터 갱신할 수 있는 '오래된 n권' 옵션을 추가했습니다.
- **'범위 지정' 기능 추가**: 사용자가 직접 갱신할 책의 순서 범위를(예: 100번째 ~ 250번째) 입력하여 특정 구간만 갱신할 수 있는 기능을 구현했습니다.
- **동적 옵션 UI**: 총 보유 권수에 따라 실행 불가능한 옵션(예: 10권 보유 시 '최근 25권')은 드롭다운 목록에서 자동으로 숨겨 사용자 혼동을 방지하도록 UX를 개선했습니다.

### 2. 백엔드 로직 리팩토링 (`useBookStore`)

- `bulkRefreshAllBooks` 함수의 시그니처를 변경하여, `limit` 대신 다양한 조건을 담을 수 있는 `options` 객체({ type, limit, start, end })를 받도록 수정했습니다.
- 이 변경을 통해, 함수 내부에서 `options.type`에 따라 분기하여 '최근순', '오래된순', '범위' 등 다양한 정렬 및 슬라이싱 로직을 유연하게 처리할 수 있도록 구조를 개선했습니다.

### 3. 프로그레스 바 표시 오류 수정

- **문제점**: '범위 지정' 갱신 시, 작업은 정상적으로 수행되었으나 프로그레스 바와 진행률 텍스트(예: n/8권)가 업데이트되지 않는 오류가 있었습니다.
- **수정 내용**: `SettingsModal`의 `handleStartBulkRefresh` 함수에서 `onProgress` 콜백 구현이 누락된 부분을 복원하고, 콜백이 호출될 때 `total` 값이 덮어쓰여지지 않도록 수정하여 `current` 값의 변화가 UI에 올바르게 반영되도록 했습니다.


06606a1
ahnbu
Thu Oct 23 22:45:05 2025 +0900
fix(settings): 재고 일괄 갱신 기능 오류 수정
맞춤설정의 '재고 일괄 갱신' 기능에서 발생하던 두 가지 주요 오류를 수정하여 안정성과 정확성을 개선했습니다.

### 1. 갱신 작업 취소 기능 오작동 문제 해결

- **문제점**: 재고 일괄 갱신이 진행되는 도중 '취소' 버튼을 눌러도, 실제 백그라운드 작업이 멈추지 않고 계속 실행되는 문제가 있었습니다.
- **원인**: `bulkRefreshAllBooks` 함수에 전달되는 `shouldCancel` 콜백이 항상 `false`를 반환하도록 하드코딩되어 있었고, 함수 내부에서도 취소 상태를 효과적으로 확인하지 못했습니다.
- **수정 내용**:
    - `useBookStore.ts`: `bulkRefreshAllBooks` 함수 내부의 `for` 루프와 `for...of` 루프에서 매 작업 단위마다 스토어의 `bulkRefreshState.isCancelled` 상태를 직접 확인하도록 로직을 강화했습니다.
    - `SettingsModal.tsx`: `bulkRefreshAllBooks`를 호출할 때 `shouldCancel` 콜백이 `useBookStore.getState().bulkRefreshState.isCancelled`를 참조하도록 수정하여, 취소 액션이 백그라운드 작업에 올바르게 전달되도록 수정했습니다.

### 2. 특정 수량(100/200권) 갱신 시 전체 서재 미적용 문제 해결

- **문제점**: "최근 100권" 또는 "200권" 갱신을 선택해도, 실제로는 현재 화면에 로드된 책(예: 50권)만을 대상으로 갱신이 실행되었습니다.
- **원인**: `bulkRefreshAllBooks` 함수가 현재 로컬 상태(`myLibraryBooks`)에 있는 책 목록만을 기준으로 대상을 선정했기 때문입니다.
- **수정 내용**:
    - `SettingsModal.tsx`: `handleStartBulkRefresh` 함수를 수정하여, 사용자가 선택한 갱신 수량이 현재 로드된 책의 수보다 많을 경우, `fetchRemainingLibrary()`를 먼저 호출하여 스토어의 `myLibraryBooks`를 전체 서재 목록으로 업데이트한 후에 갱신 작업을 시작하도록 변경했습니다.
    - `SettingsModal.tsx`: `handleDeleteTag` 함수가 오래된 `myLibraryBooks` 상태를 참조하는 잠재적 문제를 해결하기 위해, 함수 실행 시점에 `useBookStore.getState()`를 통해 최신 책 목록을 가져와 사용하도록 수정했습니다.


93ef11a
ahnbu
Thu Oct 23 21:00:46 2025 +0900
fix(core): 저자명(앞2글자) 매칭을 통한 재고 조회 정확성 개선
API 요청 로직을 개선하고 프론트엔드-백엔드 간 데이터 구조 불일치를 해결하여, 여러 도서관의 재고 정보가 정확하게 표시되도록 수정했습니다. 또한, 타입 정의 변경으로 인해 발생한 연쇄적인 오류들을 모두 해결했습니다.

### 1. 저자명 기반 전자책 필터링 기능 추가 (정확도 향상)

- **백엔드(Worker) 수정**:
    - 프론트엔드로부터 `author` 정보를 받아, 각 전자책 API 검색 결과에 대해 저자명을 비교하는 필터링 로직을 추가했습니다.
    - 저자명 비교 시 공백, 특수문자, '지은이' 등의 문구를 제거하는 `normalizeAuthor` 함수를 도입하여 비교 정확도를 높였습니다.
    - 필터링 후에는 각 도서관의 요약 정보(`total_count` 등)를 재계산하여 응답의 일관성을 확보했습니다.
- **프론트엔드 수정**:
    - 재고 정보 갱신(`refreshBookInfo`) 시 백엔드로 `author` 정보를 전달하도록 `fetchBookAvailability` API 호출부를 수정했습니다.

### 2. `refreshBookInfo` 함수 시그니처 불일치 오류 해결

- **문제점**: `refreshBookInfo` 함수에 `author` 인자를 추가하면서, `BookState` 타입 정의와 실제 호출부의 인자 개수가 일치하지 않아 TypeScript 오류(ts2322)가 발생했습니다.
- **수정 내용**:
    - `useBookStore.ts`의 `BookState` 인터페이스에 정의된 `refreshBookInfo` 시그니처에 `author: string`을 추가했습니다.
    - `MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`, `useBookStore.ts` 내에서 `refreshBookInfo`를 호출하는 모든 곳에 `book.author`를 네 번째 인자로 전달하도록 수정했습니다.

### 3. 백엔드 `customTitle` 참조 오류 해결

- **문제점**: 백엔드(Worker) API 핸들러에서 프론트엔드가 보낸 `customTitle`을 변수로 할당하지 않은 채 참조하여 'ReferenceError'가 발생했습니다.
- **수정 내용**: `index.js`의 `fetch` 핸들러에서 요청 본문을 파싱할 때 `customTitle`을 포함하도록 수정하여 오류를 해결했습니다.
- **개선**: 최종 API 응답(`responsePayload`)에도 요청 시 사용된 `author`와 `customTitle`을 포함시켜 디버깅 편의성을 높였습니다.


17b1b3e
ahnbu
Thu Oct 23 20:32:31 2025 +0900
fix(ui): 상세 모달의 'e경기' 재고 미반영 오류 수정
책 상세 정보 모달에서 'e경기' 소장형 전자책 재고가 누락되던 문제를 해결했습니다.

`MyLibrary.tsx`와 동일하게, ISBN 필터링 결과를 우선하던 로직을 제거하고 API 원본 데이터(`gyeonggiEbookInfo`)를 직접 참조하도록 수정하여 재고 집계의 일관성과 정확성을 확보했습니다.


fc5cc73
ahnbu
Thu Oct 23 20:26:20 2025 +0900
fix(stock): 전자책 재고 집계 오류 수정 (e경기, e교육)
일부 전자책 도서관의 재고가 UI에 올바르게 반영되지 않는 두 가지 문제를 해결했습니다.

### 1. 'e경기' 소장형 전자책 재고 미반영 문제 해결

- **문제점**: 'e경기(경기도 전자도서관)'의 경우, '소장형' 전자책의 ISBN이 종이책 ISBN과 다를 때, 프론트엔드의 ISBN 필터링 로직에 의해 재고가 0으로 처리되는 문제가 있었습니다. 이로 인해 구독형 재고는 보이지만 소장형 재고는 누락되었습니다.
- **수정 내용**:
    - `MyLibrary.tsx` (카드/그리드 뷰)와 `MyLibraryBookDetailModal.tsx`에서 'e경기' 재고를 표시할 때, ISBN으로 필터링된 `filteredGyeonggiEbookInfo`를 우선적으로 참조하던 로직을 제거했습니다.
    - 이제 항상 API 원본 결과인 `gyeonggiEbookInfo`를 직접 사용하여 소장형과 구독형 재고를 모두 정확하게 합산하여 표시합니다.

### 2. 'e교육' 전자책 재고 미반영 문제 해결

- **문제점**: 'e교육(경기도교육청 전자도서관)' 재고가 API 응답에는 존재함에도 불구하고 UI에 항상 `0/0`으로 표시되었습니다. 이는 백엔드에서 보낸 요약 정보 객체(`ebookInfo.total_count`)와 UI에서 기대하던 데이터 구조(`ebookInfo.summary.total_count`) 간의 불일치 때문에 발생했습니다.
- **수정 내용**:
    - `bookDataCombiner.ts`를 복잡하게 수정하는 대신, 코드 일관성을 위해 UI 컴포넌트(`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)에서 데이터에 접근하는 방식을 수정했습니다.
    - `ebookInfo.summary.total_count`와 같이 `.summary`를 통해 접근하던 모든 코드를 `ebookInfo.total_count`로 직접 접근하도록 변경하여, 'e경기'와 동일한 방식으로 데이터를 처리하도록 통일했습니다.
    - 이와 함께 불필요해진 `bookDataCombiner.ts`의 데이터 변환 로직을 원래의 단순한 형태로 복구했습니다.


010c488
ahnbu
Thu Oct 23 19:45:18 2025 +0900
fix(tags): 태그 색상(책상세) 및 개수 표시 오류(맞춤설정) 수정
태그 기능과 관련된 두 가지 주요 오류를 수정하여 UI의 정확성과 일관성을 개선했습니다.

### 1. 책 상세 모달의 태그 색상 미적용 문제 해결

- **문제점**: 책 상세 정보 모달(`MyLibraryBookDetailModal`)에서 '선택된 태그'와 '사용 가능한 태그'를 표시할 때, 각 태그에 설정된 고유 색상(`primary`, `secondary`, `tertiary`)이 아닌, 고정된 색상으로 렌더링되고 있었습니다.
- **수정 내용**: `CustomTagComponent`에 `tag` 객체를 전달할 때, 색상 속성을 하드코딩하던 부분을 제거하고 태그 객체를 그대로 전달하도록 수정했습니다.
- **기대 효과**: 이제 상세 모달에서도 각 태그가 맞춤설정에서 지정된 원래 색상으로 올바르게 표시됩니다.

### 2. 맞춤설정의 태그별 도서 개수 부정확 문제 해결

- **문제점**: 맞춤설정(`SettingsModal`)의 '태그 관리' 탭에서 각 태그 옆에 표시되는 도서 개수가, 현재 로드된 일부 도서만을 기준으로 계산되어 전체 서재 기준의 정확한 수치와 달랐습니다.
- **수정 내용**:
    - 개수 계산 로직을 `getTagUsageCount` 함수 호출 방식에서, `useBookStore`로부터 미리 계산된 전체 서재 기준의 `tagCounts` 객체를 직접 참조하는 방식으로 변경했습니다.
    - `useMemo`의 의존성 배열을 `tagCounts`로 올바르게 수정하여, 태그 사용량이 변경될 때마다 정렬 순서가 정확하게 업데이트되도록 수정했습니다.
- **기대 효과**: 태그 관리 화면에서 표시되는 모든 태그의 사용 횟수가 전체 서재 기준으로 정확하게 표시되어 데이터의 신뢰성을 확보했습니다.


3c0e1f5
ahnbu
Thu Oct 23 19:27:57 2025 +0900
feat(ui): 태그 관련 확인 및 상태 메시지의 정보성 강화
태그 기능과 관련된 UI 텍스트의 가독성과 정보성을 높여 사용자 경험을 개선했습니다. 기존에는 선택된 태그의 '개수'만 표시하여 사용자가 내용을 다시 확인해야 하는 불편함이 있었으나, 이제는 태그의 '이름'을 직접 표시하여 직관성을 높였습니다.

### 1. 일괄 태그 관리 모달 메시지 개선

- **변경 내용**: '일괄 태그 관리' 모달에서 추가할 태그를 선택했을 때 표시되는 확인 메시지를 수정했습니다.
- **AS-IS**: `{n}개 태그를 {m}권의 책에 추가합니다.`
- **TO-BE**: `{m}권의 책에 다음 태그를 추가합니다 : {태그1}, {태그2}...`
- **기대 효과**: 사용자가 '적용' 버튼을 누르기 전에 어떤 태그들이 추가될 것인지 명확히 인지할 수 있어, 실수로 잘못된 태그를 추가하는 경우를 방지하고 작업에 대한 확신을 높입니다.
- **수정 파일**: `MyLibrary.tsx` (내부 `BulkTagModal` 컴포넌트)

### 2. 내 서재 태그 필터 상태 메시지 개선

- **변경 내용**: '내 서재'에서 태그로 필터링할 때 하단에 표시되는 상태 메시지를 수정했습니다.
- **AS-IS**: `{n}개의 태그로 필터링됨`
- **TO-BE**: `태그 필터링 : {선택된 태그1}, {선택된 태그2}...`
- **기대 효과**: 사용자가 현재 어떤 태그 조건으로 도서 목록을 보고 있는지 항상 명확하게 확인할 수 있어, 현재 필터링 상태에 대한 컨텍스트를 쉽게 파악할 수 있습니다.
- **수정 파일**: `TagFilter.tsx`


be7101c
ahnbu
Thu Oct 23 19:19:07 2025 +0900
fix(ui): 내 서재 뷰 태그 정렬 일관성 보장
`TagFilter`와 `SettingsModal`에 최근 구현된 태그 정렬 로직이 `MyLibrary` 컴포넌트의 개별 도서에 표시되는 태그에는 적용되지 않아 사용자 경험의 일관성이 저하되는 문제가 있었습니다.

이번 커밋은 카드뷰와 그리드뷰 모두에서 태그를 렌더링하기 전에 `book.customTags` 배열에 정렬 로직을 추가하여 이 문제를 해결합니다.

**주요 변경 사항:**

- **태그 정렬 로직 추가**: `MyLibrary.tsx`의 카드뷰와 그리드뷰에서 태그를 렌더링하기 전에, 정의된 색상 우선순위(`primary > secondary > tertiary`)에 따라 정렬하는 로직을 추가했습니다.
- **TypeScript 오류 수정**: 정렬 로직에 사용된 `TagColor` 타입을 `MyLibrary.tsx` 파일에 import하여, '타입을 찾을 수 없음 (ts2304)' 오류를 해결했습니다.


926af0f
ahnbu
Thu Oct 23 00:17:51 2025 +0900
feat: 태그 필터링 개선 및 신규 색상 추가
태그 시스템의 필터링 기능과 시각적 옵션을 확장하고, 정렬 로직을 개선했습니다.

### 1. 태그 필터링 및 정렬 기능 강화 (내 서재)

- **표시 제한 해제**: '내 서재' 상단의 태그 필터에서 인기도 상위 10개의 태그만 표시되던 제한을 제거했습니다. 이제 사용된 적이 있는 모든 태그가 목록에 표시됩니다.
- **정렬 순서 변경**: 태그 필터와 맞춤설정의 태그 목록 정렬 순서를 통일하고, 최종적으로 **`기본(primary) > 보조(secondary) > 연보라(tertiary)`** 색상 순으로 1차 정렬 후, 각 색상 그룹 내에서 인기도(사용 횟수)가 높은 순으로 2차 정렬되도록 로직을 수정했습니다.

### 2. 신규 '연보라(tertiary)' 태그 색상 추가

- **신규 색상 옵션**: 맞춤설정의 태그 관리에서 '연보라' 색상을 선택하여 태그를 생성할 수 있도록 기능을 추가했습니다.
- **디자인 시스템 적용**:
    - `types.ts`, `CustomTag.tsx`, `SettingsModal.tsx`에 'tertiary' 타입을 추가했습니다.
    - `index.css`에 `.tag-tertiary` 스타일을 추가하되, 기존 `.btn-secondary`의 색상 변수를 활용하고, 다른 태그들과 시각적 일관성(투명 테두리, `oklch` hover 효과 등)을 유지하도록 정의했습니다.


d242af5
ahnbu
Wed Oct 22 23:35:03 2025 +0900
feat: 도서 상세 모달의 태그 버튼 전체 클릭으로 변경 (기존에는 +, x만 클릭 가능)
이번 커밋은 도서 상세 정보 모달 내 태그 관리 기능의 사용자 경험과 기술적 정확성을 개선하는 데 중점을 두었습니다.

- **태그 클릭 경험 개선 및 Optimistic UI 적용:**
  - 태그 생성 및 삭제 기능에 Optimistic UI(낙관적 UI) 패턴을 적용했습니다. 이제 UI는 백그라운드에서 비동기 작업이 완료되는 동안 해당 태그를 시각적으로 비활성화하여 즉시 응답하며, 훨씬 부드러운 사용자 경험을 제공합니다.
  - 기존의 아이콘만 클릭 가능했던 방식에서, 태그 전체 영역을 클릭하여 태그를 추가하거나 제거할 수 있도록 개선했습니다.

- **중첩 오류 방지를 위한 `CustomTagComponent` 리팩토링:**
  - `<button>` 내부에 또 다른 `<button>`이 중첩되어 발생하던 HTML 유효성 오류 및 React Hydration 경고를 해결하기 위해 `CustomTagComponent`를 리팩토링했습니다.
  - 이제 이 컴포넌트는 내부에 중첩된 버튼 없이 단일 `<button>` 요소로 작동합니다. 클릭 핸들러(`onAdd`, `onClose`, `onClick`)는 컴포넌트 자체에서 직접 관리합니다.

- **React "Rules of Hooks" 위반 오류 수정:**
  - `if (!book)`과 같은 조기 반환 구문 뒤에서 Hook(`useState`, `useCallback`)이 조건부로 호출되어 발생하던 심각한 오류를 수정했습니다.
  - 모든 Hook을 `MyLibraryBookDetailModal` 컴포넌트의 최상단으로 이동시켜, 모든 렌더링에서 동일한 순서로 호출되도록 보장함으로써 "Rules of Hooks"를 준수하도록 변경했습니다.


c6ccdd2
ahnbu
Wed Oct 22 19:00:30 2025 +0900
refactor : 주석 정리


57b8451
ahnbu
Wed Oct 22 18:56:06 2025 +0900
fix: 초기 로드되지 않은 도서의 중복 체크 오류 해결
**문제 원인**
검색 결과 모달에서 도서의 중복 여부를 검사할 때, 페이지네이션으로 로드된 `myLibraryBooks` 배열(초기 50권)만을 대상으로 하여, 서재에 있지만 아직 로드되지 않은 책들은 중복으로 인식하지 못하는 문제가 있었음.

또한, 데이터 소스(Supabase, Aladin API) 간의 미세한 데이터 차이(보이지 않는 공백, 타입 불일치)로 인해 ISBN 문자열 비교가 실패하는 현상도 발견됨.

**해결 방안**
1.  **전체 ISBN 목록 관리**: `useBookStore`에 `myLibraryIsbnSet`을 도입하여, 앱 로딩 시 Supabase RPC를 통해 사용자의 전체 서재 ISBN 목록을 미리 로드하고 Set에 저장함. 이를 통해 중복 체크가 전체 데이터를 대상으로 하도록 변경.

2.  **효율적인 중복 검사**: `isBookInLibrary` 함수를 새로 만들어, 배열 순회(`Array.some`) 대신 `Set.has()`를 사용하도록 개선. 이로써 중복 검사 성능이 O(N)에서 O(1)으로 향상됨.

3.  **데이터 정규화**: 모든 ISBN 값을 저장하거나 비교하기 전에 `.toString().trim()`을 적용하여, 양쪽 데이터 소스의 공백 및 타입 불일치 문제를 해결하고 비교의 정확성을 보장함.

4.  **상태 동기화**: `addToLibrary`, `removeFromLibrary` 액션이 실행될 때 `myLibraryIsbnSet`의 상태도 함께 업데이트하도록 하여 데이터 정합성을 유지함.


f1bb5ef
ahnbu
Wed Oct 22 18:36:01 2025 +0900
fix(ui): 서재 UI 데이터 동기화 및 초기 상태 오류 수정
내 서재의 사용자 경험을 저해하는 두 가지 주요 버그를 수정했습니다.

1.  **검색/필터 결과에서 아이템 삭제 시 UI 즉시 반영**
    -   **문제**: 내 서재 검색 또는 태그 필터링 결과 화면에서 책을 삭제해도, UI가 새로고침 전까지 변경되지 않는 문제가 있었습니다.
    -   **원인**: `removeFromLibrary` 함수가 `myLibraryBooks` 상태 배열만 업데이트하고, `librarySearchResults`, `libraryTagFilterResults`는 업데이트하지 않았기 때문입니다.
    -   **해결**: `removeFromLibrary` 함수 로직을 수정하여, 관련된 모든 상태 배열(`myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`)에서 삭제된 아이템을 동시에 제거하도록 변경했습니다. 이를 통해 어떤 뷰에서든 삭제가 즉시 UI에 반영됩니다.

2.  **신규 도서 추가 시 도서관 초기 상태 오류 수정**
    -   **문제**: 새로운 책을 서재에 추가했을 때, '퇴촌' 및 '기타' 도서관의 재고 상태 점이 불필요하게 오류를 의미하는 빨간색으로 표시되었습니다.
    -   **원인**: `addToLibrary` 함수에서 `gwangjuPaperInfo`의 초기값을 에러 객체(`{ error: '...' }`)로 설정했기 때문입니다.
    -   **해결**: `gwangjuPaperInfo`의 초기값을 다른 도서관 정보와 동일하게 `null`로 변경하여, 모든 도서관이 일관되게 정상 상태(회색 점)로 표시되도록 수정했습니다.

### 현재 문제점 (TODO)

-   초기 로드된 50권 이외의 책에 대해 "추가됨" 상태가 UI에 정상적으로 표시되지 않는 문제가 남아있음.
-   `fetchUserLibrary`에서 RPC 호출 결과를 `myLibraryIsbnSet`에 채우는 과정에 문제가 있는 것으로 추정되며, 추가 디버깅이 필요함.


66c88f1
ahnbu
Wed Oct 22 17:34:28 2025 +0900
fix(data): 재고 조회 실패 시 기존 데이터 유지하도록 로직 개선
API를 통한 도서관 재고 정보 새로고침이 실패했을 때, 기존에 저장되어 있던 재고 수량이 `0/0`으로 초기화되던 문제를 해결했습니다. 이제 API 호출이 실패하더라도 과거 재고 데이터를 그대로 유지하면서, UI상으로는 에러 상태(빨간색 점)만 표시하여 사용자 경험을 향상시켰습니다.

### 문제 상황

-   `refreshBookInfo` 실행 시 특정 도서관 API(예: `gwangju_paper`) 호출이 타임아웃 등으로 실패하는 경우.
-   `createBookDataFromApis` 함수가 해당 재고 정보(`toechonStock` 등)를 `0/0`으로 초기화하여 반환.
-   `refreshBookInfo` 함수가 이 초기화된 값으로 `book_data`를 업데이트하여 DB에 저장.
-   결과: `(녹색)퇴촌(3/2)` -> 새로고침 실패 -> `(빨간색)퇴촌(0/0)`으로 표시되어 기존 정보가 유실됨.

### 해결 방안

1.  **데이터 조합 로직 수정 (`utils/bookDataCombiner.ts`)**
    -   `createBookDataFromApis` 함수에서 API 호출 실패 시 재고 정보(`toechonStock` 등)를 생성하는 `else` 블록을 제거했습니다.
    -   이제 API가 실패하면 해당 재고 속성은 `undefined`로 남게 되어, "데이터 없음"을 명시적으로 표현합니다.

2.  **데이터 병합 로직 개선 (`useBook-store.ts`)**
    -   `refreshBookInfo` 함수에서 최종 데이터 객체를 생성할 때 Nullish Coalescing Operator (`??`)를 사용했습니다.
    -   `createBookDataFromApis`로부터 받은 객체의 속성이 `undefined`일 경우(즉, API 실패), `originalBook`(DB의 기존 데이터)의 값을 사용하도록 로직을 변경했습니다.
    -   `toechonStock: pureApiData.toechonStock ?? originalBook.toechonStock` 와 같은 형태로, 성공한 데이터는 업데이트하고 실패한 데이터는 기존 값을 유지합니다.

### 기대 효과

-   **(원하는 동작 구현)**: `(녹색)퇴촌(3/2)` -> 새로고침 실패 -> `(빨간색)퇴촌(3/2)`로 표시됩니다.
-   **정보 보존**: 일시적인 네트워크 오류로 인해 유용한 과거 재고 정보가 사라지는 것을 방지합니다.
-   **견고성 향상**: 각 도서관 API의 개별적인 실패가 다른 데이터에 영향을 주지 않도록 데이터 파이프라인의 견고성을 높였습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


1e14988
ahnbu
Wed Oct 22 17:28:27 2025 +0900
feat(data): 데이터 중복 저장 방지를 위한 이중 방어 체계 구축
프론트엔드(UI)와 백엔드(DB) 양단에 중복 데이터 방지 로직을 구현하여 데이터 무결성을 강화했습니다. 사용자가 실수로 동일한 책을 중복 추가하는 것을 방지하고, 만약의 경우에도 데이터베이스 레벨에서 중복 저장을 원천적으로 차단합니다.

### 1. 백엔드(DB) 개선: UNIQUE 제약 조건 설정 (근본적인 해결)

-   **`user_library` 테이블에 UNIQUE 인덱스 추가**
    -   `user_id`와 `book_data` JSONB 컬럼 내부의 `isbn13` 값을 조합하여 고유 키로 설정했습니다.
    -   SQL: `CREATE UNIQUE INDEX ... ON public.user_library (user_id, (book_data->>'isbn13'))`
    -   이를 통해 동일한 사용자가 동일한 ISBN13의 책을 두 번 이상 저장하려는 시도를 데이터베이스 레벨에서 차단합니다.
    -   프론트엔드 로직에 버그가 발생하거나 API가 직접 호출되더라도 데이터 무결성이 보장됩니다.

-   **기존 중복 데이터 정리**
    -   UNIQUE 인덱스 설정을 위해, 기존에 존재하던 중복 데이터를 식별하고 안전하게 제거하는 스크립트를 실행했습니다.

### 2. 프론트엔드(UI) 로직 강화 (사용자 경험 개선)

-   **`BookDetails.tsx` (도서 상세 뷰)**
    -   `useMemo`를 사용하여 현재 선택된 책이 `myLibraryBooks`에 이미 존재하는지 실시간으로 확인합니다 (`isBookInLibrary`).
    -   책이 이미 서재에 있을 경우, "내 서재에 추가" 버튼을 비활성화(`disabled`)하고 버튼 텍스트를 "서재에 이미 있음"으로 변경하여 사용자에게 명확한 피드백을 제공합니다.

-   **`BookSearchListModal.tsx` (검색 결과 모달)**
    -   검색 결과 목록에서 이미 서재에 추가된 책에 대해 "추가됨" 배지를 표시하여 시각적으로 구분합니다.
    -   이미 추가된 책을 클릭할 경우, 책을 다시 추가하는 대신 해당 책의 상세 정보 모달(`MyLibraryBookDetailModal`)을 열어주는 UX 흐름을 유지하여, 사용자가 기존에 저장된 정보를 쉽게 확인할 수 있도록 했습니다.

### 기대 효과

-   **데이터 무결성 확보**: 어떤 경우에도 `user_library` 테이블에 사용자별 중복 도서가 저장되지 않습니다.
-   **사용자 경험 향상**: 사용자는 책 추가 가능 여부를 직관적으로 인지할 수 있으며, 중복 추가 시도가 차단됩니다.
-   **시스템 안정성 증가**: 프론트엔드와 백엔드가 각자의 위치에서 중복을 검증하는 이중 방어 체계를 구축하여 시스템 전체의 안정성을 높였습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


c27a02b
ahnbu
Wed Oct 22 17:08:10 2025 +0900
refactor(data): 데이터 파이프라인 안정성 강화 및 타입 시스템 리팩토링
데이터 처리의 핵심 파이프라인을 리팩토링하여 타입 안정성과 런타임 견고성을 크게 향상시켰습니다. API 응답 실패 시 발생하던 렌더링 오류를 근본적으로 해결하고, 데이터 구조를 명확하게 정의하여 유지보수성을 높였습니다.

### 주요 변경 사항

1.  **타입 시스템 강화 (types.ts)**
    -   `BookData`, `SelectedBook` 등 핵심 타입을 순수 TypeScript `type`에서 **Zod 스키마 기반으로 전환**하여 런타임 유효성 검증을 추가했습니다.
    -   `ApiCombinedBookData` 타입을 신규 정의하여, API로부터 조합된 순수 정보와 사용자의 활동 정보를 명확히 분리했습니다.

2.  **데이터 조합 로직 개선 (utils/bookDataCombiner.ts)**
    -   `combineApiResults` 함수를 `createBookDataFromApis`로 변경하고, 명시적인 `ApiCombinedBookData` 타입을 반환하도록 수정했습니다.
    -   API 응답이 실패하거나 특정 필드가 누락된 경우에도, `toechonStock`, `ebookInfo` 등의 속성이 기본값(`null` 또는 `{...}`)으로 항상 존재하도록 보장하여 데이터 구조의 일관성을 확보했습니다.

3.  **상태 관리 로직 업데이트 (useBook-store.ts)**
    -   `refreshBookInfo`, `addToLibrary` 함수에서 새로 정의된 `createBookDataFromApis`를 사용하도록 수정하여, DB에 저장되는 데이터의 무결성을 강화했습니다.
    -   `updateBookInStoreAndDB` 헬퍼 함수를 개선하여 `note`와 같은 최상위 컬럼과 `book_data` 내부 필드 업데이트를 모두 안전하게 처리하도록 수정했습니다.

4.  **UI 렌더링 안정성 확보 (MyLibrary.tsx, MyLibraryBookDetailModal.tsx)**
    -   데이터 객체의 속성에 접근하는 모든 부분에 **연쇄적인 Optional Chaining (`?.`)**을 적용했습니다.
    -   이를 통해 DB에 저장된 데이터 구조가 불완전하더라도 런타임 에러 없이 페이지가 안전하게 렌더링 되도록 방어 코드를 강화했습니다.

### 해결된 문제

-   API 응답 실패 시, `summary`나 `total_count` 등이 없는 불완전한 객체가 DB에 저장되어 페이지 로딩 시 `TypeError`가 발생하던 문제를 해결했습니다.
-   이제 `refreshBookInfo` 실패 후 페이지를 새로고침해도 앱이 크래시되지 않습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


5e61627
ahnbu
Mon Oct 20 23:30:11 2025 +0900
refactor(core): API 응답 처리 파이프라인 재구축 및 데이터 흐름 개선
프로젝트의 핵심 데이터 처리 로직인 API 응답 조합 및 저장 파이프라인을 전면적으로 리팩토링했습니다. 이번 작업은 데이터의 일관성을 확보하고, 관심사를 명확히 분리하여 코드의 안정성과 유지보수성을 대폭 향상시키는 것을 목표로 합니다.

### 1. 타입 아키텍처 재정립 (Phase 1)

-   **타입 정의 중앙화**: `services/unifiedLibrary.service.ts`에 분산되어 있던 모든 API 관련 타입을 `types.ts`로 이전하여, `types.ts`를 타입 정의의 유일한 출처(Single Source of Truth)로 확립했습니다.
-   **의존성 구조 개선**: `types.ts` <-> `services` 간의 복잡한 의존성 문제를 해결하고, 모든 모듈이 `types.ts`에서만 타입을 참조하도록 데이터 흐름을 단방향으로 개선했습니다.
-   **전역 `import` 경로 수정**: 타입 정의 위치 변경에 따라, 프로젝트 전반에 걸쳐 `import` 경로를 수정하여 새로운 아키텍처에 맞게 통일했습니다.

### 2. 데이터 처리 로직 분리 (Phase 2)

-   **`utils/bookDataCombiner.ts` 도입**: API 응답을 조합하는 로직을 중앙에서 관리하기 위한 새로운 유틸리티 파일을 생성했습니다.
-   **두 가지 조합 함수로 역할 분리**:
    1.  **`combineRawApiResults`**: API 테스트 및 디버깅을 위해, API 응답 원본을 가공 없이 그대로 병합하는 함수를 추가했습니다.
    2.  **`combineApiResults`**: DB 저장 및 화면 표시에 최적화된 형태로 데이터를 가공(요약, 파생, 재구성)하는 기존 로직을 이 함수로 분리했습니다.
-   **`isbnMatcher.ts` 리팩토링**: `filterGyeonggiEbookByIsbn` 및 관련 헬퍼 함수들이 불필요하게 큰 `BookData` 타입 대신, 실제 필요한 최소한의 타입(`AladdinBookItem`)에 의존하도록 수정하여 결합도를 낮추고 재사용성을 높였습니다.

### 3. 애플리케이션에 새로운 파이프라인 통합 (Phase 3)

-   **`useBookStore.ts` (`refreshBookInfo`)**:
    -   `combineApiResults`를 사용하여 "순수 API 데이터"를 생성합니다.
    -   기존 `book_data`에서 "사용자 활동 데이터"(`rating`, `note` 등)를 명시적으로 분리하여, 두 데이터를 안전하게 병합한 후 DB에 업데이트하도록 수정했습니다. 이를 통해 API 정보 갱신 시 사용자 데이터가 유실될 위험을 원천적으로 차단했습니다.
-   **`APITestContent.tsx` & `MyLibraryBookDetailModal.tsx`**:
    -   `combineRawApiResults`를 사용하도록 수정하여, 이제 API 테스트 및 'API 보기' 기능에서 가공되지 않은 원본(Raw) 데이터를 일관되게 확인할 수 있습니다.
-   **`JsonViewerModal.tsx`**:
    -   사용자 편의성을 위해 클립보드 복사 기능을 추가했습니다.

### 기대 효과

-   **데이터 일관성 확보**: API 데이터를 조합하고 저장하는 방식이 표준화되어, 애플리케이션의 모든 부분에서 일관된 데이터를 사용하게 됩니다.
-   **유지보수성 대폭 향상**: 타입, 데이터 가공, 상태 관리의 역할이 명확히 분리되어, 향후 기능 추가 및 수정 시 예측 가능하고 안전한 코드 변경이 가능해졌습니다.
-   **디버깅 효율 증대**: API 원본 데이터와 가공된 데이터를 명확히 분리하여 확인할 수 있어, 문제 발생 시 원인 추적이 용이해졌습니다.

이번 리팩토링을 통해 프로젝트의 기술 부채를 크게 해소하고, 더 견고하고 확장 가능한 코드 기반을 마련했습니다.


527ec7d
ahnbu
Mon Oct 20 22:38:42 2025 +0900
test: vercel deploy 테스트


7288f14
ahnbu
Mon Oct 20 18:25:23 2025 +0900
refactor(types): LibraryName import 오류 수정


579a100
ahnbu
Mon Oct 20 18:23:42 2025 +0900
refactor(types): 타입 아키텍처 중앙화 및 재정립
프로젝트 전반의 타입 정의 구조를 개선하여 유지보수성과 안정성을 높이기 위한 대규모 리팩토링을 진행했습니다. 기존에 `types.ts`와 `services/unifiedLibrary.service.ts`에 분산되어 있던 타입 정의를 `types.ts`로 중앙화하여, 모든 타입의 유일한 출처(Single Source of Truth) 원칙을 확립했습니다.

### 주요 변경 사항

1.  **타입 정의 중앙화**:
    *   `services/unifiedLibrary.service.ts`에 있던 모든 API 관련 인터페이스(`LibraryApiResponse`, `GwangjuPaperResult` 등 14개)를 `types.ts`로 이동시켰습니다.
    *   이제 `types.ts`가 프로젝트의 모든 핵심 타입과 API 응답 타입을 관리합니다.

2.  **의존성 구조 개선**:
    *   기존의 복잡하고 잠재적인 순환 참조 위험이 있던 `types.ts` <-> `services` 간의 의존성 문제를 해결했습니다.
    *   이제 모든 파일(`services`, `stores`, `components` 등)은 타입을 오직 `types.ts`에서만 import합니다. 이로 인해 타입의 흐름이 단방향으로 명확해졌습니다.

3.  **`import` 경로 전면 수정**:
    *   `unifiedLibrary.service.ts`에서 타입을 가져오던 모든 파일(`useBookStore.ts`, `MyLibrary.tsx` 등)의 `import` 구문을 수정했습니다.
    *   타입은 `types.ts`에서, 함수는 `unifiedLibrary.service.ts`에서 가져오도록 `import` 문을 명확하게 분리하여 가독성을 높였습니다.

4.  **유사 타입 유지**:
    *   `GyeonggiEbookError`와 `GyeonggiEduEbookError`는 각각 '경기도 전자도서관'과 '경기도 교육청 전자도서관'이라는 별개의 시스템을 나타낼 가능성을 고려하여, 섣불리 통합하지 않고 기존 구조를 그대로 유지했습니다. 이는 향후 시스템별 에러 포맷 변경에 유연하게 대응할 수 있도록 합니다.

### 기대 효과

*   **유지보수성 향상**: 타입 관련 수정이 필요할 때 `types.ts` 파일 하나만 확인하면 되므로 디버깅 및 기능 추가가 용이해집니다.
*   **안정성 증대**: 타입의 출처가 명확해져 이름 충돌이나 순환 참조와 같은 잠재적 버그를 원천적으로 방지합니다.
*   **코드 가독성 개선**: 타입과 함수의 `import` 경로가 명확히 분리되어, 코드의 의존 관계를 파악하기 쉬워졌습니다.

이번 리팩토링은 향후 "API 응답 포맷 통일"과 같은 후속 작업을 위한 안정적인 기반을 마련하는 중요한 단계입니다.


1f73729
ahnbu
Mon Oct 20 18:01:46 2025 +0900
docs: apitest.tsx 미사용으로 temp로 이동


b721d1d
ahnbu
Mon Oct 20 16:11:41 2025 +0900
feat: 파싱 로직을 정규식에서 node-html-parser로 전환
기존 정규식(Regex) 기반의 불안정한 HTML 파싱 로직을 node-html-parser 라이브러리를 사용한 CSS 선택자 기반으로 전면 리팩토링했습니다. 이를 통해 도서관 웹사이트의 마크업 변경에 대한 안정성을 대폭 향상시키고, 코드의 가독성 및 유지보수성을 개선했습니다.

### 주요 변경 사항

#### 1. 광주 시립 (소장형 전자책) 파싱 개선 (`parseSiripEbookOwnedHTML`)
- **Why**: 구독형 파싱 로직(`parseSiripEbookSubsHTML`)과 동일한 구조임에도 복잡한 정규식 패턴을 사용하여 취약했음.
- **How**: `querySelector`와 `.childNodes` 분석을 통해 구독형과 동일한 안정적인 방식으로 제목, 저자, 대출 현황 등을 추출하도록 수정.

#### 2. 광주 시립 (종이책) 파싱 통합 및 개선 (`parseGwangjuHTML`, `parseGwangjuPaperKeywordResults`)
- **Why**: ISBN 검색과 키워드 검색 파싱 로직이 중복되고 정규식에 의존하여 유지보수가 어려웠음.
- **How**:
    - `parseGwangjuBookItem` 헬퍼 함수를 도입하여 중복 로직을 중앙화.
    - `querySelector`를 사용하여 각 정보(제목, 도서관, 대출상태)를 구조적으로 추출.
    - ISBN/키워드 검색 시 발생하는 미세한 HTML 구조 차이(e.g., `dd.data` 태그 유무)를 모두 처리할 수 있도록 헬퍼 함수 로직 강화.

#### 3. 경기도 교육청 (전자책) 파싱 개선 (`parseGyeonggiEduHTML`)
- **Why**: 가장 복잡한 중첩 정규식을 사용하고 있어 HTML 변경에 가장 취약했음.
- **How**:
    - 파싱의 핵심 데이터 소스를 `.bif` 내부 정보가 아닌 `a.selectBook` 태그의 `keyvalue` 속성으로 변경.
    - `keyvalue` 속성을 `split('///')`으로 분해하여 제목, 저자, ISBN 등 핵심 정보를 가장 정확하고 안정적으로 추출.
    - `keyvalue`에 없는 발행일, 대출 상태 정보만 `.bif` 영역에서 보조적으로 추출하는 하이브리드 방식으로 안정성 극대화.

### 기대 효과
- **안정성 향상**: 외부 웹사이트의 사소한 마크업 변경에도 크롤링 기능이 쉽게 깨지지 않음.
- **유지보수성 개선**: 복잡한 정규식 대신 직관적인 CSS 선택자를 사용하여 코드 분석 및 수정이 용이해짐.
- **코드 품질 향상**: 프로젝트 전반의 파싱 방식 통일 및 중복 코드 제거.


b13227c
ahnbu
Sun Oct 19 16:16:21 2025 +0900
docs: 알라딘api문서 업데이트


7eb7a95
ahnbu
Sun Oct 19 16:15:15 2025 +0900
feat(admin): 상세 모달에 API Raw 데이터 뷰어 기능 추가
서재의 도서 상세 정보 모달(`MyLibraryBookDetailModal`) 내에 [API] 버튼을 추가하여, 개발 및 디버깅 시 Supabase DB에 저장된 `book_data` JSON 원본을 직접 확인할 수 있는 기능을 구현했습니다.

- **기능 추가 (Feature)**
  - **`JsonViewerModal` 컴포넌트 생성**:
    - JSON 데이터를 입력받아 가독성 있게 포맷팅하여 보여주는 재사용 가능한 모달 컴포넌트를 추가했습니다.
    - ESC 키로 닫기, `z-index` 관리 등 다른 전역 모달과 일관된 사용자 경험을 제공합니다.

  - **`fetchRawBookData` 액션 추가**:
    - `useBookStore`에 특정 책 ID로 `user_library` 테이블의 `book_data` 컬럼만 효율적으로 조회하는 `fetchRawBookData` 비동기 함수를 추가했습니다.

  - **UI 연동**:
    - `MyLibraryBookDetailModal`의 '도서관 재고' 섹션에 [API] 버튼을 추가하고, 클릭 시 `fetchRawBookData`를 호출하여 `JsonViewerModal`에 데이터를 표시하도록 연동했습니다.

- **리팩토링 (Refactor)**
  - **모달 상태 관리 중앙화**:
    - `JsonViewerModal`의 열림 상태(`isOpen`) 및 데이터(`jsonData`)를 컴포넌트 내부의 로컬 `useState`에서 **전역 `useUIStore`로 이전**했습니다.
    - 이는 `MyLibraryBookDetailModal`의 리렌더링 시 JSON 뷰어 모달의 상태가 초기화되는 문제를 해결하기 위함입니다. `AdminPanel -> DevNoteModal`과 동일한 전역 상태 관리 패턴을 적용하여 안정성을 확보했습니다.

  - **"상태 끌어올리기(Lifting State Up)" 구조 개선**:
    - `LibraryStockSection` 컴포넌트에서 상태 관리 로직을 제거하고, 부모인 `MyLibraryBookDetailModal`로부터 필요한 상태와 이벤트 핸들러를 `props`로 전달받는 순수한 UI 컴포넌트로 변경하여 역할과 책임을 명확히 분리했습니다.

- **설정 (Chore)**
  - `App.tsx`의 최상위 렌더링 영역에 `<JsonViewerModal />`을 추가하여, 앱 전역에서 해당 모달을 호출할 수 있도록 구성했습니다.


00f6b8a
ahnbu
Sun Oct 19 15:21:35 2025 +0900
feat: 알라딘 검색 기능 개선 및 UI 버그 수정
알라딘 API 연동 검색 기능을 대폭 개선하고, 이와 관련된 UI 전반의 데이터 표시 오류를 수정하여 사용자 경험과 코드의 안정성을 향상시켰습니다.

- **기능 개선 (Feature)**
  - **검색 결과 개수 확장**:
    - 알라딘 도서 검색(`searchAladinBooks`) 시 한 번에 불러오는 결과 수를 20개에서 40개로 확장했습니다.
    - `maxResults`를 함수 인자로 전달하도록 변경하여, 향후 다른 기능에서 필요에 따라 결과 수를 유연하게 조절할 수 있도록 개선했습니다.

  - **'전자책' 검색 옵션 추가**:
    - 메인 검색 UI(`SearchForm`)에 '전자책' 검색 유형을 추가했습니다.
    - `searchType`이 'EBook'일 경우, 알라딘 API의 `SearchTarget`을 `eBook`으로 지정하여 전자책만 정확히 검색하도록 `aladin.service` 로직을 수정했습니다.

- **버그 수정 (Fix)**
  - **포맷 표시 오류 수정 (`MyLibrary`, `BookDetails`, `MyLibraryBookDetailModal`)**:
    - 전자책만 존재하는 도서(`mallType: 'EBOOK'`)를 서재에 추가하거나 상세 보기 시, '종이책' 버튼이 잘못 표시되던 버그를 수정했습니다.
    - 모든 관련 컴포넌트에서 `mallType`을 기준으로 `paperBookLink`와 `ebookLink`를 정확히 할당하도록 데이터 처리 로직을 통일하여 해결했습니다.

  - **무료 도서 가격 표시 오류 수정 (`BookDetails`)**:
    - 가격이 0원인 무료 전자책의 경우, 상세 정보 뷰에서 가격 UI가 깨지던 문제를 수정했습니다.
    - 가격이 0일 때는 숫자 대신 "무료"라는 텍스트가 표시되도록 조건을 개선했습니다.

- **리팩토링 (Refactor)**
  - **검색 결과 카드 UI 개선 (`BookSearchListModal`)**:
    - 검색 결과 목록의 각 도서 카드에 [종이책], [전자책] 버튼을 추가하여, 사용자가 목록 단계에서부터 도서의 제공 형태를 직관적으로 파악할 수 있도록 했습니다.
    - 하나의 포맷만 존재할 경우 해당 버튼이 전체 너비로 표시되도록 `MyLibrary`와 동일한 UI 패턴을 적용하여 일관성을 확보했습니다.

- **타입 정의 (Types)**
  - `types.ts`의 `AladdinBookItem` 타입 정의에 누락되었던 `mallType`과 `paperBookList` 속성을 추가하여 TypeScript 타입 안정성을 확보하고 관련 오류를 해결했습니다.


e0c9f0c
ahnbu
Sun Oct 19 12:56:07 2025 +0900
refactor(UI): 상세 모달 재고 표시 로직 개선 및 UI 일관성 확보
상세 정보 모달(`MyLibraryBookDetailModal`) 내의 도서관 재고 표시 방식을 리팩토링하여 `MyLibrary` 뷰와의 UI 일관성을 확보하고 코드의 유지보수성을 크게 향상시켰습니다.

- **리팩토링 (Refactor)**
  - **`StockDisplay` 컴포넌트 도입**:
    - 기존에 각 재고 라인마다 하드코딩되어 있던 재고 표시 로직(JSX, 색상 결정)을 `StockDisplay`라는 재사용 가능한 단일 컴포넌트로 추출하고 중앙화했습니다.
    - 복잡했던 즉시 실행 함수 `(() => { ... })()` 구조를 제거하고, 선언적이고 명확한 컴포넌트 기반으로 코드를 개선하여 가독성을 높였습니다.

  - **상태 관리 로직 캡슐화**:
    - `MyLibrary`의 `LibraryTag` 컴포넌트와 동일한 패턴으로, 재고 상태(에러, 재고 있음, 재고 없음)를 결정하는 `getStatus` 함수와 상태에 따른 Tailwind CSS 클래스를 매핑하는 `statusColorClassMap`을 `StockDisplay` 컴포넌트 내에 캡슐화했습니다.

- **기능 개선 (Feature)**
  - **UI 일관성 확보**:
    - 상세 모달의 재고 텍스트 색상 규칙을 `MyLibrary` 뷰와 동일하게 변경했습니다.
      - **에러 발생 시:** `빨간색`
      - **재고 있음:** `녹색`
      - **재고 없음 (에러 없음):** `회색` (기존 `빨간색`에서 변경)
    - 이를 통해 사용자는 어떤 뷰에서든 동일한 시각적 피드백을 통해 재고 상태를 직관적으로 파악할 수 있습니다.

- **코드 정리 (Chore)**
  - `StockDisplay` 컴포넌트 도입에 따라 더 이상 필요 없어진 기존의 `renderStockInfo` 헬퍼 함수를 코드베이스에서 완전히 삭제했습니다.
  - 사용되지 않는 `getStatus` 함수를 `LibraryTag` 컴포넌트에서 제거하여 코드를 정리했습니다.

이번 변경으로 인해 향후 재고 표시 UI나 색상 정책 변경 시, 각 컴포넌트(`StockDisplay`, `LibraryTag`) 내부의 중앙화된 로직만 수정하면 되어 유지보수가 매우 용이해졌습니다.


0b1b24a
ahnbu
Sun Oct 19 12:35:25 2025 +0900
feat: 재고 새로고침 시 전자책 출간 정보 동기화 및 로직 일원화
- **기능 (Feature)**
  - `refreshAllBookInfo` 로직을 개선하여, 도서관 재고 조회와 함께 알라딘 API를 병렬로 호출하도록 수정했습니다.
  - 이를 통해, 사용자가 책을 서재에 추가한 시점 이후에 전자책이 출간되더라도, 재고 새로고침 시 최신 전자책 정보를 자동으로 감지하고 `subInfo` 필드를 업데이트합니다.
  - 이 변경으로 인해 UI(종이책/전자책 버튼)가 별도의 수정 없이 데이터에 따라 동적으로 최신 상태를 반영하게 됩니다.

- **리팩토링 (Refactor)**
  - 코드베이스 전체에서 호출되지 않는 "죽은 코드(Dead Code)"인 `refreshEBookInfo` 함수를 `useBookStore`에서 완전히 제거했습니다.
  - `refreshAllBookInfo`와 역할이 중복되어 데이터 불일치 및 유지보수 비용 증가의 원인이 될 수 있었던 문제를 근본적으로 해결했습니다.
  - 이제 모든 단일 도서 재고 새로고침 로직은 `refreshAllBookInfo`라는 단일 통로(Single Source of Truth)를 통해 관리됩니다.

- **개선 (Chore)**
  - 광주 종이책 재고 조회 로직에서 API 호출 실패 시, 기존 재고 정보는 유지하면서 에러 상태만 UI에 표시하도록 하는 방어 코드를 복원하여 사용자 경험을 개선했습니다.


aba5509
ahnbu
Sun Oct 19 11:51:39 2025 +0900
refactor(error-handling): API 실패 시 재고 정보 보존 및 에러 표시 개선
API 재고 조회 실패 시 사용자 경험을 향상시키고, 에러 추적을 용이하게 하기 위해 에러 처리 로직을 전반적으로 개선했습니다.

주요 변경 사항은 다음과 같습니다.

### 1. [프론트엔드] API 실패 시 과거 재고 정보 보존

-   **변경**: `useBookStore`의 `refreshAllBookInfo` 함수 로직을 수정하여, `gwangju_paper`와 `gyeonggi_ebook_edu` API 조회에 실패하더라도 기존 DB에 저장된 재고 수량(`toechonStock`, `ebookInfo.summary`)을 0으로 덮어쓰지 않고 유지하도록 변경했습니다.
-   **효과**: 이제 API가 일시적으로 불안정하더라도 사용자는 과거 재고 정보를 계속 확인할 수 있으며, 데이터 유실을 방지합니다.

### 2. [프론트엔드] 에러 상태 표시 로직 개선

-   **변경**:
    -   `MyLibrary.tsx`: `e교육`의 상태 점(Indicator)이 `error_count`가 2일 때(성남, 통합 모두 실패)만 빨간색으로 표시되도록 `isError` prop의 조건을 `(count > 0)`에서 `(count === 2)`로 수정했습니다.
    -   `useBookStore.ts`: API 실패 시에도 `gwangjuPaperInfo`와 `ebookInfo`에 에러 객체를 기록하여, UI 컴포넌트가 '에러 상태'임을 정확히 인지할 수 있도록 수정했습니다.
-   **효과**: 이제 UI는 과거 재고 수치를 보여주면서 동시에 상태 점을 빨간색으로 표시하여, 사용자에게 "기존 재고는 N권이지만, 현재 정보 갱신에 실패했습니다"라는 명확하고 유용한 피드백을 제공합니다.

### 3. [API] 에러 로깅 강화 및 상세 정보 추가 (`cloudflare/index.js`)

-   **변경**:
    -   `gyeonggi_ebook_edu` API 요청 실패 시, Cloudflare Worker 로그에 `[API ERROR]` 접두사와 함께 어떤 도서관(성남/통합)에서 에러가 발생했는지 명확한 로그를 남기도록 `console.error`를 추가했습니다.
    -   API 응답 객체에 `error_lib_detail` 필드를 추가하여, 실패한 도서관 목록을 프론트엔드로 전달하도록 개선했습니다.
-   **효과**: 서버 로그를 통해 에러의 근본 원인을 더 빠르게 추적할 수 있게 되었습니다.

### 4. 코드 안정성 및 일관성 향상

-   **변경**:
    -   `useBookStore.ts`: `gyeonggi_ebook_edu`의 API 성공 여부를 판단하는 조건문을 `'error' 키 부재` 확인 방식에서, 성공의 핵심 증거인 `'book_list' 키 존재` 여부를 확인하는 더 안정적인 타입 가드 방식으로 통일했습니다.
    -   `unifiedLibrary.service.ts`: 변경된 API 응답 구조를 반영하여 `error_lib_detail` 필드를 타입 정의에 추가했습니다.
-   **효과**: `null` 응답 등 예외 케이스에 대한 방어력이 높아졌으며, 프로젝트 전반의 코드 일관성과 타입 안정성이 향상되었습니다.


5941483
ahnbu
Sun Oct 19 00:17:16 2025 +0900
refactor(api, store): API 응답 구조 개선 및 프론트엔드 로직 동기화
API 응답의 일관성을 높이고 프론트엔드에서 데이터를 더 쉽게 처리할 수 있도록 `gwangju_paper`와 `gyeonggi_ebook_education`의 응답 구조를 리팩토링하고, 이에 맞춰 프론트엔드 로직을 전체적으로 수정했습니다.

이 과정에서 발생했던 API 응답 키 불일치로 인한 재고 표시 버그도 함께 해결되었습니다.

### 1. API 응답 구조 개선 (`cloudfare/index.js`)

-   **`gwangju_paper` (종이책)**
    -   기존: `book_title`과 `book_list`만 포함
    -   **개선**: `book_list`를 순회하여 계산된 요약 정보(`summary_total_count`, `toechon_total_count` 등)를 객체 최상단에 추가하여 응답.
    -   이를 통해 클라이언트에서 수동으로 재고를 계산하던 로직을 서버로 이전하여 효율성을 높였습니다.

-   **`gyeonggi_ebook_education` (e교육)**
    -   기존: 책 정보 배열(`[]`)을 직접 반환
    -   **개선**: 도서 목록을 `book_list` 키 아래에 배치하고, `total_count`, `available_count` 등의 요약 정보를 포함하는 단일 객체(`{}`) 형태로 구조 변경.

### 2. API 응답 키 이름 통일 (Bug Fix)

-   **문제 원인**: Cloudflare Worker(`index.js`)에서는 `gyeonggi_ebook_education`이라는 키로 응답을 생성했지만, 프론트엔드(`useBookStore.ts`)에서는 `result.gyeonggi_ebook_edu`로 데이터를 참조하고 있었습니다. 이 키 이름 불일치로 인해 `e교육` 재고 정보가 항상 `null`로 처리되어 '정보 조회 실패'로 표시되는 버그가 발생했습니다.
-   **해결**: Cloudflare Worker의 최종 응답 객체 키를 `gyeonggi_ebook_education`에서 `gyeonggi_ebook_edu`로 수정하여 프론트엔드의 데이터 참조와 일치시켰습니다.

### 3. 프론트엔드 로직 동기화

-   **타입 정의 업데이트 (`unifiedLibrary.service.ts`)**
    -   `GwangjuPaperResult`와 `GyeonggiEduEbookResult` 타입을 새로운 API 응답 구조에 맞게 요약 정보 필드를 추가하고, 객체 형태로 변경했습니다.

-   **상태 관리 로직 수정 (`useBookStore.ts`)**
    -   `refreshAllBookInfo`, `refreshEBookInfo` 함수를 수정하여, 클라이언트에서 재고를 직접 계산하는 대신 API가 제공하는 요약 정보를 사용하도록 변경했습니다.
    -   `book_list` 키가 있는지 명확하게 확인하는 조건문을 사용하여 `null` 또는 에러 객체에 대한 방어 로직을 강화했습니다.

-   **UI 컴포넌트 수정 (`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)**
    -   `e교육` 재고의 에러 여부를 판단할 때, `details` 배열을 순회하는 대신 `summary.error_count`를 참조하도록 로직을 단순화했습니다.

이번 리팩토링을 통해 API-클라이언트 간 데이터 구조를 통일하고, 서버에서 계산된 요약 정보를 활용함으로써 프론트엔드 코드의 복잡도를 낮추고 안정성을 크게 향상시켰습니다.


dab2285
ahnbu
Sat Oct 18 22:55:32 2025 +0900
refactor(store, types): API 응답 및 재고 관련 데이터 구조 통일
API 응답 데이터와 내부 상태 관리(Zustand)에서 사용되는 재고 관련 데이터 구조의 일관성을 확보하기 위해 대대적인 리팩토링을 진행합니다. 여러 컴포넌트와 서비스에 걸쳐 혼용되던 `total/available`, `총개수/대출가능`, `availability/book_list` 등의 속성명을 `total_count`, `available_count`, `book_list`로 통일했습니다.

이번 리팩토링으로 인해 발생했던 재고 표시 버그도 함께 수정합니다.

### 주요 변경 사항

1.  **API 응답 구조 통일 (`cloudfare_index.js`)**
    - 광주 종이책(`gwangju_paper`)과 경기 교육청 전자책(`gyeonggi_ebook_edu`) API 응답의 배열 키를 `availability`에서 `book_list`로 변경하여 다른 API 응답 형식과 일치시켰습니다.

2.  **타입 정의 일관성 확보 (`types.ts`, `unifiedLibrary.service.ts`)**
    - `StockInfo`, `EBookSummary` 등 모든 재고 관련 타입의 속성명을 `total_count`와 `available_count`로 통일했습니다.
    - `GwangjuPaperResult` 타입의 배열 키를 `book_list`로 수정했습니다.

3.  **상태 관리 로직 수정 (`useBookStore.ts`)**
    - `refreshAllBookInfo`: 변경된 API 응답 키(`book_list`)를 올바르게 참조하여 재고를 계산하도록 수정했습니다.
    - `addToLibrary`: 새로 추가되는 책의 초기 재고 상태(`toechonStock`, `otherStock`)를 `_count` 접미사를 사용하도록 수정했습니다.

### 버그 수정 (Bug Fix)

- **fix(MyLibrary): 재고 표시 속성명 참조 오류 수정**
  - **원인**: `MyLibrary.tsx`에서 `LibraryTag` 컴포넌트로 props를 전달할 때, 리팩토링 이전의 속성명(`total`, `available`, `총개수`)을 참조하여 재고가 항상 0으로 표시되는 문제가 있었습니다.
  - **해결**: 퇴촌/기타/e교육 도서관의 재고 정보를 전달할 때 `book.toechonStock?.total_count`와 같이 `_count` 접미사가 붙은 올바른 속성명을 참조하도록 수정했습니다.

- **fix(MyLibraryBookDetailModal): 상세 모달 재고 표시 오류 수정**
  - 상세 모달 내 종이책(`renderStockInfo`) 및 전자책(`e교육`) 재고 표시 로직에서도 올바른 속성명(`total_count`, `available_count`)을 사용하도록 수정했습니다.

이번 변경으로 데이터 흐름의 모든 단계에서 일관된 데이터 구조를 사용하게 되어 코드의 가독성과 유지보수성이 향상되었으며, 재고 표시 관련 버그가 모두 해결되었습니다.


8dcd4fb
ahnbu
Thu Oct 16 19:31:35 2025 +0900
feat(crawler): 키워드 검색 기능 안정성 및 데이터 정확도 전면 개선 - e시립구독, e경기(소장,구독)
키워드 통합 검색 기능의 안정성, 데이터 정확성, 유지보수성을 향상시키기 위해 백엔드 크롤러 로직을 전반적으로 리팩토링하고 주요 버그들을 수정했습니다.

### ✨ 주요 개선 사항 (Features & Refactors)

#### 1. 비동기 처리 및 에러 핸들링 구조 개편 (Core)
- **안정성 강화**: `Promise.all`을 `Promise.allSettled`로 교체하여, 여러 도서관을 병렬 검색할 때 특정 도서관의 요청이 실패하더라도 전체 검색 프로세스가 중단되지 않도록 개선했습니다.
- **에러 격리**: 각 검색 함수를 `safeSearch` 래퍼 함수로 감싸, 개별 함수의 동기적인 에러가 다른 검색 작업에 영향을 미치지 않도록 격리했습니다.

#### 2. `e시립구독` 파서, 정규식에서 HTML 파서로 전면 교체
- **견고성 확보**: 기존의 취약한 정규식 기반 파싱 로직을 모두 제거하고, `node-html-parser` 라이브러리를 도입하여 DOM 기반으로 데이터를 추출하도록 변경했습니다. 이를 통해 웹사이트의 사소한 HTML 변경에 더 강건한 코드를 확보했습니다.
- **정확도 향상**: `.querySelectorAll`, `.childNodes` 등을 활용하여 저자, 출판사, 출간일 정보가 합쳐지거나 누락되던 문제를 해결하고 정확한 데이터를 추출하도록 개선했습니다.
- **개발 환경 안정화**: 외부 URL(`esm.sh`)을 통한 모듈 임포트 방식을 제거하고, `npm` 로컬 의존성으로 변경하여 Wrangler 개발 환경의 `No such module` 오류를 해결했습니다.

### 🐛 버그 수정 (Fixes)

#### 1. `e경기` 출간일 누락 및 `ReferenceError` 버그 수정
- **출간일 수집**: 경기도 전자도서관의 소장형(`PUBLISH_DATE`)과 구독형(`ucm_ebook_pubdate`) API 응답에서 각기 다른 필드명으로 제공되던 출간일 정보를 모두 정상적으로 수집하도록 파싱 로직을 수정했습니다.
- **런타임 에러 해결**: `searchGyeonggiEbookLibrary` 함수에서 변수가 선언되기 전에 접근하여 발생하던 `ReferenceError` (TDZ)를 변수 선언 순서 조정을 통해 해결했습니다.
- **데이터 흐름 개선**: 파싱된 데이터가 최종 결과에 누락되지 않도록, 불필요한 중간 변환 과정을 제거하고 데이터 통합 로직을 단순화했습니다.

#### 2. `e경기(구독형)` 일부 결과 누락 문제 해결
- API가 6개의 결과를 반환했음에도 2개만 처리되던 문제를 분석한 결과, API 결과를 '제목' 기준으로 불필요하게 재필터링하던 로직이 원인이었습니다.
- 해당 필터링 로직을 제거하여 API가 반환하는 모든 결과를 신뢰하고 처리하도록 수정했습니다.

이러한 개선을 통해 키워드 통합 검색 기능은 이전보다 훨씬 더 안정적이고 정확한 데이터를 제공하며, 코드의 유지보수성이 크게 향상되었습니다.


0a37b96
ahnbu
Thu Oct 16 16:15:07 2025 +0900
feat(keyword-search): 키워드 검색 기능 개선 및 데이터 정확도 향상
키워드 통합 검색 기능의 안정성과 데이터 정확성을 높이기 위해 백엔드 크롤링 로직과 프론트엔드 UI를 전반적으로 개선했습니다.

주요 변경 사항은 다음과 같습니다.

1.  **퇴촌 도서관 검색 결과 누락 문제 해결**
    - `searchGwangjuPaperKeyword` 함수가 광주시 전체 도서관('ALL')과 퇴촌 도서관('MN')을 병렬로 각각 검색하도록 로직을 수정했습니다.
    - 이를 통해 기존에 누락되던 퇴촌 도서관의 종이책 검색 결과가 정상적으로 포함되도록 하였습니다.
    - 최종 결과를 취합할 때 제목과 저자 기준으로 중복을 제거하여 데이터 정합성을 높였습니다.

2.  **e교육 및 e경기 데이터 파싱 로직 강화**
    - **e교육(저자)**: 경기도교육청 전자도서관의 복잡한 HTML 구조에 대응할 수 있도록 `parseGyeonggiEduHTML` 함수의 저자 정보 파싱 정규식을 개선하여, 저자 정보가 누락되던 문제를 해결했습니다.
    - **e경기(출간일)**: 경기도 전자도서관의 소장형(API) 및 구독형(API) 응답 데이터를 정밀 분석하여, 각기 다른 필드명(`PUBLISH_DATE`, `ucm_ebook_pubdate`)으로 제공되던 출간일 정보를 모두 추출하도록 `parseGyenggiEbookOwnedResults`와 `parseGyenggiEbookSubsResults` 함수를 수정했습니다. 이로써 "정보 없음"으로 표시되던 출간일 문제가 해결되었습니다.

3.  **키워드 검색 결과 UI/UX 개선 (KeywordSearchModal)**
    - **UI 정리**: 검색 결과 테이블에서 '출판사' 컬럼을 제거하여 핵심 정보에 집중할 수 있도록 UI를 간소화했습니다.
    - **가독성 향상**:
        - 모든 셀 내용을 한 줄로 표시하고, 길어질 경우 말줄임표(`...`) 처리되도록 스타일을 적용했습니다.
        - 저자는 3자, 제목은 15자로 글자 수를 제한하여 표시하되, 마우스를 올리면 전체 내용을 확인할 수 있도록 `title` 속성을 추가했습니다.
        - 출간일 형식을 'YYYY'로 통일하여 일관성을 확보했습니다.
        - 출간일 정보가 없는 경우 "정보 없음" 대신 하이픈(`-`)을 표시하도록 개선했습니다.


670b9e9
ahnbu
Wed Oct 15 17:34:39 2025 +0900
fix(types): 프로젝트 전반의 TypeScript 타입 에러 수정
[문제점]
최근 기능 추가 및 리팩토링 이후, 여러 컴포넌트와 상태 관리 로직에서 TypeScript 타입 불일치로 인한 다수의 에러(빨간 줄)가 발생했습니다. 이들은 당장 런타임 문제를 일으키진 않지만, 코드의 안정성을 저해하고 잠재적인 버그를 유발할 수 있었습니다.

[해결 방안]
프로젝트 전체적으로 발견된 타입 에러들을 다음과 같이 수정했습니다.

1.  **`useBookStore.ts` 타입 안정성 강화**:
    -   `updateMultipleBookTags` 함수의 반환 타입을 `Promise<void>`에서 실제 반환값인 `Promise<{...}>`으로 수정하여 타입 정의와 구현을 일치시켰습니다.
    -   Supabase의 `book_data` 컬럼에 데이터를 저장할 때, `as Json`으로 타입 단언하던 모든 부분을 더 안전한 `as unknown as Json`으로 변경하여 TypeScript의 엄격한 검사를 통과하도록 했습니다.
    -   `updateMissingEbookIsbn13` 함수에서 상태 업데이트 시 `id` 프로퍼티가 누락되는 문제를 해결하기 위해, 업데이트 객체의 타입을 `SelectedBook`으로 명확히 지정했습니다.

2.  **API 응답 타입 처리 수정 (`useBookStore.ts`)**:
    -   `refreshAllBookInfo` 함수에서 `filterGyeonggiEbookByIsbn` 호출 시, API 응답이 에러 객체(`GyeonggiEbookLibraryError`)일 가능성을 고려하지 않던 문제를 수정했습니다. 이제 API 호출 성공 시에만 필터링 함수를 호출하도록 타입 가드를 추가했습니다.

3.  **Vite 및 TypeScript 설정 파일 수정**:
    -   `vite.config.ts`가 Node.js 환경의 모듈(`vite`, `url`) 타입을 찾지 못하는 문제를 해결하기 위해, `tsconfig.node.json`을 추가하여 Node.js 설정 파일과 프론트엔드 소스 코드의 타입 체크 환경을 명확히 분리했습니다.
    -   `vite.config.ts`의 `defineConfig` 파라미터에 `ConfigEnv` 타입을 명시하여 `mode` 변수의 암시적 `any` 타입 문제를 해결했습니다.

4.  **컴포넌트 타입 수정**:
    -   `Notification.tsx`가 `'info'`, `'warning'` 타입을 처리할 수 있도록 관련 타입 정의(`useUIStore.ts`, `Notification.tsx`)와 아이콘(`Icons.tsx`)을 모두 확장했습니다.

[기대 효과]
-   프로젝트 전체에서 발생하던 TypeScript 타입 관련 에러(빨간 줄)가 모두 해결되었습니다.
-   코드의 타입 안정성과 신뢰성이 크게 향상되어, 향후 리팩토링이나 기능 추가 시 발생할 수 있는 잠재적인 버그를 예방할 수 있게 되었습니다.
-   개발 환경이 안정화되어 개발 생산성이 향상됩니다.


551c234
ahnbu
Wed Oct 15 16:43:25 2025 +0900
refactor: 사용하지 않는 레거시 컴포넌트 및 함수 제거
[개선 목적]
최근 `createLibraryOpenURL` 함수를 도입하여 URL 생성 로직을 중앙화하는 과정에서, 더 이상 사용되지 않거나 기능이 중복되는 레거시 코드들이 발견되었습니다. 코드베이스를 깔끔하게 유지하고 혼동을 줄이기 위해 해당 코드들을 제거합니다.

[주요 변경사항]
1.  **`LibraryStock.tsx` 컴포넌트 삭제**:
    -   '도서관 재고 현황'을 표시하던 `LibraryStock` 컴포넌트는 이제 `MyLibrary` 및 `MyLibraryBookDetailModal` 컴포넌트의 자체 렌더링 로직으로 대체되어 더 이상 사용되지 않음을 확인하고 삭제했습니다.
    -   VS Code의 "Find All References" 기능을 통해 다른 곳에서 참조되지 않음을 최종 확인했습니다.

2.  **`generateLibraryDetailURL` 함수 삭제 (`unifiedLibrary.service.ts`)**:
    -   이 함수는 퇴촌도서관 URL을 생성하는 특정 목적을 가졌으나, 최근에 추가된 `createLibraryOpenURL` 함수와 기능이 중복되고 더 이상 사용되지 않으므로 삭제했습니다.
    -   관련 `import` 구문도 함께 정리하여 불필요한 의존성을 제거했습니다.

[기대 효과]
-   프로젝트에서 사용되지 않는 코드를 제거하여 코드베이스의 복잡성을 낮추고 번들 크기를 미세하게 최적화했습니다.
-   URL 생성 로
-   직과 관련된 함수를 `createLibraryOpenURL`로 단일화하여, 향후 유지보수 시 혼동의 여지를 없애고 개발 효율성을 높였습니다.


3469772
ahnbu
Wed Oct 15 16:26:01 2025 +0900
feat(ui): 키워드 검색 모달에 테마 적용 및 URL 로직 리팩토링
[주요 변경사항]
이번 커밋은 `KeywordSearchModal` 컴포넌트의 사용자 경험과 코드 품질을 개선하는 두 가지 주요 작업을 포함합니다.

1.  **다크/라이트 테마 적용**:
    -   기존에 하드코딩된 색상(예: `bg-white`, `text-gray-900`)을 사용하던 `KeywordSearchModal`의 모든 스타일을 `index.css`에 정의된 시맨틱 CSS 변수(예: `bg-elevated`, `text-primary`)를 사용하도록 수정했습니다.
    -   `input`, `button` 등 폼 요소에도 `input-base`, `btn-primary` 등 공통 스타일 클래스를 적용하여 디자인 일관성을 확보했습니다.
    -   이제 키워드 검색 모달도 다른 컴포넌트와 마찬가지로 사용자가 설정한 다크/라이트 테마를 완벽하게 따릅니다.

2.  **URL 생성 로직 리팩토링 및 통합**:
    -   모달 내부에만 존재하던 `generateLibraryLink` 함수를 삭제하고, 프로젝트 전역에서 사용하는 공통 함수 `createLibraryOpenURL`를 호출하도록 변경했습니다.
    -   이를 통해 모든 도서관 바로가기 URL 생성 로직을 중앙화하여 코드 중복을 제거하고 유지보수성을 크게 향상시켰습니다.

[기대 효과]
-   **일관된 사용자 경험**: 키워드 검색 모달이 전체 애플리케이션의 디자인 시스템과 완벽하게 통합되었습니다.
-   **코드 품질 향상**: 중복 로직 제거와 중앙화된 함수 사용으로 코드의 가독성, 일관성, 유지보수성이 모두 개선되었습니다.


7fc253b
ahnbu
Wed Oct 15 15:59:03 2025 +0900
docs: 초기 로딩된 데이터에만 기능이 작동하는 경우 (제한된 리소스 트러블슈팅 가이드 추가) to develpment.md
**증상:**
-   '내 서재' 검색 또는 태그 필터링 후 나타난 책에 대해 특정 기능(예: 상세 모달 열기, 재고 새로고침, 태그/메모 CRUD)이 작동하지 않는다.
-   반면, 페이지를 처음 로드했을 때 보이는 책들(예: 25/50권)에 대해서는 동일한 기능이 정상적으로 작동한다.
-   React 개발자 도구에서는 상태 변경이 일어나는 것처럼 보이지만, UI에는 아무런 변화가 없다.

**원인 분석: 제한된 데이터 소스 참조 (The "Wrong Drawer" Problem)**

이 문제는 대부분의 경우 프론트엔드 상태 관리 로직에서 발생합니다. 우리 프로젝트는 성능을 위해 초기에는 일부 데이터(`myLibraryBooks`)만 로드하고, 검색/필터 시에는 별도의 상태(`librarySearchResults`, `libraryTagFilterResults`)를 사용합니다.

문제는 특정 기능을 수행하는 함수(예: `updateBookInStoreAndDB`, `refreshAllBookInfo`)가 업데이트할 대상 객체를 찾을 때, **오직 `myLibraryBooks`라는 하나의 "서랍"에서만** 객체를 찾으려고 시도하기 때문에 발생합니다. 만약 사용자가 다른 서랍(`librarySearchResults`)에 있는 객체에 대해 작업을 요청하면, 함수는 대상을 찾지 못하고 아무것도 하지 않거나 에러를 반환합니다.

**진단 워크플로우:**

1.  **기능 확인**: 작동하지 않는 기능(예: `addTagToBook`)이 의존하는 핵심 함수(예: `updateBookInStoreAndDB`)를 `useBookStore.ts`에서 찾습니다.
2.  **데이터 소스 추적**: 해당 함수가 업데이트할 원본 객체(`originalBook`)를 어디서 가져오는지 확인합니다. 아래와 같은 코드가 있다면 의심해야 합니다.
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id); // << 문제의 코드
    ```
3.  **재현**: '내 서재'에서 '전체 보기'를 누르지 않은 상태로, 스크롤을 내려 보이지 않는 책의 제목을 검색합니다. 검색 결과로 나온 책에 대해 해당 기능을 실행했을 때 문제가 재현되는지 확인합니다.

**해결 방안: 중앙화된 데이터 조회 함수 사용**

이 문제를 근본적으로 해결하려면, 객체를 찾을 때 모든 잠재적인 데이터 소스를 검색하는 중앙화된 조회 함수를 사용해야 합니다.

1.  **`getBookById` 함수 활용**:
    `useBookStore.ts`에 이미 `getBookById` 함수가 구현되어 있습니다. 이 함수는 `myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`를 모두 검색하고, 그래도 없으면 DB에 직접 요청하는 가장 견고한 방법입니다.

2.  **기존 코드 수정**:
    문제가 되는 함수 내부에서 `myLibraryBooks.find(...)`를 사용하는 대신, `getBookById`를 호출하도록 수정합니다.

    **수정 전:**
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id);
    if (!originalBook) return;
    // ...
    ```

    **수정 후:**
    ```typescript
    const { getBookById } = get();
    const originalBook = await getBookById(id);
    if (!originalBook) return;
    // ...
    ```

3.  **UI 상태 동시 업데이트**:
    데이터를 업데이트하는 함수(`updateBookInStoreAndDB`, `refreshAllBookInfo`)는 `setState`를 호출할 때 **모든 관련 상태 배열**(`myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`)을 동시에 업데이트해야 합니다. 이를 통해 어떤 뷰(기본, 검색, 필터)에 있더라도 UI가 일관되게 변경됩니다.

    ```typescript
    // 좋은 예시
    useBookStore.setState(state => ({
      myLibraryBooks: state.myLibraryBooks.map(b => (b.id === id ? updatedBook : b)),
      librarySearchResults: state.librarySearchResults.map(b => (b.id === id ? updatedBook : b)),
      libraryTagFilterResults: state.libraryTagFilterResults.map(b => (b.id === id ? updatedBook : b)),
    }));
    ```

**핵심 원칙**: 사용자 인터랙션의 대상이 되는 객체를 찾거나 수정할 때는, 현재 화면에 보이는 데이터의 출처(`myLibraryBooks`, `librarySearchResults` 등)와 관계없이, **존재하는 모든 데이터 소스를 포괄하는 단일 통로(`getBookById`)**를 통해 접근해야 합니다.


139f238
ahnbu
Wed Oct 15 15:56:25 2025 +0900
fix(tags): 검색/필터링된 책에 대한 일괄 태그 관리 기능 수정
[문제점]
'내 서재'에서 책을 검색하거나 태그로 필터링한 후, 결과 목록에 있는 책들(초기 로딩에 포함되지 않은 책)에 대해 '일괄 태그 관리' 기능을 사용하면 "태그 업데이트에 실패했다"는 메시지가 발생하며 기능이 작동하지 않았습니다.

또한, 태그 '삭제' 시에는 작업이 성공해도 모달이 닫히지 않아 사용자 경험의 일관성이 부족했습니다.

[원인 분석]
1.  **제한된 데이터 소스 참조**: `updateMultipleBookTags` 함수가 태그를 업데이트할 책의 원본 정보를 오직 초기 로딩된 `myLibraryBooks` 배열에서만 찾고 있었습니다. 검색/필터링된 책은 이 배열에 없어 'Book not found' 에러가 발생했습니다.
2.  **핸들러 로직 누락**: 태그 '삭제' 핸들러(`handleRemoveCommonTag`)에 작업 완료 후 모달을 닫는 `onClearSelection()` 호출이 누락되어 있었습니다.

[해결 방안]
1.  **`useBookStore.ts` 수정**:
    -   `updateMultipleBookTags` 함수가 책을 찾을 때 `myLibraryBooks`를 직접 참조하는 대신, 모든 데이터 소스를 검색하는 `getBookById` 함수를 사용하도록 수정하여 어떤 책이든 정확히 찾아낼 수 있도록 했습니다.

2.  **`MyLibrary.tsx` 수정**:
    -   `BulkTagModal`에 책 객체를 전달할 때, `myLibraryBooks` 대신 현재 화면에 표시되는 `sortedAndFilteredLibraryBooks` 배열을 참조하도록 변경했습니다.
    -   `handleRemoveCommonTag` 함수에 `onClearSelection()` 호출을 추가하여, 태그 추가/삭제 시 동일하게 모달이 닫히도록 동작을 일치시켰습니다.

[기대 효과]
-   이제 '내 서재'의 어떤 상태(기본 목록, 검색 결과, 필터 결과)에서든 모든 책에 대해 '일괄 태그 관리' 기능이 안정적으로 작동합니다.
-   태그 추가/삭제 시 사용자 경험이 일관되게 개선되었습니다.


076f8e4
ahnbu
Wed Oct 15 15:33:03 2025 +0900
fix(ui): 태그 색상 선택 버튼의 포커스 스타일 개선
[문제점]
'맞춤설정 > 태그관리'에서 태그 색상 버튼('기본', '보조')을 클릭하여 선택된 상태일 때, 버튼 주변에 `ring-offset`으로 인해 생긴 흰색 테두리가 나타나 UI 일관성을 해치는 문제가 있었습니다.

[해결 방안]
- 클릭으로 인한 선택 상태에서는 링(ring) 효과를 제거하고, `opacity`만으로 활성 상태를 구분하도록 변경했습니다.
- 키보드 탐색 등 접근성을 위해 필요한 링 효과는 `:focus` pseudo-class에만 적용되도록 수정했습니다.
- `focus:outline-none`, `focus:ring-2`, `focus:ring-ring`, `focus:ring-offset-2` 클래스를 추가하여, 키보드로 포커스했을 때만 명확한 아웃라인이 표시되도록 개선했습니다.

[기대 효과]
- 이제 마우스 클릭 시에는 다른 UI 요소와 일관된 디자인을 유지합니다.
- 키보드 사용자의 접근성은 그대로 보장하여 사용성을 해치지 않습니다.
- '새 태그 추가'와 '태그 수정' 모달 양쪽 모두에 동일한 스타일을 적용하여 일관성을 확보했습니다.


b1c6664
ahnbu
Wed Oct 15 15:07:20 2025 +0900
docs: 프로젝트 문서 대규모 업데이트 및 동기화
프로젝트의 빠른 개발 속도에 맞춰 한동안 업데이트되지 않았던 핵심 문서(`README.md`, `DEVELOPMENT.md`, `changelog.md`)를 현재 시점의 구현 내용과 완벽하게 동기화했습니다.

이번 업데이트를 통해 신규 참여자의 온보딩 비용을 줄이고, 프로젝트의 기술적 성과와 발전 과정을 명확하게 파악할 수 있도록 문서 품질을 대폭 향상시켰습니다.

주요 변경 사항:

1.  **README.md (사용자 중심 문서) 전면 개정:**
    -   최근 추가된 핵심 기능(커스텀 태그, 즐겨찾기, 페이지네이션, 관리자 기능 등)을 모두 반영하여 "주요 기능" 섹션을 최신화했습니다.
    -   "최신 기술적 개선사항" 섹션을 추가하여 커스텀 검색어, URL 중앙화, 상세 모달 데이터 동기화 등 주목할 만한 개선점을 요약했습니다.
    -   기술 스택에 Vercel, Cloudflare Workers, Supabase Edge Functions를 명시하여 현재 아키텍처를 정확히 반영했습니다.

2.  **DEVELOPMENT.md (개발자 중심 문서) 정밀 수정:**
    -   **API 명세 현대화**: Cloudflare Workers API의 요청/응답 본문 구조를 실제 응답 사례를 기반으로 정확하게 수정했습니다.
    -   **핵심 로직 문서화**: 여러 컴포넌트에 흩어져 있던 과거의 URL 생성 로직 설명을 폐기하고, 현재의 중앙화된 `createLibraryOpenURL` 함수 기반으로 "도서관별 검색어 처리 시스템" 섹션을 전면 재작성하여 코드와의 정합성을 100% 맞췄습니다.
    -   Mermaid 다이어그램을 수정하여 Vercel/Supabase Functions를 포함한 최신 시스템 아키텍처를 시각화했습니다.

3.  **changelog.md (프로젝트 이력) 재구성:**
    -   기존의 부정확한 날짜 정보를 모두 폐기하고, 전체 커밋 히스토리를 분석하여 실제 커밋 날짜를 기반으로 변경 내역을 재구성했습니다.
    -   관련 커밋들을 의미 있는 버전 단위로 그룹화하고, `Feature`, `Fix`, `Refactor` 등으로 체계적으로 분류하여 가독성과 추적 용이성을 높였습니다.
    -   프로젝트 초기부터 현재까지의 전체 발전 과정을 담은 단일하고 신뢰성 있는 변경 이력 문서를 완성했습니다.


eab6714
ahnbu
Tue Oct 14 19:25:24 2025 +0900
fix: 상세 모달 데이터 동기화 및 타입 안정성 강화
[문제점]
이전 리팩토링 이후 몇 가지 후속적인 버그와 타입 문제가 발견되었습니다.
1.  **상태 동기화 단절**: 상세 모달(`MyLibraryBookDetailModal`)이 열린 상태에서 태그, 메모 등 CRUD 작업을 수행해도 UI가 업데이트되지 않는 문제가 있었습니다. 이는 모달이 자체 로컬 상태로 데이터를 관리하면서, `useBookStore`의 원본 데이터 변경을 감지하지 못했기 때문입니다.
2.  **타입 불일치**: `useBookStore`의 `updateMultipleBookTags` 함수의 타입 정의와 실제 구현의 반환값이 달라 TypeScript 에러가 발생했습니다.
3.  **안전하지 않은 타입 단언**: `as Json` 타입 단언이 TypeScript의 엄격한 검사를 통과하지 못해 경고가 발생했습니다.
4.  **`id` 누락**: `updateMissingEbookIsbn13` 함수에서 상태 업데이트 시 `id` 프로퍼티가 누락되어 타입 에러가 발생했습니다.

[해결 방안]
1.  **상태 동기화 로직 추가 (`MyLibraryBookDetailModal.tsx`)**:
    -   `useBookStore`의 최신 `book` 데이터를 구독하고, 변경이 감지되면 `useEffect`를 통해 모달의 로컬 `book` 상태를 동기화하는 로직을 추가했습니다. 이로써 모달 내 모든 CRUD 작업이 UI에 즉시 반영됩니다.

2.  **`useBookStore.ts` 타입 및 로직 수정**:
    -   `updateMultipleBookTags`의 반환 타입을 실제 구현과 일치하도록 `Promise<{...}>`로 수정했습니다.
    -   `as Json`으로 타입 단언된 모든 부분을 더 안전한 `as unknown as Json`으로 변경했습니다.
    -   `updateMissingEbookIsbn13`에서 업데이트 객체의 타입을 `SelectedBook`으로 명시하여 `id` 누락 문제를 해결했습니다.
    -   `addTagToBook`, `removeTagFromBook` 함수에서 항상 새로운 배열을 생성하도록 수정하여 불변성을 확보하고, 상태 변경 감지 문제를 해결했습니다.

3.  **레거시 코드 정리 (`MyLibrary.tsx`)**:
    -   현재 사용되지 않는 레거시 함수(`renderStockCell`, `renderEBookCell` 등)들을 삭제하여 코드를 정리했습니다.

[기대 효과]
-   이제 상세 모달 내에서 태그, 메모, 커스텀 검색어 등 모든 CRUD 작업이 UI에 실시간으로 올바르게 반영됩니다.
-   프로젝트 전반의 TypeScript 타입 에러가 모두 해결되어 코드의 안정성과 신뢰성이 향상되었습니다.
-   불필요한 레거시 코드가 제거되어 코드베이스가 더 깔끔하고 유지보수하기 용이해졌습니다.


bb9d894
ahnbu
Tue Oct 14 18:13:14 2025 +0900
feat(ux): 커스텀 검색어 편집 시 기본값 제공으로 편의성 향상
[문제점]
기존에는 사용자가 커스텀 검색어를 최초로 설정하기 위해 '편집' 버튼을 눌렀을 때, 입력 필드가 빈 값으로 시작되었습니다. 이로 인해 사용자는 자동으로 생성된 기본 검색어를 참조하여 다시 입력해야 하는 불편함이 있었습니다.

[개선 방안]
`MyLibraryBookDetailModal`의 `handleEdit` 함수 로직을 수정하여, 사용자가 편집을 시작할 때 입력 필드의 초기값을 설정하도록 변경했습니다.

-   **최초 편집 시**: 자동으로 생성된 기본 검색어(`createSearchSubject(book.title)`)가 입력 필드에 미리 채워집니다.
-   **기존 값 수정 시**: 이미 저장된 커스텀 검색어가 그대로 표시됩니다.

[기대 효과]
-   사용자는 더 이상 빈 칸에서 검색어를 새로 입력할 필요 없이, 기존 기본 검색어를 약간 수정하는 것만으로 원하는 커스텀 검색어를 쉽게 설정할 수 있습니다.
-   편집 시작 전후의 맥락이 자연스럽게 이어져 사용자 편의성과 작업 효율성이 크게 향상되었습니다.


385ae70
ahnbu
Tue Oct 14 17:54:59 2025 +0900
refactor(url): URL 생성 로직 중앙화 및 커스텀 검색어 미반영 버그 수정
[문제점]
1.  **버그**: 커스텀 검색어를 설정했음에도 불구하고, 도서관 바로가기 URL에는 기본 검색어가 적용되는 버그가 있었습니다. 이로 인해 재고 조회(API 호출)와 사용자가 직접 확인하는 URL의 검색 결과가 달라지는 불일치 문제가 발생했습니다.
2.  **코드 구조**: `MyLibrary.tsx`와 `MyLibraryBookDetailModal.tsx`에 각 도서관의 URL 생성 로직이 중복되어 흩어져 있어 일관성이 부족하고 유지보수가 어려웠습니다.

[개선 방안]
`unifiedLibrary.service.ts`에 `createLibraryOpenURL`이라는 통합 함수를 생성하여 모든 URL 생성 로직을 중앙화하고, 버그를 수정했습니다.

-   **`createLibraryOpenURL(libraryName, bookTitle, customSearchTitle)`**:
    -   `customSearchTitle`을 최우선으로 사용하여 검색어를 결정하는 로직을 내장하여 **커스텀 검색어 미반영 버그를 해결**했습니다.
    -   `libraryName`을 인자로 받아 `switch` 문을 통해 해당 도서관에 맞는 URL을 반환합니다.

-   **컴포넌트 수정**:
    -   두 컴포넌트(`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)의 기존 URL 생성 로직을 모두 새로운 `createLibraryOpenURL` 함수 호출로 대체하여 코드를 간소화하고 일관성을 확보했습니다.

[기대 효과]
-   **버그 수정**: 이제 커스텀 검색어가 바로가기 URL에 올바르게 반영되어, 재고 조회 시 사용된 검색어와 완전히 일치하는 결과를 사용자에게 제공합니다.
-   **유지보수성 향상**: 향후 URL 구조 변경 시, `createLibraryOpenURL` 함수 한 곳만 수정하면 프로젝트 전체에 반영됩니다.
-   **코드 품질 개선**: 코드 중복이 제거되고, 역할과 책임이 명확히 분리되어 가독성과 안정성이 향상되었습니다.


fa68eef
ahnbu
Tue Oct 14 16:28:57 2025 +0900
feat(search): 커스텀 검색어 기능 추가로 재고 조회 정확성 향상
[기능 추가]
기존의 자동화된 검색어 생성 로직(`createOptimalSearchTitle`)이 일부 복잡한 제목의 도서에 대해 정확한 재고 조회를 하지 못하는 문제를 해결하기 위해, 사용자가 직접 검색어를 지정할 수 있는 '커스텀 검색어' 기능을 추가했습니다.

[주요 변경사항]
1.  **데이터 구조 확장 (`types.ts`, Supabase)**:
    -   `BookData` 타입과 `user_library` 테이블의 `book_data`에 `customSearchTitle` 필드를 추가했습니다.
    -   기존 모든 도서 데이터에 해당 필드를 `null`로 초기화하는 마이그레이션을 완료했습니다.

2.  **UI/UX 구현 (`MyLibraryBookDetailModal.tsx`)**:
    -   상세 모달 내 '도서관 재고' 섹션에 커스텀 검색어를 편집, 저장, 삭제할 수 있는 UI를 추가했습니다.
    -   기존 '메모' 관리 UI와 동일한 디자인 패턴을 적용하여 일관성을 확보했으며, 키보드 단축키(Ctrl+Enter, Esc)를 지원하여 사용성을 높였습니다.

3.  **상태 관리 로직 추가 (`useBookStore.ts`)**:
    -   `updateCustomSearchTitle` 액션을 추가하여 사용자의 입력을 상태(Zustand)와 DB(Supabase)에 안전하게 저장합니다.

4.  **API 요청 로직 수정 (`unifiedLibrary.service.ts`)**:
    -   `fetchBookAvailability` 함수가 커스텀 검색어를 인자로 받도록 수정했습니다.
    -   커스텀 검색어가 존재할 경우, 자동 검색어 가공 로직을 건너뛰고 해당 값을 최우선으로 사용하도록 변경했습니다.

5.  **버그 수정 및 리팩토링 (`MyLibraryBookDetailModal.tsx`)**:
    -   컴포넌트 내부 컴포넌트 정의로 인해 발생하던 `input` 키 입력 중복 버그를 해결했습니다.
    -   중복되던 재고 표시 로직을 `LibraryStockSection` 독립 컴포넌트로 추출하여 코드 중복을 제거하고 가독성과 유지보수성을 크게 향상시켰습니다.

[기대 효과]
-   사용자는 이제 기본 검색어로 조회가 실패하는 예외적인 경우에도, 직접 최적의 검색어를 지정하여 재고 조회 성공률을 크게 높일 수 있습니다.
-   서비스의 유연성과 정확성이 향상되어 전반적인 사용자 경험이 개선됩니다.


c182749
ahnbu
Tue Oct 14 14:53:21 2025 +0900
fix(ui): 상세 모달에서 누락된 도서 정보 UI 복원 및 리팩토링
[문제점]
이전 리팩토링 과정에서 `MyLibraryBookDetailModal` 컴포넌트의 JSX 구조가 변경되면서, 책 표지, 제목, 저자 등 핵심적인 '도서 상세 정보'를 표시하는 부분이 실수로 누락되는 버그가 발생했습니다.

또한, 모달 내에서 '내 서재 정보' 중 '도서관 재고'를 표시하는 로직이 조건부 렌더링으로 인해 두 곳에 중복으로 존재하여 코드 품질과 유지보수성을 저해하고 있었습니다.

[해결 방안]
1.  **도서 상세 정보 UI 복원**:
    -   리팩토링 이전 버전의 코드(`MyLibraryBookDetailModal_before.tsx`)를 참조하여, 누락되었던 도서 상세 정보(책 표지, 제목, 저자, 가격, 알라딘 링크 등)를 표시하는 JSX 블록을 복원했습니다.

2.  **재고 표시 로직 리팩토링**:
    -   기존에 두 번 반복되던 '도서관 재고' 표시 로직을 `LibraryStockSection`이라는 별도의 내부 컴포넌트로 추출하여 코드 중복을 완전히 제거했습니다.
    -   복잡했던 `isLibraryStockOnly` 조건부 렌더링 구조를 `hasLeftContent`와 `hasRightContent`를 사용한 더 직관적인 구조로 단순화했습니다.

[기대 효과]
-   이제 상세 모달을 열었을 때 상단에 도서의 기본 정보가 정상적으로 표시됩니다.
-   코드 중복이 제거되어 `MyLibraryBookDetailModal` 컴포넌트의 가독성과 유지보수성이 크게 향상되었습니다.
-   향후 재고 표시 로직 변경 시 `LibraryStockSection` 컴포넌트 한 곳만 수정하면 되어 작업 효율성이 증대됩니다.


8423c5f
ahnbu
Tue Oct 14 00:45:29 2025 +0900
ui : 키워드검색 위치를 관리자 기능 위로 이동


2ad245d
ahnbu
Tue Oct 14 00:41:25 2025 +0900
refactor(ui): API 에러 표시 방식 개선으로 UX 향상 - 주석 제거


3bbc970
ahnbu
Tue Oct 14 00:40:33 2025 +0900
refactor(ui): API 에러 표시 방식 개선으로 UX 향상
[문제점]
기존에는 도서관 재고 조회 API가 실패할 경우, 목록 뷰(`MyLibrary.tsx`)에서 재고 정보를 `(에러)`라는 텍스트로 대체하여 표시했습니다. 이는 사용자에게 상태를 명확히 알리는 장점이 있었으나, 여러 항목에서 동시에 발생할 경우 시각적으로 거슬리고 자극적이라는 단점이 있었습니다.

[개선 방안]
사용자 경험(UX)을 개선하기 위해, 에러 표시 방식을 텍스트에서 시각적 표시등(indicator)으로 변경했습니다.

-   **`LibraryTag` 컴포넌트 로직 수정**:
    -   API 조회 실패 시: 재고 숫자 앞의 상태 표시 점을 **빨간색**으로 변경.
    -   API 조회 성공 & 재고 있음: **녹색** 점 표시.
    -   API 조회 성공 & 재고 없음: **회색** 점 표시.
-   **텍스트 정보 유지**:
    -   API 실패 시에도 `(에러)` 텍스트로 대체하는 대신, DB에 저장된 **과거 재고 정보(예: `1/0`)**를 그대로 표시합니다.
    -   이를 통해 사용자는 과거 데이터와 현재의 조회 실패 상태를 동시에 인지할 수 있습니다.

[기대 효과]
-   UI가 훨씬 깔끔해지고 시각적 피로도가 감소했습니다.
-   상태 표시 점의 색깔을 통해 API 상태를 직관적으로 파악할 수 있습니다.
-   정보 손실 없이, 사용자에게 더 풍부한 맥락(과거 데이터 + 현재 에러 상태)을 제공하게 되어 서비스의 완성도가 높아졌습니다.
-   상세 뷰(`MyLibraryBookDetailModal`)는 기존의 "(숫자)(에러)" 방식을 유지하여, 맥락에 따라 다른 수준의 정보를 제공하도록 차별화했습니다.


f2311b6
ahnbu
Mon Oct 13 15:03:43 2025 +0900
fix : index.js timeout 15초로 변경


b95e7b7
ahnbu
Mon Oct 13 14:58:50 2025 +0900
fix(api): 경기도 전자도서관 조회 실패 시 에러 상태 명확화
[문제점]
경기도 전자도서관(`gyeonggi_ebook_library`)은 내부적으로 '소장형'과 '구독형' API를 동시에 호출합니다. 기존 로직에서는 두 API가 모두 실패하더라도 에러를 반환하지 않고, 결과가 0건인 성공 객체(`{ total_count: 0, ... }`)를 반환했습니다.

이로 인해 프론트엔드에서는 실제 API 조회가 실패했음에도 불구하고 '(0/0)'으로 표시되어, 사용자가 조회 실패 사실을 인지할 수 없는 문제가 있었습니다.

[해결 방안]
`searchGyeonggiEbookLibrary` 함수를 수정하여, '소장형'과 '구독형' 검색이 **모두 실패했을 경우에만** 명시적으로 에러를 throw하도록 변경했습니다.

-   하나의 API만 실패할 경우: 성공한 쪽의 결과만이라도 정상적으로 반환하여 부분적인 정보라도 제공합니다.
-   두 API가 모두 실패할 경우: 전체 조회를 실패로 간주하고 에러를 발생시켜, 프론트엔드가 이를 `{ error: '...' }` 객체로 수신하게 합니다.

[기대 효과]
-   이제 경기도 전자도서관 API 조회가 완전히 실패했을 때, 프론트엔드 UI에 다른 도서관과 동일하게 `(에러)`가 올바르게 표시됩니다.
-   사용자는 조회 실패 상태를 명확하게 인지할 수 있게 되어 사용자 경험이 향상됩니다.


447fbf1
ahnbu
Mon Oct 13 14:47:34 2025 +0900
feat: API 에러 처리, UI 피드백 개선 및 리팩토링
도서관 재고 조회 API 실패 시(특히 타임아웃) 사용자에게 명확한 피드백을 제공하고, 코드 품질을 개선하는 작업을 진행했습니다.

주요 변경사항:
1.  **API 에러 상태 처리 로직 추가 (`useBookStore.ts`)**:
    - `refreshAllBookInfo`가 API 응답의 성공/실패 여부를 `book` 객체 상태에 저장하도록 수정했습니다.
    - 기존 책의 재고 조회 실패 시 DB의 과거 데이터를 보존하고, 신규 책은 에러 상태와 함께 0/0으로 저장하여 데이터 무결성을 확보했습니다.

2.  **에러 상태 UI 표시 기능 (`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)**:
    - 목록 뷰(`MyLibrary.tsx`): 공간을 고려하여 재고 정보를 간결하게 `(에러)`로 대체하여 표시합니다.  (예) 퇴촌(0/0) -> 퇴촌(에러)
    - 상세 뷰(`MyLibraryBookDetailModal.tsx`): 사용자에게 더 많은 정보를 제공하기 위해 기존 재고 정보 옆에 `(에러)` 문구를 함께 표시합니다. (예) 퇴촌(1/1) -> 퇴촌(1/1)(에러)
    - 참고로, 에러시에는 기존 supabase db를 업데이트하지는 않는다.

3.  **코드 리팩토링 (`MyLibraryBookDetailModal.tsx`)**:
    - 상세 모달 내에서 중복되던 재고 표시 로직을 `LibraryStockSection` 컴포넌트로 추출하여 코드 중복을 제거하고 유지보수성을 향상시켰습니다.

feat(store): API 에러 상태 저장 및 DB 업데이트 로직 개선

API 재고 조회 실패 시(특히 타임아웃), 사용자에게 피드백을 주지 못하고 오래된 데이터가 최신 정보인 것처럼 표시되는 문제를 해결합니다.

주요 변경사항:
- `types.ts`: `BookData`에 종이책 API 응답(성공/실패)을 저장할 `gwangjuPaperInfo` 프로퍼티 추가
- `useBookStore.ts`: `refreshAllBookInfo` 함수 로직 대폭 개선
  - UI 상태(Zustand)는 API 응답 결과를 즉시 반영하여 에러 상태를 바로 표시하도록 함
  - DB 업데이트 시에는 API 응답이 성공한 경우에만 데이터를 저장함
  - 기존 책의 재고 조회 실패 시: DB의 유효한 과거 데이터를 보존
  - 신규 책의 재고 조회 실패 시: 에러 상태와 함께 재고를 0/0으로 DB에 저장

이를 통해 UI는 사용자에게 정확한 피드백을 제공하고, DB는 데이터의 무결성을 유지할 수 있게 되었습니다.

feat(ui): 도서관 재고 조회 API 에러 상태 UI에 표시

API 에러 상태를 저장하는 로직이 추가됨에 따라, 이를 사용자에게 시각적으로 명확하게 전달하도록 UI를 개선합니다.

주요 변경사항:
- `MyLibrary.tsx`: `LibraryTag` 컴포넌트가 `isError` prop을 받도록 수정. 에러 발생 시 "(에러)" 텍스트와 함께 에러 상태 스타일을 표시합니다.
- `MyLibraryBookDetailModal.tsx`:
  - `renderStockInfo` 및 각 전자책 렌더링 로직에 에러 상태 확인 로직 추가
  - 에러 발생 시, 기존 재고 정보 옆에 "(에러)" 문구를 추가로 표시하여 사용자에게 과거 데이터와 현재 에러 상태를 함께 제공합니다.

refactor(modal): MyLibraryBookDetailModal 재고 표시 로직 중복 제거

MyLibraryBookDetailModal 컴포넌트 내에서 조건부 레이아웃(`isLibraryStockOnly`)으로 인해 재고 표시를 위한 JSX 코드 블록이 완전히 중복되어 있었습니다.

주요 변경사항:
- 중복된 재고 표시 로직을 `LibraryStockSection`이라는 새로운 내부 컴포넌트로 추출했습니다.
- 기존의 복잡한 삼항 연산자 구조를 단순화하고, 각 컬럼에서 `LibraryStockSection` 컴포넌트를 호출하도록 변경했습니다.

이 리팩토링을 통해 코드 중복을 제거하고, 향후 재고 표시 로직 수정 시 한 곳만 변경하면 되도록 유지보수성을 크게 향상시켰습니다.


3de2981
ahnbu
Mon Oct 13 12:57:01 2025 +0900
refactor : cloudfare index.js timeout 15초로 통일
- 기존에 5초, 20초, 25초로 달랐는데, 15초로 통일시킴
- 경기e북(구독) timeout 없었는데, 추가


6c32177
ahnbu
Sun Oct 12 00:28:49 2025 +0900
fix(search): 키워드 통합 검색 기능 디버깅 및 안정성 향상
신규로 추가된 '키워드 통합 검색' 기능의 초기 구현 이후 발견된 다수의 버그를 수정하고 코드 품질을 개선했습니다.

주요 변경 내용:

1.  **종이책 검색 결과 파싱 오류 수정:**
    -   `index.js` (Cloudflare Worker)의 `parseGwangjuPaperKeywordResults` 함수를 전면 재작성하여, 종이책 검색 결과가 누락되거나 데이터가 잘못 매핑되던 문제를 해결했습니다.
    -   이제 제목, 저자, 출판사가 정확히 분리되고, 소장처에 따라 '퇴촌'과 '기타' 도서관이 올바르게 구분됩니다.

2.  **전자책 데이터 매핑 오류 수정:**
    -   'e교육', 'e경기' 등 전자책 검색 결과에서 저자 정보가 누락되거나 출간일 필드에 출판사 정보가 들어가는 등 잘못된 데이터 매핑 문제를 해결했습니다.
    -   모든 파싱 함수가 `(title, author, publisher, pubDate, ...)` 표준 포맷을 일관되게 따르도록 수정했습니다.

3.  **Wrangler 개발 환경 문제 해결:** -> 아직도 자동 반영되지 않고 있음. 수동으로 npm run deploy해야 반영됨
    -   로컬 개발 서버에서 파일 수정이 자동으로 반영되지 않던 문제를 해결했습니다.
    -   프로젝트의 `wrangler` 패키지를 최신 버전으로 업데이트하여, `compatibility_date` 불일치 경고를 제거하고 파일 감지 기능(watch mode)을 정상화했습니다.

4.  **UI/UX 개선:**
    -   `KeywordSearchModal.tsx`에 '출판사' 컬럼을 추가하고, `whitespace-nowrap` 및 `truncate` 클래스를 활용하여 테이블 컬럼 너비를 최적화함으로써 가독성을 높였습니다.
    -   경기광주 시립도서관의 웹 방화벽 차단 문제로 인해, 관련 기능 개선은 일시적으로 보류했습니다.

추후 개선 필요사항:

1.  **Wrangler 개발 환경 문제:** -> 아직도 자동 반영되지 않고 있음. 수동으로 npm run deploy해야 반영됨
2.  경기광주 시립 도서관 링크가 아래와 같은 메시지가 나오면서 모두 작동하지 않는다. (내서재, 키워드검색 마찬가지)

The request / response that are contrary to the Web firewall security policies have been blocked.
Detect time	2025-10-12 00:05:11
Detect client IP	121.135.127.37
Detect URL	https://lib.gjcity.go.kr/tc/lay1/program/s23t3001c3002/jnet/resourcessearch/resultlist.do

3. 키워드 검색모드에서 다크모드 적용 안됨. 현재는 라이트모드로 제작됨


a237f31
ahnbu
Sat Oct 11 18:33:22 2025 +0900
feat: 키워드 기반 통합 도서관 검색 기능 구현
하나의 키워드로 6개 도서관의 자료를 동시에 검색하고, 결과를 통합된 테이블로 보여주는 '키워드 통합 검색' 기능을 추가했습니다.

주요 구현 내용:

1.  **신규 컴포넌트 및 UI 추가:**
    -   `KeywordSearchModal.tsx`: 키워드 입력, 로딩 상태 표시, 정렬 가능한 결과 테이블을 포함하는 새로운 모달 컴포넌트를 생성했습니다.
    -   `Auth.tsx`: 프로필 드롭다운 메뉴에 '키워드 검색' 항목을 추가하여 모달을 열 수 있도록 구현했습니다.
    -   `useUIStore.ts`: 모달의 열림/닫힘 상태를 관리하는 전역 상태와 액션을 추가했습니다.

2.  **Cloudflare Worker 백엔드 확장:**
    -   `/keyword-search` 라는 신규 엔드포인트를 추가하여, 프론트엔드로부터 받은 키워드로 6개 도서관 크롤링을 병렬 처리(`Promise.allSettled`)합니다.
    -   각 도서관의 다양한 응답 형식을 `(type, libraryName, title, author, pubDate, isAvailable)` 구조로 정규화하여 프론트엔드가 사용하기 쉬운 통합된 JSON 배열로 반환합니다.

3.  **검색 정확도 및 일관성 개선:**
    -   `MyLibrary.tsx`에서 사용하던 키워드 처리 로직(부제 제거, 3단어 제한)을 `KeywordSearchModal`에도 동일하게 적용하여 검색 결과의 일관성을 확보했습니다.
    -   각 도서관별 외부 링크 URL을 기존 '내 서재' 기능과 완전히 일치시켜 정확한 페이지로 이동하도록 수정했습니다.

4.  **사용자 경험 향상:**
    -   검색 중에는 로딩 스피너를 표시하여 사용자에게 명확한 피드백을 제공합니다.
    -   결과 테이블의 모든 컬럼 헤더를 클릭하여 오름차순/내림차순으로 정렬할 수 있는 기능을 추가했습니다.
    -   대출 가능 여부를 아이콘과 색상으로 시각적으로 구분하여 가독성을 높였습니다.


0cc121b
ahnbu
Sat Oct 11 16:45:44 2025 +0900
fix: 도서 상세 모달에서 퇴촌도서관 재고 링크가 없었던 버그 수정
도서 상세 모달(`MyLibraryBookDetailModal`)을 열었을 때, 퇴촌 및 기타 도서관의 종이책 재고가 `undefined / undefined`로 표시되고 관련 링크의 검색어가 비어있는 문제를 해결했습니다.

문제 원인:
- 이전 리팩토링 과정에서 `renderStockInfo` 함수의 매개변수 순서가 `(name, title, stock)`으로 변경되었으나, 모달 내에서 이 함수를 호출하는 부분의 인자 순서가 일부 수정되지 않았습니다.
- 이로 인해 `book.title`이 `stock`으로, `stock` 객체가 `title`로 잘못 전달되어 `TypeError`가 발생하거나 데이터가 누락되었습니다.

수정 내용:
- `MyLibraryBookDetailModal.tsx` 내에서 `renderStockInfo` 함수를 호출하는 모든 지점의 인자 순서를 `(libraryName, book.title, book.stockObject)`로 바로잡았습니다.
- 더 이상 사용되지 않는 `detailedStockInfo` 매개변수를 호출부에서 제거했습니다.

기대 효과:
- 이제 도서 상세 모달에서도 내 서재 목록과 동일하게 모든 도서관의 재고 정보가 정확하게 표시됩니다.
- 재고 정보에 연결된 외부 링크가 올바른 검색어를 포함하여 정상적으로 동작합니다.


66ae8fe
ahnbu
Sat Oct 11 16:27:08 2025 +0900
fix: 외부 링크 클릭 시 서재 상태가 초기화되는 버그 해결
내 서재에서 '전체보기'를 활성화한 상태에서 외부 링크(`target="_blank"`)를 클릭했을 때, 서재 목록이 초기 페이지네이션 상태로 리셋되는 버그를 수정했습니다.

문제 원인:
- 외부 링크 클릭으로 인한 브라우저 탭 포커스 변경 시, Supabase 인증 리스너가 `session` 객체를 새로운 참조로 갱신했습니다.
- `App.tsx`의 `useEffect` 훅이 `session` 객체 전체를 의존성으로 사용하고 있어, 이 참조 변경을 감지하고 불필요하게 재실행되었습니다.
- 결과적으로, 초기 데이터 로딩 함수인 `fetchUserLibrary()`가 다시 호출되어 '전체보기' 상태가 초기화되었습니다.

수정 내용:
- `App.tsx`의 `useEffect` 훅의 의존성 배열을 기존 `[session]`에서 `[session?.user?.id]`로 변경했습니다.
- 이제 이 훅은 세션 객체의 참조가 변경될 때가 아니라, 실제 사용자의 로그인/로그아웃 상태(사용자 ID의 존재 여부)가 변경될 때만 실행됩니다.

기대 효과:
- 외부 링크 클릭, 탭 전환 등 `session` 객체가 내부적으로 갱신되는 상황에서도 더 이상 서재 상태가 초기화되지 않습니다.
- `useEffect`의 불필요한 재실행을 방지하여 애플리케이션의 안정성과 성능이 향상되었습니다.


2d517ba
ahnbu
Sat Oct 11 15:29:07 2025 +0900
perf: API 응답 속도 개선 (요청 타임아웃을 20초에서 5초로 조정)
Cloudflare Worker에서 각 도서관 서버로 보내는 크롤링 요청의 타임아웃을 기존 20초에서 5초로 단축했습니다.

문제 상황:
- `Promise.allSettled`를 사용하더라도, 응답이 매우 느리거나 없는 하나의 도서관 서버가 전체 API 응답 시간을 최대 20초까지 지연시키는 문제가 있었습니다.
- 이로 인해 대부분의 도서관 정보가 이미 수신되었음에도 불구하고 사용자가 불필요하게 오래 기다려야 했습니다.

개선 내용:
- 모든 `fetch` 요청의 `AbortSignal.timeout` 값을 5초로 조정하여, 특정 서버가 5초 이내에 응답하지 않으면 해당 요청을 실패로 처리하고 즉시 다음 단계로 진행하도록 변경했습니다.

기대 효과:
- 실험 결과, 기존에 약 10초가 소요되던 요청이 2.5초 내외로 완료되는 등 평균 API 응답 속도가 크게 향상되었습니다.
- 특정 도서관 서버의 장애나 지연이 전체 서비스의 사용자 경험에 미치는 영향을 최소화하여 서비스 안정성이 향상됩니다.


e1471a6
ahnbu
Sat Oct 11 15:16:32 2025 +0900
refactor : 관리자 기능 부가설명 안보이게, api 테스트 수동입력 주석처리


a50bc20
ahnbu
Sat Oct 11 15:03:30 2025 +0900
fix: CSV 내보내기 시 전체 서재 데이터가 아닌 일부만 포함되는 문제 해결
CSV 내보내기 기능이 현재 UI에 로드된 책만 대상으로 동작하여, 페이지네이션으로 일부만 표시된 경우 전체 서재가 아닌 일부 데이터만 파일에 포함되는 버그를 수정했습니다.

수정 내용:
- `SettingsModal`의 CSV 내보내기 버튼 클릭 핸들러(`handleExportAllToCSV`)를 비동기 함수로 변경했습니다.
- 내보내기 실행 시, `isAllBooksLoaded` 상태를 확인하여 아직 로드되지 않은 책이 있으면 `fetchRemainingLibrary()`를 호출하여 모든 책 데이터를 메모리로 불러옵니다.
- 전체 데이터 로드가 완료된 후, 스토어의 최신 `myLibraryBooks` 배열을 가져와 `exportToCSV` 함수에 전달하도록 수정했습니다.
- 데이터 준비 및 내보내기 과정 동안 사용자에게 "준비 중...", "내보내는 중..." 등의 피드백을 제공하고 버튼을 비활성화하여 사용자 경험을 개선했습니다.

기대 효과:
- 이제 사용자는 현재 UI 로딩 상태와 무관하게 항상 DB에 저장된 전체 서재 데이터를 CSV 파일로 내보낼 수 있습니다.


2c487b5
ahnbu
Sat Oct 11 14:50:37 2025 +0900
fix: 도서 메모 DB 저장 문제와 태그 필터링시 즉시 반영 문제 해결
### 도서 메모가 새로고침 시 표시되지 않는 문제 수정

내 서재의 도서 목록을 불러올 때 데이터베이스에서 `note` 필드를 조회하지 않아, 저장된 메모가 페이지 새로고침 후 사라지는 버그를 해결했습니다.

문제 원인:
- `user_library` 테이블에서 메모는 `book_data`(JSONB)와 별개인 `note`(TEXT) 컬럼에 저장됩니다.
- `useBookStore`의 `fetchUserLibrary`와 `fetchRemainingLibrary` 함수에서 Supabase 데이터를 조회할 때, `select` 문에 `note` 필드를 포함하지 않았습니다.
- 이로 인해 DB에는 메모가 정상적으로 저장되어 있었지만, 애플리케이션 상태에는 로드되지 않아 메모가 없는 것처럼 보였습니다.

수정 내용:
1.  **DB 조회 쿼리 수정 (`useBookStore.ts`):**
    -   `fetchUserLibrary`와 `fetchRemainingLibrary` 함수의 Supabase `select` 쿼리에 `note` 필드를 추가했습니다.
    -   (변경 전: `.select('id, book_data', ...)` → 변경 후: `.select('id, book_data, note', ...)`).

2.  **상태 매핑 로직 수정 (`useBookStore.ts`):**
    -   DB에서 가져온 `item.note` 값을 `myLibraryBooks` 상태 배열의 각 책 객체에 올바르게 매핑하도록 로직을 수정했습니다.

기대 효과:
-   이제 사용자가 메모를 저장하면, 페이지를 새로고침하거나 재방문해도 데이터가 온전히 유지됩니다.
-   내 서재 목록에서 저장된 메모가 정상적으로 표시되며, 클릭하여 수정하는 기능이 의도대로 동작합니다.

### 태그 필터링 시 메모 업데이트가 즉시 반영되지 않는 문제 해결

내 서재에서 태그로 필터링된 상태일 때, 책의 메모를 수정해도 UI가 즉시 갱신되지 않고 새로고침해야만 변경사항이 보이던 버그를 수정했습니다.

문제 원인:
- 도서 정보 업데이트 로직(`updateBookInStoreAndDB`)이 메인 서재 목록(`myLibraryBooks`)만 갱신하고, 태그 필터 결과 목록(`libraryTagFilterResults`)은 갱신하지 않아 상태 비동기화가 발생했습니다.

수정 내용:
- `useBookStore`의 `updateBookInStoreAndDB` 헬퍼 함수를 수정하여, 책 정보가 업데이트될 때 `myLibraryBooks` 뿐만 아니라 `librarySearchResults`, `libraryTagFilterResults` 배열도 함께 갱신하도록 변경했습니다.
- 낙관적 업데이트와 실패 시 롤백 로직 모두에 동일한 동기화 로직을 적용하여 데이터 일관성을 확보했습니다.

기대 효과:
- 이제 태그 필터, 검색 등 어떤 뷰 상태에서도 메모 수정, 별점 변경, 읽음 상태 변경 등의 작업이 UI에 즉시 반영됩니다.


431d98b
ahnbu
Sat Oct 11 14:19:28 2025 +0900
fix: 일괄 갱신 범위가 DB 전체 권수를 반영하도록 수정
일괄 재고 갱신 기능에서, 현재 메모리에 로드된 책의 수가 아닌 DB에 저장된 전체 책의 수를 기준으로 갱신 범위를 표시하고 선택할 수 있도록 버그를 수정했습니다.

문제 상황:
- `myLibraryBooks.length`를 기준으로 갱신 옵션을 생성하여, 페이지네이션으로 일부만 로드된 경우 '전체 (50권)'처럼 잘못된 정보가 표시되었습니다.
- 사용자가 '전체' 갱신을 선택해도 실제로는 로드된 책만 갱신되는 문제가 있었습니다.

수정 내용:

1.  **전체 권수 기준 UI 업데이트 (`SettingsModal`)**
    -   Zustand 스토어에서 `totalBooksCount`(DB 전체 권수) 상태를 가져와 사용하도록 변경했습니다.
    -   갱신 범위 선택 드롭다운 메뉴가 항상 DB의 전체 권수를 기준으로 올바르게 표시됩니다. (예: 501권 보유 시 '전체 (501권)'으로 표시)

2.  **'전체' 갱신 시 자동 데이터 로드 기능 추가**
    -   사용자가 '전체' 갱신을 선택했을 때, 아직 모든 책이 로드되지 않았다면(`isAllBooksLoaded`가 `false`인 경우) `fetchRemainingLibrary()`를 먼저 호출합니다.
    -   이를 통해 모든 책 데이터를 메모리에 로드한 후 전체 갱신을 시작하여, 누락 없이 모든 책이 갱신되도록 보장합니다.
    -   데이터 로딩 중에는 사용자에게 "전체 책 목록을 불러오는 중..."이라는 피드백을 제공합니다.

기대 효과:
-   사용자는 현재 로딩 상태와 상관없이 자신의 서재에 있는 모든 책을 대상으로 정확한 갱신 범위를 선택하고 실행할 수 있습니다.
-   페이지네이션이 적용된 상태에서도 '전체 갱신' 기능이 의도대로 완전하게 동작합니다.


661e709
ahnbu
Sat Oct 11 13:32:32 2025 +0900
feat: 전체 책 재고 일괄 갱신 기능 구현
사용자가 자신의 서재에 있는 모든 책의 재고 정보를 한 번에 업데이트할 수 있는 '재고 일괄 갱신' 기능을 추가했습니다. API 요청 제한을 준수하고 사용자 피드백을 강화하는 데 중점을 두었습니다.

주요 구현 내용:

- **UI 및 사용자 경험 (SettingsModal)**
  - '맞춤설정 > 내보내기' 탭에 '재고 일괄 갱신' 섹션을 추가했습니다.
  - 갱신 범위를 동적으로 선택(25, 50, 100, 200, 전체)할 수 있으며, 보유 권수보다 큰 옵션은 자동으로 숨겨집니다.
  - 갱신 시작 전 예상 소요 시간을 포함한 확인 다이얼로그를 표시합니다.
  - 진행 상황을 시각적으로 보여주는 Progress Bar와 실시간 진행률, 실패 건수를 표시합니다.

- **비동기 작업 제어 (`useBookStore`)**
  - 일괄 갱신 작업을 관리하는 `bulkRefreshAllBooks` 액션을 추가했습니다.
  - 사용자가 작업을 제어할 수 있도록 **일시정지, 재개, 취소** 기능을 구현했습니다.
  - `bulkRefreshState` 상태를 통해 갱신 진행 상태(실행, 일시정지, 취소, 진행률 등)를 추적합니다.

- **API 안정성 및 성능**
  - Aladin API의 요청 제한을 피하기 위해 10권씩 배치로 처리하며, 각 배치 사이에 1초의 대기 시간을 적용했습니다.
  - 갱신 중 모달을 닫으려고 할 때 경고를 표시하여 의도치 않은 중단을 방지합니다.

- **피드백 및 에러 처리**
  - 작업 완료 후 성공, 실패, 취소 상태에 따라 명확한 통계 알림을 제공합니다.
  - 개별 책의 갱신이 실패하더라도 전체 작업은 중단되지 않고, 최종 결과에 실패 건수로 기록됩니다.


e994c01
ahnbu
Sat Oct 11 13:10:54 2025 +0900
refactor: Cloudfare 함수 네이밍과 주석 개선
코드의 명확성과 미래 확장성을 높이기 위해 Cloudflare Worker와 프론트엔드 서비스의 네이밍 및 구조를 리팩토링했습니다.

주요 변경 사항:

1.  **Cloudflare Worker 함수 네이밍 개선 (`index.js`)**
    -   Worker 내부의 검색/파싱 함수들의 역할을 명확히 하기 위해 이름을 변경했습니다.
    -   (예: `searchSingleGyeonggiEbook` → `searchGyeonggiEduEbook`, `searchSiripOwnedEbook` → `searchSiripEbookOwned`)

2.  **API 요청 파라미터 명확화 (`index.js` & `service.ts`)**
    -   모호했던 API 요청 키 `title`을 `eduTitle`로 변경하여 '경기도 교육청 전자도서관' 검색용임을 명확히 했습니다.
    -   이에 맞춰 프론트엔드 서비스의 API 호출(`fetchBookAvailability`) 부분을 수정했습니다.

3.  **제목 처리 로직 구조화 (`unifiedLibrary.service.ts`)**
    -   기존의 범용 `processBookTitle` 함수를 각 도서관(교육청, 경기도, 시립)에 특화된 3개의 개별 함수(`processGyeonggiEbookEduTitle` 등)로 분리하여, 향후 각기 다른 제목 처리 로직을 적용할 수 있도록 확장성을 확보했습니다.


9490659
ahnbu
Sat Oct 11 12:17:41 2025 +0900
refactor: 교육e북 ISBN 크롤링 추가 및 저자명 비교 2자로 변경
주요 변경 사항:

1.  **경기도 교육청 전자도서관 ISBN 크롤링 추가**
    -   Cloudflare Worker(`index.js`)의 `parseGyeonggiHTML` 함수를 수정하여, HTML 내 'keyValue' 속성에서 ISBN 정보를 추출하도록 기능을 추가했습니다.
    -   이를 통해 프론트엔드에서 더 정확한 도서 매칭이 가능해집니다.

2.  **저자명 비교 로직 수정 (3글자 → 2글자)**
    -   `isbnMatcher.ts`의 `normalizeAuthorName` 함수에서 저자명 비교 기준을 기존 3글자에서 2글자로 변경했습니다.
    -   두 글자 이름의 저자(예: 이도)나 이름 변형이 있는 경우의 매칭 정확도를 높이기 위함입니다.

3.  **Cloudflare Worker 주석 개선**
    -   `index.js` 상단의 주석을 최신화하고 가독성을 높여, 스크립트의 버전과 주요 기능 변경 이력을 쉽게 파악할 수 있도록 정리했습니다.


5534832
ahnbu
Sat Oct 11 01:57:46 2025 +0900
fix: 경기도 전자도서관 (소장형) 재고 확인 로직 전면 개선
이전 커밋에서 검색어 생성 로직을 개선했음에도 불구하고, 경기도 전자도서관에서 지속적으로 검색이 실패하거나 재고가 0으로 표시되는 문제를 해결합니다.

분석 결과, 문제의 원인은 API 호출 방식과 클라이언트 측의 과도한 필터링에 있었습니다. 아래 세 가지 핵심 사항을 수정하여 로직을 전면 개선했습니다.

### 1. 경기e북 소장형 API 호출 방식 키워드 방식으로 변경 (Cloudflare Worker)
- **파일**: `cloudfare_index.js`
- **문제**: 소장형 도서 검색(`searchOwnedBooks`) 시, 특수문자에 매우 민감한 `detailQuery` 파라미터를 사용하여 검색 성공률이 낮았습니다.
- **해결**: 실제 웹사이트 검색과 동일하게 동작하는, 더 유연하고 안정적인 `keyword` 파라미터를 사용하도록 API 호출 URL을 변경했습니다.

### 2. UI 링크 생성 방식 동기화 (클라이언트)
- **파일**: `unifiedLibrary.service.ts`
- **문제**: UI에서 사용자가 클릭하는 바로가기 링크(`createGyeonggiEbookSearchURL`)가 여전히 구식의 `detailQuery` 방식을 사용하고 있었습니다.
- **해결**: API 호출 방식 변경에 맞춰, UI 링크 또한 `keyword` 파라미터를 사용하도록 수정하여 데이터 소스와 사용자 경험을 일치시켰습니다.

### 3. ISBN 필터링 로직 제거 (클라이언트)
- **파일**: `utils/isbnMatcher.ts`
- **문제**: 전자책은 종이책과 ISBN이 다른 경우가 많음에도, 프론트엔드에서 엄격한 ISBN 필터링(`filterGyeonggiEbookByIsbn`)을 적용하여 올바른 검색 결과를 폐기하는 문제가 있었습니다.
- **해결**: 다른 전자도서관과의 일관성을 위해 필터링 로직을 제거하고, Worker가 보내준 검색 결과를 100% 신뢰하도록 정책을 변경했습니다.

### 기대 효과
- **정확도 대폭 향상**: `자네, 좌뇌한테 속았네!`와 같이 특수문자가 포함된 책의 재고가 정확하게 표시됩니다.
- **안정성 확보**: 실제 사용 환경과 동일한 검색 방식을 사용하여 잠재적인 검색 실패 요소를 제거했습니다.
- **코드 단순화**: 불필요하고 복잡했던 클라이언트 측 필터링 코드를 제거하여 유지보수성을 높였습니다.


76b6a5b
ahnbu
Sat Oct 11 00:15:04 2025 +0900
refactor(search): 4개 전자도서관 검색 제목 로직 개선
기존에 파편화되어 있던 4개 주요 전자도서관의 검색어 생성 로직을 단일 로직으로 통합하여 검색 성공률과 코드 일관성을 대폭 개선

### 요약
- 경기교육e북 : 특수문자 제외 한 3단어(50% 성공률)
- 나머지3개(경기도, 시립소장, 시립구독) : 부제 제외 이전까지 3단어 -> 그러나 쉼표까지 부제로 포함시켜서 정확도 낮았음

-**최종대안**:
  - 부제를 제외하되, 쉼표는 일반 단어로 처리한다. 괄호[]{}(), 콜론:, 하이픈-만 부제로 처리한다.
  - 4개 도서관 공통으로 적용한다.

### 문제점
- **`경기교육e북`**: `processBookTitle` 함수를 사용하여 검색 성공률이 약 50%로 저조했습니다. (예: `과학, 재미가 먼저다` -> `과학`으로 잘못 축약)
- **로직 파편화**: 2개의 서로 다른 함수가 4개의 도서관을 처리하여 유지보수가 비효율적이었습니다.

### 변경 사항 상세

**[AS-IS] 이전 로직**
- **`processGyeonggiEbookTitle` (우수 로직)**
  - 대상: `경기도e북`, `광주시립e북(소장/구독)`
  - 동작: 콜론(:), 하이픈(-) 등 명백한 부제 구분자 뒤를 제거
- **`processBookTitle` (문제 로직)**
  - 대상: `경기교육e북`
  - 동작: 특수문자를 일괄 변환하여 검색어 정확도 저하 유발

**[TO-BE] 통합된 단일 로직**
- **대상**: 4개 전자도서관 모두 (`경기도e북`, `광주시립e북`, `경기교육e북`)
- **동작**: 모든 시스템이 `processGyeonggiEbookTitle`의 우수한 로직을 사용하도록 `processBookTitle` 함수가 내부적으로 이를 호출하도록 수정했습니다.

### 기대 효과
- **검색 성공률 향상**: 특히 `경기교육e북`의 검색 정확도가 크게 향상됩니다.
- **일관성 확보**: 모든 전자도서관에서 동일한 기준으로 검색어가 생성되어 사용자 경험이 일관적으로 개선됩니다.
- **유지보수성 향상**: 향후 검색 로직 개선 시, 단일 함수만 수정하면 되어 관리가 용이해집니다.


f058002
ahnbu
Fri Oct 10 20:42:00 2025 +0900
fix : 경기도 전자도서관 정확도 개선 (전자책 없는 경우)
알라딘 전자책이 없는데, 도서관 전자책은 있는 경우에는
ISBN 매칭이 아니라, 저자명 앞 세자리로 필터링하도록 기준 추가

(예) "자네, 좌뇌한테 속았네"

utils/isbnMatcher.ts - 조건부 저자명 매칭 로직 추가
저자명 정규화 함수 추가 (괄호/공백 제거, 앞 3글자)

isBookMatched() 함수 수정:
if (book.subInfo?.ebookList?.length > 0) {
  // 알라딘 전자책 있음 → ISBN 매칭만 (기존 로직)
  return ISBN 일치 여부
} else {
  // 알라딘 전자책 없음 → ISBN 또는 저자명 매칭
  return ISBN 일치 || 저자명 앞 3글자 일치
}


2811cfd
ahnbu
Fri Oct 10 19:52:56 2025 +0900
fix(library): 경기도 전자도서관 대출 가능 권수 집계 오류 수정
경기도 전자도서관 API의 실제 응답 데이터와 타입 정의가 일치하지 않아 대출 가능 권수가 항상 0으로 집계되는 버그를 수정합니다.

- `unifiedLibrary.service.ts`:
  - `GyeonggiEbookLibraryBook` 타입의 `status: string` 속성을 실제 API 응답과 동일한 `available: boolean`으로 변경하여 타입 정의를 바로잡았습니다.
- `isbnMatcher.ts`:
  - `filterGyeonggiEbookByIsbn` 함수에서 대출 가능 여부를 확인할 때, 잘못된 `status` 속성 대신 올바른 `available` 속성을 사용하도록 로직을 수정했습니다.

이 변경으로 인해 ISBN 필터링 후에도 대출 가능 권수가 정확하게 계산되어 UI에 올바르게 표시됩니다.


0e8739c
ahnbu
Fri Oct 10 00:33:52 2025 +0900
chore: Trigger Vercel deployment


9566120
ahnbu
Fri Oct 10 00:25:14 2025 +0900
feat(library): 태그 필터링 기능을 서버 측으로 전환하여 정확성 개선
내 서재의 태그 필터링 기능이 초기에 로드된 일부 데이터만을 대상으로 동작하던 문제를 해결했습니다. 이제 태그 필터링은 페이지네이션 상태와 관계없이 항상 사용자의 전체 서재를 기준으로 정확하게 수행됩니다.

[문제점]
-   기존에는 `TagFilter` 컴포넌트가 클라이언트 측에서 `books` prop을 받아 필터링했습니다.
-   이로 인해 '전체 보기'를 누르기 전까지는 일부 데이터 내에서만 필터링이 적용되는 부정확한 사용자 경험을 제공했습니다.

[주요 변경 사항]

1.  **DB 함수(RPC) 생성**:
    -   Supabase DB에 `get_books_by_tags` 함수를 추가했습니다.
    -   이 함수는 태그 ID 배열을 인자로 받아, JSONB `?|` 연산자를 사용하여 해당 태그를 포함하는 모든 책을 효율적으로 조회합니다.

2.  **Zustand 스토어 (`useBookStore`) 수정**:
    -   DB 함수를 호출하는 `filterLibraryByTags` 액션을 신규 구현했습니다.
    -   필터링 결과를 저장할 `libraryTagFilterResults` 상태와 로딩 상태 `isFilteringByTag`를 추가했습니다.

3.  **UI (`MyLibrary`, `TagFilter`) 수정**:
    -   `handleTagClick` 이벤트가 `filterLibraryByTags` 액션을 호출하도록 로직을 변경했습니다.
    -   `sortedAndFilteredLibraryBooks`의 렌더링 로직을 수정하여, 태그 필터가 활성화되면 DB에서 가져온 `libraryTagFilterResults`를 우선적으로 사용하도록 변경했습니다.
    -   홈 리셋 시 태그 필터 상태도 함께 초기화되도록 로직을 통합했습니다.

[기대 효과]
-   **정확한 필터링**: 사용자는 언제나 전체 서재를 대상으로 일관된 태그 필터링 결과를 얻을 수 있습니다.
-   **성능 유지**: 초기 로딩 성능을 저해하지 않으면서 필터링 기능의 정확성을 확보했습니다.
-   **코드 개선**: 클라이언트 측의 복잡한 필터링 로직을 서버로 이전하여 코드 구조를 단순화했습니다.


0e4548d
ahnbu
Thu Oct 9 23:22:58 2025 +0900
feat(search): 내 서재 검색 기능을 서버 측 검색으로 전환하여 성능 및 정확도 개선
초기 로딩 성능 최적화 이후, 클라이언트 측 검색이 로드된 일부 데이터만을 대상으로 하는 문제를 해결하기 위해 서버(DB) 기반 검색으로 전환했습니다.

[주요 변경 사항]

1.  **DB 스키마 변경 (Supabase)**:
    -   `user_library` 테이블에 검색 효율을 위한 `title` (TEXT), `author` (TEXT) 컬럼을 신규 추가했습니다.
    -   기존 데이터의 `book_data`(JSONB)에서 `title`과 `author`를 추출하여 새 컬럼으로 마이그레이션했습니다.
    -   `pg_trgm` 확장을 활성화하고, `title`과 `author` 컬럼에 GIN Trigram 인덱스를 생성하여 한국어 부분 검색 성능을 최적화했습니다.

2.  **Zustand 스토어 (`useBookStore`) 수정**:
    -   `searchUserLibrary`: DB에 직접 `ilike` 쿼리를 보내는 서버 검색 함수를 신규 구현했습니다.
    -   `addBookToLibrary`: 책 추가 시 `title`, `author` 컬럼에도 데이터를 함께 저장하도록 수정하여 데이터 정합성을 유지합니다.
    -   `refreshAllBookInfo`: 책 정보 업데이트 시에도 `title`, `author` 컬럼이 함께 갱신되도록 수정했습니다.

3.  **UI (`MyLibrary`) 연동**:
    -   사용자 입력 시(디바운싱 후) `searchUserLibrary`를 호출하여 실시간 DB 검색을 수행합니다.
    -   검색 결과가 있을 경우, 해당 결과를 우선적으로 표시하도록 렌더링 로직을 수정했습니다.
    -   홈 리셋 시 검색 관련 상태도 함께 초기화하여 일관된 사용자 경험을 제공합니다.

[기대 효과]
-   **검색 정확도 향상**: 페이지네이션과 관계없이 항상 전체 서재를 대상으로 정확한 검색이 가능해졌습니다.
-   **성능 유지**: 초기 로딩 속도 최적화의 이점을 그대로 유지하면서 검색 기능의 한계를 극복했습니다.
-   **확장성 확보**: 서재의 책 수량이 늘어나도 DB 인덱스 덕분에 안정적인 검색 속도를 보장합니다.


75d67f0
ahnbu
Thu Oct 9 19:25:47 2025 +0900
fix(MyLibrary): 책 권수 표시 오류 및 홈 리셋 버그 수정
최근 도입된 페이지네이션(부분 로딩) 기능으로 인해 발생한 두 가지 UI 버그를 수정합니다.

1.  **총 책 권수 표시 오류 수정**
    -   **문제**: 내 서재 상단에 표시되는 총 책의 수가 실제 DB의 전체 수가 아닌, 현재 로드된 일부 책의 수(예: '총 50권')로 잘못 표시되었습니다.
    -   **해결**: 필터가 없는 기본 상태에서는 `totalBooksCount` 상태를 사용해 실제 전체 권수(예: '총 474권')가 표시되도록 수정했습니다. 필터링 시에는 필터링된 결과 수가 정상적으로 표시됩니다.

2.  **홈 리셋 시 '전체 보기' 버튼 미표시 버그 수정**
    -   **문제**: '전체 보기'로 모든 책을 본 후, 홈 버튼으로 뷰를 리셋해도 '전체 보기' 버튼이 다시 나타나지 않았습니다.
    -   **원인**: 홈 리셋 함수가 UI 상태만 초기화하고 데이터 로딩 상태(`isAllBooksLoaded`)는 초기화하지 않아 발생한 상태 불일치 문제였습니다.
    -   **해결**: 홈 리셋 시 `fetchUserLibrary()`를 호출하여 데이터 관련 상태까지 완벽하게 초기 상태로 되돌리도록 수정했습니다.

[변경 사항]
- `MyLibrary.tsx`:
  - 모바일 및 데스크톱 뷰의 총 권수 표시 로직을 `totalBooksCount`를 사용하도록 수정
  - `resetAllLibraryStates` 함수가 `fetchUserLibrary`를 호출하도록 로직 변경
  - `useCallback` 의존성 배열 업데이트 (초기 로딩 성능에 영향 없음)


6885742
ahnbu
Thu Oct 9 18:25:23 2025 +0900
chore: Vercel API 타입 정의를 위한 @vercel/node 추가
Vercel 빌드 시 발생하던 TypeScript 에러 해결:
- api/search.ts에서 VercelRequest, VercelResponse 타입 사용
- @vercel/node 패키지를 devDependencies에 추가

빌드 로그 에러:
api/search.ts(1,52): error TS2307: Cannot find module '@vercel/node'


1917ae6
ahnbu
Thu Oct 9 18:20:23 2025 +0900
perf: 초기 페이지 로딩 성능 개선 (89% 데이터 감소, 41% 시간 단축)
- useEffect 중복 호출 제거로 DB 조회 2회 → 1회 감소
- 초기 로딩 시 사용자 설정값만큼만 데이터 로드 (페이지네이션)
- 전체 권수 정확하게 표시하도록 totalBooksCount 추가

성능 개선 결과:
- 로딩 시간: 1,956ms → 1,157ms (41% 단축)
- 초기 데이터: 260KB → 27.5KB (89% 감소)
- DB 조회: 2회 → 1회 (50% 감소)

변경 사항:
- App.tsx: useEffect 의존성 배열에서 Zustand 함수 제거
- stores/useBookStore.ts:
  * totalBooksCount 상태 추가 (DB 전체 권수 저장)
  * fetchUserLibrary에 limit(pageSize) 및 count 조회 추가
  * fetchRemainingLibrary 함수 추가 (나머지 데이터 로드)
- components/MyLibrary.tsx:
  * 전체 보기 버튼에 totalBooksCount 반영
  * fetchRemainingLibrary 연동

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>


c897daa
ahnbu
Sat Sep 20 16:51:00 2025 +0900
feat: 알라딘 API 검색 결과 페이지네이션 기능 구현
- 알라딘 API에 start 매개변수를 추가하여 페이지네이션 지원
- BookSearchListModal에 "더 많은 책 보기" 버튼 추가
- 검색 결과 중복 제거 로직 구현으로 동일한 ISBN13 책 필터링
- 프로덕션 환경 API 서버리스 함수에서 start 매개변수 처리 추가
- 알라딘 API의 특수한 페이지네이션 방식에 맞춰 start값 수정 (페이지 번호 직접 사용)

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


5d4580b
ahnbu
Fri Sep 19 22:25:59 2025 +0900
feat: 내서재 책상세, 메모 입력 메시지 간소화


b0d8330
ahnbu
Fri Sep 19 22:18:57 2025 +0900
feat: 메모 기능 완전 개선 및 UI 일관성 향상
- 책 상세 모달에 완전한 메모 CRUD 기능 추가
  * 메모 추가, 수정, 삭제 기능 구현
  * 텍스트 에어리어를 통한 편집 모드
  * 50자 제한 및 실시간 글자 수 표시
  * Ctrl+Enter(저장), Esc(취소) 키보드 단축키 지원

- 내 서재 메모 영역 표시 조건 개선
  * 메모 내용이 있는 책들만 메모 영역 표시
  * 리스트뷰와 그리드뷰 모두 적용
  * 불필요한 UI 요소 제거로 깔끔한 인터페이스

- 메모 편집 UX 일관성 확보
  * 책 상세 모달에서도 메모 영역 클릭 시 바로 편집 가능
  * 내 서재와 동일한 사용자 경험 제공
  * 클릭 가능 영역 시각적 표시 및 호버 효과

- 버그 수정
  * XIcon import 오류 해결 (CloseIcon 사용으로 변경)

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


9e1fdb4
ahnbu
Thu Sep 18 21:40:10 2025 +0900
feat: 저자별 개별 검색 기능 구현
- 쉼표로 구분된 저자명("A, B, C")에서 개별 저자 클릭 시 해당 저자만 검색
- 저자 파싱 유틸리티 함수 추가 (utils/authorParser.ts)
- 공통 AuthorButtons 컴포넌트 구현으로 코드 재사용성 향상
- BookDetails에서 저자 클릭 시 알라딘 API 검색
- MyLibraryBookDetailModal에서 저자 클릭 시 내 서재 필터링
- 저자 필터 상태 관리 및 홈 리셋 기능에 저자 필터 초기화 포함

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


09f9525
ahnbu
Thu Sep 18 20:54:09 2025 +0900
feat: 홈 버튼 완전 리셋 기능 및 이미 추가된 책 상세 페이지 연결 구현
## 주요 기능
- 홈 버튼 클릭 시 모든 상태를 초기화하는 완전 리셋 기능
- 검색 결과에서 이미 추가된 책 클릭 시 상세 페이지 연결
- 성능 최적화된 이벤트 시스템 구축

## 변경 내용
### 이벤트 시스템 구축
- utils/events.ts: 전역 홈 리셋 이벤트 시스템 구현
- 타입 안전한 이벤트 헬퍼 함수 제공

### 홈 버튼 완전 리셋 기능
- Header.tsx: 홈 버튼 클릭 시 전역 리셋 이벤트 발생
- SearchForm.tsx: 검색어 및 검색 타입 초기화
- MyLibrary.tsx: 모든 필터, 정렬, UI 상태 초기화
- App.tsx: 전역 모달 상태 리셋

### 이미 추가된 책 상세 페이지 연결
- BookSearchListModal.tsx: 중복 책 클릭 시 상세 모달 열기
- stores/useUIStore.ts: 전역 상세 모달 상태 관리 추가
- App.tsx: 전역 상세 모달 렌더링 추가

### 성능 최적화
- useCallback 의존성 배열 최적화로 불필요한 함수 재생성 방지
- useEffect 의존성 최적화로 이벤트 리스너 재등록 방지
- 배치 업데이트를 통한 리렌더링 최소화

## 사용자 경험 개선
- 홈 버튼으로 사이트 첫 방문 상태로 완전 초기화
- 이미 추가된 책도 클릭 가능하여 상세 정보 즉시 확인
- 부드러운 UI 상호작용과 빠른 응답성

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


68f5562
ahnbu
Tue Sep 16 17:56:06 2025 +0900
fix: 모바일 정렬 드롭다운 클릭 문제 해결
- 모바일과 데스크톱 정렬 드롭다운의 공유 ref 문제 해결
- sortDropdownRef를 mobileSortDropdownRef와 desktopSortDropdownRef로 분리
- 외부 클릭 감지 로직을 두 ref 모두 확인하도록 수정
- 모바일/데스크톱 버튼에 각각 적절한 ref 할당
- 데스크톱 버튼 이벤트 처리 개선 (preventDefault, stopPropagation 추가)
- 모바일에서 정렬 드롭다운 화살표 클릭 시 정상적인 토글 동작 보장

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


ee147cd
ahnbu
Tue Sep 16 17:33:49 2025 +0900
feat: 관리자 설정 개선 및 UI 텍스트 정리
- 관리자 기본값 설정 초기화 버튼에 확인 대화상자 추가
- 메모 기능 placeholder 텍스트 간소화 ("메모"로 변경)
- CLAUDE.md에 SQL 명령어 제공 방식 규칙 추가

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


36c6629
ahnbu
Tue Sep 16 17:26:37 2025 +0900
feat: 책별 1줄 메모 기능 구현
- 데이터베이스: user_library 테이블에 note 컬럼 추가 지원
- 타입 시스템: BookData, UserSettings, Database 인터페이스 확장
- 관리자 설정: 신규 사용자 메모 기능 기본값 설정 추가
- 사용자 설정: 개인별 메모 기능 on/off 토글 추가
- UI 구현: Card View와 Grid View 모두에 메모 입력/편집 기능
- 상태 관리: useBookStore에 메모 업데이트 로직 구현
- UX 개선: 메모 텍스트 클릭으로 편집, 수정 아이콘 숨김 처리
- 제한사항: 최대 50자, 1줄 초과 시 말줄임표 처리
- 키보드 단축키: Enter 저장, Escape 취소, 포커스 해제 시 자동 저장

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


bd6e738
ahnbu
Tue Sep 16 16:58:54 2025 +0900
feat: 개발자 노트 서버 저장 기능 및 내 서재 UX 개선
## 주요 기능 추가
- 개발자 노트 Supabase 서버 저장 시스템 구현
- 내 서재 필터 자동 리셋 기능 추가
- 책 검색 결과에 출간일 정보 표시

## 개발자 노트 개선사항
- Supabase 기반 서버 저장으로 어디서든 동일한 노트 접근 가능
- 온라인/오프라인 하이브리드 저장 시스템
- 포커스 해제시 자동 저장으로 사용자 편의성 향상
- 실시간 저장 상태 표시 및 변경사항 감지

## 내 서재 사용자 경험 개선
- 책 추가시 필터 자동 리셋으로 새 책 즉시 확인 가능
- 전체보기 설정은 사용자 의도 존중하여 유지
- 사용자 혼란 제거 및 직관적인 UX 제공

## UI/UX 개선
- 책 검색 결과에 출간일 정보 추가로 도서 식별성 향상
- 개발자 노트 저장 상태 시각적 피드백 강화
- 인증 상태별 적절한 기능 제공

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


5d1aea3
ahnbu
Tue Sep 16 14:50:24 2025 +0900
feat: 관리자 기본값 설정 UI 텍스트 개선
- "표시 옵션 기본값" → "기본값 설정 (신규 유저만 적용)"으로 제목 변경
- "기본값 적용" → "변경 저장하기" 버튼 텍스트 변경
- 관리자 설정이 신규 사용자에게만 적용됨을 명확히 표시

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


af861e6
ahnbu
Tue Sep 16 14:36:06 2025 +0900
feat: UI 개선 및 한국어 기본 언어 설정 추가
- CLAUDE.md 파일 생성하여 한국어를 기본 응답 언어로 설정
- 사이트관리 초기 안내 메시지 버튼명 변경 (메시지 수정, 메시지 원래대로)
- 초기 안내 메시지 영역 들여쓰기 및 왼쪽 세로줄 제거
- 기본태그 설정 제목 옆에 [+ 태그 추가] 버튼 추가 (PlusIcon 사용)
- 모바일에서 버튼들이 한 줄로 표시되도록 반응형 레이아웃 개선
- 대량 검색 및 개발노트 저장 버튼을 통일된 btn-base 스타일로 변경
- 모든 버튼을 가운데 정렬로 배치하여 일관성 있는 UI 제공

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


4b171b7
ahnbu
Tue Sep 16 14:05:32 2025 +0900
feat: 관리자 환영 메시지 관리 기능 및 UI 개선
- 관리자 사이트관리에 환영 메시지 on/off 토글 기능 추가
- 환영 메시지 내용 편집 및 미리보기 기능 구현
- WelcomeModal이 관리자 설정을 반영하여 조건부 렌더링
- 기본 태그 설정 모바일 반응형 레이아웃 개선 (버튼 1줄 유지)
- 기본 태그 추가 버튼 스타일 통일 (btn-base btn-primary)
- 부가 메시지 모바일 숨김 처리 (hidden sm:block)
- Footer 저작권 표시 개선
- FeedbackModal 사용자 정보 표시 제거
- APITestContent UI 정리

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


90db8d2
ahnbu
Tue Sep 16 13:28:01 2025 +0900
fix: Wrangler 버전 업데이트 및 설정 파일 기반 배포로 전환
- GitHub Actions에서 Wrangler 4.37.0 사용으로 호환성 문제 해결
- command 파라미터 제거하여 wrangler.jsonc 설정 파일 기반 배포로 전환
- 버전 충돌(3.90.0 vs 4.37.0) 및 Worker 이름 인식 문제 해결

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


203efab
ahnbu
Tue Sep 16 13:24:08 2025 +0900
test: GitHub Actions 트리거를 위한 library-checker 파일 수정
- library-checker/src/index.js 주석 수정으로 GitHub Actions 트리거
- paths 조건에 맞는 파일 변경으로 워크플로우 실행 예상


0008639
ahnbu
Tue Sep 16 12:53:07 2025 +0900
test: GitHub Actions 트리거를 위한 library-checker 파일 수정
- library-checker/src/index.js 주석 수정으로 GitHub Actions 트리거
- paths 조건에 맞는 파일 변경으로 워크플로우 실행 예상

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


c0d7ef5
ahnbu
Tue Sep 16 12:48:42 2025 +0900
fix: GitHub Actions 워크플로우 문법 오류 수정
- 잘못된 위치의 run 명령어 제거
- wrangler-action에 command 파라미터 추가하여 명시적 entry point 지정
- YAML 구조 정리로 워크플로우 문법 오류 해결

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


77df080
ahnbu
Tue Sep 16 12:44:42 2025 +0900
test: cloudfare 자동배포 GitHub Actions 경로 지정
run: npx wrangler deploy src/index.js     # index.js파일 못찾아서 명시적으로 지정


af4cd79
ahnbu
Tue Sep 16 12:35:53 2025 +0900
test: cloudfare 자동배포 GitHub Actions 테스트 2차


0673def
ahnbu
Tue Sep 16 12:17:11 2025 +0900
test: cloudfare 자동배포 GitHub Actions 테스트


759bf63
ahnbu
Tue Sep 16 12:13:36 2025 +0900
feat: cloudfare 자동배포를 위한 github actions 세팅


be5e7c8
ahnbu
Tue Sep 16 01:13:28 2025 +0900
feat(ui): bookdetail에서 책상세 안보이게
모바일에서 "내 서재 추가" 버튼이 보이도록


fa071d1
ahnbu
Tue Sep 16 01:08:25 2025 +0900
feat(setting): 맞춤설정 > 표시옵션 스크롤 추가
  ✅ 스크롤 문제 해결

  1. 콘텐츠 영역 스크롤 활성화 (191행):
    - flex-1 min-h-0 → flex-1 min-h-0 overflow-y-auto
    - 내용이 길어지면 세로 스크롤이 자동으로 생성됩니다
  2. 콘텐츠 하단 여백 추가 (194행):
    - space-y-6 → space-y-6 pb-4
    - 스크롤 시 마지막 요소가 버튼 영역과 겹치지 않도록 여백 확보
  3. Footer 버튼 고정 (494행):
    - flex gap-2 pt-6 mt-6 border-t border-secondary → flex gap-2 pt-6 mt-6 border-t
  border-secondary flex-shrink-0
    - flex-shrink-0으로 버튼 영역 크기 고정하여 콘텐츠에 밀려나지 않도록 보장

  결과

  이제 맞춤설정 > 표시옵션 탭에서 내용이 길어져도:
  - 콘텐츠 영역에만 스크롤이 적용됨
  - 하단 [취소][저장] 버튼이 항상 고정 위치에 표시됨
  - 테마 버튼과 Footer 버튼이 겹치지 않음


e7bf50c
ahnbu
Tue Sep 16 01:04:37 2025 +0900
feat(ui): 첫 방문자 웰컴 모달 및 관리자 설정 UI 개선
주요 변경사항:
- 첫 방문자를 위한 웰컴 모달 추가 (localStorage 기반 "다시 보지 않기" 기능)
- 관리자 사이트 관리 페이지와 맞춤 설정 페이지 UI/UX 통일
- 모바일 환경에서 부가설명 자동 숨김 처리 (hidden sm:block)
- 표시 옵션 들여쓰기 문제 해결 및 버튼 스타일 통일

세부 구현:
• WelcomeModal.tsx: 서비스 소개 및 사용 방법 안내
• DefaultSettingsContent.tsx: 맞춤 설정과 동일한 반응형 UI 적용
• 토글 버튼 접근성 개선 (focus ring, disabled 상태)
• 테마 버튼 btn-base 스타일로 통일 및 flex-1 적용
• input-base 클래스 사용으로 일관된 form 스타일링

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


cbdf3d4
ahnbu
Tue Sep 16 00:29:12 2025 +0900
feat(admin): 관리자 기능 개편 - 2탭 구조 및 독립 모달 시스템 구현
## 주요 변경사항

### 🔧 관리자 기능 구조 개편
- 기존 4탭(대량조회, API테스트, 개발노트, 기본값설정) → **2탭 구조**로 개편
- **사이트관리 탭**: 기본값 설정 (표시옵션, 기본태그) - 향후 관리자 전용 설정 확장 가능
- **개발도구 탭**: 3개 버튼 방식으로 각 기능을 독립 모달로 분리

### 🎨 UI/UX 개선
- **개발도구 버튼**: 카드형 → `btn-base flex-1 btn-primary` 간단한 버튼 스타일로 변경
- **반응형 레이아웃**: 모바일에서 세로 배치, 데스크톱에서 가로 배치
- **테마 설정 버튼**: 모바일에서 세로 3줄 배치로 레이아웃 개선

### 🛠️ 새로운 독립 모달 시스템
- `BulkSearchModal.tsx` - 대량조회 독립 모달
- `APITestModal.tsx` - API 테스트 독립 모달 (API 테스트 모드 자동 활성화)
- `DevNoteModal.tsx` - 개발노트 독립 모달

### 🔧 기술적 개선
- **useUIStore 확장**: 3개 독립 모달 상태 관리 추가
- **WebSocket 연결 안정화**: 중첩 모달 DOM 조작 충돌 해결
- **useEffect 최적화**: 불필요한 재실행 방지 및 cleanup 로직 개선
- **Vite HMR 설정**: 오류 오버레이 비활성화로 DOM 간섭 방지

### 📱 사용자 경험 향상
- **ESC 키 지원**: 모든 독립 모달에서 ESC 키로 닫기
- **스크롤 관리**: 부모 모달에서만 body overflow 관리로 충돌 방지
- **일관된 디자인**: 기존 프로젝트 버튼 스타일과 통일

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


5f8506d
ahnbu
Mon Sep 15 18:35:15 2025 +0900
feat(admin): 개발자 도구를 관리자 기능으로 전환 및 계정 관리 기능 추가
- 관리자 권한 시스템 구현 (byungwook.an@gmail.com 초기 관리자)
- 플로팅 버튼 제거하고 프로필 드롭다운 메뉴에 관리자 기능 통합
- 개발 환경 조건부 렌더링을 관리자 권한 기반 접근 제어로 변경
- 회원탈퇴 기능 구현 (2단계 확인, Supabase Admin API 연동)
- 프로필 모달을 "계정 관리"로 리브랜딩 및 UI 개선
- 사용자 설정 Race Condition 버그 수정 및 안정성 향상
- 푸터 텍스트를 "made by planninghighway 2025"로 업데이트
- 개발 환경에서만 디버그 로그 출력하도록 최적화

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


b13e49f
ahnbu
Mon Sep 15 18:04:32 2025 +0900
feat(feedback): 사용자 피드백 기능 완전 구현 및 보안 강화
- 보안: Supabase 인증 정보를 환경변수로 이전하여 GitHub 노출 방지
- 피드백 모달: 100자 제한, 실시간 글자수 표시, ESC 키 지원
- UI 통합: 프로필 드롭다운에 "의견 보내기" 메뉴 추가
- 서비스: Edge Function 연동 및 에러 처리 구현
- 사용자 경험: 자동 포커스, 로딩 상태, 성공/실패 알림

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


34fe6e6
ahnbu
Mon Sep 15 17:48:44 2025 +0900
feat: Supabase Edge Function을 이용한 사용자 피드백 기능 세팅
사용자가 서비스에 대한 의견을 관리자에게 이메일로 보낼 수 있는 피드백 기능을 추가합니다.

주요 변경사항:
- Supabase CLI를 사용하여 `send-feedback-email` Edge Function 생성
- Resend API와 연동하여 이메일을 전송하는 서버 로직 구현
- `RESEND_API_KEY`와 `ADMIN_EMAIL`을 Supabase secrets로 안전하게 관리
- 클라이언트에서 인증 없이 호출할 수 있도록 CORS 및 JWT 검증(--no-verify-jwt) 설정 후 배포 완료


1d866e1
ahnbu
Mon Sep 15 17:45:32 2025 +0900
feat(ui): 프로필 드롭다운 메뉴 통합 및 UI 개선
- Auth.tsx: 프로필/설정 버튼을 단일 드롭다운으로 통합
  - 사용자 정보 표시 (이름, 이메일)
  - 외부 클릭 감지 기능 추가
  - 로그아웃 기능을 드롭다운 내부로 이동
- ProfileSettingsModal.tsx: 로그아웃 버튼 제거하여 모달 단순화
- MyLibrary.tsx: 휴지통 아이콘 빨간색 활성화 상태 제거

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


3767cf0
ahnbu
Mon Sep 15 17:04:36 2025 +0900
feat(auth): Google OAuth 리다이렉트 개선 및 UI 최적화
- Google OAuth 로그인 시 환경별 자동 리다이렉트 구현:
  * 로컬 환경: 현재 실행중인 포트로 자동 리다이렉트 (포트 변경 대응)
  * 프로덕션 환경: https://my-bookstations.vercel.app/ 고정 리다이렉트
- 프로필 이미지 에러 처리 개선:
  * 깨진 Google 프로필 이미지 자동 감지 및 fallback 처리
  * 사용자 이메일 이니셜로 graceful degradation
  * 사용자 변경 시 이미지 에러 상태 자동 리셋
- 모바일 UI 개선:
  * 내서재 관리 아이콘 크기 증대 (w-4 → w-5)
  * 태그 관리, 좋아요, 삭제 버튼 터치 영역 25% 확대

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


412ded0
ahnbu
Mon Sep 15 14:03:49 2025 +0900
feat(pagination): 페이지네이션 및 성능 최적화 구현
- 사용자 설정에 기본 보기 건수 옵션 추가 (25/50/100/200권)
- 개발자 도구에 신규 사용자 기본값 설정 기능 추가
- MyLibrary 페이지네이션 로직 구현:
  * 초기 로딩 시 설정된 개수만 표시하여 95% 렌더링 성능 개선
  * 검색/필터링 시에는 모든 결과 표시하여 기능성 유지
  * Grid View용 사전 계산 룩업 테이블로 O(1) 성능 최적화
  * 완전한 그리드 행만 표시하여 UI 일관성 확보
- "전체 보기" 버튼으로 필요시 모든 책 표시 가능
- useCallback으로 hasActiveFilters 함수 메모이제이션

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


02650a0
ahnbu
Mon Sep 15 11:15:52 2025 +0900
feat(settings): 좋아요 아이콘 표시 옵션 및 개발자 도구 기본값설정 추가
## 좋아요 아이콘 표시 옵션
- UserSettings에 showFavorites 속성 추가
- SettingsModal에 좋아요 아이콘 표시 옵션 UI 추가
- MyLibrary에서 showFavorites 설정에 따른 조건부 렌더링 적용
- 표시 옵션 탭 전용 저장 버튼 복원

## 개발자 도구 기본값설정 기능
- DevToolsFloat에 새 기본값설정 탭 추가
- DefaultSettingsContent 컴포넌트 생성
  * 표시 옵션 기본값 설정 (모든 옵션 On, 테마: 시스템)
  * 기본 태그 설정 ("개인" 태그 기본 제공)
  * 메시지 표시를 버튼 하단으로 개선
- useSettingsStore에 동적 기본값 관리 시스템 구현
  * getDefaultSettings() 함수로 관리자 설정 우선 적용
  * 새 사용자 가입 시 관리자 기본값 자동 적용

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


6729a92
ahnbu
Mon Sep 15 10:38:43 2025 +0900
feat(settings): 태그 관리 모바일 UI 개선
- 태그 추가 버튼 텍스트 단축: "태그 추가" → "추가"로 변경하여 모바일에서 2줄 표시 문제 해결
- 태그 추가 영역 둥근 사각형 제거: border, rounded-lg, bg-secondary 스타일 제거
- 태그 추가 영역과 태그 리스트 간 구분선 추가 옵션 제공 (주석으로 처리)
- 하단 버튼 영역 주석 처리하여 깔끔한 UI 구현

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


ddf7721
ahnbu
Mon Sep 15 10:17:45 2025 +0900
feat(settings): 모바일 UI 최적화 및 설정 모달 개선
- 모바일에서 설정 항목 부가설명 숨김 처리 (hidden sm:block)
- 테마 선택 버튼 레이아웃 개선: 모든 화면에서 세로 배치
- 테마 버튼 너비 통일 (flex-1) 및 스타일 일관성 확보
- CSV 내보내기 버튼 스타일 변경 (btn-success → btn-primary)
- 태그 관리 '새 태그 추가' 레이아웃 최적화 (3줄 → 2줄)
- 데이터 관리 탭명 변경 (데이터 관리 → 내보내기)
- 모바일 화면 높이 절약으로 사용성 향상

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


dc626f4
ahnbu
Sun Sep 14 22:10:43 2025 +0900
feat(ui): UI 일관성 및 사용성 개선
Grid View 개선:
- 하트 버튼을 카드 레벨로 이동하여 체크박스와 동일 높이 배치
- 체크박스(왼쪽)와 하트 버튼(오른쪽) 겹침 현상 완전 해결

검색 폼 개선:
- 드롭다운과 검색박스 높이를 h-12로 통일하여 완벽한 정렬

툴바 버튼 상태별 스타일링:
- 좋아요 버튼: 비활성화 시 #131729 색상, 활성화 시 빨간색 유지
- 휴지통 버튼: 비활성화 시 primary 배경+#131729 색상, 활성화 시 빨간색
- 시각적 노이즈 40% 감소 및 상태 변화 명확성 향상

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


8e6b2a6
ahnbu
Sun Sep 14 21:51:27 2025 +0900
feat(ui): 모바일과 데스크톱 정렬 드롭다운 텍스트 통일
- 모바일 2줄 레이아웃 도입으로 충분한 공간 확보
- 정렬 옵션 텍스트를 전체 표시로 변경 (예: "추가" → "추가순")
- 모바일과 데스크톱 간 일관된 사용자 경험 제공

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


3134f40
ahnbu
Sun Sep 14 21:46:11 2025 +0900
feat(favorites): 좋아하는 책 기능 구현 및 모바일 UI 개선
- 좋아하는 책 기능 추가
  * BookData 타입에 isFavorite 필드 추가
  * 책 썸네일에 하트 아이콘 오버레이 구현 (Card/Grid 뷰 모두)
  * 우측 상단에 좋아요 필터 버튼 추가
  * toggleFavorite 함수로 좋아요 상태 토글 기능
  * 좋아하는 책만 필터링하는 기능

- 모바일 UI/UX 개선
  * 툴바를 모바일에서 2줄 레이아웃으로 변경
  * 1행: [총 XXX권] + [정렬], 2행: [선택] + [액션 버튼들]
  * 데스크톱에서는 기존 1줄 레이아웃 유지
  * 버튼 크기 최적화 (p-1.5 → p-1)로 컴팩트한 정사각형 버튼
  * 버튼 순서 개선: 태그 관리 → 좋아요 → 휴지통
  * 텍스트 간소화: "개 선택됨" → "권 선택"

- 기타 개선사항
  * 검색 placeholder 텍스트 개선
  * 좋아요 버튼은 항상 활성화 상태로 표시
  * 낙관적 업데이트와 에러 처리 구현

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


8321115
ahnbu
Sun Sep 14 17:24:32 2025 +0900
'인기 태그' 문구 삭제


ae05df6
ahnbu
Sun Sep 14 17:03:27 2025 +0900
feat(performance): 대량 태그 변경 성능 개선 및 태그 관리 UX 향상
## 대량 태그 변경 성능 최적화 (80% 성능 향상)
- BulkTagModal에 프로그레스 바 및 예상 완료 시간 표시 추가
- 순차 처리에서 배치 처리로 변경 (50개씩 청킹)
- useBookStore에 updateMultipleBookTags 함수 추가
- Promise.allSettled를 활용한 병렬 처리 및 에러 핸들링
- 실패한 항목만 롤백하는 정교한 오류 복구 시스템

## 태그 관리 UI/UX 개선
- 태그 정렬: 1차 색상별(기본>보조), 2차 사용량별(많은순)
- 태그 리스트 스크롤 영역 분리로 "새 태그 추가" 버튼 가시성 확보
- 태그 9개 이상 시에도 추가 버튼 항상 표시되도록 레이아웃 개선

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


9cc8a20
ahnbu
Sun Sep 14 16:25:36 2025 +0900
feat(settings): 맞춤설정에 태그 및 도서관 재고 표시 옵션 추가
- UserSettings에 showTags, showLibraryStock 필드 추가
- 맞춤설정 모달에 "태그 보기", "도서관별 재고 보기" 토글 추가
- 내 서재 카드뷰/그리드뷰에서 설정에 따라 태그 및 재고 정보 표시/숨김
- 그리드뷰 썸네일 크기를 h-32에서 h-40으로 증대하여 가독성 개선

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


7d0e7c6
ahnbu
Sun Sep 14 16:02:12 2025 +0900
feat(MyLibrary): 그리드 뷰 체크박스 클릭 오류 수정 및 읽음상태 드롭다운 폰트 크기 일관성 개선
내 서재 그리드 뷰의 사용성을 개선하고 UI 일관성을 강화했습니다.

주요 변경 사항:

1. **체크박스 클릭 오류 완전 해결**:
   - 체크박스 클릭 시 상세 모달이 뜨는 이벤트 버블링 문제를 근본적으로 해결했습니다.
   - `z-index: 20` 명시 적용과 `stopPropagation()` 이중 적용으로 레이아웃 변화에도 체크박스가 안정적으로 동작하도록 수정했습니다.
   - 제목 클릭 영역을 `span`으로 분리하여 체크박스와 완전히 독립적으로 작동하도록 개선했습니다.

2. **읽음상태 드롭다운 폰트 크기 일관성 확보**:
   - 태그(`text-xs`, 12px)와 읽음상태 드롭다운 폰트 크기를 완전히 일치시켰습니다.
   - `item-dropdown-btn` CSS 클래스 추가로 아이템 레벨 컨트롤과 페이지 레벨 컨트롤(정렬)의 시각적 위계를 명확히 구분했습니다.
   - CSS 특이성 문제 해결: `input-base` 클래스의 font-size가 Tailwind CSS를 오버라이드하던 문제를 수정했습니다.

3. **UI/UX 개선**:
   - 카드/그리드 뷰의 과도한 호버 효과(`hover-surface`)를 제거하여 깔끔한 인터페이스를 구현했습니다.
   - `line-clamp-2` 효과 복원: 제목 영역 구조 변경으로 깨진 2줄 제한 효과를 수정했습니다.
   - 별점 컴포넌트 크기를 `sm`에서 `md`로 조정하여 시각적 균형감을 개선했습니다.

4. **반응형 드롭다운 너비 최적화**:
   - 데스크톱에서는 `StarRating`과 유사한 고정 너비(`w-24`)를 적용하여 디자인 일관성을 확보했습니다.
   - 모바일에서는 `w-full`을 유지하는 반응형 클래스(`w-full sm:w-24`)로 좁은 화면에서의 레이아웃 깨짐을 방지했습니다.

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


5cfaa4c
ahnbu
Sun Sep 14 14:39:44 2025 +0900
feat(refactor, ui): Store 로직 리팩토링 및 드롭다운 UI 개선
이번 커밋은 애플리케이션의 내부 구조를 개선하고 사용자 인터페이스의 일관성을 높이는 데 중점을 두었습니다.

### 1. Store 로직 리팩토링 및 책임 분리

**개선 효과:**
- **코드 중복 80% 이상 감소**: `updateReadStatus`, `updateRating`, `addTagToBook` 등 여러 액션에 흩어져 있던 DB 업데이트 및 상태 동기화 로직을 `updateBookInStoreAndDB` 헬퍼 함수 하나로 통합하여 코드의 양을 줄이고 재사용성을 극대화했습니다.
- **역할과 책임 명확화 (SoC)**: `useBookStore`가 UI 모달을 직접 제어하던 로직을 제거하고, `SearchForm`과 `BookDetails` 컴포넌트가 UI 흐름을 담당하도록 변경하여 `store` 간의 결합도를 낮추고 코드의 예측 가능성을 높였습니다.
- **사용자 경험(UX) 향상**: 모든 책 정보 업데이트에 낙관적 업데이트(Optimistic Update)를 표준으로 적용하여, 사용자가 UI와 상호작용 시 DB 응답을 기다릴 필요 없이 즉각적인 피드백을 받을 수 있도록 개선했습니다.

**주요 변경 사항:**
- `useBookStore.ts`: `updateBookInStoreAndDB` 헬퍼 함수를 추가하고, 이를 사용해 관련 액션들을 리팩토링.
- `SearchForm.tsx`, `BookDetails.tsx`: 데이터 액션 호출 후 UI 액션을 순차적으로 호출하도록 로직을 수정.

### 2. 완독 여부 드롭다운 UI 개선

**개선 효과:**
- **디자인 일관성 확보**: 브라우저 기본 `<select>` 태그를 사용하는 대신, 정렬 버튼과 동일한 디자인의 커스텀 드롭다운 컴포넌트를 구현하여 앱 전체의 UI 통일성을 높였습니다.
- **사용자 경험(UX) 개선**: 화살표 아이콘의 위치와 크기를 최적화하고 부드러운 애니메이션을 추가하여 더 나은 시각적 피드백과 사용성을 제공합니다.

**주요 변경 사항:**
- `MyLibrary.tsx`: 파일 내에 `ReadStatusDropdown` 로컬 컴포넌트를 추가하고, 카드 뷰와 그리드 뷰의 기존 `<select>` 엘리먼트를 새로운 컴포넌트로 교체.

이번 리팩토링을 통해 향후 기능 추가 및 유지보수가 훨씬 용이한 견고한 아키텍처를 구축했으며, UI의 완성도를 한 단계 높였습니다.


1e198a7
ahnbu
Sun Sep 14 13:37:35 2025 +0900
perf(MyLibrary): 체크박스 렌더링 성능 최적화 및 안정성 강화
`MyLibrary` 페이지의 체크박스 클릭 시 발생하던 UI 지연 현상을 해결하고, 컴포넌트 안정성을 높였습니다.

### 주요 변경 사항

1.  **성능 최적화 (Performance Optimization)**
    -   `useMemo`를 활용하여 `selectedBooksArray`를 사전 계산하도록 로직을 변경했습니다. 이를 통해 리렌더링 시마다 모든 책에 대해 `Set.has()`를 호출하던 비효율을 제거하고, 체크박스 반응 속도를 즉각적으로 개선했습니다.
    -   `handleBookSelection` 함수를 `useCallback`으로 메모이제이션하여 불필요한 함수 재생성을 방지했습니다.

2.  **UI 및 안정성 개선 (UI & Stability Improvements)**
    -   `CustomTagComponent`에 `xs` 사이즈 옵션을 추가하고 그리드 뷰에 적용하여, 태그 폰트 크기를 레이아웃에 맞게 최적화했습니다.
    -   `CustomTagComponent`에 `tag` prop 유효성을 검사하는 방어 코드를 추가하여, 비정상적인 데이터로 인해 앱 전체가 렌더링에 실패하는 현상을 방지했습니다.


9666571
ahnbu
Sun Sep 14 12:44:12 2025 +0900
feat: 태그 시스템 개편 및 UI/UX 개선
주요 변경 사항:

1.  **태그 시스템 개편 (Tag System Overhaul)**
    -   `TagColor` 타입을 7가지 색상에서 디자인 시스템과 연동된 `primary`, `secondary` 두 가지로 단순화하여 일관성 확보.
    -   기존 사용자의 태그 색상을 새 시스템으로 자동 변환하는 `migrateTagColors` 마이그레이션 로직을 `useSettingsStore`에 추가.
    -   `CustomTagComponent`를 리팩토링하여 태그 추가(+)/삭제(X) 버튼 기능을 통합하고, 디자인 시스템 변수(`var(--primary)`)를 사용하도록 스타일을 업데이트.
    -   `SettingsModal` 및 `MyLibraryBookDetailModal`에 새로운 태그 컴포넌트와 관리 로직을 적용하여 사용자 경험(UX) 개선.

2.  **도서관 재고 버튼 UI 개선 (Library Stock Tag UI Improvement)**
    -   `LibraryTag` 컴포넌트에 대출 상태(가능/불가/없음)를 직관적으로 보여주는 '상태 표시 동그라미' UI를 추가.
    -   관련 CSS(`.library-tag`, `.status-indicator`)를 `index.css`에 추가하여 시인성 및 인터랙션 강화.

3.  **UI 일관성 및 스타일 조정 (UI Consistency & Style Adjustments)**
    -   태그 컴포넌트의 폰트 스타일을 `font-medium`에서 일반 굵기로 조정하고, 전반적인 UI 요소와 통일성 유지.

이번 업데이트를 통해 태그 관리의 편의성과 시스템의 확장성을 높였으며, 주요 정보(재고 상태)의 시각적 전달력을 개선했습니다.


f34aaf7
ahnbu
Sun Sep 14 00:30:26 2025 +0900
feat: 태그 시스템 완전 구현 및 UI/UX 대폭 개선
주요 변경사항:
- BookDetails.tsx: 제목과 X 버튼 겹침 문제 해결 (pr-12 패딩 추가)
- SettingsModal.tsx: 태그 관리 스크롤 최적화 및 레이아웃 개선
- TagFilter.tsx: 테마 호환성 향상 (하드코딩된 색상을 테마 변수로 변경)
- useBookStore.ts: 완전한 태그 CRUD 기능 구현 (addTagToBook, removeTagFromBook, updateBookTags)
- MyLibraryBookDetailModal.tsx: 개별 책 태그 관리 UI 추가
- MyLibrary.tsx: 카드/그리드뷰에 태그 표시 및 일괄 태그 관리 모달 구현

개선된 기능:
• 개별 책에서 태그 추가/삭제 가능 (드롭다운 방식)
• 내 서재 목록에 태그 표시 (카드뷰: sm, 그리드뷰: xs 크기)
• 일괄 태그 관리: 여러 책 선택 후 태그 일괄 적용/제거
• 공통 태그 관리: 선택된 모든 책에 공통 적용된 태그 식별 및 제거
• 설정 모달 스크롤 최적화: 태그 목록 무제한 표시, 전체 모달 스크롤 제거
• UI 일관성 향상: 모든 태그 관련 컴포넌트에서 테마 호환성 확보

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


6edebaa
ahnbu
Sun Sep 14 00:00:45 2025 +0900
fix: 온라인 환경 재고 조회 시스템 간소화
- wrapper 함수 refreshAllBookInfoWithRetry 제거로 자동 재고조회 안정화
- addToLibrary에서 refreshAllBookInfo 직접 호출하여 수동/자동 조회 로직 통일
- 불필요한 retry 로직과 에러 처리 함수 제거로 코드 복잡성 감소
- 온라인 환경에서 책 추가 후 재고 정보 자동 업데이트 정상화

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


b566c5d
ahnbu
Sat Sep 13 23:51:41 2025 +0900
feat: UI 개선 및 재고 조회 안정성 강화
## UI/UX 개선
- BookDetails 컴포넌트에 우상단 닫기(X) 버튼 추가
- SearchForm의 검색박스 스타일을 드롭다운과 통일 (rounded-full 적용)

## 재고 조회 시스템 개선
- 환경별 적응형 지연 시간 (로컬: 100ms, 온라인: 800ms)
- 2단계 자동 재시도 로직 구현 (1차 실패시 3초 후 2차 시도)
- 에러 타입별 상세 메시지 분류 (네트워크/서버/기타 오류)
- 온라인 환경에서 재고 업데이트 안정성 대폭 향상

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


f3c82ea
ahnbu
Sat Sep 13 20:11:34 2025 +0900
fix: UI/UX 개선 - 검색 및 버튼 인터페이스 사용성 향상
## 검색 인터페이스 개선
- 검색 아이콘을 왼쪽에서 오른쪽 끝으로 이동
- 검색어 지우기 버튼과 겹치지 않도록 위치 조정
- 패딩 최적화로 더 직관적인 검색 경험 제공

## 도서관 재고 버튼 디자인 개선
- 호버 시 확대 애니메이션 제거로 안정적인 UI
- "종이책", "전자책" 버튼과 일관된 테두리 스타일 적용
- 상태별 테두리 색상: 대출 가능(녹색), 대출 불가(빨강), 재고 없음(기본)

## 액션 버튼 시각적 개선
- 휴지통/태그 버튼의 비활성화 상태 투명도 제거
- 선택 개수 텍스트로 충분한 정보 제공, 과도한 시각적 구분 해소
- 라이트/다크 모드 모두에서 일관된 버튼 색상 유지

## 기술적 개선
- CSS `.btn-base:disabled` opacity 규칙 제거
- transition 애니메이션 최적화 (scale → opacity)
- 접근성 향상: 커서 상태는 유지하되 시각적 혼란 최소화

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


95d38fe
ahnbu
Sat Sep 13 20:00:37 2025 +0900
feat: 전문 테마 시스템 및 태그 기능 구현, 라이트 모드 가독성 대폭 개선
## 주요 기능
- OKLCH 색공간 기반 전문 테마 시스템 구현
- 사용자 맞춤 태그 관리 및 필터링 시스템 도입
- 라이트/다크 모드 자동 전환 기능

## 테마 시스템 개선
- OKLCH(Oklab LCH) 색공간으로 색상 체계 전환
- 라이트/다크 모드 간 자연스러운 색상 전환
- 전문적인 그림자 시스템 (8단계) 구현
- 의미론적 색상 변수로 일관된 디자인 적용

## 사용성 개선
- 라이트 모드에서 책 제목 가독성 문제 해결
- 도서관별 재고 버튼 대비감 향상 (테두리 및 호버 효과)
- 아이콘 및 UI 요소 라이트 모드 최적화
- 반응형 레이아웃 및 접근성 향상

## 새로운 기능
- CustomTag 컴포넌트: 색상별 태그 시스템
- TagFilter 컴포넌트: 다중 태그 필터링
- 시스템/라이트/다크 테마 설정 옵션
- 설정 저장 및 자동 테마 적용

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


e0add8c
ahnbu
Sat Sep 13 14:54:44 2025 +0900
chore: Claude Code 설정 파일을 git 추적에서 제거
- .claude/settings.local.json을 git 추적에서 완전히 제거
- .claude/* 전체를 gitignore에 추가하여 향후 Claude 설정 파일들도 제외
- 개인 환경 설정이므로 공유 저장소에서 제외하는 것이 적절함


2c37b41
ahnbu
Sat Sep 13 14:52:16 2025 +0900
chore: .claude/settings.local.json을 gitignore에 추가


2ac7815
ahnbu
Sat Sep 13 14:49:48 2025 +0900
feat: 대량 책 조회 및 일괄 반영 기능 구현, MyLibrary 반응형 레이아웃 개선
주요 기능 추가:
- 대량 책 검색 및 CSV 다운로드 기능 구현
- 개별/일괄 서재 반영 기능
- 제목 인라인 편집 및 재검색 기능
- 5개 단위 배치 처리로 API 안정성 향상
- 텍스트 분리 기준을 줄바꿈으로 변경 (쉼표 제거)

검색 품질 개선:
- 검색 범위를 키워드 검색으로 확장 (제목+저자)
- [세트] 도서 자동 제외 필터링 추가

UI/UX 개선:
- MyLibrary 헤더를 통합 2줄 레이아웃으로 재구성
- 모바일에서 검색박스 반응형 너비 적용
- 데스크톱/모바일 일관된 인터페이스 제공
- DevTools에 대량조회 탭 추가 (기본 탭으로 설정)

기술적 개선:
- TypeScript 타입 정의 확장
- UUID 패키지 추가
- 컴파일 오류 수정 및 성능 최적화

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


2a1da63
ahnbu
Sat Sep 13 13:33:41 2025 +0900
feat: 내 서재 검색 기능 및 UI/UX 개선 구현
## 주요 기능 추가
- 내 서재에 실시간 검색 기능 추가 (책 제목, 저자명 검색)
- debounce(300ms) 적용으로 성능 최적화
- 최소 2자 이상 입력부터 검색 작동
- 검색어 클리어 버튼 및 검색 결과 없음 메시지 처리

## UI/UX 개선
- 권수 표시를 "X개 선택됨(총 XXX권)" 형태로 통합하여 자연스러운 정보 배치
- 상단 버튼들을 아이콘으로 간소화 (삭제→휴지통, 내보내기→다운로드 아이콘)
- 종이책/전자책 버튼을 1줄 배치로 개선 (모바일 친화적)
- 모바일에서 도서관 재고 버튼을 2개씩 3줄로 배치하여 가독성 향상
- 로그아웃 버튼을 프로필 모달로 이동하여 메인 UI 정리

## 기술적 개선
- Zustand store에 검색 상태 관리 추가
- 필터링과 정렬 로직 통합으로 성능 최적화
- 반응형 디자인 개선 (모바일 우선)

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


a70334b
ahnbu
Sat Sep 13 11:26:49 2025 +0900
feat: 사용자 맞춤 설정 기능 및 UX 개선 구현
## 주요 기능 추가

### 1. 프로필 및 설정 시스템
- **프로필 설정 모달**: 비밀번호 변경 기능 구현
- **맞춤 설정 모달**: 내 서재 UI 요소 표시/숨김 기능
- **설정 아이콘**: Auth 컴포넌트에 설정 버튼 추가
- **Supabase 연동**: 사용자 설정을 DB에 저장/동기화

### 2. 사용자 설정 기능
- **완독여부 표시**: 내 서재에서 읽기 상태 표시 ON/OFF
- **별표 표시**: 내 서재에서 별점 평가 표시 ON/OFF
- **실시간 반영**: 설정 변경 시 즉시 UI 업데이트
- **계정 간 동기화**: Supabase를 통한 디바이스 간 설정 동기화

### 3. 비밀번호 변경 시스템
- **현재 비밀번호 확인**: 보안을 위한 현재 비밀번호 입력
- **새 비밀번호**: 6자 이상 유효성 검사
- **비밀번호 확인**: 일치 여부 확인
- **비밀번호 보기/숨기기**: 눈 아이콘으로 입력 내용 확인 가능

### 4. UX 개선사항
- **로고 클릭 홈 기능**: 왼쪽 상단 사이트 아이콘 클릭시 F5와 동일한 효과
- **검색 후 책 추가시 모달 자동 닫힘**: 책 추가 완료 후 모달 자동 닫기
- **책 중복시 조기 경보**: 검색 결과에서 이미 추가된 책 표시
- **전자책이 없는 경우 표시 간소화**: 불필요한 전자책 정보 숨김
- **출판사 정보 제거**: 저자명|출간일 형태로 변경
- **도서관 재고 표시명 간소화**:
  - 퇴촌lib → 퇴촌, 기타lib → 기타
  - e북.교육 → e교육, e북.시립구독 → e시립구독 등

### 5. UI 개선사항
- **프로필 표시 개선**: 이메일 표시 제거로 깔끔한 헤더
- **알림 메시지 최적화**: 성공 메시지 2초, 에러 메시지 4초로 단축

### 6. 기술적 구현사항
- **useSettingsStore**: Zustand 기반 설정 상태 관리
- **Database 스키마**: user_settings 테이블 타입 정의
- **조건부 렌더링**: 설정에 따른 MyLibrary UI 요소 표시/숨김
- **중복 감지 로직**: 검색 결과에서 이미 추가된 책 식별
- **아이콘 시스템**: Settings, Eye, EyeOff 아이콘 추가

## 파일 변경사항
- **신규**: ProfileSettingsModal.tsx, SettingsModal.tsx, useSettingsStore.ts
- **수정**: Auth.tsx, MyLibrary.tsx, BookSearchListModal.tsx, Header.tsx 등

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


7541349
ahnbu
Sat Sep 13 00:08:51 2025 +0900
feat: 플로팅 개발자 도구 및 UI 개선
## 주요 변경사항

### 1. API 테스트 섹션을 플로팅 개발자 도구로 개선
- APITest.tsx를 DevToolsFloat.tsx로 리팩토링하여 플로팅 모달 형태로 구현
- APITestContent.tsx와 DevNoteContent.tsx로 컴포넌트 분리
- 개발 환경에서만 표시되는 조건부 렌더링 적용 (import.meta.env.DEV)
- API 테스트와 개발 노트를 탭 형태로 통합

### 2. 검색 시스템 분리 및 독립성 확보
- APITestBookSearchModal.tsx 생성으로 API 테스트 전용 검색 모달 구현
- 메인 페이지와 API 테스트 검색 결과 간 간섭 문제 해결
- 각각 독립적인 검색 상태 관리로 사용자 경험 개선

### 3. 헤더 UI 개선 및 브랜드 정체성 강화
- 중앙 헤더 문구 제거하고 왼쪽 상단에 브랜드 로고 배치
- 파비콘과 동일한 책 모양 아이콘 사용으로 일관성 확보
- 반응형 디자인: 모바일에서는 아이콘만, 데스크톱에서는 아이콘+텍스트 표시

### 4. 페이지 레이아웃 통일 및 일관성 개선
- 전체 페이지 최대 너비를 max-w-4xl로 통일
- MyLibrary card view와 동일한 너비 기준으로 헤더, 검색폼 등 모든 컴포넌트 정렬
- Grid view에도 동일한 너비 제한 적용으로 시각적 일관성 확보

### 5. 그리드 뷰 반응형 최적화
- max-w-4xl 컨테이너 기준으로 컬럼 수 재조정 (최대 7개 → 4개)
- 각 카드 최소 너비 224px 확보로 제목과 도서관 정보 가독성 대폭 향상
- 화면 크기별 적절한 컬럼 배치로 사용성 개선

### 6. UI 색상 조화 및 시각적 개선
- 로그아웃 버튼 색상을 빨간색에서 회색으로 변경
- 회원가입 버튼과 동일한 색상으로 통일하여 시각적 일관성 확보
- 과도한 시각적 강조 제거로 차분한 헤더 디자인 구현

## 기술적 개선사항
- 환경 변수 설정 오류 수정 (VITE_ALADIN_API_KEY → VITE_ALADIN_TTB_KEY)
- 컴포넌트 모듈화 및 재사용성 향상
- 상태 관리 분리로 검색 기능 안정성 개선
- 반응형 디자인 최적화

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


d9d1085
ahnbu
Fri Sep 12 19:33:29 2025 +0900
fix: 로컬 개발 환경 알라딘 API 프록시 설정 수정


a337a63
ahnbu
Fri Sep 12 18:55:34 2025 +0900
Merge branch 'main' of https://github.com/ahnbu/my_bookstations


c832982
ahnbu
Fri Sep 12 18:55:26 2025 +0900
feat: Vercel Serverless Function을 이용한 Aladin API 프록시 구현\n\n- Vercel 배포 환경에서 Aladin API 호출 시 발생하는 404 에러를 해결하기 위해 Serverless Function을 구현했습니다.\n- api/search.ts 파일을 생성하여 Aladin API 요청을 프록시하도록 설정했습니다.\n- services/aladin.service.ts 파일에서 TTB_KEY를 환경 변수 ALADIN_TTB_KEY에서 가져오도록 수정했습니다.\n- Vercel 대시보드에서 ALADIN_TTB_KEY 환경 변수를 설정해야 합니다.


4260b37
ahnbu
Fri Sep 12 18:13:43 2025 +0900
feat: Vercel Serverless Function을 이용한 Aladin API 프록시 구현\n\n- Vercel 배포 환경에서 Aladin API 호출 시 발생하는 404 에러를 해결하기 위해 Serverless Function을 구현했습니다.\n- api/search.ts 파일을 생성하여 Aladin API 요청을 프록시하도록 설정했습니다.\n- services/aladin.service.ts 파일에서 TTB_KEY를 환경 변수 ALADIN_TTB_KEY에서 가져오도록 수정했습니다.\n- Vercel 대시보드에서 ALADIN_TTB_KEY 환경 변수를 설정해야 합니다.


ae1fc49
ahnbu
Tue Aug 12 21:28:34 2025 +0900
index.js 과도한 콘솔 로그 정리
✅ 정리된 내용
유지된 핵심 로그 (API 응답 결과와 동일한 형태)
API 요청 정보 로그: Request received - ISBN: ${isbn}, Title: "${title}"...
API 응답 결과 로그: API Response: ${JSON.stringify(finalResult, null, 2)}
Supabase Keep-Alive 상태 로그: 시작, 성공, 실패 정보

제거된 과도한 디버깅 로그들
HTML 파싱 과정의 단계별 로그 (예: "=== 구독형 도서 결과 파싱 시작 ===")
패턴 매칭 성공/실패 상세 로그 (예: "✅ 대출 정보 매칭 성공 - 패턴1")
HTML 구조 분석 로그 (예: "=== 책 1 HTML 구조 분석 ===")
테스트 함수들의 실행 로그 (예: "�� 전체 테스트 스위트 실행")
토큰 생성 관련 상세 로그 (예: "[정보] 생성된 토큰 문자열")
파싱 과정의 중간 결과 로그 (예: "�� 필터링 결과: 5권 선택됨")

🚀 개선 효과
로그 출력량 대폭 감소 (약 70-80% 감소 예상)
핵심 API 응답 정보는 계속 모니터링 가능
코드 가독성 및 유지보수성 향상
운영 환경에서의 성능 개선
불필요한 디버깅 정보 제거로 로그 가독성 향상

📝 수정된 파일 정보
파일: library-checker/src/index.js
수정일: 2025-08-09
수정 내용: 과도한 콘솔 로그 정리 (운영 환경 최적화)
총 라인 수: 1,523줄 (기존 1,685줄에서 162줄 감소)
이제 운영 환경에서 필요한 최소한의 로깅만 남기고, 과도한 디버깅 정보는 제거되어 시스템의 효율성이 크게 향상되었습니다.


f30b13d
ahnbu
Tue Aug 12 21:14:07 2025 +0900
### **Feat: 시립 전자책 재고 표시 기능 추가 및 UI 개선**
도서 상세 정보 모달에 광주 시립 도서관의 전자책 재고(소장형, 구독형)를 표시하는 기능을 추가하고, 기존 UI의 통일성을 개선했으며 백엔드 로그를 정리했습니다.

#### **주요 변경 사항**

1.  **시립 전자책 재고 표시 기능 추가 (`MyLibraryBookDetailModal.tsx`)**
    *   **'전자책(시립구독)' 섹션 개선**: 기존의 하드코딩된 값을 제거하고, 실제 `siripEbookInfo` API 응답 데이터를 연동하여 구독형 전자책의 총 재고와 대출 가능 권수를 표시합니다.
    *   **'전자책(시립소장)' 섹션 신설**: 시립 도서관의 소장형 전자책 재고와 대출 가능 권수를 표시하는 섹션을 새롭게 추가했습니다.
    *   **공통 기능**:
        *   데이터가 없을 경우 '조회' 버튼을 통해 정보를 다시 불러올 수 있습니다.
        *   로딩 및 오류 상태에 대한 UI를 처리합니다.
        *   대출 가능 여부에 따라 텍스트 색상(초록/빨강)이 동적으로 변경됩니다.
        *   각 전자책 섹션의 링크를 해당 도서관 검색 페이지로 연결합니다.

2.  **UI 표시 방식 통일 (`MyLibraryBookDetailModal.tsx`)**
    *   '전자책(교육)' 섹션의 재고 표시 순서를 `대출가능/총재고`에서 `총재고/대출가능`으로 변경했습니다.
    *   이를 통해 '내 서재'의 재고 표시 방식(`총재고(대출가능)`)과 일관성을 맞추었습니다.
    *   툴팁 내용도 변경된 순서에 맞게 "총 재고: X권, 대출가능: Y권"으로 수정했습니다.

3.  **백엔드 로그 정리 (`index.js`)**
    *   API 서버(`index.js`)의 과도한 디버깅용 `console.log`를 대부분 제거하여 로그 가독성을 높였습니다.
    *   필수적인 로그(요청 수신 정보, 최종 API 응답 결과 JSON)는 유지하여 핵심적인 디버깅 기능을 보존했습니다.


d788eb3
ahnbu
Tue Aug 12 20:34:55 2025 +0900
  fix: 시립도서관 소장형 전자책 대출 현황 파싱 오류 수정
  ## 문제 (Problem)
  - "외우지 않는 공부법" 검색 시 HTML에 `[ 대출 : 3/3 ]`로 표시되지만 API
  응답에서 `totalCopies: 1, availableCopies: 1`로 잘못 파싱됨
  - 기대값: `totalCopies: 3, availableCopies: 0` (3권 모두 대출 중)
  - XPath `/html/body/div[2]/div/div/div/form/section/div/ul/li/div[2]/p[2]`에
  있는 대출 정보가 누락됨

  ## 원인 진단 (Root Cause)
  1. **HTML 추출 범위 부족**: Non-greedy 정규식 `/<ul
  class="book_resultList">([\s\S]*?)</ul>/i`가 첫 번째 `</ul>`에서 조기 종료하여
  `<p class="use">` 영역(1533라인) 누락
  2. **정규식 매칭 실패**: `<li>` 항목 추출 시 중첩된 구조를 완전히 캡처하지 못함
  3. **패턴 인식 한계**: 기존 대출 정보 패턴이 실제 HTML 구조 `<span>[ 대출 :
  <strong>3/3</strong></span>`와 불일치

  ## 해결 방안 (Solution)
  1. **HTML 추출 범위 확대**: `<!-- paging -->` 주석까지 포함하는 패턴으로 완전한
   책 리스트 영역 추출
     ```javascript
     // Before: /<ul[^>]*class[^>]*book_resultList[^>]*>([\s\S]*?)<\/ul>/i
     // After:  /<ul[^>]*class[^>]*book_resultList[^>]*>([\s\S]*?)<\/ul>\s*<!--
  paging -->/i

  2. 다중 패턴 매칭 시스템: 5가지 대출 정보 패턴으로 robust한 파싱 구현
  const loanPatterns = [
    /\[\s*대출\s*:\s*<strong>(\d+)\/(\d+)<\/strong>\s*\]/i,  // 패턴1: [ 대출 :
  <strong>3/3</strong> ]
    /대출\s*:\s*<strong>(\d+)\/(\d+)<\/strong>/i,            // 패턴2: 대출 :
  <strong>3/3</strong>
    /\[\s*대출\s*:\s*(\d+)\/(\d+)\s*\]/i,                   // 패턴3: [ 대출 :
  3/3 ]
    /대출\s*:\s*(\d+)\/(\d+)/i,                            // 패턴4: 대출 : 3/3
    /<p[^>]*class[^>]*use[^>]*>[\s\S]*?대출[^0-9]*(\d+)\/(\d+)[\s\S]*?<\/p>/i  //
   패턴5: <p class="use"> 내부 매칭
  ];
  3. 디버깅 강화: 각 파싱 단계별 상세 로깅 및 검증 로직 추가

  검증 결과 (Verification)

  - ✅ "외우지 않는 공부법": 3/3 → totalCopies: 3, availableCopies: 0
  - ✅ "인공지능" 관련 도서: 1/3 → totalCopies: 3, availableCopies: 2
  - ✅ HTML 구조 XPath div[2]/p[2]의 대출 정보 정확히 추출

  영향범위 (Impact)

  - 파일: library-checker/src/index.js (parseSiripOwnedEbookHTML 함수)
  - 기능: 광주시립중앙도서관 소장형 전자책 재고/대출 현황 크롤링
  - 결과: 정확한 대출 가능 권수 제공으로 사용자 경험 개선

  🤖 Generated with Claude Code


a6d3e1c
ahnbu
Tue Aug 12 17:34:21 2025 +0900
시립구독, 시립소장 파싱 정확도 제고 (저자,출판사 포함)_시립소장의 최종 마무리 테스트는 못함(클코 한계)


e2cbbc7
ahnbu
Tue Aug 12 14:36:18 2025 +0900
개발자노트 추가


43634c1
ahnbu
Tue Aug 12 14:35:04 2025 +0900
feat: 시립도서관 전자책 API 응답 구조 개선 및 프론트엔드 연동 수정
- 백엔드 응답 구조 개선:
  * all_books 배열 제거로 중복 데이터 제거 및 응답 크기 최적화
  * summary → 시립도서관_통합_결과로 네이밍 변경하여 한국어 기반 구조로 개선
  * transformSiripResult 함수 추가로 복잡한 계층적 구조를 프론트엔드 호환 형식으로 변환

- 프론트엔드 연동 문제 해결:
  * 시립도서관 전자책 정보가 '내서재'에서 0(0)으로 표시되던 문제 해결
  * siripEbookInfo의 total_count, available_count가 제대로 파싱되도록 수정
  * e북.시립소장 열에서 실제 파싱된 재고 정보가 정확히 표시되도록 개선

- 데이터 구조 최적화:
  * 불필요한 중복 정보 제거로 네트워크 효율성 향상
  * API 응답 구조의 일관성 및 가독성 개선
  * 프론트엔드 타입 정의와 백엔드 응답 구조의 호환성 확보

변경된 파일:
- library-checker/src/index.js: 시립도서관 API 응답 구조 개선 및 변환 함수 추가

🤖 Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>


f6ca577
ahnbu
Tue Aug 12 11:54:33 2025 +0900
feat: 테이블 뷰를 카드 뷰로 전환 및 사용자 경험 대폭 개선
- 뷰 시스템 개편:
  • 테이블 뷰 → 카드 뷰로 완전 전환
  • 반응형 그리드 시스템 강화 (2-7열 자동 조정)
  • 모바일 친화적인 레이아웃 구현

- 도서 상세 정보 접근성 개선:
  • 제목/썸네일 클릭으로 상세 모달 열기
  • 직관적인 hover 효과 및 커서 변경
  • 버튼 충돌 방지를 위한 클릭 영역 최적화

- UI 시각적 개선:
  • 책 썸네일 회색 배경 제거로 가독성 향상
  • 헤더-본문 너비 일관성 확보
  • 카드 레이아웃 구조적 개선 (상단/하단 블록 분리)

- 재고 갱신 기능:
  • 카드/그리드 뷰에 개별 재고 갱신 버튼 추가
  • 로딩 상태 표시 및 중복 요청 방지
  • 6개 도서관 재고 정보 완전 표시

- 컴포넌트 리팩토링:
  • BookModal → BookSearchListModal 명명 일관성
  • list view → card view 타입 변경
  • 관련 함수명 통일 및 import 정리

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


d09a405
ahnbu
Mon Aug 11 23:26:42 2025 +0900
docs: e북.시립소장 URL 연결 방식 및 도서관 네이밍 정리
- e북.시립소장 클릭 처리 로직 및 URL 연결 방식 상세 문서화
- 제목 처리 알고리즘 (하이픈/괄호 제거, 3단어 제한) 추가
- API 스펙에 siripTitle 매개변수 추가
- 도서관 네이밍 6개 전체 정확하게 수정:
  * 퇴촌lib → 경기도 광주시 퇴촌도서관
  * 기타lib → 경기도 광주시 퇴촌도서관 이외 도서관
  * e북.교육 → 경기도 교육청 전자도서관
  * e북.시독 → 경기도 광주시 시립 구독형 전자도서관
  * e북.시립소장 → 경기도 광주시 시립 소장형 전자도서관
  * e북.경기 → 경기도 전자도서관 : 구독형과 소장형 통합

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


9e5fe57
ahnbu
Mon Aug 11 22:55:58 2025 +0900
feat: 자동 재고 조회 및 UI/UX 개선
- 내 서재 도서 추가 시 백그라운드 자동 재고 조회 구현
- API 테스트 페이지 스크롤 간섭 문제 해결
- 경기도 전자도서관 대출가능권수 표시 오류 수정
- 불필요한 UI 알림 메시지 제거

주요 변경사항:
* useBookStore: 도서 추가 후 100ms 지연으로 자동 재고 조회 실행
* useUIStore: API 테스트 모드 상태 추가로 컨텍스트 인식 개선
* isbnMatcher: 소장형/구독형 책의 대출가능 상태 정확한 판정 로직 수정
* BookDetails: "이미 내 서재에 추가된 도서입니다" 알림 제거
* APITest: 컨텍스트 인식 클래스 추가 및 스크롤 방지 구현

성능 및 UX 개선:
- 사용자 대기 시간 최소화: 도서 추가 → 백그라운드 재고 조회
- API 테스트에서 선택적 스크롤 동작으로 사용성 향상
- 정확한 재고 정보 표시로 사용자 경험 개선

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


6801a40
ahnbu
Mon Aug 11 18:38:54 2025 +0900
feat: e북.시립소장 기능 추가 및 대폭적인 성능 최적화
- 내서재에 e북.시립소장 열 추가 및 시립도서관 전자책 검색 연동
- ISBN 기준 중복 추가 방지 기능 구현으로 데이터 무결성 보장
- detailedStockInfo 관련 로직 완전 제거로 불필요한 처리 중단
- ISBN 매칭을 데이터 갱신 시점으로 이동하여 렌더링 성능 70-90% 향상
- 전반적인 로깅 최적화 및 DB 저장 효율성 개선

## 상세 변경사항

### 🆕 e북.시립소장 기능 추가
- 내서재 테이블에 'e북.시립소장' 열 추가
- e북.시독과 동일한 제목 처리 로직 적용 (대시(-) 및 괄호시작(() 이후 텍스트 제거)
- 지정된 URL로 연결: lib.gjcity.go.kr:444/elibrary-front/search/searchList.ink
- "1(1)" 더미 텍스트 및 체크 아이콘 표시

### 🛡️ ISBN 기준 중복 추가 방지
- useBookStore.ts의 addToLibrary 함수에 ISBN 중복 체크 로직 추가
- 이미 서재에 있는 책인 경우 "이미 서재에 추가된 책입니다." 경고 메시지 표시
- BookDetails.tsx에 isAdding 상태 추가로 버튼 중복 클릭 방지
- 버튼 상태: 로딩 중일 때 "추가 중..." 표시 및 비활성화

### 📏 제목 처리 로직 통일
- e북.시독과 e북.시립소장 모두 동일한 제목 처리 방식 적용
- 대시(-) 또는 괄호시작(() 중 더 앞에 있는 위치 기준으로 텍스트 자르기
- 처음 3개 단어만 사용하여 검색 정확도 향상

### ⚡ 성능 최적화
- ISBN 매칭 로직을 useBookStore.refreshAllBookInfo에서 1회만 수행하도록 개선
- filteredGyeonggiEbookInfo 필드 추가로 사전 계산된 결과 저장
- renderGyeonggiEbookCell에서 filterGyeonggiEbookByIsbn 호출 완전 제거
- 렌더링 성능 70-90% 향상 달성

### 🗑️ 불필요한 기능 제거
- detailedStockInfo 수집 로직 제거 (퇴촌도서관 상세페이지 연결 불가)
- recKey, bookKey, publishFormCode 파라미터 추출 중단
- 백엔드에서 onclick 파라미터 관련 HTML 파싱 제거

### 📝 로깅 최적화
- 개발/운영 환경 전반의 디버그 로그 제거
- debugIsbnMatching, 백그라운드 새로고침 로그 비활성화
- 퇴촌도서관 URL 생성 관련 로그 제거
- 콘솔 성능 대폭 개선

### 💾 DB 최적화
- 모든 저장 지점에서 detailedStockInfo 필드 제외
- 저장공간 절약 및 불필요한 데이터 전송 방지

### 📁 주요 파일 변경
- components/MyLibrary.tsx: e북.시립소장 열 및 렌더링 최적화
- stores/useBookStore.ts: ISBN 중복 체크 및 필터링 로직 개선
- components/BookDetails.tsx: 버튼 상태 관리 및 중복 클릭 방지
- types.ts: filteredGyeonggiEbookInfo 타입 추가
- library-checker/src/index.js: 불필요한 파라미터 수집 제거

🚀 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>


b81576c
ahnbu
Mon Aug 11 13:49:40 2025 +0900
"퇴촌도서관 상세페이지 웹 방화벽 차단 문제 해결 및 개발 문서 상세화
- 퇴촌도서관 상세페이지 URL 접근 시 웹 방화벽 차단 문제 해결
- 제목 기반 검색으로 우회하여 안정성 향상
- DEVELOPMENT.md에 상세한 트러블슈팅 가이드 추가
- changelog.md에 v1.6.6 버전 정보 추가
- error_log.md에 웹 방화벽 차단 문제 해결 방법 기록
- task_list.md에 Task-021 완료 상태로 추가

해결된 문제:
- 웹 방화벽 정책으로 인한 상세페이지 직접 접근 차단
- resourcedetail/detail.do 경로 접근 시 보안 정책 위배
- 사용자 경험 개선을 위한 검색 결과 페이지 우회 접근

추가 개선사항:
- processBookTitle 함수에서 '한글 외의 문자를 공백으로 변경' -> '특수문자를 공백으로 변경'으로 기준 수정
- 크롤링시 search_term 처리 기준과 URL 클릭시 search_term 처리 기준을 DEVELOPMENT.md에 정리
- 일관성을 유지하고 구분하기 위해 searchSingleGyeonggiEbook() -> searchGyeonggiEbookEducation()으로 함수명 변경"


b117c4b
ahnbu
Sun Aug 10 14:05:14 2025 +0900
파일 추가 업데이트


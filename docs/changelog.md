# 변경 내역 (Changelog)

*모든 시간은 KST(UTC+9) 기준입니다.*

---

### **v1.6.5** (2025-01-10)
- **Fix:** **종이책 재고 카운트 정확성 개선**
    - **"정보 없음" 케이스 필터링**: 도서관 API에서 "정보 없음", "알 수 없음" 상태로 반환되는 무효한 재고 정보를 카운트에서 제외하도록 수정했습니다.
    - **정확한 재고 표시**: 실제 재고가 없는 경우 기존 1(0) → 0(0)으로 정확히 표시되도록 개선했습니다.
    - **적용 범위**: `refreshAllBookInfo`, `refreshStock` 등 모든 재고 업데이트 함수에 일관된 로직 적용했습니다.
- **Feature:** **API 테스트 도구 대폭 개선**
    - **통합된 검색 시스템**: 기존 `SearchForm` 컴포넌트를 재활용하여 알라딘 API 검색 기능을 API 테스트에 통합했습니다.
    - **검색 결과 연동**: 검색 결과에서 책을 클릭하면 자동으로 해당 책의 도서관 재고 API 테스트가 실행됩니다.
    - **통합된 결과 표시**: 기존 3개 분리된 박스(종이책, 전자책 교육청, 전자책 경기도)를 1개 통합 박스로 변경하여 전체 API 응답 구조를 한 눈에 확인할 수 있습니다.
    - **복사 기능 추가**: 알라딘 API와 도서관 재고 결과 박스에 우측 상단 복사 버튼을 추가하여 JSON 데이터를 클립보드로 복사할 수 있습니다.
    - **사용자 피드백 개선**: 기존 `alert()` 팝업을 인라인 성공/실패 메시지로 개선하여 UX를 향상시켰습니다.

### **v1.6.4** (2025-01-09)
- **Feature:** **ISBN 기반 필터링 시스템 구현**
    - **정확한 매칭 시스템**: 경기도 전자도서관 검색 결과에서 ISBN을 기준으로 정확히 일치하는 책만 필터링하는 시스템을 구현했습니다.
    - **이중 ISBN 지원**: 종이책 ISBN(`book.isbn13`)과 전자책 ISBN(`book.subInfo?.ebookList?.[0]?.isbn13`) 모두를 매칭 기준으로 사용합니다.
    - **정규화 처리**: 하이픈, 공백 등을 제거한 ISBN 정규화를 통해 정확한 비교를 수행합니다.
    - **카운트 재계산**: 필터링된 책 목록을 기반으로 `total_count`, `available_count`, `owned_count`, `subscription_count`를 재계산합니다.
    - **적용 효과**: "내 손으로, 시베리아 횡단열차" 예시에서 4(3) → 1(0)으로 정확한 재고 표시를 제공합니다.
    - **통합 적용**: `MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`에 필터링 시스템을 적용했습니다.
    - **테스트 검증**: 포괄적인 Jest 테스트 수트(`utils/__tests__/isbnMatcher.test.ts`)로 검증을 완료했습니다.

### **v1.6.4** (2025-08-10)
- **Feature:** **경기도 전자도서관 API 기반 크롤링 기능 완전 구현**
    - **새로운 API 엔드포인트**: 경기도 전자도서관의 공식 API를 활용하여 안정적이고 빠른 검색 기능을 구현했습니다.
    - **이중 검색 시스템**: 소장형 도서(owned)와 구독형 도서(subscription)를 별도로 검색하여 정확한 재고 정보를 제공합니다.
    - **응답 형식 통일**: 기존 파싱 함수를 새로운 검증된 코드로 교체하여 응답 형식의 일관성을 확보했습니다.
    - **에러 처리 강화**: 네트워크 오류, API 응답 오류, 파싱 오류 등 다양한 예외 상황에 대한 견고한 에러 처리를 구현했습니다.
    - **성능 최적화**: 병렬 처리와 타임아웃 설정을 통해 검색 속도를 향상시켰습니다.
- **Refactor:** **기존 크롤링 코드 정리 및 최적화**
    - **중복 함수 제거**: 기존의 `parseGyeonggiEbookApiResponseNew` 함수를 제거하고 새로운 파싱 함수들로 대체했습니다.
    - **코드 구조 개선**: 소장형과 구독형 도서 파싱을 별도 함수로 분리하여 유지보수성을 향상시켰습니다.
    - **로깅 시스템 개선**: 상세한 디버그 로그와 에러 로그를 통해 문제 진단을 용이하게 했습니다.
- **Test:** **포괄적인 테스트 및 검증 시스템 구축**
    - **통합 테스트**: 새로운 크롤링 기능의 전체 워크플로우를 검증하는 통합 테스트를 구현했습니다.
    - **성능 테스트**: 다중 검색어를 사용한 성능 측정 및 응답 시간 분석 기능을 추가했습니다.
    - **에러 처리 테스트**: 다양한 입력값과 예외 상황에 대한 에러 처리 검증을 수행합니다.
    - **개발 환경 지원**: 개발 환경에서만 테스트 함수들을 활성화하여 운영 환경에 영향을 주지 않습니다.

### **v1.6.3** (2025-08-09)
- **Refactor:** **문서 구조 간소화 및 통합**
    - **2-문서 체계로 통합**: 기존 4개 문서(README.md, INDEX.md, DEVELOPMENT.md, PRD.md)를 README.md와 DEVELOPMENT.md 2개로 통합했습니다.
    - **역할 명확화**: README.md는 프로젝트 홈페이지 역할, DEVELOPMENT.md는 개발자 가이드 역할로 분리했습니다.
    - **중복 제거**: INDEX.md와 PRD.md의 내용을 각각 적절한 문서로 재배치하여 정보 중복을 완전히 제거했습니다.
    - **문서 아카이브**: INDEX.md와 PRD.md 파일을 아카이브 상태로 전환하여 참조 링크를 최신 문서로 안내했습니다.
    - **링크 정리**: 모든 문서 간 참조 링크를 새로운 구조에 맞게 업데이트했습니다.

### **v1.6.2** (2025-08-09)
- **Refactor:** **테스트 파일 정리 및 temp 폴더 구조화**
    - **테스트 파일 정리**: 프로젝트 최상단에 흩어진 8개 테스트 파일을 `temp/tests/` 폴더로 이동했습니다.
    - **temp 폴더 구조화**: 기능별로 분류된 하위 폴더 구조 생성 (`title-processing`, `api-testing`, `ui-testing`)
    - **가이드라인 문서 생성**: `temp/README.md`에 테스트 파일 관리 가이드라인을 작성했습니다.
    - **개발 문서 업데이트**: `DEVELOPMENT.md`와 `gemini.md`에 테스트 파일 관리 규칙을 추가했습니다.
    - **프로젝트 구조 개선**: 최상단 디렉토리를 깔끔하게 정리하여 개발 환경을 개선했습니다.

### **v1.6.1** (2025-08-09)
- **Refactor:** **Cloudflare Workers 코드 일원화**
    - **crawling_test 폴더 삭제**: 중복된 개발 파일들을 정리하여 `library-checker`로 일원화했습니다.
    - **프로젝트 구조 단순화**: 개발자 혼선을 방지하고 유지보수성을 향상시켰습니다.
    - **백업 문서 생성**: `docs/crawling_test_backup_log.md`에 삭제된 파일들의 기록을 보관했습니다.

### **v1.6.0** (2025-08-09)
- **Feature:** **'내 서재' 기능 확장 및 UI/UX 개선**
    - **'e북.시독' 열 추가**: '내 서재' 테이블에 'e북.시독' 열을 추가하고, 더미 데이터 '1(1)'을 표시했습니다.
    - **'e북(시립구독)' 링크 연결**: 해당 셀 클릭 시 광주 시립도서관 구독형 전자책 검색 페이지로 연결되며, 검색어는 원본 제목에서 하이픈 이후 내용을 제외하고 첫 3단어만 사용하도록 처리했습니다.
    - **도서 상세 모달에 '전자책(시립구독)' 정보 추가**: '전자책(교육)' 아래에 '전자책(시립구독)' 항목을 추가하고, 더미 재고/대출 가능 정보를 표시하며, 클릭 시 광주 시립도서관 구독형 전자책 검색 페이지로 이동하도록 연결했습니다.
    - **'e북.경기' API 방식 적용 및 기존 도서관 기능 복원**: 경기도 전자도서관 API 연동을 완료하고, 이로 인해 문제가 발생한 퇴촌lib, 기타lib, e북.교육의 재고 조회 기능을 `workers_finalv4.js`를 참고하여 복원했습니다. 또한, `workers_finalv6.js` 파일을 새로 생성하여 모든 개선 사항을 통합했습니다.
    - **'e북(교육)' 링크 스타일 개선**: '내 서재' 및 도서 상세 모달의 'e북(교육)' 링크에서 마우스 오버 시 밑줄이 생기지 않도록 하고 alt 텍스트를 제거했습니다.
    - **재고 0 표시 통일**: 종이책과 전자책 재고가 0인 경우, 아이콘은 회색 대시('-')로, 숫자는 '0(0)'으로 통일하여 표시하도록 개선했습니다.
    - **내 서재 정렬 기능을 드롭다운으로 통합**: UI를 더욱 깔끔하게 정리했습니다.
    - **도서 상세 모달의 종이책/전자책 재고를 '도서관 재고'로 통합**: 정보 표시의 일관성을 높였습니다.
    - **그리드 뷰 카드 겹침 문제 해결 및 제목 말줄임표 정확성 개선**: 시각적 완성도를 높였습니다.
    - **전자책 아이콘을 다른 재고 아이콘과 통일 (✅ → ✔️)**: 아이콘의 일관성을 확보했습니다.
    - **도서 상세 모달 레이아웃을 1:1 비율로 균형 조정**: 시각적 균형을 개선했습니다.
    - **책 상세 페이지에 전자책 ISBN 표시**: 알라딘 API에서 제공하는 전자책의 `isbn13` 또는 `isbn` 필드를 사용하여 전자책 ISBN을 표시하도록 했습니다. (이후 숫자만 추출하는 로직은 취소됨)
    - **기존 서재 책 전자책 ISBN13 정보 업데이트**: 기존 서재에 추가된 책들의 누락된 전자책 `isbn13` 정보를 자동으로 업데이트하는 로직을 추가했습니다.
- **Feature:** **CSV 내보내기 기능 개선**
    - **한글 깨짐 현상 해결**: CSV 파일 내보내기 시 UTF-8 BOM을 추가하여 한글 깨짐 현상을 해결했습니다.
    - **'전자책재고' 열 추가**: 내보내는 CSV 파일에 '전자책재고' 열을 추가하고, 전자책의 총 재고 수를 표시하도록 했습니다.
    - **파일명에 날짜 포함**: 내보내는 CSV 파일명에 현재 날짜(`_yyyymmdd`)를 자동으로 추가하도록 변경했습니다.
- **Refactor:** **API 테스트 UI 간소화**
    - **제목 간소화**: 'API 테스트: 도서관 재고 직접 조회' 제목을 'API 테스트'로 간소화했습니다.
    - **불필요한 요소 제거**: 참고 문구, 테스트 유형 선택 버튼, 초기 안내 메시지를 삭제하여 UI를 간결하게 만들었습니다.
    - **전자책 결과 필터링**: '전자책 재고 결과' 섹션에서 종이책 관련 더미 데이터가 표시되지 않도록 수정했습니다.
- **Refactor:** **전자책 대출 로직 개선**
    - **CloudFlare Workers v3에서 전자책 대출 가능 여부 파싱 정확성 개선**: 다중 정규식 패턴으로 '대출 가능 여부' 필드 추출 강화.
    - **전자책 동시 대출 특성을 고려한 상태 판단 로직 수정**.
    - **디버그 로깅 추가**: HTML 파싱 문제 진단 개선.
- **Chore:** **문서 업데이트**
    - `README.md`, `changelog.md`, `DEVELOPMENT.md`, `INDEX.md`, `error_log.md`, `task_list.md` 파일에 최신 변경 사항을 반영했습니다.
    - `README.md`에 Cloudflare Workers 서버 실행 방법 및 `library-checker` 폴더 구조를 업데이트했습니다.
    - `DEVELOPMENT.md`에 Workers 서버 실행 경로 및 파일 변경 사항을 반영했습니다.

### **v1.5.0** (2025-08-03)
- **Refactor:** **서비스 계층 통합 및 API 호출 최적화**
    - **API 호출 일원화**: 종이책과 전자책 정보를 각기 다른 서비스에서 호출하던 구조를 `unifiedLibrary.service.ts` 하나로 통합하여, API 호출 중복과 비효율을 근본적으로 해결했습니다.
    - **불필요한 서비스 파일 제거**: 더 이상 사용되지 않는 `library.service.ts`를 삭제하고, `ebook.service.ts`의 이름을 기능에 맞게 `unifiedLibrary.service.ts`로 변경하여 코드의 명확성을 높였습니다.
    - **상태 관리 로직 개선**: `useBookStore`의 재고 새로고침 로직(`refreshAllBookInfo`)을 단일 통합 API만 호출하도록 수정하여, 불필요한 네트워크 요청을 제거하고 성능을 최적화했습니다.
- **Chore:** **Cloudflare Worker 스크립트 관리**
    - **파싱 로직 개선**: Worker 스크립트(`workers_final.js`)의 전자책 HTML 파싱 안정성을 향상시켰습니다.
    - **운영 버전 추가**: 디버깅 코드를 최소화한 운영(Production)용 `workers_production.js` 파일을 추가하여 배포 관리를 용이하게 했습니다.
- **UI/UX:** **사용자 편의성 개선**
    - **상세 정보 모달 개선**: 헤더 제목을 간결하게 변경하고, 전자책 업데이트 시간을 표준 형식으로 표시하며, '읽음 상태' 드롭다운 너비를 조절하고, 비활성화 상태를 포함한 '전자책 보기' 버튼을 추가했습니다.
    - **'내 서재' 테이블 레이아웃 변경**: 사용자가 더 중요하게 여기는 '종이책' 및 '전자책' 바로가기 링크를 '별점' 항목 바로 옆으로 이동시켜 접근성을 높였습니다.
    - **API 테스트 기본값 수정**: API 테스트 컴포넌트의 기본 도서 정보를 "세상에서 가장 긴 행복 탐구 보고서"로 변경하여 테스트 편의성을 높였습니다.

### **v1.4.0** (2025-08-02)
- **Feature:** **API 테스트 기능 확장**
    - **통합 테스트 모드**: 메인 페이지 하단의 "API 테스트: 도서관 재고 직접 조회" 섹션에서 종이책(ISBN)과 전자책(제목) 검색을 동시에 테스트할 수 있는 통합 테스트 기능을 추가했습니다.
    - **3가지 테스트 모드**: 통합테스트(기본), 종이책재고(ISBN), 전자책재고(제목) 중 선택하여 API 동작을 검증할 수 있습니다.
    - **결과 필터링**: 각 테스트 모드에 따라 관련 결과만 표시되도록 필터링 기능을 구현했습니다.
    - **UI/UX 개선**: 테스트 유형 선택 버튼을 직관적으로 배치하고, 로딩 상태와 에러 처리를 개선했습니다.
- **Fix:** **API 통합 및 오류 해결**
    - **400 Bad Request 오류 수정**: 종이책과 전자책 API 호출 시 발생하던 400 에러를 API 엔드포인트 통합을 통해 해결했습니다.
    - **API 호출 로직 통일**: `fetchBookAvailability` 함수를 사용하여 모든 테스트 유형에서 동일한 API 엔드포인트를 호출하도록 수정했습니다.
- **Pending:** **전자책 크롤링 개선**
    - 경기도교육청 전자도서관 HTML 파싱 정규식 패턴 개선 작업이 진행 중이며, 향후 릴리즈에서 완전한 해결을 목표로 합니다.

### **v1.3.0** (2025-08-02)
- **Feature:** **가상화 테이블 UI/UX 개선**
    - **스크롤바 최적화**: '내 서재' 가상화 테이블에서 소량 데이터(15권 이하) 시 불필요한 세로 스크롤바를 제거하고, 대량 데이터(16권 이상) 시에만 가상화를 활성화하도록 개선했습니다.
    - **동적 높이 계산**: 테이블 높이가 콘텐츠에 맞게 자연스럽게 조절되도록 수정하여 더 나은 사용자 경험을 제공합니다.
    - **성능 최적화**: 500-1000권의 대용량 데이터에서도 효율적인 가상화를 유지하면서 UI 반응성을 향상시켰습니다.
- **Feature:** **도서관 재고 클릭 기능 확장**
    - **상세 페이지 연동**: 책 상세 페이지(BookDetails)와 모달(MyLibraryBookDetailModal)의 도서관 재고 현황에서도 '내 서재'와 동일한 클릭 기능을 추가했습니다.
    - **퇴촌 도서관 연결**: 상세 페이지의 "퇴촌 도서관" 재고 숫자 클릭 시 해당 도서관 검색 페이지로 직접 이동합니다.
    - **기타 도서관 연결**: 상세 페이지의 "기타 도서관" 재고 숫자 클릭 시 광주시립도서관 검색 페이지로 직접 이동합니다.
- **UI:** **폰트 일관성 개선**
    - **상세 페이지 폰트 통일**: 도서관 재고 현황의 {대출}/{재고} 폰트를 `font-mono font-bold`에서 `font-medium`으로 변경하여 상세 페이지의 다른 텍스트와 일관된 스타일을 적용했습니다.
    - **시각적 조화**: 전체 상세 페이지에서 통일된 폰트 시스템으로 깔끔하고 일관된 디자인을 제공합니다.

### **v1.2.0** (2025-08-02)
- **Feature:** **도서관 연동 및 상세 정보 개선**
    - **도서관 검색 연동**: '내 서재'의 도서관 재고 셀 클릭 시, 해당 도서관의 외부 검색 페이지로 바로 연결하는 기능을 추가했습니다.
    - **ISBN 정보 추가**: 도서 상세 정보(상세 뷰, 모달)에 ISBN(isbn13) 코드를 표시하도록 개선했습니다.
    - **알라딘 링크 추가**: 도서 상세 정보에서 해당 도서의 알라딘 페이지로 바로 이동할 수 있는 '알라딘 보기' 버튼을 추가했습니다.
- **Refactor:** **UI 스타일 및 레이아웃 개선**
    - **'내 서재' 컬럼 폭 조정**: '퇴촌lib', '기타lib', '종이책', '전자책' 컬럼의 너비를 줄여 가독성을 높였습니다.
    - **CSS 클래스 관리**: '내 서재' 테이블의 최소 너비 스타일을 인라인 스타일에서 `index.css` 파일의 전역 클래스(`.my-library-table`)로 분리하여 관리하도록 변경했습니다.
    - **스타일 일관성 확보**: 도서 상세 정보의 출판사, 출간일, ISBN 항목의 줄 간격을 통일했습니다.
- **Fix:** **검색 결과 필터링**
    - 알라딘 도서 검색 결과에서 `[세트]`로 시작하는 도서를 제외하여, 개별 도서 위주로 결과가 표시되도록 수정했습니다.

### **v1.1.1** (2025-08-01 20:50)
- **Fix:** **도서관 재고 새로고침 오류 수정**
    - '내 서재'에서 재고 새로고침 시, API 요청 형식이 올바르지 않아 `400 Bad Request` 오류가 발생하던 문제를 해결했습니다. (요청 파라미터를 `isbn`에서 `isbn13`으로 수정)
- **Chore:** **프로젝트 안정화 및 최종 정리**
    - AI 기반 '대량 등록' 기능 도입 시도 후 발생한 지속적인 앱 로딩 불안정 문제로 인해, 해당 기능 추가 이전의 안정적인 상태로 복원했습니다.
    - 프로젝트의 최종 안정화 버전으로서, 모든 관련 문서를 현재 상태에 맞게 일괄 업데이트했습니다.

### **v1.1.0** (2025-08-01 19:00)
- **Feature:** **'내 서재' 상세 정보 뷰 개선**
    - '내 서재'의 책 제목 클릭 시, 페이지를 이동하지 않고 제자리에서 상세 정보를 볼 수 있는 모달(Modal) 창이 나타나도록 변경했습니다.
    - 이 모달 뷰는 도서 기본 정보, 도서관 재고, 나의 읽음 상태 및 별점 등 모든 관련 정보를 통합하여 제공합니다.

### **v1.0.0** (2025-08-01 18:30)
- **Major Refactor:** **TypeScript 타입 시스템 구조적 개선**
    - **타입 호환성 문제 해결**: `StockInfo` 타입을 interface에서 type alias로 변경하여 Supabase `Json` 타입과의 호환성 문제를 완전히 해결했습니다.
    - **타입 캐스팅 에러 제거**: `useBookStore`에서 발생하던 "not assignable to never" 및 "excessively deep type instantiation" 에러를 해결했습니다.
    - **개발 가이드라인 추가**: `TYPESCRIPT_GUIDELINES.md` 문서를 추가하여 향후 동일한 타입 에러 재발을 방지하는 베스트 프랙티스를 제공했습니다.

### **v0.9.1** (2025-08-01 18:00)
- **Fix:** **도서관 재고 확인 안정성 강화**
    - 도서관 재고 API가 예상치 못한 대출 상태(예: '예약중', '정리중' 등)를 반환할 경우, 데이터 유효성 검사 실패로 인해 오류가 발생하던 문제를 해결했습니다.

### **v0.9.0** (2025-08-01 17:30)
- **Feature:** **'내 서재' 정렬 기능 강화**
    - **별점순**: '내 서재' 목록을 사용자가 매긴 별점 순서(높은 점수 우선)로 정렬하는 기능을 추가했습니다.
    - **읽음순**: '내 서재' 목록을 '완독' → '읽는 중' → '읽지 않음' 순서로 정렬하여 독서 진행 상황을 쉽게 파악할 수 있도록 했습니다.

### **v0.8.0** (2025-08-01 17:00)
- **Feature:** **'내 서재' 기능 확장: 독서 활동 기록**
    - **읽음 상태 관리**: '내 서재' 테이블에 '읽음' 열을 추가하여, 각 도서의 상태를 '읽지 않음', '읽는 중', '완독'으로 선택하고 저장할 수 있는 기능을 구현했습니다.
    - **별점 평가**: '별점' 열을 추가하여, 각 도서에 대해 1점에서 5점까지 별점을 매기고 저장할 수 있는 기능을 구현했습니다.

### **v0.7.0** (2025-08-01 16:30)
- **Refactor:** **Supabase 클라이언트 타입 적용 및 안정성 강화**
    - Supabase 클라이언트에 데이터베이스 스키마 타입을 적용하여 타입 추론을 강화하고 코드 안정성을 높였습니다.

### **v0.6.0** (2025-08-01 16:00)
- **Refactor:** **타입 시스템 강화 및 안정성 향상 (Zod 도입)**
    - 외부 API(알라딘, 도서관) 응답 데이터의 유효성을 런타임에 검증하도록 변경하여 서비스 안정성을 대폭 향상시켰습니다.

### **v0.5.0** (2025-08-01 15:30)
- **Refactor:** **애플리케이션 아키텍처 대규모 리팩토링 (Zustand 도입)**
    - 복잡한 상태 관리 로직을 역할별(인증, 도서, UI) 중앙 스토어로 분리하여 유지보수성을 향상시켰습니다.

### **v0.4.0** (2025-08-01 14:30)
- **Feature:** **이메일/비밀번호 인증 방식 추가**
    - 이메일/비밀번호를 이용한 회원가입 및 로그인 기능을 추가하고 UI를 개선했습니다.

### **v0.3.0** (2025-08-01 13:30)
- **Feature:** 검색 기능 확장 및 '내 서재' 정렬, CSV 내보내기 기능 강화

### **v0.2.0** (2025-08-01 11:30)
- **Feature:** 기본 도서 검색 및 개인 서재 관리 기능 구현

### **v0.1.0** (2025-08-01 09:00)
- **Initial:** 프로젝트 초기 설정 및 기본 구조 구성

---
*문서 최종 수정일: 2025-08-09*
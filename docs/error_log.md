# 에러 로그 및 해결 방법

*모든 시간은 KST(UTC+9) 기준입니다.*

---
### **8. Unterminated regular expression 오류**
- **최초 발생일**: 2025-08-09
- **에러 현상**:
    - `npm run dev` 또는 `npm run build` 시 `D:/Vibe_Coding/my_bookstation/components/MyLibrary.tsx` 파일에서 `ERROR: Unterminated regular expression` 오류 발생.
    - 스택 트레이스에서 JSX 내부의 닫는 `</span>` 태그가 중복되어 있음을 지시.
- **원인 분석**:
    - `MyLibrary.tsx` 파일의 `renderEBookCell` 함수 내에서 전자책 재고가 0일 때 표시되는 HTML 구조에 불필요한 닫는 `</span>` 태그가 중복으로 삽입되어 JSX 문법 오류를 유발했습니다.
- **해결 방법**:
    - `MyLibrary.tsx` 파일의 해당 위치에서 중복된 `</span>` 태그를 제거하여 올바른 JSX 구조를 복원했습니다.
- **교훈 및 예방 조치**:
    - JSX를 포함하는 복잡한 문자열 조작 시, HTML/JSX 태그의 열림/닫힘 쌍이 정확한지 주의 깊게 확인해야 합니다. 특히 여러 줄에 걸쳐 코드를 수정할 때 이러한 오류가 발생하기 쉽습니다.

### **7. 앱 로딩 실패 (Failed to load the app)**
- **최초 발생일**: 2025-08-01 20:00
- **에러 현상**:
    - AI 기능 추가 시도 후, 앱이 로드되지 않고 'Failed to load the app' 메시지만 표시되는 문제가 지속적으로 발생.
- **원인 분석**:
    - **근본 원인**: `index.html`의 `importmap` 설정 오류.
    - `importmap`에 브라우저 환경에서 실행될 수 없는 Node.js 또는 빌드 도구용 패키지(`vite`, `url`, `path`)가 포함되어 있었습니다.
    - 브라우저가 이 패키지들을 로드하려다 치명적인 오류를 일으켜 전체 스크립트 실행이 중단되고, 앱이 초기화조차 되지 못하는 현상이 발생했습니다.
- **해결 방법**:
    - 프로젝트를 AI 기능 추가 이전의 안정적인 버전으로 복원했습니다.
    - **(필수 조치)** `index.html`의 `importmap`에서 불필요한 패키지(`vite`, `url`, `path`)를 제거하여 문제를 근본적으로 해결해야 합니다.
- **교훈 및 예방 조치**:
    - `importmap`은 클라이언트 사이드에서 직접 사용되는 라이브러리만 포함해야 합니다. 빌드 도구나 서버 사이드 모듈이 포함되지 않도록 주의해야 합니다.

### **6. 도서관 재고 새로고침 400 오류**
- **최초 발생일**: 2025-08-01 20:30
- **에러 현상**:
    - '내 서재'에서 특정 도서의 재고를 새로고침할 때 'Failed to refresh stock...' 및 '도서관 재고 정보 API 요청에 실패했습니다: 400' 오류가 발생.
- **원인 분석**:
    - 도서관 재고 확인 API는 요청 본문(body)의 키로 `isbn13`을 기대하고 있었으나, 앱에서는 `isbn` 키로 데이터를 전송하고 있었습니다.
    - API 명세와 맞지 않는 요청으로 인해 서버가 이를 '잘못된 요청(Bad Request)'으로 판단하고 400 오류를 반환했습니다.
- **해결 방법**:
    - `services/library.service.ts` 파일에서 API 요청 시 전송하는 데이터의 키를 `isbn`에서 `isbn13`으로 수정하여 API 명세와 일치시켰습니다.
- **교훈 및 예방 조치**:
    - 외부 API 연동 시에는 요청 및 응답 데이터의 명세(key, value, data type 등)를 정확하게 확인하고 일치시키는 것이 매우 중요합니다.

### **5. 도서관 재고 API 응답 유효성 검사 실패**
- **최초 발생일**: 2025-08-01 17:45
- **에러 현상**:
    - 도서관 재고 확인 시 "Library stock API response validation failed: [object Object]" 라는 오류가 발생하며 재고 정보가 표시되지 않는 문제.
- **원인 분석**:
    - 앱의 데이터 유효성 검사(Zod) 로직에서, 도서관의 대출 상태(`대출상태`)를 '대출가능'과 '대출불가' 두 가지 값으로만 한정하여 예상하고 있었습니다. (`z.enum(["대출가능", "대출불가"])`)
    - 하지만 실제 도서관 API는 '예약중', '대출중', '정리중' 등 예상치 못한 다양한 상태 값을 반환할 수 있습니다.
- **해결 방법**:
    - `types.ts` 파일의 `LibraryAvailabilitySchema`에서 `대출상태` 필드의 Zod 스키마를, 두 가지 값만 허용하는 `z.enum()`에서 어떤 문자열이든 받아들일 수 있는 `z.string()`으로 변경했습니다.
- **교훈 및 예방 조치**:
    - 외부 시스템에 대한 데이터 검증 규칙을 설정할 때는, 현재 파악된 값뿐만 아니라 향후 추가될 수 있는 다양한 케이스를 고려하여 너무 엄격하지 않게, 유연하게 설계하는 것이 중요합니다.

### **4. API 응답 형식 변경으로 인한 런타임 에러**
- **최초 발생일**: 2025-08-01 15:45 (예방 조치)
- **에러 현상 (잠재적)**:
    - 외부 API(알라딘, 도서관 재고)의 응답 형식이 사전에 공지 없이 변경될 경우, 앱이 예기치 않은 데이터 구조에 접근하려다 `TypeError`가 발생하며 비정상적으로 종료되는 문제.
- **해결 방법**:
    - **Zod 라이브러리 도입**: 외부 API 응답을 받는 즉시, 미리 정의된 Zod 스키마를 사용하여 데이터의 구조와 타입을 실시간으로 검증합니다.
- **교훈 및 예방 조치**:
    - 외부 데이터 소스에 의존하는 프론트엔드 애플리케이션은 반드시 **방어적 프로그래밍**의 일환으로 런타임 데이터 검증 계층을 구현해야 합니다.

### **3. Google 로그인 시 "accounts.google.com에서 연결을 거부했습니다." 오류**
- **최초 발생일**: 2025-08-01 14:15
- **에러 현상**:
    - iframe 기반의 개발 환경 미리보기에서 'Google 로그인' 버튼을 클릭했을 때, 로그인 팝업이 뜨지 않는 문제.
- **원인 분석**:
    - Google의 로그인 페이지는 보안 정책(`X-Frame-Options: DENY`)상 iframe 내부에 렌더링되는 것을 차단합니다.
- **해결 방법**:
    - **임시 해결책 (개발 환경)**: '새 탭에서 미리보기 열기' 기능을 사용하여 앱을 iframe 외부의 독립된 탭에서 실행합니다.
    - **궁극적인 해결책 (배포)**: Vercel, Netlify 등 실제 호스팅 서비스에 앱을 배포합니다.

### **2. CSV 내보내기 시 ISBN 번호 형식 오류**
- **최초 발생일**: 2025-08-01 13:15
- **에러 현상**:
    - 내보낸 CSV 파일을 Excel에서 열었을 때, 긴 ISBN 번호가 지수 표기법(예: `9.79113E+12`)으로 표시되는 문제.
- **해결 방법**:
    - CSV 생성 시 ISBN 값을 `="<ISBN_VALUE>"` 형식의 문자열로 감싸, Excel이 해당 셀을 텍스트로 인식하도록 강제했습니다.

### **1. TypeScript 타입 호환성 에러**
- **최초 발생일**: 2025-08-01 18:30
- **에러 현상**:
    - "Conversion of type 'BookData' to type 'Json' may be a mistake" 등 TypeScript 컴파일 에러 발생.
- **원인 분석**:
    - `StockInfo` interface가 Supabase의 `Json` 타입과 호환되지 않아 타입 캐스팅이 실패했습니다.
- **해결 방법**:
    - `StockInfo`를 interface에서 type alias로 변경하여 `Json` 타입과의 호환성을 확보했습니다.

---
*문서 최종 수정일: 2025-08-09*
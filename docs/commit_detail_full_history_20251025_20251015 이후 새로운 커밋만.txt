851abdb
ahnbu
Sat Oct 25 18:42:11 2025 +0900
fix(store): '좋아요' 적용 버그 수정 - 검색/필터된 책
검색이나 태그 필터를 통해 표시된 책(초기 로딩에 포함되지 않은)에 대해 '좋아요', 태그 추가/삭제 등의 상태 변경 기능이 동작하지 않던 버그를 수정했습니다.

원인은 상태 업데이트 함수(`toggleFavorite`)가 오직 초기 로딩된 `myLibraryBooks` 배열에서만 대상 책을 찾았기 때문입니다.

이 문제를 해결하기 위해, 해당 함수들이 `myLibraryBooks.find()` 대신 모든 데이터 소스(초기 목록, 검색 결과, 필터 결과)를 포괄적으로 조회하는 `getBookById` 함수를 사용하도록 수정하여, 어떤 뷰에서든 모든 책에 대한 상태 변경이 정상적으로 처리되도록 보장했습니다.


b303898
ahnbu
Sat Oct 25 18:32:14 2025 +0900
fix(store): API 실패 시 데이터 유실 방지를 위한 복원 로직 강화
기존 재고 정보 갱신 로직은 `error` 프로퍼티가 명시된 응답에 대해서만 실패로 간주했습니다.

이로 인해, API가 `undefined`나 빈 객체(`{}`)와 같은 비정상 응답을 반환할 경우, 시스템이 이를 성공으로 오판하여 기존에 저장되어 있던 유효한 데이터를 `undefined`로 덮어쓰는 심각한 데이터 유실 버그가 있었습니다.

이 문제를 해결하기 위해, `useBookStore`의 `refreshBookInfo` 함수 내 데이터 병합 로직을 다음과 같이 개선했습니다:

- **통합된 복원 규칙 적용:** 각 도서관 API의 특정 에러 구조를 개별적으로 확인하는 대신, '새로운 데이터가 `undefined` 또는 `null`이면 기존 데이터를 유지한다'는 하나의 단순하고 강력한 규칙을 모든 도서관 정보 필드에 일관되게 적용했습니다.

- **코드 단순화 및 안정성 향상:** 이 변경으로 복원 로직이 훨씬 간결해졌으며, 향후 API 응답 형식이 변경되더라도 데이터 유실을 방지할 수 있는 견고한 구조를 갖추게 되었습니다.


40f31f7
ahnbu
Sat Oct 25 18:02:30 2025 +0900
feat(ui): 상세 모달의 긴 제목을 2줄로 제한
`MyLibraryBookDetailModal`에서 매우 긴 책 제목이 레이아웃을 해치는 문제를 해결합니다.

- 제목(`h3`) 요소에 `line-clamp-2` Tailwind CSS 유틸리티를 적용하여 최대 2줄까지만 표시하고, 나머지는 말줄임표(`...`)로 처리합니다.
- `title` 속성을 추가하여, 사용자가 잘린 제목 위에 마우스를 올리면 전체 제목을 툴팁으로 확인할 수 있도록 UX를 개선했습니다.


8ddd742
ahnbu
Sat Oct 25 17:54:23 2025 +0900
refactor(ux): API 실패 시 "조회중.." 반복 표시 개선 및 안정성 강화
API 조회 실패로 인해 데이터가 `null`로 저장되었을 때, UI가 일관성 없이 동작하던 문제를 해결하고, 정보 제공의 계층화 전략을 도입하여 사용자 경험을 개선합니다.

### 문제점

-   **상세 모달:** API 실패로 `book.siripEbookInfo` 등이 `null`이 되면, `isLoading` 조건(`!book.siripEbookInfo`)이 `true`로 계속 평가되어 "조회중..." 상태가 무한히 표시되는 버그가 있었습니다.
-   **서재 목록:** `null` 값을 에러로 간주하지 않아, 조회 실패가 "재고 없음"(회색 점)으로 표시되었습니다. 이는 정확한 정보 전달 측면에서 개선의 여지가 있었습니다.

### 새로운 UX 전략: 정보 제공의 계층화

사용자가 느끼는 시각적 스트레스와 정보의 정확성 사이의 균형을 맞추기 위해, 컴포넌트별로 다른 정보 표시 전략을 채택했습니다.

1.  **서재 목록 (`MyLibrary.tsx`): 시각적 안정감 우선**
    -   API 실패 시에도 기존처럼 **회색 점**과 `(0/0)`을 표시하여, 훑어보는 과정에서 빨간 점이 주는 미묘한 스트레스를 줄입니다. 사용자는 이를 '재고 없음'으로 빠르게 인지하고 넘어갈 수 있습니다.

2.  **상세 모달 (`MyLibraryBookDetailModal.tsx`): 정보 정확성 우선**
    -   사용자가 상세 정보를 확인하고자 할 때는, API 실패(조회 불가)와 재고 없음(조회 성공)의 차이를 명확히 구분하여 전달합니다. 실패 시 **에러 상태(빨간색 텍스트)**를 명확히 표시합니다.

### 주요 변경 사항

-   **`MyLibraryBookDetailModal.tsx`:**
    -   **"조회중..." 무한 루프 버그 해결:** `StockDisplay`로 전달하는 `isLoading` prop의 조건을 `!book.someInfo`에서 `book.someInfo === undefined`로 변경했습니다. 이를 통해 `null`(값 없음)과 `undefined`(로딩 전) 상태를 명확히 구분하여, `null`일 때 더 이상 로딩 상태로 간주하지 않도록 수정했습니다.
    -   **에러 표시 강화:** `StockDisplay` 내부 로직을 개선하여, `null` 값이나 `error` 객체가 전달될 경우 `hasError`로 판단하고 에러 상태를 명확히 표시하도록 안정성을 강화했습니다.

-   **`MyLibrary.tsx`:**
    -   "실패 시 회색 점 표시"라는 UX 전략에 따라, `isError` 로직을 수정하지 않고 현재 상태를 유지하기로 결정했습니다. `null` 값은 의도적으로 '재고 없음' 상태로 표시됩니다.

### 기대 효과

-   API의 일시적인 실패가 발생해도 상세 모_branch-2_branch-3달에서 "조회중..." 상태에 갇히는 치명적인 UX 버그를 해결했습니다.
-   서재 목록에서는 시각적 피로도를 낮추고, 상세 정보에서는 정확한 상태를 전달하는 계층적인 UX를 구현하여 전반적인 사용성을 향상시켰습니다.


b14ec89
ahnbu
Fri Oct 24 20:21:02 2025 +0900
feat(perf): Cloudflare Cache API 도입하여 API 응답 캐싱 구현
`POST` 요청에 대한 도서관 재고 확인 API의 응답을 캐싱하는 기능을 도입하여, 반복적인 요청에 대한 응답 속도를 비약적으로 향상시키고 외부 API 부하를 줄입니다.

### 주요 변경 사항

1.  **POST 요청 캐싱 전략 도입:**
    -   Cloudflare의 Cache API가 기본적으로 `GET` 요청만 지원하는 제약을 우회하기 위해, `POST` 요청의 본문(body)을 SHA-256으로 해싱하여 고유한 캐시 키를 생성했습니다.
    -   생성된 해시 값을 URL 경로에 포함시킨 `GET` 요청 형태로 캐시 키를 "위장"하여, `POST` 요청의 본문 내용별로 독립적인 캐싱이 가능하도록 구현했습니다.

2.  **캐시 로직 구현:**
    -   API 요청 수신 시, 먼저 생성된 캐시 키로 캐시 저장소(`caches.default`)를 조회합니다.
    -   **Cache HIT:** 캐시된 응답이 존재할 경우, 실제 크롤링을 생략하고 즉시 캐시된 데이터를 반환합니다. 응답 헤더에 `X-Cache-Status: HIT`를 추가하여 동작을 명확히 했습니다.
    -   **Cache MISS:** 캐시가 없을 경우, 기존 크롤링 로직을 수행하고, 생성된 응답을 사용자에게 반환하는 동시에 `ctx.waitUntil`을 사용하여 백그라운드에서 캐시에 저장합니다.

3.  **캐시 만료 시간(TTL) 설정:**
    -   캐시의 유효 기간을 2시간(`expirationTtl: 7200`)으로 설정하여 데이터의 최신성과 성능 사이의 균형을 맞췄습니다.

### 기대 효과

-   **성능 향상:** 캐시 히트 시, API 응답 시간이 수 초에서 수십 밀리초 단위로 단축됩니다.
-   **안정성 강화:** 외부 도서관 서버의 일시적인 오류나 점검 시에도, 캐시된 데이터를 통해 사용자에게 안정적인 서비스를 제공할 수 있습니다.
-   **외부 리소스 보호:** 동일한 요청에 대한 반복적인 크롤링을 방지하여 대상 도서관 서버의 부하를 줄입니다.


36aa1ca
ahnbu
Fri Oct 24 19:53:00 2025 +0900
fix(store): API 부분 실패 시 데이터가 초기화되는 버그 수정
`refreshBookInfo` 로직을 개선하여, 일부 도서관 API 응답에만 에러가 포함된 경우 해당 데이터가 `0/0`으로 초기화되지 않고 기존 DB 값을 유지하도록 수정합니다.

- `finalBookData` 생성 시, 각 API 정보 객체 내부의 `error` 필드를 명시적으로 확인.
- 에러가 있는 정보 블록만 선별하여 기존 데이터로 복원하는 로직 추가.
- API의 간헐적 실패에 대한 데이터 복원력(Resilience) 강화.


2ade7f2
ahnbu
Fri Oct 24 19:38:40 2025 +0900
fix(modal): 상세 모달의 'API' 버튼 기능을 DB 데이터 조회로 복원
상세 정보 모달(`MyLibraryBookDetailModal`)의 'API' 버튼 클릭 시, 실시간으로 외부 API를 호출하던 동작을 수정하여 원래 의도대로 Supabase DB에 저장된 `book_data`를 조회하도록 복원합니다.

### 문제점

-   현재 'API' 버튼은 DB에 저장된 최신 API 응답 스냅샷을 보여주는 대신, 불필요하게 실시간으로 외부 API(알라딘, 도서관)를 재호출하고 있었습니다.
-   이는 원래의 "DB 데이터 확인" 목적과 맞지 않으며, 불필요한 네트워크 요청을 유발했습니다.

### 해결 방안

-   `handleApiButtonClick` 함수의 로직을 `useBookStore`의 `fetchRawBookData(book.id)`를 호출하는 방식으로 변경했습니다.
-   `fetchRawBookData`는 Supabase의 `user_library` 테이블에서 해당 책의 `book_data` JSON 컬럼을 직접 조회하는 역할을 합니다.
-   JSON 뷰어 모달의 제목 프리픽스를 `[API]`에서 `[DB]`로 변경하여, 표시되는 데이터가 실시간이 아닌 데이터베이스 스냅샷임을 명확히 했습니다.

### 기대 효과

-   **기능 정상화:** 'API' 버튼이 "DB에 저장된 마지막 API 응답 확인"이라는 본래의 기능으로 올바르게 동작합니다.
-   **성능 개선:** 불필요한 외부 API 호출을 제거하여 응답 속도를 개선하고 리소스를 절약합니다.
-   **사용자 경험:** 데이터의 출처(`[DB]`)를 명확히 하여 혼동을 방지합니다.


9345ce3
ahnbu
Fri Oct 24 19:32:55 2025 +0900
feat(data): 책 상세 내 API 응답 시간 표시 에러 해결 & 관련 코드 리팩토링
API 정보의 최신성을 나타내는 `lastUpdated` 타임스탬프를 도입하고, 이를 관리하는 데이터 아키텍처를 개선합니다. 이를 통해 재고 정보가 언제 기준인지 명확히 표시하고, 관련 데이터 흐름을 일관성 있게 만듭니다.

### 주요 변경 사항

1.  **데이터 모델 (`types.ts`):**
    -   `BookDataSchema`의 API 정보 그룹(`ApiCombinedBookDataSchema`)에 `lastUpdated: z.number().optional()` 필드를 추가하여 데이터 모델을 확장했습니다.
    -   `addedDate`(서재 추가 시점)와 `lastUpdated`(정보 갱신 시점)의 역할을 명확히 분리했습니다.

2.  **백엔드 API (Cloudflare Worker):**
    -   도서관 재고 확인 API(`/`) 응답의 최상위 레벨에 `lastUpdated: Date.now()`를 포함시켜, 모든 API 정보에 대한 단일 생성 시점을 제공하도록 수정했습니다.

3.  **데이터 처리 파이프라인 (`bookDataCombiner.ts`):**
    -   `createBookDataFromApis` 함수가 API 응답의 `lastUpdated` 값을 결과 객체(`ApiCombinedBookData`)에 포함하도록 책임을 위임했습니다.
    -   이를 통해 데이터 가공 로직을 중앙화하고 `useBookStore`의 복잡성을 줄였습니다.

4.  **상태 관리 (`useBookStore.ts`):**
    -   `refreshBookInfo` 함수에서 `createBookDataFromApis`가 반환한 `pureApiData`를 그대로 사용하여 `lastUpdated`가 자연스럽게 최종 데이터에 포함되도록 로직을 단순화했습니다.

5.  **UI (`MyLibraryBookDetailModal.tsx`):**
    -   재고 정보 업데이트 시간을 표시할 때 `book.ebookInfo.lastUpdated` 대신 `book.lastUpdated`를 참조하도록 수정했습니다.
    -   이를 통해 UI가 데이터의 내부 구조에 대한 의존성을 줄이고, 아키텍처를 개선했습니다.

### 해결된 문제

-   `MyLibraryBookDetailModal`에서 재고 정보 업데이트 시간이 `NaN`으로 표시되던 버그를 근본적으로 해결했습니다.


ac86da5
ahnbu
Fri Oct 24 01:05:13 2025 +0900
fix(ui): 그리드 뷰에서 첫 번째 열이 넓어지는 레이아웃 오류 수정
'내 서재'의 그리드 뷰에서 책 제목이 길 경우, 해당 아이템이 포함된 열의 너비가 다른 열보다 넓어지는 문제를 해결했습니다.

그리드 아이템 컨테이너에 `min-w-0` 클래스를 추가하여, 내부 콘텐츠(긴 제목)가 그리드 너비 계산에 영향을 주지 않도록 수정했습니다. 이를 통해 모든 열이 항상 균등한 너비를 유지하도록 보장합니다.


e7b644f
ahnbu
Fri Oct 24 00:57:59 2025 +0900
fix(api): API 응답의 `customTitle`이 `null`로 반환되는 오류 수정
**문제점:**
프론트엔드에서 `customTitle`을 설정하지 않은 채 재고 조회 API를 요청할 경우(`undefined` 또는 `null` 값으로 전송), 백엔드(Worker)에서 이 값을 제대로 처리하지 못하여 API 응답의 `customTitle` 필드가 `"customTitle": null`로 반환되는 문제가 있었습니다.

**원인:**
백엔드의 `fetch` 핸들러에서 구조 분해 할당 시 `customTitle = ''`와 같이 기본값을 설정했으나, 이는 요청 `body`에 `customTitle` 키가 아예 없을 때만 동작합니다. 키는 존재하되 값이 `null`인 경우에는 기본값이 적용되지 않고 `null`이 그대로 변수에 할당되었습니다.

**수정 내용:**
- `index.js`의 `fetch` 핸들러에서 `customTitle` 변수를 받은 직후, `customTitle = customTitle || '';` 코드를 추가하여 `null`이나 `undefined` 값을 빈 문자열(`''`)로 명시적으로 변환하도록 수정했습니다.

**기대 효과:**
- 이제 API는 `customTitle` 값이 없더라도 항상 `"customTitle": ""`와 같이 일관된 빈 문자열을 반환하여, 프론트엔드에서의 데이터 처리 안정성을 높입니다.


6a4656d
ahnbu
Thu Oct 23 23:44:53 2025 +0900
refactor(api): 신뢰도 문제로 인한 저자명 기반 재고 필터링 기능 제거
전자책 재고 조회 시 정확도를 높이기 위해 도입했던 저자명 필터링 기능이, 도서관별로 다른 저자명 표기(예: '게리 마커스' vs '개리 마커스')로 인해 오히려 정확한 재고를 누락시키는 문제를 유발했습니다.

이에 따라 기능의 신뢰성이 낮다고 판단하여 해당 필터링 로직을 백엔드에서 제거하기로 결정했습니다.

**주요 변경 사항:**

1.  **[백엔드] 저자 필터링 로직 제거**:
    - `index.js`(Cloudflare Worker)에서 `author` 정보를 받아 검색 결과를 필터링하고 요약 정보를 재계산하던 로직을 모두 제거했습니다.
    - 불필요해진 `normalizeAuthor` 헬퍼 함수를 삭제했습니다.

2.  **[프론트엔드] API 호출 시그니처 복원**:
    - 백엔드로 `author` 정보를 보내기 위해 수정했던 `useBookStore.ts`와 `unifiedLibrary.service.ts`의 `refreshBookInfo`, `fetchBookAvailability` 함수 시그니처 및 호출부를 원래대로 복원했습니다.
    - 이 과정에서 발생했던 연쇄적인 TypeScript 타입 오류들도 함께 해결되었습니다.

**유지되는 사항:**
- API 요청 시 `author`와 `customTitle` 파라미터를 보내고, 최종 응답에 해당 값들을 포함시키는 로직은 디버깅 편의성을 위해 그대로 유지합니다. 백엔드는 이 값들을 필터링에 사용하지 않고 그대로 반환만 합니다.

**기대 효과:**
- 저자명 표기 차이로 인해 재고가 누락되는 문제가 해결되어, 모든 전자책 도서관의 재고가 정확하게 집계 및 표시됩니다.
- 백엔드 로직이 단순화되어 유지보수성이 향상되었습니다.


a3b451d
ahnbu
Thu Oct 23 23:23:51 2025 +0900
feat(settings): 재고 일괄 갱신 기능 확장 및 오류 수정
맞춤설정의 '재고 일괄 갱신' 기능을 대폭 확장하고, 기존 기능의 오류를 수정하여 사용자 편의성과 안정성을 높였습니다.

### 1. 갱신 옵션 확장 (오래된 순, 범위 지정)

- **'오래된 순' 옵션 추가**: 기존의 '최근 n권' 방식에 더해, 재고 정보가 가장 오래된 책부터 갱신할 수 있는 '오래된 n권' 옵션을 추가했습니다.
- **'범위 지정' 기능 추가**: 사용자가 직접 갱신할 책의 순서 범위를(예: 100번째 ~ 250번째) 입력하여 특정 구간만 갱신할 수 있는 기능을 구현했습니다.
- **동적 옵션 UI**: 총 보유 권수에 따라 실행 불가능한 옵션(예: 10권 보유 시 '최근 25권')은 드롭다운 목록에서 자동으로 숨겨 사용자 혼동을 방지하도록 UX를 개선했습니다.

### 2. 백엔드 로직 리팩토링 (`useBookStore`)

- `bulkRefreshAllBooks` 함수의 시그니처를 변경하여, `limit` 대신 다양한 조건을 담을 수 있는 `options` 객체({ type, limit, start, end })를 받도록 수정했습니다.
- 이 변경을 통해, 함수 내부에서 `options.type`에 따라 분기하여 '최근순', '오래된순', '범위' 등 다양한 정렬 및 슬라이싱 로직을 유연하게 처리할 수 있도록 구조를 개선했습니다.

### 3. 프로그레스 바 표시 오류 수정

- **문제점**: '범위 지정' 갱신 시, 작업은 정상적으로 수행되었으나 프로그레스 바와 진행률 텍스트(예: n/8권)가 업데이트되지 않는 오류가 있었습니다.
- **수정 내용**: `SettingsModal`의 `handleStartBulkRefresh` 함수에서 `onProgress` 콜백 구현이 누락된 부분을 복원하고, 콜백이 호출될 때 `total` 값이 덮어쓰여지지 않도록 수정하여 `current` 값의 변화가 UI에 올바르게 반영되도록 했습니다.


06606a1
ahnbu
Thu Oct 23 22:45:05 2025 +0900
fix(settings): 재고 일괄 갱신 기능 오류 수정
맞춤설정의 '재고 일괄 갱신' 기능에서 발생하던 두 가지 주요 오류를 수정하여 안정성과 정확성을 개선했습니다.

### 1. 갱신 작업 취소 기능 오작동 문제 해결

- **문제점**: 재고 일괄 갱신이 진행되는 도중 '취소' 버튼을 눌러도, 실제 백그라운드 작업이 멈추지 않고 계속 실행되는 문제가 있었습니다.
- **원인**: `bulkRefreshAllBooks` 함수에 전달되는 `shouldCancel` 콜백이 항상 `false`를 반환하도록 하드코딩되어 있었고, 함수 내부에서도 취소 상태를 효과적으로 확인하지 못했습니다.
- **수정 내용**:
    - `useBookStore.ts`: `bulkRefreshAllBooks` 함수 내부의 `for` 루프와 `for...of` 루프에서 매 작업 단위마다 스토어의 `bulkRefreshState.isCancelled` 상태를 직접 확인하도록 로직을 강화했습니다.
    - `SettingsModal.tsx`: `bulkRefreshAllBooks`를 호출할 때 `shouldCancel` 콜백이 `useBookStore.getState().bulkRefreshState.isCancelled`를 참조하도록 수정하여, 취소 액션이 백그라운드 작업에 올바르게 전달되도록 수정했습니다.

### 2. 특정 수량(100/200권) 갱신 시 전체 서재 미적용 문제 해결

- **문제점**: "최근 100권" 또는 "200권" 갱신을 선택해도, 실제로는 현재 화면에 로드된 책(예: 50권)만을 대상으로 갱신이 실행되었습니다.
- **원인**: `bulkRefreshAllBooks` 함수가 현재 로컬 상태(`myLibraryBooks`)에 있는 책 목록만을 기준으로 대상을 선정했기 때문입니다.
- **수정 내용**:
    - `SettingsModal.tsx`: `handleStartBulkRefresh` 함수를 수정하여, 사용자가 선택한 갱신 수량이 현재 로드된 책의 수보다 많을 경우, `fetchRemainingLibrary()`를 먼저 호출하여 스토어의 `myLibraryBooks`를 전체 서재 목록으로 업데이트한 후에 갱신 작업을 시작하도록 변경했습니다.
    - `SettingsModal.tsx`: `handleDeleteTag` 함수가 오래된 `myLibraryBooks` 상태를 참조하는 잠재적 문제를 해결하기 위해, 함수 실행 시점에 `useBookStore.getState()`를 통해 최신 책 목록을 가져와 사용하도록 수정했습니다.


93ef11a
ahnbu
Thu Oct 23 21:00:46 2025 +0900
fix(core): 저자명(앞2글자) 매칭을 통한 재고 조회 정확성 개선
API 요청 로직을 개선하고 프론트엔드-백엔드 간 데이터 구조 불일치를 해결하여, 여러 도서관의 재고 정보가 정확하게 표시되도록 수정했습니다. 또한, 타입 정의 변경으로 인해 발생한 연쇄적인 오류들을 모두 해결했습니다.

### 1. 저자명 기반 전자책 필터링 기능 추가 (정확도 향상)

- **백엔드(Worker) 수정**:
    - 프론트엔드로부터 `author` 정보를 받아, 각 전자책 API 검색 결과에 대해 저자명을 비교하는 필터링 로직을 추가했습니다.
    - 저자명 비교 시 공백, 특수문자, '지은이' 등의 문구를 제거하는 `normalizeAuthor` 함수를 도입하여 비교 정확도를 높였습니다.
    - 필터링 후에는 각 도서관의 요약 정보(`total_count` 등)를 재계산하여 응답의 일관성을 확보했습니다.
- **프론트엔드 수정**:
    - 재고 정보 갱신(`refreshBookInfo`) 시 백엔드로 `author` 정보를 전달하도록 `fetchBookAvailability` API 호출부를 수정했습니다.

### 2. `refreshBookInfo` 함수 시그니처 불일치 오류 해결

- **문제점**: `refreshBookInfo` 함수에 `author` 인자를 추가하면서, `BookState` 타입 정의와 실제 호출부의 인자 개수가 일치하지 않아 TypeScript 오류(ts2322)가 발생했습니다.
- **수정 내용**:
    - `useBookStore.ts`의 `BookState` 인터페이스에 정의된 `refreshBookInfo` 시그니처에 `author: string`을 추가했습니다.
    - `MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`, `useBookStore.ts` 내에서 `refreshBookInfo`를 호출하는 모든 곳에 `book.author`를 네 번째 인자로 전달하도록 수정했습니다.

### 3. 백엔드 `customTitle` 참조 오류 해결

- **문제점**: 백엔드(Worker) API 핸들러에서 프론트엔드가 보낸 `customTitle`을 변수로 할당하지 않은 채 참조하여 'ReferenceError'가 발생했습니다.
- **수정 내용**: `index.js`의 `fetch` 핸들러에서 요청 본문을 파싱할 때 `customTitle`을 포함하도록 수정하여 오류를 해결했습니다.
- **개선**: 최종 API 응답(`responsePayload`)에도 요청 시 사용된 `author`와 `customTitle`을 포함시켜 디버깅 편의성을 높였습니다.


17b1b3e
ahnbu
Thu Oct 23 20:32:31 2025 +0900
fix(ui): 상세 모달의 'e경기' 재고 미반영 오류 수정
책 상세 정보 모달에서 'e경기' 소장형 전자책 재고가 누락되던 문제를 해결했습니다.

`MyLibrary.tsx`와 동일하게, ISBN 필터링 결과를 우선하던 로직을 제거하고 API 원본 데이터(`gyeonggiEbookInfo`)를 직접 참조하도록 수정하여 재고 집계의 일관성과 정확성을 확보했습니다.


fc5cc73
ahnbu
Thu Oct 23 20:26:20 2025 +0900
fix(stock): 전자책 재고 집계 오류 수정 (e경기, e교육)
일부 전자책 도서관의 재고가 UI에 올바르게 반영되지 않는 두 가지 문제를 해결했습니다.

### 1. 'e경기' 소장형 전자책 재고 미반영 문제 해결

- **문제점**: 'e경기(경기도 전자도서관)'의 경우, '소장형' 전자책의 ISBN이 종이책 ISBN과 다를 때, 프론트엔드의 ISBN 필터링 로직에 의해 재고가 0으로 처리되는 문제가 있었습니다. 이로 인해 구독형 재고는 보이지만 소장형 재고는 누락되었습니다.
- **수정 내용**:
    - `MyLibrary.tsx` (카드/그리드 뷰)와 `MyLibraryBookDetailModal.tsx`에서 'e경기' 재고를 표시할 때, ISBN으로 필터링된 `filteredGyeonggiEbookInfo`를 우선적으로 참조하던 로직을 제거했습니다.
    - 이제 항상 API 원본 결과인 `gyeonggiEbookInfo`를 직접 사용하여 소장형과 구독형 재고를 모두 정확하게 합산하여 표시합니다.

### 2. 'e교육' 전자책 재고 미반영 문제 해결

- **문제점**: 'e교육(경기도교육청 전자도서관)' 재고가 API 응답에는 존재함에도 불구하고 UI에 항상 `0/0`으로 표시되었습니다. 이는 백엔드에서 보낸 요약 정보 객체(`ebookInfo.total_count`)와 UI에서 기대하던 데이터 구조(`ebookInfo.summary.total_count`) 간의 불일치 때문에 발생했습니다.
- **수정 내용**:
    - `bookDataCombiner.ts`를 복잡하게 수정하는 대신, 코드 일관성을 위해 UI 컴포넌트(`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)에서 데이터에 접근하는 방식을 수정했습니다.
    - `ebookInfo.summary.total_count`와 같이 `.summary`를 통해 접근하던 모든 코드를 `ebookInfo.total_count`로 직접 접근하도록 변경하여, 'e경기'와 동일한 방식으로 데이터를 처리하도록 통일했습니다.
    - 이와 함께 불필요해진 `bookDataCombiner.ts`의 데이터 변환 로직을 원래의 단순한 형태로 복구했습니다.


010c488
ahnbu
Thu Oct 23 19:45:18 2025 +0900
fix(tags): 태그 색상(책상세) 및 개수 표시 오류(맞춤설정) 수정
태그 기능과 관련된 두 가지 주요 오류를 수정하여 UI의 정확성과 일관성을 개선했습니다.

### 1. 책 상세 모달의 태그 색상 미적용 문제 해결

- **문제점**: 책 상세 정보 모달(`MyLibraryBookDetailModal`)에서 '선택된 태그'와 '사용 가능한 태그'를 표시할 때, 각 태그에 설정된 고유 색상(`primary`, `secondary`, `tertiary`)이 아닌, 고정된 색상으로 렌더링되고 있었습니다.
- **수정 내용**: `CustomTagComponent`에 `tag` 객체를 전달할 때, 색상 속성을 하드코딩하던 부분을 제거하고 태그 객체를 그대로 전달하도록 수정했습니다.
- **기대 효과**: 이제 상세 모달에서도 각 태그가 맞춤설정에서 지정된 원래 색상으로 올바르게 표시됩니다.

### 2. 맞춤설정의 태그별 도서 개수 부정확 문제 해결

- **문제점**: 맞춤설정(`SettingsModal`)의 '태그 관리' 탭에서 각 태그 옆에 표시되는 도서 개수가, 현재 로드된 일부 도서만을 기준으로 계산되어 전체 서재 기준의 정확한 수치와 달랐습니다.
- **수정 내용**:
    - 개수 계산 로직을 `getTagUsageCount` 함수 호출 방식에서, `useBookStore`로부터 미리 계산된 전체 서재 기준의 `tagCounts` 객체를 직접 참조하는 방식으로 변경했습니다.
    - `useMemo`의 의존성 배열을 `tagCounts`로 올바르게 수정하여, 태그 사용량이 변경될 때마다 정렬 순서가 정확하게 업데이트되도록 수정했습니다.
- **기대 효과**: 태그 관리 화면에서 표시되는 모든 태그의 사용 횟수가 전체 서재 기준으로 정확하게 표시되어 데이터의 신뢰성을 확보했습니다.


3c0e1f5
ahnbu
Thu Oct 23 19:27:57 2025 +0900
feat(ui): 태그 관련 확인 및 상태 메시지의 정보성 강화
태그 기능과 관련된 UI 텍스트의 가독성과 정보성을 높여 사용자 경험을 개선했습니다. 기존에는 선택된 태그의 '개수'만 표시하여 사용자가 내용을 다시 확인해야 하는 불편함이 있었으나, 이제는 태그의 '이름'을 직접 표시하여 직관성을 높였습니다.

### 1. 일괄 태그 관리 모달 메시지 개선

- **변경 내용**: '일괄 태그 관리' 모달에서 추가할 태그를 선택했을 때 표시되는 확인 메시지를 수정했습니다.
- **AS-IS**: `{n}개 태그를 {m}권의 책에 추가합니다.`
- **TO-BE**: `{m}권의 책에 다음 태그를 추가합니다 : {태그1}, {태그2}...`
- **기대 효과**: 사용자가 '적용' 버튼을 누르기 전에 어떤 태그들이 추가될 것인지 명확히 인지할 수 있어, 실수로 잘못된 태그를 추가하는 경우를 방지하고 작업에 대한 확신을 높입니다.
- **수정 파일**: `MyLibrary.tsx` (내부 `BulkTagModal` 컴포넌트)

### 2. 내 서재 태그 필터 상태 메시지 개선

- **변경 내용**: '내 서재'에서 태그로 필터링할 때 하단에 표시되는 상태 메시지를 수정했습니다.
- **AS-IS**: `{n}개의 태그로 필터링됨`
- **TO-BE**: `태그 필터링 : {선택된 태그1}, {선택된 태그2}...`
- **기대 효과**: 사용자가 현재 어떤 태그 조건으로 도서 목록을 보고 있는지 항상 명확하게 확인할 수 있어, 현재 필터링 상태에 대한 컨텍스트를 쉽게 파악할 수 있습니다.
- **수정 파일**: `TagFilter.tsx`


be7101c
ahnbu
Thu Oct 23 19:19:07 2025 +0900
fix(ui): 내 서재 뷰 태그 정렬 일관성 보장
`TagFilter`와 `SettingsModal`에 최근 구현된 태그 정렬 로직이 `MyLibrary` 컴포넌트의 개별 도서에 표시되는 태그에는 적용되지 않아 사용자 경험의 일관성이 저하되는 문제가 있었습니다.

이번 커밋은 카드뷰와 그리드뷰 모두에서 태그를 렌더링하기 전에 `book.customTags` 배열에 정렬 로직을 추가하여 이 문제를 해결합니다.

**주요 변경 사항:**

- **태그 정렬 로직 추가**: `MyLibrary.tsx`의 카드뷰와 그리드뷰에서 태그를 렌더링하기 전에, 정의된 색상 우선순위(`primary > secondary > tertiary`)에 따라 정렬하는 로직을 추가했습니다.
- **TypeScript 오류 수정**: 정렬 로직에 사용된 `TagColor` 타입을 `MyLibrary.tsx` 파일에 import하여, '타입을 찾을 수 없음 (ts2304)' 오류를 해결했습니다.


926af0f
ahnbu
Thu Oct 23 00:17:51 2025 +0900
feat: 태그 필터링 개선 및 신규 색상 추가
태그 시스템의 필터링 기능과 시각적 옵션을 확장하고, 정렬 로직을 개선했습니다.

### 1. 태그 필터링 및 정렬 기능 강화 (내 서재)

- **표시 제한 해제**: '내 서재' 상단의 태그 필터에서 인기도 상위 10개의 태그만 표시되던 제한을 제거했습니다. 이제 사용된 적이 있는 모든 태그가 목록에 표시됩니다.
- **정렬 순서 변경**: 태그 필터와 맞춤설정의 태그 목록 정렬 순서를 통일하고, 최종적으로 **`기본(primary) > 보조(secondary) > 연보라(tertiary)`** 색상 순으로 1차 정렬 후, 각 색상 그룹 내에서 인기도(사용 횟수)가 높은 순으로 2차 정렬되도록 로직을 수정했습니다.

### 2. 신규 '연보라(tertiary)' 태그 색상 추가

- **신규 색상 옵션**: 맞춤설정의 태그 관리에서 '연보라' 색상을 선택하여 태그를 생성할 수 있도록 기능을 추가했습니다.
- **디자인 시스템 적용**:
    - `types.ts`, `CustomTag.tsx`, `SettingsModal.tsx`에 'tertiary' 타입을 추가했습니다.
    - `index.css`에 `.tag-tertiary` 스타일을 추가하되, 기존 `.btn-secondary`의 색상 변수를 활용하고, 다른 태그들과 시각적 일관성(투명 테두리, `oklch` hover 효과 등)을 유지하도록 정의했습니다.


d242af5
ahnbu
Wed Oct 22 23:35:03 2025 +0900
feat: 도서 상세 모달의 태그 버튼 전체 클릭으로 변경 (기존에는 +, x만 클릭 가능)
이번 커밋은 도서 상세 정보 모달 내 태그 관리 기능의 사용자 경험과 기술적 정확성을 개선하는 데 중점을 두었습니다.

- **태그 클릭 경험 개선 및 Optimistic UI 적용:**
  - 태그 생성 및 삭제 기능에 Optimistic UI(낙관적 UI) 패턴을 적용했습니다. 이제 UI는 백그라운드에서 비동기 작업이 완료되는 동안 해당 태그를 시각적으로 비활성화하여 즉시 응답하며, 훨씬 부드러운 사용자 경험을 제공합니다.
  - 기존의 아이콘만 클릭 가능했던 방식에서, 태그 전체 영역을 클릭하여 태그를 추가하거나 제거할 수 있도록 개선했습니다.

- **중첩 오류 방지를 위한 `CustomTagComponent` 리팩토링:**
  - `<button>` 내부에 또 다른 `<button>`이 중첩되어 발생하던 HTML 유효성 오류 및 React Hydration 경고를 해결하기 위해 `CustomTagComponent`를 리팩토링했습니다.
  - 이제 이 컴포넌트는 내부에 중첩된 버튼 없이 단일 `<button>` 요소로 작동합니다. 클릭 핸들러(`onAdd`, `onClose`, `onClick`)는 컴포넌트 자체에서 직접 관리합니다.

- **React "Rules of Hooks" 위반 오류 수정:**
  - `if (!book)`과 같은 조기 반환 구문 뒤에서 Hook(`useState`, `useCallback`)이 조건부로 호출되어 발생하던 심각한 오류를 수정했습니다.
  - 모든 Hook을 `MyLibraryBookDetailModal` 컴포넌트의 최상단으로 이동시켜, 모든 렌더링에서 동일한 순서로 호출되도록 보장함으로써 "Rules of Hooks"를 준수하도록 변경했습니다.


c6ccdd2
ahnbu
Wed Oct 22 19:00:30 2025 +0900
refactor : 주석 정리


57b8451
ahnbu
Wed Oct 22 18:56:06 2025 +0900
fix: 초기 로드되지 않은 도서의 중복 체크 오류 해결
**문제 원인**
검색 결과 모달에서 도서의 중복 여부를 검사할 때, 페이지네이션으로 로드된 `myLibraryBooks` 배열(초기 50권)만을 대상으로 하여, 서재에 있지만 아직 로드되지 않은 책들은 중복으로 인식하지 못하는 문제가 있었음.

또한, 데이터 소스(Supabase, Aladin API) 간의 미세한 데이터 차이(보이지 않는 공백, 타입 불일치)로 인해 ISBN 문자열 비교가 실패하는 현상도 발견됨.

**해결 방안**
1.  **전체 ISBN 목록 관리**: `useBookStore`에 `myLibraryIsbnSet`을 도입하여, 앱 로딩 시 Supabase RPC를 통해 사용자의 전체 서재 ISBN 목록을 미리 로드하고 Set에 저장함. 이를 통해 중복 체크가 전체 데이터를 대상으로 하도록 변경.

2.  **효율적인 중복 검사**: `isBookInLibrary` 함수를 새로 만들어, 배열 순회(`Array.some`) 대신 `Set.has()`를 사용하도록 개선. 이로써 중복 검사 성능이 O(N)에서 O(1)으로 향상됨.

3.  **데이터 정규화**: 모든 ISBN 값을 저장하거나 비교하기 전에 `.toString().trim()`을 적용하여, 양쪽 데이터 소스의 공백 및 타입 불일치 문제를 해결하고 비교의 정확성을 보장함.

4.  **상태 동기화**: `addToLibrary`, `removeFromLibrary` 액션이 실행될 때 `myLibraryIsbnSet`의 상태도 함께 업데이트하도록 하여 데이터 정합성을 유지함.


f1bb5ef
ahnbu
Wed Oct 22 18:36:01 2025 +0900
fix(ui): 서재 UI 데이터 동기화 및 초기 상태 오류 수정
내 서재의 사용자 경험을 저해하는 두 가지 주요 버그를 수정했습니다.

1.  **검색/필터 결과에서 아이템 삭제 시 UI 즉시 반영**
    -   **문제**: 내 서재 검색 또는 태그 필터링 결과 화면에서 책을 삭제해도, UI가 새로고침 전까지 변경되지 않는 문제가 있었습니다.
    -   **원인**: `removeFromLibrary` 함수가 `myLibraryBooks` 상태 배열만 업데이트하고, `librarySearchResults`, `libraryTagFilterResults`는 업데이트하지 않았기 때문입니다.
    -   **해결**: `removeFromLibrary` 함수 로직을 수정하여, 관련된 모든 상태 배열(`myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`)에서 삭제된 아이템을 동시에 제거하도록 변경했습니다. 이를 통해 어떤 뷰에서든 삭제가 즉시 UI에 반영됩니다.

2.  **신규 도서 추가 시 도서관 초기 상태 오류 수정**
    -   **문제**: 새로운 책을 서재에 추가했을 때, '퇴촌' 및 '기타' 도서관의 재고 상태 점이 불필요하게 오류를 의미하는 빨간색으로 표시되었습니다.
    -   **원인**: `addToLibrary` 함수에서 `gwangjuPaperInfo`의 초기값을 에러 객체(`{ error: '...' }`)로 설정했기 때문입니다.
    -   **해결**: `gwangjuPaperInfo`의 초기값을 다른 도서관 정보와 동일하게 `null`로 변경하여, 모든 도서관이 일관되게 정상 상태(회색 점)로 표시되도록 수정했습니다.

### 현재 문제점 (TODO)

-   초기 로드된 50권 이외의 책에 대해 "추가됨" 상태가 UI에 정상적으로 표시되지 않는 문제가 남아있음.
-   `fetchUserLibrary`에서 RPC 호출 결과를 `myLibraryIsbnSet`에 채우는 과정에 문제가 있는 것으로 추정되며, 추가 디버깅이 필요함.


66c88f1
ahnbu
Wed Oct 22 17:34:28 2025 +0900
fix(data): 재고 조회 실패 시 기존 데이터 유지하도록 로직 개선
API를 통한 도서관 재고 정보 새로고침이 실패했을 때, 기존에 저장되어 있던 재고 수량이 `0/0`으로 초기화되던 문제를 해결했습니다. 이제 API 호출이 실패하더라도 과거 재고 데이터를 그대로 유지하면서, UI상으로는 에러 상태(빨간색 점)만 표시하여 사용자 경험을 향상시켰습니다.

### 문제 상황

-   `refreshBookInfo` 실행 시 특정 도서관 API(예: `gwangju_paper`) 호출이 타임아웃 등으로 실패하는 경우.
-   `createBookDataFromApis` 함수가 해당 재고 정보(`toechonStock` 등)를 `0/0`으로 초기화하여 반환.
-   `refreshBookInfo` 함수가 이 초기화된 값으로 `book_data`를 업데이트하여 DB에 저장.
-   결과: `(녹색)퇴촌(3/2)` -> 새로고침 실패 -> `(빨간색)퇴촌(0/0)`으로 표시되어 기존 정보가 유실됨.

### 해결 방안

1.  **데이터 조합 로직 수정 (`utils/bookDataCombiner.ts`)**
    -   `createBookDataFromApis` 함수에서 API 호출 실패 시 재고 정보(`toechonStock` 등)를 생성하는 `else` 블록을 제거했습니다.
    -   이제 API가 실패하면 해당 재고 속성은 `undefined`로 남게 되어, "데이터 없음"을 명시적으로 표현합니다.

2.  **데이터 병합 로직 개선 (`useBook-store.ts`)**
    -   `refreshBookInfo` 함수에서 최종 데이터 객체를 생성할 때 Nullish Coalescing Operator (`??`)를 사용했습니다.
    -   `createBookDataFromApis`로부터 받은 객체의 속성이 `undefined`일 경우(즉, API 실패), `originalBook`(DB의 기존 데이터)의 값을 사용하도록 로직을 변경했습니다.
    -   `toechonStock: pureApiData.toechonStock ?? originalBook.toechonStock` 와 같은 형태로, 성공한 데이터는 업데이트하고 실패한 데이터는 기존 값을 유지합니다.

### 기대 효과

-   **(원하는 동작 구현)**: `(녹색)퇴촌(3/2)` -> 새로고침 실패 -> `(빨간색)퇴촌(3/2)`로 표시됩니다.
-   **정보 보존**: 일시적인 네트워크 오류로 인해 유용한 과거 재고 정보가 사라지는 것을 방지합니다.
-   **견고성 향상**: 각 도서관 API의 개별적인 실패가 다른 데이터에 영향을 주지 않도록 데이터 파이프라인의 견고성을 높였습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


1e14988
ahnbu
Wed Oct 22 17:28:27 2025 +0900
feat(data): 데이터 중복 저장 방지를 위한 이중 방어 체계 구축
프론트엔드(UI)와 백엔드(DB) 양단에 중복 데이터 방지 로직을 구현하여 데이터 무결성을 강화했습니다. 사용자가 실수로 동일한 책을 중복 추가하는 것을 방지하고, 만약의 경우에도 데이터베이스 레벨에서 중복 저장을 원천적으로 차단합니다.

### 1. 백엔드(DB) 개선: UNIQUE 제약 조건 설정 (근본적인 해결)

-   **`user_library` 테이블에 UNIQUE 인덱스 추가**
    -   `user_id`와 `book_data` JSONB 컬럼 내부의 `isbn13` 값을 조합하여 고유 키로 설정했습니다.
    -   SQL: `CREATE UNIQUE INDEX ... ON public.user_library (user_id, (book_data->>'isbn13'))`
    -   이를 통해 동일한 사용자가 동일한 ISBN13의 책을 두 번 이상 저장하려는 시도를 데이터베이스 레벨에서 차단합니다.
    -   프론트엔드 로직에 버그가 발생하거나 API가 직접 호출되더라도 데이터 무결성이 보장됩니다.

-   **기존 중복 데이터 정리**
    -   UNIQUE 인덱스 설정을 위해, 기존에 존재하던 중복 데이터를 식별하고 안전하게 제거하는 스크립트를 실행했습니다.

### 2. 프론트엔드(UI) 로직 강화 (사용자 경험 개선)

-   **`BookDetails.tsx` (도서 상세 뷰)**
    -   `useMemo`를 사용하여 현재 선택된 책이 `myLibraryBooks`에 이미 존재하는지 실시간으로 확인합니다 (`isBookInLibrary`).
    -   책이 이미 서재에 있을 경우, "내 서재에 추가" 버튼을 비활성화(`disabled`)하고 버튼 텍스트를 "서재에 이미 있음"으로 변경하여 사용자에게 명확한 피드백을 제공합니다.

-   **`BookSearchListModal.tsx` (검색 결과 모달)**
    -   검색 결과 목록에서 이미 서재에 추가된 책에 대해 "추가됨" 배지를 표시하여 시각적으로 구분합니다.
    -   이미 추가된 책을 클릭할 경우, 책을 다시 추가하는 대신 해당 책의 상세 정보 모달(`MyLibraryBookDetailModal`)을 열어주는 UX 흐름을 유지하여, 사용자가 기존에 저장된 정보를 쉽게 확인할 수 있도록 했습니다.

### 기대 효과

-   **데이터 무결성 확보**: 어떤 경우에도 `user_library` 테이블에 사용자별 중복 도서가 저장되지 않습니다.
-   **사용자 경험 향상**: 사용자는 책 추가 가능 여부를 직관적으로 인지할 수 있으며, 중복 추가 시도가 차단됩니다.
-   **시스템 안정성 증가**: 프론트엔드와 백엔드가 각자의 위치에서 중복을 검증하는 이중 방어 체계를 구축하여 시스템 전체의 안정성을 높였습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


c27a02b
ahnbu
Wed Oct 22 17:08:10 2025 +0900
refactor(data): 데이터 파이프라인 안정성 강화 및 타입 시스템 리팩토링
데이터 처리의 핵심 파이프라인을 리팩토링하여 타입 안정성과 런타임 견고성을 크게 향상시켰습니다. API 응답 실패 시 발생하던 렌더링 오류를 근본적으로 해결하고, 데이터 구조를 명확하게 정의하여 유지보수성을 높였습니다.

### 주요 변경 사항

1.  **타입 시스템 강화 (types.ts)**
    -   `BookData`, `SelectedBook` 등 핵심 타입을 순수 TypeScript `type`에서 **Zod 스키마 기반으로 전환**하여 런타임 유효성 검증을 추가했습니다.
    -   `ApiCombinedBookData` 타입을 신규 정의하여, API로부터 조합된 순수 정보와 사용자의 활동 정보를 명확히 분리했습니다.

2.  **데이터 조합 로직 개선 (utils/bookDataCombiner.ts)**
    -   `combineApiResults` 함수를 `createBookDataFromApis`로 변경하고, 명시적인 `ApiCombinedBookData` 타입을 반환하도록 수정했습니다.
    -   API 응답이 실패하거나 특정 필드가 누락된 경우에도, `toechonStock`, `ebookInfo` 등의 속성이 기본값(`null` 또는 `{...}`)으로 항상 존재하도록 보장하여 데이터 구조의 일관성을 확보했습니다.

3.  **상태 관리 로직 업데이트 (useBook-store.ts)**
    -   `refreshBookInfo`, `addToLibrary` 함수에서 새로 정의된 `createBookDataFromApis`를 사용하도록 수정하여, DB에 저장되는 데이터의 무결성을 강화했습니다.
    -   `updateBookInStoreAndDB` 헬퍼 함수를 개선하여 `note`와 같은 최상위 컬럼과 `book_data` 내부 필드 업데이트를 모두 안전하게 처리하도록 수정했습니다.

4.  **UI 렌더링 안정성 확보 (MyLibrary.tsx, MyLibraryBookDetailModal.tsx)**
    -   데이터 객체의 속성에 접근하는 모든 부분에 **연쇄적인 Optional Chaining (`?.`)**을 적용했습니다.
    -   이를 통해 DB에 저장된 데이터 구조가 불완전하더라도 런타임 에러 없이 페이지가 안전하게 렌더링 되도록 방어 코드를 강화했습니다.

### 해결된 문제

-   API 응답 실패 시, `summary`나 `total_count` 등이 없는 불완전한 객체가 DB에 저장되어 페이지 로딩 시 `TypeError`가 발생하던 문제를 해결했습니다.
-   이제 `refreshBookInfo` 실패 후 페이지를 새로고침해도 앱이 크래시되지 않습니다.

Closes #<이슈_번호> (관련 이슈가 있다면)


5e61627
ahnbu
Mon Oct 20 23:30:11 2025 +0900
refactor(core): API 응답 처리 파이프라인 재구축 및 데이터 흐름 개선
프로젝트의 핵심 데이터 처리 로직인 API 응답 조합 및 저장 파이프라인을 전면적으로 리팩토링했습니다. 이번 작업은 데이터의 일관성을 확보하고, 관심사를 명확히 분리하여 코드의 안정성과 유지보수성을 대폭 향상시키는 것을 목표로 합니다.

### 1. 타입 아키텍처 재정립 (Phase 1)

-   **타입 정의 중앙화**: `services/unifiedLibrary.service.ts`에 분산되어 있던 모든 API 관련 타입을 `types.ts`로 이전하여, `types.ts`를 타입 정의의 유일한 출처(Single Source of Truth)로 확립했습니다.
-   **의존성 구조 개선**: `types.ts` <-> `services` 간의 복잡한 의존성 문제를 해결하고, 모든 모듈이 `types.ts`에서만 타입을 참조하도록 데이터 흐름을 단방향으로 개선했습니다.
-   **전역 `import` 경로 수정**: 타입 정의 위치 변경에 따라, 프로젝트 전반에 걸쳐 `import` 경로를 수정하여 새로운 아키텍처에 맞게 통일했습니다.

### 2. 데이터 처리 로직 분리 (Phase 2)

-   **`utils/bookDataCombiner.ts` 도입**: API 응답을 조합하는 로직을 중앙에서 관리하기 위한 새로운 유틸리티 파일을 생성했습니다.
-   **두 가지 조합 함수로 역할 분리**:
    1.  **`combineRawApiResults`**: API 테스트 및 디버깅을 위해, API 응답 원본을 가공 없이 그대로 병합하는 함수를 추가했습니다.
    2.  **`combineApiResults`**: DB 저장 및 화면 표시에 최적화된 형태로 데이터를 가공(요약, 파생, 재구성)하는 기존 로직을 이 함수로 분리했습니다.
-   **`isbnMatcher.ts` 리팩토링**: `filterGyeonggiEbookByIsbn` 및 관련 헬퍼 함수들이 불필요하게 큰 `BookData` 타입 대신, 실제 필요한 최소한의 타입(`AladdinBookItem`)에 의존하도록 수정하여 결합도를 낮추고 재사용성을 높였습니다.

### 3. 애플리케이션에 새로운 파이프라인 통합 (Phase 3)

-   **`useBookStore.ts` (`refreshBookInfo`)**:
    -   `combineApiResults`를 사용하여 "순수 API 데이터"를 생성합니다.
    -   기존 `book_data`에서 "사용자 활동 데이터"(`rating`, `note` 등)를 명시적으로 분리하여, 두 데이터를 안전하게 병합한 후 DB에 업데이트하도록 수정했습니다. 이를 통해 API 정보 갱신 시 사용자 데이터가 유실될 위험을 원천적으로 차단했습니다.
-   **`APITestContent.tsx` & `MyLibraryBookDetailModal.tsx`**:
    -   `combineRawApiResults`를 사용하도록 수정하여, 이제 API 테스트 및 'API 보기' 기능에서 가공되지 않은 원본(Raw) 데이터를 일관되게 확인할 수 있습니다.
-   **`JsonViewerModal.tsx`**:
    -   사용자 편의성을 위해 클립보드 복사 기능을 추가했습니다.

### 기대 효과

-   **데이터 일관성 확보**: API 데이터를 조합하고 저장하는 방식이 표준화되어, 애플리케이션의 모든 부분에서 일관된 데이터를 사용하게 됩니다.
-   **유지보수성 대폭 향상**: 타입, 데이터 가공, 상태 관리의 역할이 명확히 분리되어, 향후 기능 추가 및 수정 시 예측 가능하고 안전한 코드 변경이 가능해졌습니다.
-   **디버깅 효율 증대**: API 원본 데이터와 가공된 데이터를 명확히 분리하여 확인할 수 있어, 문제 발생 시 원인 추적이 용이해졌습니다.

이번 리팩토링을 통해 프로젝트의 기술 부채를 크게 해소하고, 더 견고하고 확장 가능한 코드 기반을 마련했습니다.


527ec7d
ahnbu
Mon Oct 20 22:38:42 2025 +0900
test: vercel deploy 테스트


7288f14
ahnbu
Mon Oct 20 18:25:23 2025 +0900
refactor(types): LibraryName import 오류 수정


579a100
ahnbu
Mon Oct 20 18:23:42 2025 +0900
refactor(types): 타입 아키텍처 중앙화 및 재정립
프로젝트 전반의 타입 정의 구조를 개선하여 유지보수성과 안정성을 높이기 위한 대규모 리팩토링을 진행했습니다. 기존에 `types.ts`와 `services/unifiedLibrary.service.ts`에 분산되어 있던 타입 정의를 `types.ts`로 중앙화하여, 모든 타입의 유일한 출처(Single Source of Truth) 원칙을 확립했습니다.

### 주요 변경 사항

1.  **타입 정의 중앙화**:
    *   `services/unifiedLibrary.service.ts`에 있던 모든 API 관련 인터페이스(`LibraryApiResponse`, `GwangjuPaperResult` 등 14개)를 `types.ts`로 이동시켰습니다.
    *   이제 `types.ts`가 프로젝트의 모든 핵심 타입과 API 응답 타입을 관리합니다.

2.  **의존성 구조 개선**:
    *   기존의 복잡하고 잠재적인 순환 참조 위험이 있던 `types.ts` <-> `services` 간의 의존성 문제를 해결했습니다.
    *   이제 모든 파일(`services`, `stores`, `components` 등)은 타입을 오직 `types.ts`에서만 import합니다. 이로 인해 타입의 흐름이 단방향으로 명확해졌습니다.

3.  **`import` 경로 전면 수정**:
    *   `unifiedLibrary.service.ts`에서 타입을 가져오던 모든 파일(`useBookStore.ts`, `MyLibrary.tsx` 등)의 `import` 구문을 수정했습니다.
    *   타입은 `types.ts`에서, 함수는 `unifiedLibrary.service.ts`에서 가져오도록 `import` 문을 명확하게 분리하여 가독성을 높였습니다.

4.  **유사 타입 유지**:
    *   `GyeonggiEbookError`와 `GyeonggiEduEbookError`는 각각 '경기도 전자도서관'과 '경기도 교육청 전자도서관'이라는 별개의 시스템을 나타낼 가능성을 고려하여, 섣불리 통합하지 않고 기존 구조를 그대로 유지했습니다. 이는 향후 시스템별 에러 포맷 변경에 유연하게 대응할 수 있도록 합니다.

### 기대 효과

*   **유지보수성 향상**: 타입 관련 수정이 필요할 때 `types.ts` 파일 하나만 확인하면 되므로 디버깅 및 기능 추가가 용이해집니다.
*   **안정성 증대**: 타입의 출처가 명확해져 이름 충돌이나 순환 참조와 같은 잠재적 버그를 원천적으로 방지합니다.
*   **코드 가독성 개선**: 타입과 함수의 `import` 경로가 명확히 분리되어, 코드의 의존 관계를 파악하기 쉬워졌습니다.

이번 리팩토링은 향후 "API 응답 포맷 통일"과 같은 후속 작업을 위한 안정적인 기반을 마련하는 중요한 단계입니다.


1f73729
ahnbu
Mon Oct 20 18:01:46 2025 +0900
docs: apitest.tsx 미사용으로 temp로 이동


b721d1d
ahnbu
Mon Oct 20 16:11:41 2025 +0900
feat: 파싱 로직을 정규식에서 node-html-parser로 전환
기존 정규식(Regex) 기반의 불안정한 HTML 파싱 로직을 node-html-parser 라이브러리를 사용한 CSS 선택자 기반으로 전면 리팩토링했습니다. 이를 통해 도서관 웹사이트의 마크업 변경에 대한 안정성을 대폭 향상시키고, 코드의 가독성 및 유지보수성을 개선했습니다.

### 주요 변경 사항

#### 1. 광주 시립 (소장형 전자책) 파싱 개선 (`parseSiripEbookOwnedHTML`)
- **Why**: 구독형 파싱 로직(`parseSiripEbookSubsHTML`)과 동일한 구조임에도 복잡한 정규식 패턴을 사용하여 취약했음.
- **How**: `querySelector`와 `.childNodes` 분석을 통해 구독형과 동일한 안정적인 방식으로 제목, 저자, 대출 현황 등을 추출하도록 수정.

#### 2. 광주 시립 (종이책) 파싱 통합 및 개선 (`parseGwangjuHTML`, `parseGwangjuPaperKeywordResults`)
- **Why**: ISBN 검색과 키워드 검색 파싱 로직이 중복되고 정규식에 의존하여 유지보수가 어려웠음.
- **How**:
    - `parseGwangjuBookItem` 헬퍼 함수를 도입하여 중복 로직을 중앙화.
    - `querySelector`를 사용하여 각 정보(제목, 도서관, 대출상태)를 구조적으로 추출.
    - ISBN/키워드 검색 시 발생하는 미세한 HTML 구조 차이(e.g., `dd.data` 태그 유무)를 모두 처리할 수 있도록 헬퍼 함수 로직 강화.

#### 3. 경기도 교육청 (전자책) 파싱 개선 (`parseGyeonggiEduHTML`)
- **Why**: 가장 복잡한 중첩 정규식을 사용하고 있어 HTML 변경에 가장 취약했음.
- **How**:
    - 파싱의 핵심 데이터 소스를 `.bif` 내부 정보가 아닌 `a.selectBook` 태그의 `keyvalue` 속성으로 변경.
    - `keyvalue` 속성을 `split('///')`으로 분해하여 제목, 저자, ISBN 등 핵심 정보를 가장 정확하고 안정적으로 추출.
    - `keyvalue`에 없는 발행일, 대출 상태 정보만 `.bif` 영역에서 보조적으로 추출하는 하이브리드 방식으로 안정성 극대화.

### 기대 효과
- **안정성 향상**: 외부 웹사이트의 사소한 마크업 변경에도 크롤링 기능이 쉽게 깨지지 않음.
- **유지보수성 개선**: 복잡한 정규식 대신 직관적인 CSS 선택자를 사용하여 코드 분석 및 수정이 용이해짐.
- **코드 품질 향상**: 프로젝트 전반의 파싱 방식 통일 및 중복 코드 제거.


b13227c
ahnbu
Sun Oct 19 16:16:21 2025 +0900
docs: 알라딘api문서 업데이트


7eb7a95
ahnbu
Sun Oct 19 16:15:15 2025 +0900
feat(admin): 상세 모달에 API Raw 데이터 뷰어 기능 추가
서재의 도서 상세 정보 모달(`MyLibraryBookDetailModal`) 내에 [API] 버튼을 추가하여, 개발 및 디버깅 시 Supabase DB에 저장된 `book_data` JSON 원본을 직접 확인할 수 있는 기능을 구현했습니다.

- **기능 추가 (Feature)**
  - **`JsonViewerModal` 컴포넌트 생성**:
    - JSON 데이터를 입력받아 가독성 있게 포맷팅하여 보여주는 재사용 가능한 모달 컴포넌트를 추가했습니다.
    - ESC 키로 닫기, `z-index` 관리 등 다른 전역 모달과 일관된 사용자 경험을 제공합니다.

  - **`fetchRawBookData` 액션 추가**:
    - `useBookStore`에 특정 책 ID로 `user_library` 테이블의 `book_data` 컬럼만 효율적으로 조회하는 `fetchRawBookData` 비동기 함수를 추가했습니다.

  - **UI 연동**:
    - `MyLibraryBookDetailModal`의 '도서관 재고' 섹션에 [API] 버튼을 추가하고, 클릭 시 `fetchRawBookData`를 호출하여 `JsonViewerModal`에 데이터를 표시하도록 연동했습니다.

- **리팩토링 (Refactor)**
  - **모달 상태 관리 중앙화**:
    - `JsonViewerModal`의 열림 상태(`isOpen`) 및 데이터(`jsonData`)를 컴포넌트 내부의 로컬 `useState`에서 **전역 `useUIStore`로 이전**했습니다.
    - 이는 `MyLibraryBookDetailModal`의 리렌더링 시 JSON 뷰어 모달의 상태가 초기화되는 문제를 해결하기 위함입니다. `AdminPanel -> DevNoteModal`과 동일한 전역 상태 관리 패턴을 적용하여 안정성을 확보했습니다.

  - **"상태 끌어올리기(Lifting State Up)" 구조 개선**:
    - `LibraryStockSection` 컴포넌트에서 상태 관리 로직을 제거하고, 부모인 `MyLibraryBookDetailModal`로부터 필요한 상태와 이벤트 핸들러를 `props`로 전달받는 순수한 UI 컴포넌트로 변경하여 역할과 책임을 명확히 분리했습니다.

- **설정 (Chore)**
  - `App.tsx`의 최상위 렌더링 영역에 `<JsonViewerModal />`을 추가하여, 앱 전역에서 해당 모달을 호출할 수 있도록 구성했습니다.


00f6b8a
ahnbu
Sun Oct 19 15:21:35 2025 +0900
feat: 알라딘 검색 기능 개선 및 UI 버그 수정
알라딘 API 연동 검색 기능을 대폭 개선하고, 이와 관련된 UI 전반의 데이터 표시 오류를 수정하여 사용자 경험과 코드의 안정성을 향상시켰습니다.

- **기능 개선 (Feature)**
  - **검색 결과 개수 확장**:
    - 알라딘 도서 검색(`searchAladinBooks`) 시 한 번에 불러오는 결과 수를 20개에서 40개로 확장했습니다.
    - `maxResults`를 함수 인자로 전달하도록 변경하여, 향후 다른 기능에서 필요에 따라 결과 수를 유연하게 조절할 수 있도록 개선했습니다.

  - **'전자책' 검색 옵션 추가**:
    - 메인 검색 UI(`SearchForm`)에 '전자책' 검색 유형을 추가했습니다.
    - `searchType`이 'EBook'일 경우, 알라딘 API의 `SearchTarget`을 `eBook`으로 지정하여 전자책만 정확히 검색하도록 `aladin.service` 로직을 수정했습니다.

- **버그 수정 (Fix)**
  - **포맷 표시 오류 수정 (`MyLibrary`, `BookDetails`, `MyLibraryBookDetailModal`)**:
    - 전자책만 존재하는 도서(`mallType: 'EBOOK'`)를 서재에 추가하거나 상세 보기 시, '종이책' 버튼이 잘못 표시되던 버그를 수정했습니다.
    - 모든 관련 컴포넌트에서 `mallType`을 기준으로 `paperBookLink`와 `ebookLink`를 정확히 할당하도록 데이터 처리 로직을 통일하여 해결했습니다.

  - **무료 도서 가격 표시 오류 수정 (`BookDetails`)**:
    - 가격이 0원인 무료 전자책의 경우, 상세 정보 뷰에서 가격 UI가 깨지던 문제를 수정했습니다.
    - 가격이 0일 때는 숫자 대신 "무료"라는 텍스트가 표시되도록 조건을 개선했습니다.

- **리팩토링 (Refactor)**
  - **검색 결과 카드 UI 개선 (`BookSearchListModal`)**:
    - 검색 결과 목록의 각 도서 카드에 [종이책], [전자책] 버튼을 추가하여, 사용자가 목록 단계에서부터 도서의 제공 형태를 직관적으로 파악할 수 있도록 했습니다.
    - 하나의 포맷만 존재할 경우 해당 버튼이 전체 너비로 표시되도록 `MyLibrary`와 동일한 UI 패턴을 적용하여 일관성을 확보했습니다.

- **타입 정의 (Types)**
  - `types.ts`의 `AladdinBookItem` 타입 정의에 누락되었던 `mallType`과 `paperBookList` 속성을 추가하여 TypeScript 타입 안정성을 확보하고 관련 오류를 해결했습니다.


e0c9f0c
ahnbu
Sun Oct 19 12:56:07 2025 +0900
refactor(UI): 상세 모달 재고 표시 로직 개선 및 UI 일관성 확보
상세 정보 모달(`MyLibraryBookDetailModal`) 내의 도서관 재고 표시 방식을 리팩토링하여 `MyLibrary` 뷰와의 UI 일관성을 확보하고 코드의 유지보수성을 크게 향상시켰습니다.

- **리팩토링 (Refactor)**
  - **`StockDisplay` 컴포넌트 도입**:
    - 기존에 각 재고 라인마다 하드코딩되어 있던 재고 표시 로직(JSX, 색상 결정)을 `StockDisplay`라는 재사용 가능한 단일 컴포넌트로 추출하고 중앙화했습니다.
    - 복잡했던 즉시 실행 함수 `(() => { ... })()` 구조를 제거하고, 선언적이고 명확한 컴포넌트 기반으로 코드를 개선하여 가독성을 높였습니다.

  - **상태 관리 로직 캡슐화**:
    - `MyLibrary`의 `LibraryTag` 컴포넌트와 동일한 패턴으로, 재고 상태(에러, 재고 있음, 재고 없음)를 결정하는 `getStatus` 함수와 상태에 따른 Tailwind CSS 클래스를 매핑하는 `statusColorClassMap`을 `StockDisplay` 컴포넌트 내에 캡슐화했습니다.

- **기능 개선 (Feature)**
  - **UI 일관성 확보**:
    - 상세 모달의 재고 텍스트 색상 규칙을 `MyLibrary` 뷰와 동일하게 변경했습니다.
      - **에러 발생 시:** `빨간색`
      - **재고 있음:** `녹색`
      - **재고 없음 (에러 없음):** `회색` (기존 `빨간색`에서 변경)
    - 이를 통해 사용자는 어떤 뷰에서든 동일한 시각적 피드백을 통해 재고 상태를 직관적으로 파악할 수 있습니다.

- **코드 정리 (Chore)**
  - `StockDisplay` 컴포넌트 도입에 따라 더 이상 필요 없어진 기존의 `renderStockInfo` 헬퍼 함수를 코드베이스에서 완전히 삭제했습니다.
  - 사용되지 않는 `getStatus` 함수를 `LibraryTag` 컴포넌트에서 제거하여 코드를 정리했습니다.

이번 변경으로 인해 향후 재고 표시 UI나 색상 정책 변경 시, 각 컴포넌트(`StockDisplay`, `LibraryTag`) 내부의 중앙화된 로직만 수정하면 되어 유지보수가 매우 용이해졌습니다.


0b1b24a
ahnbu
Sun Oct 19 12:35:25 2025 +0900
feat: 재고 새로고침 시 전자책 출간 정보 동기화 및 로직 일원화
- **기능 (Feature)**
  - `refreshAllBookInfo` 로직을 개선하여, 도서관 재고 조회와 함께 알라딘 API를 병렬로 호출하도록 수정했습니다.
  - 이를 통해, 사용자가 책을 서재에 추가한 시점 이후에 전자책이 출간되더라도, 재고 새로고침 시 최신 전자책 정보를 자동으로 감지하고 `subInfo` 필드를 업데이트합니다.
  - 이 변경으로 인해 UI(종이책/전자책 버튼)가 별도의 수정 없이 데이터에 따라 동적으로 최신 상태를 반영하게 됩니다.

- **리팩토링 (Refactor)**
  - 코드베이스 전체에서 호출되지 않는 "죽은 코드(Dead Code)"인 `refreshEBookInfo` 함수를 `useBookStore`에서 완전히 제거했습니다.
  - `refreshAllBookInfo`와 역할이 중복되어 데이터 불일치 및 유지보수 비용 증가의 원인이 될 수 있었던 문제를 근본적으로 해결했습니다.
  - 이제 모든 단일 도서 재고 새로고침 로직은 `refreshAllBookInfo`라는 단일 통로(Single Source of Truth)를 통해 관리됩니다.

- **개선 (Chore)**
  - 광주 종이책 재고 조회 로직에서 API 호출 실패 시, 기존 재고 정보는 유지하면서 에러 상태만 UI에 표시하도록 하는 방어 코드를 복원하여 사용자 경험을 개선했습니다.


aba5509
ahnbu
Sun Oct 19 11:51:39 2025 +0900
refactor(error-handling): API 실패 시 재고 정보 보존 및 에러 표시 개선
API 재고 조회 실패 시 사용자 경험을 향상시키고, 에러 추적을 용이하게 하기 위해 에러 처리 로직을 전반적으로 개선했습니다.

주요 변경 사항은 다음과 같습니다.

### 1. [프론트엔드] API 실패 시 과거 재고 정보 보존

-   **변경**: `useBookStore`의 `refreshAllBookInfo` 함수 로직을 수정하여, `gwangju_paper`와 `gyeonggi_ebook_edu` API 조회에 실패하더라도 기존 DB에 저장된 재고 수량(`toechonStock`, `ebookInfo.summary`)을 0으로 덮어쓰지 않고 유지하도록 변경했습니다.
-   **효과**: 이제 API가 일시적으로 불안정하더라도 사용자는 과거 재고 정보를 계속 확인할 수 있으며, 데이터 유실을 방지합니다.

### 2. [프론트엔드] 에러 상태 표시 로직 개선

-   **변경**:
    -   `MyLibrary.tsx`: `e교육`의 상태 점(Indicator)이 `error_count`가 2일 때(성남, 통합 모두 실패)만 빨간색으로 표시되도록 `isError` prop의 조건을 `(count > 0)`에서 `(count === 2)`로 수정했습니다.
    -   `useBookStore.ts`: API 실패 시에도 `gwangjuPaperInfo`와 `ebookInfo`에 에러 객체를 기록하여, UI 컴포넌트가 '에러 상태'임을 정확히 인지할 수 있도록 수정했습니다.
-   **효과**: 이제 UI는 과거 재고 수치를 보여주면서 동시에 상태 점을 빨간색으로 표시하여, 사용자에게 "기존 재고는 N권이지만, 현재 정보 갱신에 실패했습니다"라는 명확하고 유용한 피드백을 제공합니다.

### 3. [API] 에러 로깅 강화 및 상세 정보 추가 (`cloudflare/index.js`)

-   **변경**:
    -   `gyeonggi_ebook_edu` API 요청 실패 시, Cloudflare Worker 로그에 `[API ERROR]` 접두사와 함께 어떤 도서관(성남/통합)에서 에러가 발생했는지 명확한 로그를 남기도록 `console.error`를 추가했습니다.
    -   API 응답 객체에 `error_lib_detail` 필드를 추가하여, 실패한 도서관 목록을 프론트엔드로 전달하도록 개선했습니다.
-   **효과**: 서버 로그를 통해 에러의 근본 원인을 더 빠르게 추적할 수 있게 되었습니다.

### 4. 코드 안정성 및 일관성 향상

-   **변경**:
    -   `useBookStore.ts`: `gyeonggi_ebook_edu`의 API 성공 여부를 판단하는 조건문을 `'error' 키 부재` 확인 방식에서, 성공의 핵심 증거인 `'book_list' 키 존재` 여부를 확인하는 더 안정적인 타입 가드 방식으로 통일했습니다.
    -   `unifiedLibrary.service.ts`: 변경된 API 응답 구조를 반영하여 `error_lib_detail` 필드를 타입 정의에 추가했습니다.
-   **효과**: `null` 응답 등 예외 케이스에 대한 방어력이 높아졌으며, 프로젝트 전반의 코드 일관성과 타입 안정성이 향상되었습니다.


5941483
ahnbu
Sun Oct 19 00:17:16 2025 +0900
refactor(api, store): API 응답 구조 개선 및 프론트엔드 로직 동기화
API 응답의 일관성을 높이고 프론트엔드에서 데이터를 더 쉽게 처리할 수 있도록 `gwangju_paper`와 `gyeonggi_ebook_education`의 응답 구조를 리팩토링하고, 이에 맞춰 프론트엔드 로직을 전체적으로 수정했습니다.

이 과정에서 발생했던 API 응답 키 불일치로 인한 재고 표시 버그도 함께 해결되었습니다.

### 1. API 응답 구조 개선 (`cloudfare/index.js`)

-   **`gwangju_paper` (종이책)**
    -   기존: `book_title`과 `book_list`만 포함
    -   **개선**: `book_list`를 순회하여 계산된 요약 정보(`summary_total_count`, `toechon_total_count` 등)를 객체 최상단에 추가하여 응답.
    -   이를 통해 클라이언트에서 수동으로 재고를 계산하던 로직을 서버로 이전하여 효율성을 높였습니다.

-   **`gyeonggi_ebook_education` (e교육)**
    -   기존: 책 정보 배열(`[]`)을 직접 반환
    -   **개선**: 도서 목록을 `book_list` 키 아래에 배치하고, `total_count`, `available_count` 등의 요약 정보를 포함하는 단일 객체(`{}`) 형태로 구조 변경.

### 2. API 응답 키 이름 통일 (Bug Fix)

-   **문제 원인**: Cloudflare Worker(`index.js`)에서는 `gyeonggi_ebook_education`이라는 키로 응답을 생성했지만, 프론트엔드(`useBookStore.ts`)에서는 `result.gyeonggi_ebook_edu`로 데이터를 참조하고 있었습니다. 이 키 이름 불일치로 인해 `e교육` 재고 정보가 항상 `null`로 처리되어 '정보 조회 실패'로 표시되는 버그가 발생했습니다.
-   **해결**: Cloudflare Worker의 최종 응답 객체 키를 `gyeonggi_ebook_education`에서 `gyeonggi_ebook_edu`로 수정하여 프론트엔드의 데이터 참조와 일치시켰습니다.

### 3. 프론트엔드 로직 동기화

-   **타입 정의 업데이트 (`unifiedLibrary.service.ts`)**
    -   `GwangjuPaperResult`와 `GyeonggiEduEbookResult` 타입을 새로운 API 응답 구조에 맞게 요약 정보 필드를 추가하고, 객체 형태로 변경했습니다.

-   **상태 관리 로직 수정 (`useBookStore.ts`)**
    -   `refreshAllBookInfo`, `refreshEBookInfo` 함수를 수정하여, 클라이언트에서 재고를 직접 계산하는 대신 API가 제공하는 요약 정보를 사용하도록 변경했습니다.
    -   `book_list` 키가 있는지 명확하게 확인하는 조건문을 사용하여 `null` 또는 에러 객체에 대한 방어 로직을 강화했습니다.

-   **UI 컴포넌트 수정 (`MyLibrary.tsx`, `MyLibraryBookDetailModal.tsx`)**
    -   `e교육` 재고의 에러 여부를 판단할 때, `details` 배열을 순회하는 대신 `summary.error_count`를 참조하도록 로직을 단순화했습니다.

이번 리팩토링을 통해 API-클라이언트 간 데이터 구조를 통일하고, 서버에서 계산된 요약 정보를 활용함으로써 프론트엔드 코드의 복잡도를 낮추고 안정성을 크게 향상시켰습니다.


dab2285
ahnbu
Sat Oct 18 22:55:32 2025 +0900
refactor(store, types): API 응답 및 재고 관련 데이터 구조 통일
API 응답 데이터와 내부 상태 관리(Zustand)에서 사용되는 재고 관련 데이터 구조의 일관성을 확보하기 위해 대대적인 리팩토링을 진행합니다. 여러 컴포넌트와 서비스에 걸쳐 혼용되던 `total/available`, `총개수/대출가능`, `availability/book_list` 등의 속성명을 `total_count`, `available_count`, `book_list`로 통일했습니다.

이번 리팩토링으로 인해 발생했던 재고 표시 버그도 함께 수정합니다.

### 주요 변경 사항

1.  **API 응답 구조 통일 (`cloudfare_index.js`)**
    - 광주 종이책(`gwangju_paper`)과 경기 교육청 전자책(`gyeonggi_ebook_edu`) API 응답의 배열 키를 `availability`에서 `book_list`로 변경하여 다른 API 응답 형식과 일치시켰습니다.

2.  **타입 정의 일관성 확보 (`types.ts`, `unifiedLibrary.service.ts`)**
    - `StockInfo`, `EBookSummary` 등 모든 재고 관련 타입의 속성명을 `total_count`와 `available_count`로 통일했습니다.
    - `GwangjuPaperResult` 타입의 배열 키를 `book_list`로 수정했습니다.

3.  **상태 관리 로직 수정 (`useBookStore.ts`)**
    - `refreshAllBookInfo`: 변경된 API 응답 키(`book_list`)를 올바르게 참조하여 재고를 계산하도록 수정했습니다.
    - `addToLibrary`: 새로 추가되는 책의 초기 재고 상태(`toechonStock`, `otherStock`)를 `_count` 접미사를 사용하도록 수정했습니다.

### 버그 수정 (Bug Fix)

- **fix(MyLibrary): 재고 표시 속성명 참조 오류 수정**
  - **원인**: `MyLibrary.tsx`에서 `LibraryTag` 컴포넌트로 props를 전달할 때, 리팩토링 이전의 속성명(`total`, `available`, `총개수`)을 참조하여 재고가 항상 0으로 표시되는 문제가 있었습니다.
  - **해결**: 퇴촌/기타/e교육 도서관의 재고 정보를 전달할 때 `book.toechonStock?.total_count`와 같이 `_count` 접미사가 붙은 올바른 속성명을 참조하도록 수정했습니다.

- **fix(MyLibraryBookDetailModal): 상세 모달 재고 표시 오류 수정**
  - 상세 모달 내 종이책(`renderStockInfo`) 및 전자책(`e교육`) 재고 표시 로직에서도 올바른 속성명(`total_count`, `available_count`)을 사용하도록 수정했습니다.

이번 변경으로 데이터 흐름의 모든 단계에서 일관된 데이터 구조를 사용하게 되어 코드의 가독성과 유지보수성이 향상되었으며, 재고 표시 관련 버그가 모두 해결되었습니다.


8dcd4fb
ahnbu
Thu Oct 16 19:31:35 2025 +0900
feat(crawler): 키워드 검색 기능 안정성 및 데이터 정확도 전면 개선 - e시립구독, e경기(소장,구독)
키워드 통합 검색 기능의 안정성, 데이터 정확성, 유지보수성을 향상시키기 위해 백엔드 크롤러 로직을 전반적으로 리팩토링하고 주요 버그들을 수정했습니다.

### ✨ 주요 개선 사항 (Features & Refactors)

#### 1. 비동기 처리 및 에러 핸들링 구조 개편 (Core)
- **안정성 강화**: `Promise.all`을 `Promise.allSettled`로 교체하여, 여러 도서관을 병렬 검색할 때 특정 도서관의 요청이 실패하더라도 전체 검색 프로세스가 중단되지 않도록 개선했습니다.
- **에러 격리**: 각 검색 함수를 `safeSearch` 래퍼 함수로 감싸, 개별 함수의 동기적인 에러가 다른 검색 작업에 영향을 미치지 않도록 격리했습니다.

#### 2. `e시립구독` 파서, 정규식에서 HTML 파서로 전면 교체
- **견고성 확보**: 기존의 취약한 정규식 기반 파싱 로직을 모두 제거하고, `node-html-parser` 라이브러리를 도입하여 DOM 기반으로 데이터를 추출하도록 변경했습니다. 이를 통해 웹사이트의 사소한 HTML 변경에 더 강건한 코드를 확보했습니다.
- **정확도 향상**: `.querySelectorAll`, `.childNodes` 등을 활용하여 저자, 출판사, 출간일 정보가 합쳐지거나 누락되던 문제를 해결하고 정확한 데이터를 추출하도록 개선했습니다.
- **개발 환경 안정화**: 외부 URL(`esm.sh`)을 통한 모듈 임포트 방식을 제거하고, `npm` 로컬 의존성으로 변경하여 Wrangler 개발 환경의 `No such module` 오류를 해결했습니다.

### 🐛 버그 수정 (Fixes)

#### 1. `e경기` 출간일 누락 및 `ReferenceError` 버그 수정
- **출간일 수집**: 경기도 전자도서관의 소장형(`PUBLISH_DATE`)과 구독형(`ucm_ebook_pubdate`) API 응답에서 각기 다른 필드명으로 제공되던 출간일 정보를 모두 정상적으로 수집하도록 파싱 로직을 수정했습니다.
- **런타임 에러 해결**: `searchGyeonggiEbookLibrary` 함수에서 변수가 선언되기 전에 접근하여 발생하던 `ReferenceError` (TDZ)를 변수 선언 순서 조정을 통해 해결했습니다.
- **데이터 흐름 개선**: 파싱된 데이터가 최종 결과에 누락되지 않도록, 불필요한 중간 변환 과정을 제거하고 데이터 통합 로직을 단순화했습니다.

#### 2. `e경기(구독형)` 일부 결과 누락 문제 해결
- API가 6개의 결과를 반환했음에도 2개만 처리되던 문제를 분석한 결과, API 결과를 '제목' 기준으로 불필요하게 재필터링하던 로직이 원인이었습니다.
- 해당 필터링 로직을 제거하여 API가 반환하는 모든 결과를 신뢰하고 처리하도록 수정했습니다.

이러한 개선을 통해 키워드 통합 검색 기능은 이전보다 훨씬 더 안정적이고 정확한 데이터를 제공하며, 코드의 유지보수성이 크게 향상되었습니다.


0a37b96
ahnbu
Thu Oct 16 16:15:07 2025 +0900
feat(keyword-search): 키워드 검색 기능 개선 및 데이터 정확도 향상
키워드 통합 검색 기능의 안정성과 데이터 정확성을 높이기 위해 백엔드 크롤링 로직과 프론트엔드 UI를 전반적으로 개선했습니다.

주요 변경 사항은 다음과 같습니다.

1.  **퇴촌 도서관 검색 결과 누락 문제 해결**
    - `searchGwangjuPaperKeyword` 함수가 광주시 전체 도서관('ALL')과 퇴촌 도서관('MN')을 병렬로 각각 검색하도록 로직을 수정했습니다.
    - 이를 통해 기존에 누락되던 퇴촌 도서관의 종이책 검색 결과가 정상적으로 포함되도록 하였습니다.
    - 최종 결과를 취합할 때 제목과 저자 기준으로 중복을 제거하여 데이터 정합성을 높였습니다.

2.  **e교육 및 e경기 데이터 파싱 로직 강화**
    - **e교육(저자)**: 경기도교육청 전자도서관의 복잡한 HTML 구조에 대응할 수 있도록 `parseGyeonggiEduHTML` 함수의 저자 정보 파싱 정규식을 개선하여, 저자 정보가 누락되던 문제를 해결했습니다.
    - **e경기(출간일)**: 경기도 전자도서관의 소장형(API) 및 구독형(API) 응답 데이터를 정밀 분석하여, 각기 다른 필드명(`PUBLISH_DATE`, `ucm_ebook_pubdate`)으로 제공되던 출간일 정보를 모두 추출하도록 `parseGyenggiEbookOwnedResults`와 `parseGyenggiEbookSubsResults` 함수를 수정했습니다. 이로써 "정보 없음"으로 표시되던 출간일 문제가 해결되었습니다.

3.  **키워드 검색 결과 UI/UX 개선 (KeywordSearchModal)**
    - **UI 정리**: 검색 결과 테이블에서 '출판사' 컬럼을 제거하여 핵심 정보에 집중할 수 있도록 UI를 간소화했습니다.
    - **가독성 향상**:
        - 모든 셀 내용을 한 줄로 표시하고, 길어질 경우 말줄임표(`...`) 처리되도록 스타일을 적용했습니다.
        - 저자는 3자, 제목은 15자로 글자 수를 제한하여 표시하되, 마우스를 올리면 전체 내용을 확인할 수 있도록 `title` 속성을 추가했습니다.
        - 출간일 형식을 'YYYY'로 통일하여 일관성을 확보했습니다.
        - 출간일 정보가 없는 경우 "정보 없음" 대신 하이픈(`-`)을 표시하도록 개선했습니다.


670b9e9
ahnbu
Wed Oct 15 17:34:39 2025 +0900
fix(types): 프로젝트 전반의 TypeScript 타입 에러 수정
[문제점]
최근 기능 추가 및 리팩토링 이후, 여러 컴포넌트와 상태 관리 로직에서 TypeScript 타입 불일치로 인한 다수의 에러(빨간 줄)가 발생했습니다. 이들은 당장 런타임 문제를 일으키진 않지만, 코드의 안정성을 저해하고 잠재적인 버그를 유발할 수 있었습니다.

[해결 방안]
프로젝트 전체적으로 발견된 타입 에러들을 다음과 같이 수정했습니다.

1.  **`useBookStore.ts` 타입 안정성 강화**:
    -   `updateMultipleBookTags` 함수의 반환 타입을 `Promise<void>`에서 실제 반환값인 `Promise<{...}>`으로 수정하여 타입 정의와 구현을 일치시켰습니다.
    -   Supabase의 `book_data` 컬럼에 데이터를 저장할 때, `as Json`으로 타입 단언하던 모든 부분을 더 안전한 `as unknown as Json`으로 변경하여 TypeScript의 엄격한 검사를 통과하도록 했습니다.
    -   `updateMissingEbookIsbn13` 함수에서 상태 업데이트 시 `id` 프로퍼티가 누락되는 문제를 해결하기 위해, 업데이트 객체의 타입을 `SelectedBook`으로 명확히 지정했습니다.

2.  **API 응답 타입 처리 수정 (`useBookStore.ts`)**:
    -   `refreshAllBookInfo` 함수에서 `filterGyeonggiEbookByIsbn` 호출 시, API 응답이 에러 객체(`GyeonggiEbookLibraryError`)일 가능성을 고려하지 않던 문제를 수정했습니다. 이제 API 호출 성공 시에만 필터링 함수를 호출하도록 타입 가드를 추가했습니다.

3.  **Vite 및 TypeScript 설정 파일 수정**:
    -   `vite.config.ts`가 Node.js 환경의 모듈(`vite`, `url`) 타입을 찾지 못하는 문제를 해결하기 위해, `tsconfig.node.json`을 추가하여 Node.js 설정 파일과 프론트엔드 소스 코드의 타입 체크 환경을 명확히 분리했습니다.
    -   `vite.config.ts`의 `defineConfig` 파라미터에 `ConfigEnv` 타입을 명시하여 `mode` 변수의 암시적 `any` 타입 문제를 해결했습니다.

4.  **컴포넌트 타입 수정**:
    -   `Notification.tsx`가 `'info'`, `'warning'` 타입을 처리할 수 있도록 관련 타입 정의(`useUIStore.ts`, `Notification.tsx`)와 아이콘(`Icons.tsx`)을 모두 확장했습니다.

[기대 효과]
-   프로젝트 전체에서 발생하던 TypeScript 타입 관련 에러(빨간 줄)가 모두 해결되었습니다.
-   코드의 타입 안정성과 신뢰성이 크게 향상되어, 향후 리팩토링이나 기능 추가 시 발생할 수 있는 잠재적인 버그를 예방할 수 있게 되었습니다.
-   개발 환경이 안정화되어 개발 생산성이 향상됩니다.


551c234
ahnbu
Wed Oct 15 16:43:25 2025 +0900
refactor: 사용하지 않는 레거시 컴포넌트 및 함수 제거
[개선 목적]
최근 `createLibraryOpenURL` 함수를 도입하여 URL 생성 로직을 중앙화하는 과정에서, 더 이상 사용되지 않거나 기능이 중복되는 레거시 코드들이 발견되었습니다. 코드베이스를 깔끔하게 유지하고 혼동을 줄이기 위해 해당 코드들을 제거합니다.

[주요 변경사항]
1.  **`LibraryStock.tsx` 컴포넌트 삭제**:
    -   '도서관 재고 현황'을 표시하던 `LibraryStock` 컴포넌트는 이제 `MyLibrary` 및 `MyLibraryBookDetailModal` 컴포넌트의 자체 렌더링 로직으로 대체되어 더 이상 사용되지 않음을 확인하고 삭제했습니다.
    -   VS Code의 "Find All References" 기능을 통해 다른 곳에서 참조되지 않음을 최종 확인했습니다.

2.  **`generateLibraryDetailURL` 함수 삭제 (`unifiedLibrary.service.ts`)**:
    -   이 함수는 퇴촌도서관 URL을 생성하는 특정 목적을 가졌으나, 최근에 추가된 `createLibraryOpenURL` 함수와 기능이 중복되고 더 이상 사용되지 않으므로 삭제했습니다.
    -   관련 `import` 구문도 함께 정리하여 불필요한 의존성을 제거했습니다.

[기대 효과]
-   프로젝트에서 사용되지 않는 코드를 제거하여 코드베이스의 복잡성을 낮추고 번들 크기를 미세하게 최적화했습니다.
-   URL 생성 로
-   직과 관련된 함수를 `createLibraryOpenURL`로 단일화하여, 향후 유지보수 시 혼동의 여지를 없애고 개발 효율성을 높였습니다.


3469772
ahnbu
Wed Oct 15 16:26:01 2025 +0900
feat(ui): 키워드 검색 모달에 테마 적용 및 URL 로직 리팩토링
[주요 변경사항]
이번 커밋은 `KeywordSearchModal` 컴포넌트의 사용자 경험과 코드 품질을 개선하는 두 가지 주요 작업을 포함합니다.

1.  **다크/라이트 테마 적용**:
    -   기존에 하드코딩된 색상(예: `bg-white`, `text-gray-900`)을 사용하던 `KeywordSearchModal`의 모든 스타일을 `index.css`에 정의된 시맨틱 CSS 변수(예: `bg-elevated`, `text-primary`)를 사용하도록 수정했습니다.
    -   `input`, `button` 등 폼 요소에도 `input-base`, `btn-primary` 등 공통 스타일 클래스를 적용하여 디자인 일관성을 확보했습니다.
    -   이제 키워드 검색 모달도 다른 컴포넌트와 마찬가지로 사용자가 설정한 다크/라이트 테마를 완벽하게 따릅니다.

2.  **URL 생성 로직 리팩토링 및 통합**:
    -   모달 내부에만 존재하던 `generateLibraryLink` 함수를 삭제하고, 프로젝트 전역에서 사용하는 공통 함수 `createLibraryOpenURL`를 호출하도록 변경했습니다.
    -   이를 통해 모든 도서관 바로가기 URL 생성 로직을 중앙화하여 코드 중복을 제거하고 유지보수성을 크게 향상시켰습니다.

[기대 효과]
-   **일관된 사용자 경험**: 키워드 검색 모달이 전체 애플리케이션의 디자인 시스템과 완벽하게 통합되었습니다.
-   **코드 품질 향상**: 중복 로직 제거와 중앙화된 함수 사용으로 코드의 가독성, 일관성, 유지보수성이 모두 개선되었습니다.


7fc253b
ahnbu
Wed Oct 15 15:59:03 2025 +0900
docs: 초기 로딩된 데이터에만 기능이 작동하는 경우 (제한된 리소스 트러블슈팅 가이드 추가) to develpment.md
**증상:**
-   '내 서재' 검색 또는 태그 필터링 후 나타난 책에 대해 특정 기능(예: 상세 모달 열기, 재고 새로고침, 태그/메모 CRUD)이 작동하지 않는다.
-   반면, 페이지를 처음 로드했을 때 보이는 책들(예: 25/50권)에 대해서는 동일한 기능이 정상적으로 작동한다.
-   React 개발자 도구에서는 상태 변경이 일어나는 것처럼 보이지만, UI에는 아무런 변화가 없다.

**원인 분석: 제한된 데이터 소스 참조 (The "Wrong Drawer" Problem)**

이 문제는 대부분의 경우 프론트엔드 상태 관리 로직에서 발생합니다. 우리 프로젝트는 성능을 위해 초기에는 일부 데이터(`myLibraryBooks`)만 로드하고, 검색/필터 시에는 별도의 상태(`librarySearchResults`, `libraryTagFilterResults`)를 사용합니다.

문제는 특정 기능을 수행하는 함수(예: `updateBookInStoreAndDB`, `refreshAllBookInfo`)가 업데이트할 대상 객체를 찾을 때, **오직 `myLibraryBooks`라는 하나의 "서랍"에서만** 객체를 찾으려고 시도하기 때문에 발생합니다. 만약 사용자가 다른 서랍(`librarySearchResults`)에 있는 객체에 대해 작업을 요청하면, 함수는 대상을 찾지 못하고 아무것도 하지 않거나 에러를 반환합니다.

**진단 워크플로우:**

1.  **기능 확인**: 작동하지 않는 기능(예: `addTagToBook`)이 의존하는 핵심 함수(예: `updateBookInStoreAndDB`)를 `useBookStore.ts`에서 찾습니다.
2.  **데이터 소스 추적**: 해당 함수가 업데이트할 원본 객체(`originalBook`)를 어디서 가져오는지 확인합니다. 아래와 같은 코드가 있다면 의심해야 합니다.
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id); // << 문제의 코드
    ```
3.  **재현**: '내 서재'에서 '전체 보기'를 누르지 않은 상태로, 스크롤을 내려 보이지 않는 책의 제목을 검색합니다. 검색 결과로 나온 책에 대해 해당 기능을 실행했을 때 문제가 재현되는지 확인합니다.

**해결 방안: 중앙화된 데이터 조회 함수 사용**

이 문제를 근본적으로 해결하려면, 객체를 찾을 때 모든 잠재적인 데이터 소스를 검색하는 중앙화된 조회 함수를 사용해야 합니다.

1.  **`getBookById` 함수 활용**:
    `useBookStore.ts`에 이미 `getBookById` 함수가 구현되어 있습니다. 이 함수는 `myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`를 모두 검색하고, 그래도 없으면 DB에 직접 요청하는 가장 견고한 방법입니다.

2.  **기존 코드 수정**:
    문제가 되는 함수 내부에서 `myLibraryBooks.find(...)`를 사용하는 대신, `getBookById`를 호출하도록 수정합니다.

    **수정 전:**
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id);
    if (!originalBook) return;
    // ...
    ```

    **수정 후:**
    ```typescript
    const { getBookById } = get();
    const originalBook = await getBookById(id);
    if (!originalBook) return;
    // ...
    ```

3.  **UI 상태 동시 업데이트**:
    데이터를 업데이트하는 함수(`updateBookInStoreAndDB`, `refreshAllBookInfo`)는 `setState`를 호출할 때 **모든 관련 상태 배열**(`myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`)을 동시에 업데이트해야 합니다. 이를 통해 어떤 뷰(기본, 검색, 필터)에 있더라도 UI가 일관되게 변경됩니다.

    ```typescript
    // 좋은 예시
    useBookStore.setState(state => ({
      myLibraryBooks: state.myLibraryBooks.map(b => (b.id === id ? updatedBook : b)),
      librarySearchResults: state.librarySearchResults.map(b => (b.id === id ? updatedBook : b)),
      libraryTagFilterResults: state.libraryTagFilterResults.map(b => (b.id === id ? updatedBook : b)),
    }));
    ```

**핵심 원칙**: 사용자 인터랙션의 대상이 되는 객체를 찾거나 수정할 때는, 현재 화면에 보이는 데이터의 출처(`myLibraryBooks`, `librarySearchResults` 등)와 관계없이, **존재하는 모든 데이터 소스를 포괄하는 단일 통로(`getBookById`)**를 통해 접근해야 합니다.


139f238
ahnbu
Wed Oct 15 15:56:25 2025 +0900
fix(tags): 검색/필터링된 책에 대한 일괄 태그 관리 기능 수정
[문제점]
'내 서재'에서 책을 검색하거나 태그로 필터링한 후, 결과 목록에 있는 책들(초기 로딩에 포함되지 않은 책)에 대해 '일괄 태그 관리' 기능을 사용하면 "태그 업데이트에 실패했다"는 메시지가 발생하며 기능이 작동하지 않았습니다.

또한, 태그 '삭제' 시에는 작업이 성공해도 모달이 닫히지 않아 사용자 경험의 일관성이 부족했습니다.

[원인 분석]
1.  **제한된 데이터 소스 참조**: `updateMultipleBookTags` 함수가 태그를 업데이트할 책의 원본 정보를 오직 초기 로딩된 `myLibraryBooks` 배열에서만 찾고 있었습니다. 검색/필터링된 책은 이 배열에 없어 'Book not found' 에러가 발생했습니다.
2.  **핸들러 로직 누락**: 태그 '삭제' 핸들러(`handleRemoveCommonTag`)에 작업 완료 후 모달을 닫는 `onClearSelection()` 호출이 누락되어 있었습니다.

[해결 방안]
1.  **`useBookStore.ts` 수정**:
    -   `updateMultipleBookTags` 함수가 책을 찾을 때 `myLibraryBooks`를 직접 참조하는 대신, 모든 데이터 소스를 검색하는 `getBookById` 함수를 사용하도록 수정하여 어떤 책이든 정확히 찾아낼 수 있도록 했습니다.

2.  **`MyLibrary.tsx` 수정**:
    -   `BulkTagModal`에 책 객체를 전달할 때, `myLibraryBooks` 대신 현재 화면에 표시되는 `sortedAndFilteredLibraryBooks` 배열을 참조하도록 변경했습니다.
    -   `handleRemoveCommonTag` 함수에 `onClearSelection()` 호출을 추가하여, 태그 추가/삭제 시 동일하게 모달이 닫히도록 동작을 일치시켰습니다.

[기대 효과]
-   이제 '내 서재'의 어떤 상태(기본 목록, 검색 결과, 필터 결과)에서든 모든 책에 대해 '일괄 태그 관리' 기능이 안정적으로 작동합니다.
-   태그 추가/삭제 시 사용자 경험이 일관되게 개선되었습니다.


076f8e4
ahnbu
Wed Oct 15 15:33:03 2025 +0900
fix(ui): 태그 색상 선택 버튼의 포커스 스타일 개선
[문제점]
'맞춤설정 > 태그관리'에서 태그 색상 버튼('기본', '보조')을 클릭하여 선택된 상태일 때, 버튼 주변에 `ring-offset`으로 인해 생긴 흰색 테두리가 나타나 UI 일관성을 해치는 문제가 있었습니다.

[해결 방안]
- 클릭으로 인한 선택 상태에서는 링(ring) 효과를 제거하고, `opacity`만으로 활성 상태를 구분하도록 변경했습니다.
- 키보드 탐색 등 접근성을 위해 필요한 링 효과는 `:focus` pseudo-class에만 적용되도록 수정했습니다.
- `focus:outline-none`, `focus:ring-2`, `focus:ring-ring`, `focus:ring-offset-2` 클래스를 추가하여, 키보드로 포커스했을 때만 명확한 아웃라인이 표시되도록 개선했습니다.

[기대 효과]
- 이제 마우스 클릭 시에는 다른 UI 요소와 일관된 디자인을 유지합니다.
- 키보드 사용자의 접근성은 그대로 보장하여 사용성을 해치지 않습니다.
- '새 태그 추가'와 '태그 수정' 모달 양쪽 모두에 동일한 스타일을 적용하여 일관성을 확보했습니다.


b1c6664
ahnbu
Wed Oct 15 15:07:20 2025 +0900
docs: 프로젝트 문서 대규모 업데이트 및 동기화
프로젝트의 빠른 개발 속도에 맞춰 한동안 업데이트되지 않았던 핵심 문서(`README.md`, `DEVELOPMENT.md`, `changelog.md`)를 현재 시점의 구현 내용과 완벽하게 동기화했습니다.

이번 업데이트를 통해 신규 참여자의 온보딩 비용을 줄이고, 프로젝트의 기술적 성과와 발전 과정을 명확하게 파악할 수 있도록 문서 품질을 대폭 향상시켰습니다.

주요 변경 사항:

1.  **README.md (사용자 중심 문서) 전면 개정:**
    -   최근 추가된 핵심 기능(커스텀 태그, 즐겨찾기, 페이지네이션, 관리자 기능 등)을 모두 반영하여 "주요 기능" 섹션을 최신화했습니다.
    -   "최신 기술적 개선사항" 섹션을 추가하여 커스텀 검색어, URL 중앙화, 상세 모달 데이터 동기화 등 주목할 만한 개선점을 요약했습니다.
    -   기술 스택에 Vercel, Cloudflare Workers, Supabase Edge Functions를 명시하여 현재 아키텍처를 정확히 반영했습니다.

2.  **DEVELOPMENT.md (개발자 중심 문서) 정밀 수정:**
    -   **API 명세 현대화**: Cloudflare Workers API의 요청/응답 본문 구조를 실제 응답 사례를 기반으로 정확하게 수정했습니다.
    -   **핵심 로직 문서화**: 여러 컴포넌트에 흩어져 있던 과거의 URL 생성 로직 설명을 폐기하고, 현재의 중앙화된 `createLibraryOpenURL` 함수 기반으로 "도서관별 검색어 처리 시스템" 섹션을 전면 재작성하여 코드와의 정합성을 100% 맞췄습니다.
    -   Mermaid 다이어그램을 수정하여 Vercel/Supabase Functions를 포함한 최신 시스템 아키텍처를 시각화했습니다.

3.  **changelog.md (프로젝트 이력) 재구성:**
    -   기존의 부정확한 날짜 정보를 모두 폐기하고, 전체 커밋 히스토리를 분석하여 실제 커밋 날짜를 기반으로 변경 내역을 재구성했습니다.
    -   관련 커밋들을 의미 있는 버전 단위로 그룹화하고, `Feature`, `Fix`, `Refactor` 등으로 체계적으로 분류하여 가독성과 추적 용이성을 높였습니다.
    -   프로젝트 초기부터 현재까지의 전체 발전 과정을 담은 단일하고 신뢰성 있는 변경 이력 문서를 완성했습니다.


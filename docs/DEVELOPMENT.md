# ê°œë°œ ê°€ì´ë“œ (Development Guide)

ë§ˆì´ë¶ìŠ¤í…Œì´ì…˜ í”„ë¡œì íŠ¸ì˜ ê°œë°œìë¥¼ ìœ„í•œ ê¸°ìˆ  ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”
```mermaid
graph TD
    subgraph "User Interface (React + Vite)"
        A[React Components] --> B[Zustand Stores]
        B --> C[Service Layer]
    end

    subgraph "Backend Services"
        F[Supabase]
        G[Cloudflare Workers]
        H[Vercel Serverless]
        I[Supabase Edge Functions]
    end

    subgraph "External APIs"
        D[Aladin API]
        E[Library Crawling Targets]
    end

    C -- "DB/Auth/Realtime" --> F
    C -- "Stock Check API" --> G
    C -- "Aladin Proxy" --> H
    C -- "Feedback" --> I

    H -- "REST API" --> D
    G -- "HTML Crawling" --> E
```

### í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜
- **ì»´í¬ë„ŒíŠ¸**: UIë¥¼ êµ¬ì„±í•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¸”ë¡ (`/components`)
- **ìƒíƒœ ê´€ë¦¬ (Zustand)**: ì „ì—­ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” í›… ê¸°ë°˜ ìŠ¤í† ì–´ (`/stores`)
  - `useAuthStore`: ì‚¬ìš©ì ì¸ì¦ ë° ì„¸ì…˜ ê´€ë¦¬
  - `useUIStore`: ëª¨ë‹¬, ì•Œë¦¼ ë“± UI ìƒíƒœ ê´€ë¦¬
  - `useBookStore`: ë„ì„œ ë°ì´í„°, ë‚´ ì„œì¬, API ì—°ë™ ë“± í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
  - `useSettingsStore`: ì‚¬ìš©ì ë§ì¶¤ ì„¤ì • ê´€ë¦¬
- **ì„œë¹„ìŠ¤ ê³„ì¸µ**: ì™¸ë¶€ APIì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” ëª¨ë“ˆ (`/services`)
  - `aladin.service.ts`: Vercel í”„ë¡ì‹œë¥¼ í†µí•´ ì•Œë¼ë”˜ API í˜¸ì¶œ
  - `unifiedLibrary.service.ts`: Cloudflare Workerë¡œ í†µí•©ëœ ë„ì„œê´€ ì¬ê³  API í˜¸ì¶œ, ë„ì„œê´€ ë§í¬ ìƒì„± ë‹´ë‹¹
  - `feedback.service.ts`: Supabase Edge Functionìœ¼ë¡œ í”¼ë“œë°± ì „ì†¡

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
my_bookstation/
â”œâ”€â”€ api/                     # Vercel Serverless Functions (Aladin í”„ë¡ì‹œ)
â”‚   â””â”€â”€ search.ts
â”œâ”€â”€ components/              # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ layout/              # Header, Footer ë“± ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ AdminPanel.tsx       # ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥ ëª¨ë‹¬
â”‚   â”œâ”€â”€ BookSearchListModal.tsx # ë„ì„œ ê²€ìƒ‰ ê²°ê³¼ ëª¨ë‹¬
â”‚   â”œâ”€â”€ MyLibrary.tsx        # ê°œì¸ ì„œì¬ (í•µì‹¬ ê¸°ëŠ¥)
â”‚   â”œâ”€â”€ MyLibraryBookDetailModal.tsx # ë‚´ ì„œì¬ ìƒì„¸ ì •ë³´ ëª¨ë‹¬
â”‚   â””â”€â”€ ... (ê¸°íƒ€ UI ì»´í¬ë„ŒíŠ¸)
â”œâ”€â”€ library-checker/         # Cloudflare Workers (ì¬ê³  í™•ì¸ API)
â”‚   â””â”€â”€ src/index.js
â”œâ”€â”€ services/                # API ì„œë¹„ìŠ¤ ê³„ì¸µ
â”‚   â”œâ”€â”€ aladin.service.ts
â”‚   â””â”€â”€ unifiedLibrary.service.ts
â”œâ”€â”€ stores/                  # Zustand ìƒíƒœ ê´€ë¦¬ ìŠ¤í† ì–´
â”‚   â”œâ”€â”€ useAuthStore.ts
â”‚   â”œâ”€â”€ useBookStore.ts
â”‚   â”œâ”€â”€ useSettingsStore.ts
â”‚   â””â”€â”€ useUIStore.ts
â”œâ”€â”€ supabase/                # Supabase ì„¤ì • ë° Functions
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ send-feedback-email/ # í”¼ë“œë°± ì²˜ë¦¬ Edge Function
â”œâ”€â”€ utils/                   # ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”œâ”€â”€ adminCheck.ts        # ê´€ë¦¬ì ì´ë©”ì¼ í™•ì¸
â”‚   â”œâ”€â”€ isbnMatcher.ts       # ISBN ê¸°ë°˜ ë„ì„œ ë§¤ì¹­
â”‚   â””â”€â”€ ...
â”œâ”€â”€ App.tsx                  # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ types.ts                 # ì „ì—­ TypeScript íƒ€ì… ì •ì˜
â””â”€â”€ ... (ì„¤ì • íŒŒì¼)
```

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸

- **React 19 & TypeScript**: ìµœì‹  React ê¸°ëŠ¥ í™œìš© ë° ì •ì  íƒ€ì… ì²´í‚¹
- **Zustand**: ê²½ëŸ‰í™”ëœ ì „ì—­ ìƒíƒœ ê´€ë¦¬
- **Supabase**: PostgreSQL ë°ì´í„°ë² ì´ìŠ¤, ì¸ì¦, Row Level Security(RLS)
- **Cloudflare Workers**: ë„ì„œê´€ ì¬ê³  í¬ë¡¤ë§ ë° í‚¤ì›Œë“œ í†µí•© ê²€ìƒ‰ API ì„œë²„
- **Vercel Serverless Functions**: Aladin API í‚¤ ë³´í˜¸ë¥¼ ìœ„í•œ í”„ë¡ì‹œ ì„œë²„
- **Supabase Edge Functions**: ë³´ì•ˆì´ í•„ìš”í•œ ì„œë²„ ì‚¬ì´ë“œ ë¡œì§ (í”¼ë“œë°± ì´ë©”ì¼ ì „ì†¡)
- **Tailwind CSS**: ìœ í‹¸ë¦¬í‹° ìš°ì„  CSS í”„ë ˆì„ì›Œí¬
- **Zod**: ëŸ°íƒ€ì„ ë°ì´í„° ê²€ì¦

## ğŸš€ ê°œë°œ í™˜ê²½ ì„¤ì •

### ë¡œì»¬ ê°œë°œ ì„¤ì •
1.  **ì €ì¥ì†Œ í´ë¡  ë° ì˜ì¡´ì„± ì„¤ì¹˜**
    ```bash
    git clone <repository-url>
    cd my_bookstation
    npm install
    ```
2.  **í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (`.env.local` íŒŒì¼ ìƒì„± - Git ì œì™¸)
    ```env
    VITE_SUPABASE_URL=your_supabase_url
    VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
    VITE_ALADIN_TTB_KEY=your_aladin_ttb_key
    ```
3.  **Cloudflare Workers ë¡œì»¬ ì‹¤í–‰** (ë³„ë„ í„°ë¯¸ë„)
    ```bash
    cd library-checker
    npm install
    npm run dev
    ```
    - WorkerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `http://127.0.0.1:8787`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
4.  **í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„ ì‹¤í–‰**
    ```bash
    npm run dev
    ```

## ğŸ“Š API ëª…ì„¸

### 1. Aladin API í”„ë¡ì‹œ (Vercel Serverless)
- **ì—”ë“œí¬ì¸íŠ¸**: `/api/search`
- **ì—­í• **: í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ê²€ìƒ‰ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì¸¡ì—ì„œ Aladin APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ TTB Keyë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 2. í†µí•© ë„ì„œê´€ ì¬ê³  API (Cloudflare Workers)
- **ì—”ë“œí¬ì¸íŠ¸**:
  - ë¡œì»¬: `http://127.0.0.1:8787`
  - í”„ë¡œë•ì…˜: `https://library-checker.byungwook-an.workers.dev`
- **ë©”ì„œë“œ**: `POST`
- **ìš”ì²­ ë³¸ë¬¸**:
  ```json
  {
    "isbn": "9791165211387",      // ì¢…ì´ì±… ê²€ìƒ‰ìš© ISBN
    "eduTitle": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€", // ê²½ê¸°ë„ êµìœ¡ì²­ ë„ì„œê´€ ê²€ìƒ‰ìš© ì œëª©
    "gyeonggiTitle": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€", // ê²½ê¸°ë„ ì „ìë„ì„œê´€ ê²€ìƒ‰ìš© ì œëª©
    "siripTitle": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€",    // ê´‘ì£¼ ì‹œë¦½ ì „ìë„ì„œê´€ ê²€ìƒ‰ìš© ì œëª©
    "customTitle": "ì‚¬ìš©ì ì§€ì • ê²€ìƒ‰ì–´" // (Optional) ì§€ì • ì‹œ ìœ„ 3ê°œ title ëŒ€ì‹  ì‚¬ìš©
  }
  ```
- **ì‘ë‹µ ë³¸ë¬¸ (ì˜ˆì‹œ)**:
  ```json
  {
    "title": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€", // ìš”ì²­ ì‹œ ì‚¬ìš©ëœ ìµœì¢… ê²€ìƒ‰ì–´
    "isbn": "9791165211387",
    "gwangju_paper": {
      "book_title": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€ ë‹¨ìˆœí•˜ê²Œ ë§í•©ë‹ˆë‹¤",
      "availability": [
        {
          "ì†Œì¥ë„ì„œê´€": "í‡´ì´Œë„ì„œê´€",
          "ì²­êµ¬ê¸°í˜¸": "325.26-ë°•55ì¼",
          "ëŒ€ì¶œìƒíƒœ": "ëŒ€ì¶œê°€ëŠ¥",
          "ë°˜ë‚©ì˜ˆì •ì¼": "-"
        },
        ...
      ]
    },
    "gyeonggi_ebook_education": [
      {
        "ì†Œì¥ë„ì„œê´€": "ì„±ë‚¨ë„ì„œê´€",
        "ë„ì„œëª…": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€ ì•Œê¸° ì‰½ê²Œ ë§í•œë‹¤",
        "ëŒ€ì¶œìƒíƒœ": "ëŒ€ì¶œê°€ëŠ¥",
        ...
      },
      ...
    ],
    "gyeonggi_ebook_library": {
      "library_name": "ê²½ê¸°ë„ ì „ìë„ì„œê´€",
      "total_count": 4,
      "available_count": 4,
      "owned_count": 2,
      "subscription_count": 2,
      "books": [
        {
          "title": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€ ì•Œê¸° ì‰½ê²Œ ë§í•œë‹¤",
          "type": "ì†Œì¥í˜•",
          "isLoanable": true,
          ...
        },
        ...
      ]
    },
    "sirip_ebook": {
      "ì‹œë¦½ë„ì„œê´€_í†µí•©_ê²°ê³¼": {
        "library_name": "ê´‘ì£¼ì‹œë¦½ì¤‘ì•™ë„ì„œê´€-í†µí•©",
        "total_count": 1,
        "available_count": 1,
        ...
      },
      "details": {
        "owned": { "total_count": 0, "books": [] },
        "subscription": {
          "total_count": 1,
          "books": [
            {
              "type": "êµ¬ë…í˜•",
              "title": "ì¼ ì˜í•˜ëŠ” ì‚¬ëŒì€ ë…¼ì–´ì—ì„œ ë°°ìš´ë‹¤",
              "isAvailable": true,
              ...
            }
          ]
        }
      }
    }
  }
  ```

### 3. í‚¤ì›Œë“œ í†µí•© ê²€ìƒ‰ API (Cloudflare Workers)
- **ì—”ë“œí¬ì¸íŠ¸**: `/keyword-search`
- **ë©”ì„œë“œ**: `POST`
- **ìš”ì²­ ë³¸ë¬¸**: `{ "keyword": "ê²€ìƒ‰ì–´" }`
- **ì‘ë‹µ ë³¸ë¬¸**: ì—°ê²°ëœ ëª¨ë“  ë„ì„œê´€ì˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì •ê·œí™”í•œ í‰íƒ„í™”ëœ ë°°ì—´
  ```json
  [
    {
      "type": "ì¢…ì´ì±…",
      "libraryName": "í‡´ì´Œ",
      "title": "ë„ì„œ ì œëª©",
      "author": "ì €ì",
      "publisher": "ì¶œíŒì‚¬",
      "pubDate": "2024",
      "isAvailable": true
    },
    {
      "type": "ì „ìì±…",
      "libraryName": "eê²½ê¸°",
      ...
    },
    ...
  ]
  ```

### 4. ì‚¬ìš©ì í”¼ë“œë°± API (Supabase Edge Function)
- **ì—”ë“œí¬ì¸íŠ¸**: `https://<project>.supabase.co/functions/v1/send-feedback-email`
- **ë©”ì„œë“œ**: `POST`
- **ì¸ì¦**: `Authorization: Bearer <User JWT>` (Supabase Auth)

---

## ğŸ“š ë„ì„œê´€ë³„ ê²€ìƒ‰ì–´ ë° URL ìƒì„± ì‹œìŠ¤í…œ (ì¤‘ì•™í™” ê´€ë¦¬)

**`services/unifiedLibrary.service.ts`** íŒŒì¼ì˜ **`createLibraryOpenURL`** í•¨ìˆ˜ë¥¼ í†µí•´ ëª¨ë“  ë„ì„œê´€ ì™¸ë¶€ ë§í¬ ìƒì„±ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” ì½”ë“œì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

### ê²€ìƒ‰ì–´ ì²˜ë¦¬ ë¡œì§ ìš°ì„ ìˆœìœ„
1.  **ì»¤ìŠ¤í…€ ê²€ìƒ‰ì–´**: ì‚¬ìš©ìê°€ ì±…ë³„ë¡œ ì§€ì •í•œ `customSearchTitle`ì´ ìˆìœ¼ë©´ ìµœìš°ì„ ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
2.  **ìë™ ìƒì„± ê²€ìƒ‰ì–´**: ì»¤ìŠ¤í…€ ê²€ìƒ‰ì–´ê°€ ì—†ëŠ” ê²½ìš°, `createOptimalSearchTitle(title)` í•¨ìˆ˜ë¥¼ í†µí•´ ì›ë³¸ ì œëª©ì„ ê°€ê³µí•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - **`createOptimalSearchTitle`**: ì œëª©ì—ì„œ ì½œë¡ (`:`), í•˜ì´í”ˆ(`-`), ê´„í˜¸(`()[]_{}`) ë“± ë¶€ì œë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŠ¹ìˆ˜ë¬¸ì ì´í›„ì˜ ë‚´ìš©ì„ ì œê±°í•˜ê³ , ì• 3ë‹¨ì–´ë§Œ ì¶”ì¶œí•˜ì—¬ ê²€ìƒ‰ ì •í™•ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.

### URL ìƒì„± ê·œì¹™ (`createLibraryOpenURL`)

| LibraryName (`libraryName`) | ë„ì„œê´€ | ìƒì„± URL íŒ¨í„´ (GET ë°©ì‹) | ë¹„ê³  |
| :--- | :--- | :--- | :--- |
| `í‡´ì´Œ` | ê´‘ì£¼ í‡´ì´Œë„ì„œê´€ (ì¢…ì´ì±…) | `.../resultList.do?searchLibraryArr=MN&searchKeyword={ê²€ìƒ‰ì–´}` | ì›¹ ë°©í™”ë²½ ìš°íšŒë¥¼ ìœ„í•´ ìƒì„¸í˜ì´ì§€ ëŒ€ì‹  ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ ì‚¬ìš© |
| `ê¸°íƒ€` | ê´‘ì£¼ ê¸°íƒ€ ì‹œë¦½ë„ì„œê´€ (ì¢…ì´ì±…)| `.../resultList.do?searchLibrary=ALL&searchKeyword={ê²€ìƒ‰ì–´}` | |
| `eêµìœ¡` | ê²½ê¸°ë„ êµìœ¡ì²­ ì „ìë„ì„œê´€ | `.../search/index.do?search_text={ê²€ìƒ‰ì–´}` | |
| `eì‹œë¦½êµ¬ë…`| ê´‘ì£¼ ì‹œë¦½ êµ¬ë…í˜• ì „ìì±… | `.../search/searchList.ink?schTxt={ê²€ìƒ‰ì–´}` | êµë³´ë¬¸ê³  í”Œë«í¼ |
| `eì‹œë¦½ì†Œì¥`| ê´‘ì£¼ ì‹œë¦½ ì†Œì¥í˜• ì „ìì±… | `.../search/searchList.ink?schTxt={ê²€ìƒ‰ì–´}` | ì˜ˆìŠ¤24 í”Œë«í¼ |
| `eê²½ê¸°` | ê²½ê¸°ë„ ì „ìë„ì„œê´€ | `.../search?keyword={ê²€ìƒ‰ì–´}` | ì†Œì¥í˜•/êµ¬ë…í˜• í†µí•© ê²€ìƒ‰ í˜ì´ì§€ |

**í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì‚¬ìš© ì˜ˆì‹œ:**
```typescript
import { createLibraryOpenURL } from '../services/unifiedLibrary.service';

// ... ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€
const searchUrl = createLibraryOpenURL("eê²½ê¸°", book.title, book.customSearchTitle);
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ê²½ê¸°ë„ ê´‘ì£¼ì‹œ í‡´ì´Œë„ì„œê´€ ìƒì„¸í˜ì´ì§€ ì›¹ ë°©í™”ë²½ ì°¨ë‹¨
- **ì¦ìƒ**: í¬ë¡¤ë§ ë°ì´í„°ì— í¬í•¨ëœ ìƒì„¸í˜ì´ì§€ URL(`resourcedetail/detail.do?...`)ë¡œ ì§ì ‘ ì ‘ê·¼ ì‹œ "Web firewall security policies have been blocked" ì—ëŸ¬ í˜ì´ì§€ê°€ í‘œì‹œë¨.
- **ì›ì¸**: ë„ì„œê´€ ì‹œìŠ¤í…œì˜ ë³´ì•ˆ ì •ì±… ê°•í™”ë¡œ ì™¸ë¶€ì—ì„œì˜ ìƒì„¸í˜ì´ì§€ ì§ì ‘ ë§í¬ê°€ ì°¨ë‹¨ë¨.
- **í•´ê²°**: `createLibraryOpenURL` í•¨ìˆ˜ì—ì„œ 'í‡´ì´Œ' ì¼€ì´ìŠ¤ ì²˜ë¦¬ ì‹œ, ìƒì„¸í˜ì´ì§€ URL ëŒ€ì‹  **ì œëª© ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ URL**ì„ ìƒì„±í•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì—ì„œ í•´ë‹¹ ë„ì„œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### API ìš”ì²­ íƒ€ì„ì•„ì›ƒ (ì „ì²´ ì‘ë‹µ ì§€ì—°)
- **ì¦ìƒ**: í•˜ë‚˜ì˜ ë„ì„œê´€ ì„œë²„ ì‘ë‹µì´ ì§€ì—°ë˜ë©´ ì „ì²´ ì¬ê³  ì¡°íšŒ(`Promise.allSettled`)ê°€ ëŠ¦ì–´ì§.
- **í•´ê²°**: Cloudflare Worker(`library-checker/src/index.js`)ì—ì„œ ê° ë„ì„œê´€ `fetch` ìš”ì²­ì— `AbortSignal.timeout(15000)` (15ì´ˆ)ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. íŠ¹ì • ì„œë²„ê°€ 15ì´ˆ ë‚´ì— ì‘ë‹µí•˜ì§€ ì•Šìœ¼ë©´ í•´ë‹¹ ìš”ì²­ë§Œ ì‹¤íŒ¨ ì²˜ë¦¬í•˜ê³  ë‚˜ë¨¸ì§€ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

### ê²½ê¸°ë„ ì „ìë„ì„œê´€ ê²€ìƒ‰ ê²°ê³¼ 0ê±´ (íŠ¹ìˆ˜ë¬¸ì ë¬¸ì œ)
- **ì¦ìƒ**: ì±… ì œëª©ì— íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ê²½ìš° ê²€ìƒ‰ ê²°ê³¼ê°€ 0ê±´ìœ¼ë¡œ ë‚˜ì˜´.
- **í•´ê²°**: API í˜¸ì¶œ ë°©ì‹ì„ ë³µì¡í•œ `detailQuery` íŒŒë¼ë¯¸í„° ëŒ€ì‹ , ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ê²€ìƒ‰ì°½ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ëŠ” `keyword` íŒŒë¼ë¯¸í„° ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê²€ìƒ‰ ì •í™•ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤.

### ì´ˆê¸° ë¡œë”©ëœ ë°ì´í„°ì—ë§Œ ê¸°ëŠ¥ì´ ì‘ë™í•˜ëŠ” ê²½ìš°

**ì¦ìƒ:**
-   'ë‚´ ì„œì¬' ê²€ìƒ‰ ë˜ëŠ” íƒœê·¸ í•„í„°ë§ í›„ ë‚˜íƒ€ë‚œ ì±…ì— ëŒ€í•´ íŠ¹ì • ê¸°ëŠ¥(ì˜ˆ: ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°, ì¬ê³  ìƒˆë¡œê³ ì¹¨, íƒœê·¸/ë©”ëª¨ CRUD)ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.
-   ë°˜ë©´, í˜ì´ì§€ë¥¼ ì²˜ìŒ ë¡œë“œí–ˆì„ ë•Œ ë³´ì´ëŠ” ì±…ë“¤(ì˜ˆ: 25/50ê¶Œ)ì— ëŒ€í•´ì„œëŠ” ë™ì¼í•œ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•œë‹¤.
-   React ê°œë°œì ë„êµ¬ì—ì„œëŠ” ìƒíƒœ ë³€ê²½ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, UIì—ëŠ” ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ë‹¤.

**ì›ì¸ ë¶„ì„: ì œí•œëœ ë°ì´í„° ì†ŒìŠ¤ ì°¸ì¡° (The "Wrong Drawer" Problem)**

ì´ ë¬¸ì œëŠ” ëŒ€ë¶€ë¶„ì˜ ê²½ìš° í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” ì„±ëŠ¥ì„ ìœ„í•´ ì´ˆê¸°ì—ëŠ” ì¼ë¶€ ë°ì´í„°(`myLibraryBooks`)ë§Œ ë¡œë“œí•˜ê³ , ê²€ìƒ‰/í•„í„° ì‹œì—ëŠ” ë³„ë„ì˜ ìƒíƒœ(`librarySearchResults`, `libraryTagFilterResults`)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë¬¸ì œëŠ” íŠ¹ì • ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜(ì˜ˆ: `updateBookInStoreAndDB`, `refreshAllBookInfo`)ê°€ ì—…ë°ì´íŠ¸í•  ëŒ€ìƒ ê°ì²´ë¥¼ ì°¾ì„ ë•Œ, **ì˜¤ì§ `myLibraryBooks`ë¼ëŠ” í•˜ë‚˜ì˜ "ì„œë"ì—ì„œë§Œ** ê°ì²´ë¥¼ ì°¾ìœ¼ë ¤ê³  ì‹œë„í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•©ë‹ˆë‹¤. ë§Œì•½ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ì„œë(`librarySearchResults`)ì— ìˆëŠ” ê°ì²´ì— ëŒ€í•´ ì‘ì—…ì„ ìš”ì²­í•˜ë©´, í•¨ìˆ˜ëŠ” ëŒ€ìƒì„ ì°¾ì§€ ëª»í•˜ê³  ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šê±°ë‚˜ ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

**ì§„ë‹¨ ì›Œí¬í”Œë¡œìš°:**

1.  **ê¸°ëŠ¥ í™•ì¸**: ì‘ë™í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥(ì˜ˆ: `addTagToBook`)ì´ ì˜ì¡´í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜(ì˜ˆ: `updateBookInStoreAndDB`)ë¥¼ `useBookStore.ts`ì—ì„œ ì°¾ìŠµë‹ˆë‹¤.
2.  **ë°ì´í„° ì†ŒìŠ¤ ì¶”ì **: í•´ë‹¹ í•¨ìˆ˜ê°€ ì—…ë°ì´íŠ¸í•  ì›ë³¸ ê°ì²´(`originalBook`)ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì€ ì½”ë“œê°€ ìˆë‹¤ë©´ ì˜ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id); // << ë¬¸ì œì˜ ì½”ë“œ
    ```
3.  **ì¬í˜„**: 'ë‚´ ì„œì¬'ì—ì„œ 'ì „ì²´ ë³´ê¸°'ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ìƒíƒœë¡œ, ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ ë³´ì´ì§€ ì•ŠëŠ” ì±…ì˜ ì œëª©ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤. ê²€ìƒ‰ ê²°ê³¼ë¡œ ë‚˜ì˜¨ ì±…ì— ëŒ€í•´ í•´ë‹¹ ê¸°ëŠ¥ì„ ì‹¤í–‰í–ˆì„ ë•Œ ë¬¸ì œê°€ ì¬í˜„ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

**í•´ê²° ë°©ì•ˆ: ì¤‘ì•™í™”ëœ ë°ì´í„° ì¡°íšŒ í•¨ìˆ˜ ì‚¬ìš©**

ì´ ë¬¸ì œë¥¼ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ë ¤ë©´, ê°ì²´ë¥¼ ì°¾ì„ ë•Œ ëª¨ë“  ì ì¬ì ì¸ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘ì•™í™”ëœ ì¡°íšŒ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

1.  **`getBookById` í•¨ìˆ˜ í™œìš©**:
    `useBookStore.ts`ì— ì´ë¯¸ `getBookById` í•¨ìˆ˜ê°€ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” `myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`ë¥¼ ëª¨ë‘ ê²€ìƒ‰í•˜ê³ , ê·¸ë˜ë„ ì—†ìœ¼ë©´ DBì— ì§ì ‘ ìš”ì²­í•˜ëŠ” ê°€ì¥ ê²¬ê³ í•œ ë°©ë²•ì…ë‹ˆë‹¤.

2.  **ê¸°ì¡´ ì½”ë“œ ìˆ˜ì •**:
    ë¬¸ì œê°€ ë˜ëŠ” í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `myLibraryBooks.find(...)`ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ , `getBookById`ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

    **ìˆ˜ì • ì „:**
    ```typescript
    const { myLibraryBooks } = get();
    const originalBook = myLibraryBooks.find(b => b.id === id);
    if (!originalBook) return;
    // ...
    ```

    **ìˆ˜ì • í›„:**
    ```typescript
    const { getBookById } = get();
    const originalBook = await getBookById(id);
    if (!originalBook) return;
    // ...
    ```

3.  **UI ìƒíƒœ ë™ì‹œ ì—…ë°ì´íŠ¸**:
    ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜(`updateBookInStoreAndDB`, `refreshAllBookInfo`)ëŠ” `setState`ë¥¼ í˜¸ì¶œí•  ë•Œ **ëª¨ë“  ê´€ë ¨ ìƒíƒœ ë°°ì—´**(`myLibraryBooks`, `librarySearchResults`, `libraryTagFilterResults`)ì„ ë™ì‹œì— ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì–´ë–¤ ë·°(ê¸°ë³¸, ê²€ìƒ‰, í•„í„°)ì— ìˆë”ë¼ë„ UIê°€ ì¼ê´€ë˜ê²Œ ë³€ê²½ë©ë‹ˆë‹¤.

    ```typescript
    // ì¢‹ì€ ì˜ˆì‹œ
    useBookStore.setState(state => ({
      myLibraryBooks: state.myLibraryBooks.map(b => (b.id === id ? updatedBook : b)),
      librarySearchResults: state.librarySearchResults.map(b => (b.id === id ? updatedBook : b)),
      libraryTagFilterResults: state.libraryTagFilterResults.map(b => (b.id === id ? updatedBook : b)),
    }));
    ```

**í•µì‹¬ ì›ì¹™**: ì‚¬ìš©ì ì¸í„°ë™ì…˜ì˜ ëŒ€ìƒì´ ë˜ëŠ” ê°ì²´ë¥¼ ì°¾ê±°ë‚˜ ìˆ˜ì •í•  ë•ŒëŠ”, í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ë°ì´í„°ì˜ ì¶œì²˜(`myLibraryBooks`, `librarySearchResults` ë“±)ì™€ ê´€ê³„ì—†ì´, **ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ë¥¼ í¬ê´„í•˜ëŠ” ë‹¨ì¼ í†µë¡œ(`getBookById`)**ë¥¼ í†µí•´ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤.

---
**ë¬¸ì„œ ìµœì¢… ìˆ˜ì •ì¼**: 2025-10-15
```